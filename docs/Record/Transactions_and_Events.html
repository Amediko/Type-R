<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Transactions and Events - Type-R</title>
    <meta name="description" content="Universal state management framework" />
    <meta name="author" content="Vlad Balin">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-navy.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme-navy.min.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
<header class="Navbar hidden-print">
    <a class="Navbar__brand" href="../index.html">Type-R</a>

    <div class="Search">
        <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451"><path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/></svg>
        <input type="search" id="tipue_search_input" class="Search__field" placeholder="Search..." autocomplete="on" results=25 autosave=text_search>
    </div>
</header>
<div class="Columns content">
    <aside class="Columns__left Collapsible">
        <div class="Collapsible__container">
            <button type="button" class="Button Collapsible__trigger">
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
            </button>
        </div>

        <div class="Collapsible__content">
            <!-- Navigation -->
            <ul class='Nav'><li class='Nav__item '><a href="../Getting_Started.html">Getting Started</a></li><li class='Nav__item '><a href="../Overview.html">Overview</a></li><li class='Nav__item Nav__item--open has-children'><a href="../Record/Overview.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Record</a><ul class='Nav'><li class='Nav__item '><a href="../Record/Overview.html">Overview</a></li><li class='Nav__item '><a href="../Record/Record_basics.html">Record basics</a></li><li class='Nav__item '><a href="../Record/Aggregation_tree.html">Aggregation tree</a></li><li class='Nav__item Nav__item--active'><a href="../Record/Transactions_and_Events.html">Transactions and Events</a></li><li class='Nav__item '><a href="../Record/Validation.html">Validation</a></li><li class='Nav__item '><a href="../Record/Serialization.html">Serialization</a></li><li class='Nav__item '><a href="../Record/id_ and_id-references.html">id  and id-references</a></li></ul></li></ul>

            <div class="Links">
                                    <hr/>
                                            <a href="https://github.com/Volicon/React-MVx/issues" target="_blank">Help/Support/Bugs</a>
                        <br />
                                            <a href="http://volicon.com" target="_blank">Made by Volicon (a Verizon company)</a>
                        <br />
                                    
                                    <div class="CodeToggler">
                        <hr/>
                                                    <a class="CodeToggler__button CodeToggler__button--main" href="#">Show Code Blocks Inline</a><br>
                                            </div>
                
                                    <hr/>
                    <div class="Twitter">
                                                    <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=gaperton&amp;show_count=false"></iframe>
                            <br />
                            <br />
                                            </div>
                            </div>
        </div>
    </aside>
    <div class="Columns__right ">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1>Transactions and Events</h1>
                <span style="float: left; font-size: 10px; color: gray;">
            Thursday, May 18, 2017 8:21 AM        </span>
                        <span style="float: right; font-size: 10px; color: gray;">
            <a href="https://github.com/Volicon/React-MVx/blob/develop/docs/04_Record/03_Transactions_and_Events.md" target="_blank">Edit on GitHub</a>
        </span>
            </div>


    <div class="s-content">
        <h2 id="page_How+record+updates+are+processed">How record updates are processed</h2>
<p>Record changes occure in the scope of transactions. Record triggers the set of events during the transaction.
Transaction is executed in three steps.</p>
<ol>
<li>Apply all the changes to the record and nested records and collections.</li>
<li>Send <code>change:[attribute]</code> <em>(record, value, options)</em> events for each attribute which has been updated (including nested objects).</li>
<li>If any of the model's attributes have changed:
<ul>
<li>Send <code>change</code> <em>(record, options)</em> event.</li>
<li>Notify record's owner on changes.</li>
</ul>
</li>
</ol>
<p>So, the statement like <code>user.name = 'Joe'</code> will trigger two events: <code>change:attr</code> and the subsequent <code>change</code>.</p>
<p>Statement <code>user.set({ name : 'Joe', email : 'joe@mail.com' })</code> will (assuming that both attributes was changed) execute like this:</p>
<ol>
<li>New name and email values will be applied to the user.</li>
<li>
<code>change:name</code> and <code>change:user</code> events will be sent out.</li>
<li>
<code>change</code> event will be sent out.</li>
</ol>
<p>Any additional changes that may be applied to the record in <code>change:[attribute]</code> and <code>change</code> event handlers will be executed in the scope of the original transaction. It means, that:</p>
<ul>
<li>No additional <code>change</code> events will be triggered if you modify the record in <code>change:[attribute]</code> event handler (but new <code>change:[attribute]</code> events will).</li>
<li>If the record will be modified in <code>change</code> event handler, there <em>will</em> be additional <code>change</code> events. However, record's owner will be notifyed only once when the wave of events and reactions will finish its processing.</li>
</ul>
<h4 id="page_record.transaction%28+fun+%29">record.transaction( fun )</h4>
<p>Execute the sequence of updates in <code>fun</code> function in the scope of the transaction, so it will trigger the single <code>change</code> event.
Transactions are superior to <code>record.set()</code> in terms of both performance and flexibility.</p>
<pre><code class="language-javascript">some.record.transaction( record =&gt; {
    record.a = 1; // `change:a` is triggered.
    record.b = 2; // `change:b` is triggered.
}); // `change` is triggered.
</code></pre>
<h2 id="page_Listening+to+change+events">Listening to change events</h2>
<h4 id="page_attr+%3A+Type.has.watcher%28+%27methodName%27+%29"><code>attrDef</code> attr : Type.has.watcher( 'methodName' )</h4>
<h4 id="page_attr+%3A+Type.has.watcher%28+function%28+value%2C+name+%29%7B+...+%7D+%29"><code>attrDef</code> attr : Type.has.watcher( function( value, name ){ ... } )</h4>
<p>To attach some custom reaction on specific record's attribute change event, you attach the <em>watcher function</em> to this attribute.
Watcher has the signature <code>( attrValue, attrName ) =&gt; void</code> and is executed in the context of the record.</p>
<p>Watcher internally listens to <code>change:attr</code> event which is triggered during the step 2. Therefore, no additional <code>change</code> events will be triggered. In the example below, any change of the <code>name</code> attribute will result in the subsequent update of the <code>isAdmin</code> attribute, and the single<code>change</code> event is triggered.</p>
<pre><code class="language-javascript">@define class User extends Record {
    static attributes = {
        name : String.has.watcher( 'onNameChange' ),
        isAdmin : Boolean,
    }

    onNameChange(){
        // Cruel. But we need it for the purpose of the example.
        this.isAdmin = this.name.indexOf( 'Admin' ) &gt;= 0; 
    }
}
</code></pre>
<h4 id="page_Events+API">Events API</h4>
<p>TODO</p>
<h2 id="page_Class+methods">Class methods</h2>
<p>Following API might be useful in change event listeners.</p>
<h4 id="page_record.changed">record.changed</h4>
<p>The <code>changed</code> property is the internal hash containing all the attributes that have changed during its last transaction.
Please do not update <code>changed</code> directly since its state is internally maintained by <code>set()</code>.
A copy of <code>changed</code> can be acquired from <code>changedAttributes()</code>.</p>
<h4 id="page_record.changedAttributes%28+attrs%3F+%29">record.changedAttributes( attrs? )</h4>
<p>Retrieve a hash of only the record's attributes that have changed during the last transaction,
or false if there are none. Optionally, an external attributes hash can be passed in,
returning the attributes in that hash which differ from the record.
This can be used to figure out which portions of a view should be updated,
or what calls need to be made to sync the changes to the server.</p>
<h4 id="page_record.previous%28+attr+%29">record.previous( attr )</h4>
<p>During a &quot;change&quot; event, this method can be used to get the previous value of a changed attribute.</p>
<pre><code class="language-javascript">@define class Person extends Record{
    static attributes = {
        name: ''
    }
}

const bill = new Person({
  name: &quot;Bill Smith&quot;
});

bill.on(&quot;change:name&quot;, ( record, name ) =&gt; {
  alert( `Changed name from ${ bill.previous('name') } to ${ name }`);
});

bill.name = &quot;Bill Jones&quot;;
</code></pre>
<h4 id="page_record.previousAttributes%28%29">record.previousAttributes()</h4>
<p>Return a copy of the record's previous attributes. Useful for getting a diff between versions of a record, or getting back to a valid state after an error occurs.</p>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../Record/Aggregation_tree.html">Previous</a></li>            <li class=Pager--next><a href="../Record/Validation.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    
    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>

    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(function() {
                tipuesearch({
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
