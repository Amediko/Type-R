<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Updates and change events - Type-R</title>
    <meta name="description" content="Universal state management framework" />
    <meta name="author" content="Vlad Balin">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-navy.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme-navy.min.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
<header class="Navbar hidden-print">
    <a class="Navbar__brand" href="../index.html">Type-R</a>

    <div class="Search">
        <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451"><path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/></svg>
        <input type="search" id="tipue_search_input" class="Search__field" placeholder="Search..." autocomplete="on" results=25 autosave=text_search>
    </div>
</header>
<div class="Columns content">
    <aside class="Columns__left Collapsible">
        <div class="Collapsible__container">
            <button type="button" class="Button Collapsible__trigger">
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
            </button>
        </div>

        <div class="Collapsible__content">
            <!-- Navigation -->
            <ul class='Nav'><li class='Nav__item '><a href="../Getting_Started.html">Getting Started</a></li><li class='Nav__item '><a href="../Overview.html">Overview</a></li><li class='Nav__item Nav__item--open has-children'><a href="../Record/Overview.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Record</a><ul class='Nav'><li class='Nav__item '><a href="../Record/Overview.html">Overview</a></li><li class='Nav__item '><a href="../Record/Aggregation_tree.html">Aggregation tree</a></li><li class='Nav__item Nav__item--active'><a href="../Record/Updates_and_change_events.html">Updates and change events</a></li><li class='Nav__item '><a href="../Record/Validation.html">Validation</a></li><li class='Nav__item '><a href="../Record/Custom_serialization.html">Custom serialization</a></li><li class='Nav__item '><a href="../Record/id_ and_id-references.html">id  and id-references</a></li></ul></li><li class='Nav__item  has-children'><a href="../Collection/Overview.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Collection</a><ul class='Nav'><li class='Nav__item '><a href="../Collection/Overview.html">Overview</a></li><li class='Nav__item '><a href="../Collection/Proxied_array_methods.html">Proxied array methods</a></li><li class='Nav__item '><a href="../Collection/Iteration_methods.html">Iteration methods</a></li><li class='Nav__item '><a href="../Collection/Sorted_collections.html">Sorted collections</a></li><li class='Nav__item '><a href="../Collection/Serialization.html">Serialization</a></li><li class='Nav__item '><a href="../Collection/Updates_and_Events.html">Updates and Events</a></li><li class='Nav__item '><a href="../Collection/Validation.html">Validation</a></li></ul></li><li class='Nav__item  has-children'><a href="../Aggregation_tree/Overview.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Aggregation tree</a><ul class='Nav'><li class='Nav__item '><a href="../Aggregation_tree/Overview.html">Overview</a></li><li class='Nav__item '><a href="../Aggregation_tree/Serialization.html">Serialization</a></li><li class='Nav__item '><a href="../Aggregation_tree/Validation.html">Validation</a></li><li class='Nav__item '><a href="../Aggregation_tree/Shared_objects.html">Shared objects</a></li><li class='Nav__item '><a href="../Aggregation_tree/id-references.html">id-references</a></li></ul></li><li class='Nav__item '><a href="../Events.html">Events</a></li><li class='Nav__item '><a href="../Mixins.html">Mixins</a></li></ul>

            <div class="Links">
                                    <hr/>
                                            <a href="https://github.com/Volicon/React-MVx/issues" target="_blank">Help/Support/Bugs</a>
                        <br />
                                            <a href="http://volicon.com" target="_blank">Made by Volicon (a Verizon company)</a>
                        <br />
                                    
                                    <div class="CodeToggler">
                        <hr/>
                                                    <a class="CodeToggler__button CodeToggler__button--main" href="#">Show Code Blocks Inline</a><br>
                                            </div>
                
                                    <hr/>
                    <div class="Twitter">
                                                    <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=gaperton&amp;show_count=false"></iframe>
                            <br />
                            <br />
                                            </div>
                            </div>
        </div>
    </aside>
    <div class="Columns__right ">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1>Updates and change events</h1>
                        <span style="float: right; font-size: 10px; color: gray;">
            <a href="https://github.com/Volicon/React-MVx/blob/develop/docs/04_Record/03_Updates_and_change_events.md" target="_blank">Edit on GitHub</a>
        </span>
            </div>


    <div class="s-content">
        <h1 id="page_Update+record+attributes">Update record attributes</h1>
<h3 id="page_record.attrName+%3D+val">record.attrName = val</h3>
<p>Assign record attribute.</p>
<ol>
<li>Assign new attribute value.</li>
<li>If value has changed,
<ul>
<li>trigger event <code>change:attrName</code> <em>( record, value )</em>.</li>
<li>trigger event <code>change</code> <em>( record )</em>.</li>
</ul>
</li>
</ol>
<h3 id="page_record.set%28+%7B+attrName+%3A+val%2C+...+%7D%2C+options%3F+%3A+++%29">record.set( { attrName : val, ... }, options? : <code>options</code> )</h3>
<p>Bulk assign record's attributes, possibly taking options.</p>
<ol>
<li>Assign new attribut values.</li>
<li>For any changed attribute, trigger event <code>change:attrName</code> <em>( record, val, options )</em>.</li>
<li>If any attribute has changed:
<ul>
<li>trigger event <code>change</code> <em>(record, options)</em>.</li>
</ul>
</li>
</ol>
<h3 id="page_%7B+parse+%3A+true+%7D"><code>options</code> { parse : true }</h3>
<p>Transform <code>record.set</code> argument with user-defined parse logic. Typically used to process the responce from the server to make user-defined JSON format conversion.</p>
<h3 id="page_%7B+merge+%3A+true+%7D"><code>options</code> { merge : true }</h3>
<p>Merge attributes of record and collection types instead of replacement. If the new instance of record or collection is to be assigned,
update the current instances instead.</p>
<h3 id="page_record.assignFrom%28+otherRecord+%29">record.assignFrom( otherRecord )</h3>
<p>Makes an existing <code>record</code> to be the copy of <code>otherRecord</code>, recursively assigning all attributes.</p>
<p>Works similar to <code>record.set( otherRecord.attributes, { merge : true })</code>;</p>
<h1 id="page_Listening+to+events">Listening to events</h1>
<h2 id="page_Observable+changes">Observable changes</h2>
<p>Object tree formed by records and collection is deeply observable by default; changes in tree leafs triggers the changes of all parent elements in sequence.</p>
<p>Records automatically listens to change events of all nested records and collections, and triggers the corresponding change events on its attributes.</p>
<h3 id="page_attr+%3A+Type.has.changeEvents%28+false+%29"><code>attrDef</code> attr : Type.has.changeEvents( false )</h3>
<p>Do <em>not</em> listen for the inner changes of the specific <code>attr</code>.</p>
<h2 id="page_Listening+to+events+in+the+record">Listening to events in the record</h2>
<p>Record has declarative API for managing event subscriptions for its attributes.</p>
<h3 id="page_attr+%3A+Type.has.watcher%28+%27methodName%27+%29"><code>attrDef</code> attr : Type.has.watcher( 'methodName' )</h3>
<h3 id="page_attr+%3A+Type.has.watcher%28+function%28+value%2C+name+%29%7B+...+%7D+%29"><code>attrDef</code> attr : Type.has.watcher( function( value, name ){ ... } )</h3>
<p>Attach <code>change:attr</code> event listener to the particular record's attribute.</p>
<p><em>Watcher function</em> has the signature <code>( attrValue, attrName ) =&gt; void</code> and is executed in the context of the record. Note that it differs from the event signature.</p>
<pre><code class="language-javascript">@define class User extends Record {
    static attributes = {
        name : String.has.watcher( 'onNameChange' ),
        isAdmin : Boolean,
    }

    onNameChange(){
        // Cruel. But we need it for the purpose of the example.
        this.isAdmin = this.name.indexOf( 'Admin' ) &gt;= 0; 
    }
}
</code></pre>
<h3 id="page_attr+%3A+Type.has.events%28%7B+eventName+%3A+handler%2C+...+%7D%29"><code>attrDef</code> attr : Type.has.events({ eventName : handler, ... })</h3>
<p>Automatically manage custom event subscription for the attribute. <code>handler</code> is either the method name or the handler function.</p>
<h2 id="page_Events+subscription+with+Events+API">Events subscription with Events API</h2>
<p><code>listener.listenTo()</code> and <code>listener.listenToOnce()</code> methods can be used to listen to the any of the change events.</p>
<p>If listener itself is the record or collection, subscribtions will be stopped automatically. Otherwise they must be stopped
manually with <code>listener.stopListening()</code> call to prevent memory leaks.</p>
<h1 id="page_Transactions">Transactions</h1>
<p>All record updates occures in the scope of transactions. Transaction is the sequence of changes which results in a single <code>change</code> event.</p>
<p>Transaction can be opened either manually or implicitly with calling <code>set()</code> or assigning an attribute.
Any additional changes made to the record in <code>change:attr</code> event handler will be executed in the scope of the original transaction, and won't trigger additional <code>change</code> events.</p>
<h3 id="page_record.transaction%28+fun+%29">record.transaction( fun )</h3>
<p>Execute the all changes made to the record in <code>fun</code> as single transaction.</p>
<pre><code class="language-javascript">some.record.transaction( record =&gt; {
    record.a = 1; // `change:a` is triggered.
    record.b = 2; // `change:b` is triggered.
}); // `change` is triggered.
</code></pre>
<p>Manual transactions with attribute assignments are superior to <code>record.set()</code> in terms of both performance and flexibility.</p>
<h1 id="page_Change+inspection+methods">Change inspection methods</h1>
<p>Following API might be useful in change event listeners.</p>
<h3 id="page_record.changed">record.changed</h3>
<p>The <code>changed</code> property is the internal hash containing all the attributes that have changed during its last transaction.
Please do not update <code>changed</code> directly since its state is internally maintained by <code>set()</code>.
A copy of <code>changed</code> can be acquired from <code>changedAttributes()</code>.</p>
<h3 id="page_record.changedAttributes%28+attrs%3F+%29">record.changedAttributes( attrs? )</h3>
<p>Retrieve a hash of only the record's attributes that have changed during the last transaction,
or false if there are none. Optionally, an external attributes hash can be passed in,
returning the attributes in that hash which differ from the record.
This can be used to figure out which portions of a view should be updated,
or what calls need to be made to sync the changes to the server.</p>
<h3 id="page_record.previous%28+attr+%29">record.previous( attr )</h3>
<p>During a &quot;change&quot; event, this method can be used to get the previous value of a changed attribute.</p>
<pre><code class="language-javascript">@define class Person extends Record{
    static attributes = {
        name: ''
    }
}

const bill = new Person({
  name: &quot;Bill Smith&quot;
});

bill.on(&quot;change:name&quot;, ( record, name ) =&gt; {
  alert( `Changed name from ${ bill.previous('name') } to ${ name }`);
});

bill.name = &quot;Bill Jones&quot;;
</code></pre>
<h3 id="page_record.previousAttributes%28%29">record.previousAttributes()</h3>
<p>Return a copy of the record's previous attributes. Useful for getting a diff between versions of a record, or getting back to a valid state after an error occurs.</p>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../Record/Aggregation_tree.html">Previous</a></li>            <li class=Pager--next><a href="../Record/Validation.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    
    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>

    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(function() {
                tipuesearch({
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
