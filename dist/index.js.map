{"version":3,"file":"index.js","sources":["../lib/object-plus/tools.js","../lib/object-plus/mixins.js","../lib/object-plus/eventsource.js","../lib/object-plus/events.js","../lib/traversable.js","../lib/record/attributes/updates.js","../lib/record/attributes/any.js","../lib/record/attributes/attrDef.js","../lib/record/attributes/date.js","../lib/record/attributes/basic.js","../lib/record/attributes/shared.js","../lib/record/attributes/index.js","../lib/record/record.js","../lib/record/index.js","../lib/collection/commons.js","../lib/collection/add.js","../lib/collection/set.js","../lib/collection/remove.js","../lib/collection/index.js","../lib/relations/commons.js","../lib/relations/subsetOf.js","../lib/object-plus/index.js","../lib/validation.js","../lib/transactions.js","../lib/record/attributes/owned.js","../lib/relations/from.js","../lib/relations/store.js","../lib/index.js"],"sourcesContent":["var levelToNumber = {\n    none: 0, error: 1, warn: 2, info: 3, log: 4, debug: 5\n};\nexport var log = function (a_level, a_msg, a_props) {\n    var levelAsNumber = levelToNumber[a_level], msg, props, level;\n    if (levelAsNumber === void 0 && !a_props) {\n        levelAsNumber = 4;\n        msg = a_level;\n        props = a_msg;\n        level = 'log';\n    }\n    else {\n        msg = a_msg, level = a_level, props = a_props;\n    }\n    if (levelAsNumber <= log.level) {\n        if (levelAsNumber <= log.throw || !log.logger) {\n            var error = new Error(msg);\n            error.props = props;\n            throw error;\n        }\n        else {\n            log.logger(level, msg, props);\n            if (levelAsNumber <= log.stop) {\n                debugger;\n            }\n        }\n    }\n};\nlog.level = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'production' ? 1 : 2;\nlog.throw = 0;\nlog.stop = 0;\nif (typeof console !== 'undefined') {\n    log.logger = function _console(level, error, props) {\n        var args = [error];\n        for (var name_1 in props) {\n            args.push(\"\\n\\t\" + name_1 + \":\", props[name_1]);\n        }\n        console[level].apply(console, args);\n    };\n}\nexport function isValidJSON(value) {\n    if (value === null) {\n        return true;\n    }\n    switch (typeof value) {\n        case 'number':\n        case 'string':\n        case 'boolean':\n            return true;\n        case 'object':\n            var proto = Object.getPrototypeOf(value);\n            if (proto === Object.prototype || proto === Array.prototype) {\n                return every(value, isValidJSON);\n            }\n    }\n    return false;\n}\nexport function getBaseClass(Class) {\n    return Object.getPrototypeOf(Class.prototype).constructor;\n}\nexport function assignToClassProto(Class, definition) {\n    var names = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        names[_i - 2] = arguments[_i];\n    }\n    for (var _a = 0, names_1 = names; _a < names_1.length; _a++) {\n        var name_2 = names_1[_a];\n        var value = definition[name_2];\n        value === void 0 || (Class.prototype[name_2] = value);\n    }\n}\nexport function isEmpty(obj) {\n    if (obj) {\n        for (var key in obj) {\n            if (obj.hasOwnProperty(key)) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\nfunction someArray(arr, fun) {\n    var result;\n    for (var i = 0; i < arr.length; i++) {\n        if (result = fun(arr[i], i)) {\n            return result;\n        }\n    }\n}\nfunction someObject(obj, fun) {\n    var result;\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            if (result = fun(obj[key], key)) {\n                return result;\n            }\n        }\n    }\n}\nexport function some(obj, fun) {\n    if (Object.getPrototypeOf(obj) === ArrayProto) {\n        return someArray(obj, fun);\n    }\n    else {\n        return someObject(obj, fun);\n    }\n}\nexport function every(obj, predicate) {\n    return !some(obj, function (x) { return !predicate(x); });\n}\nexport function getPropertyDescriptor(obj, prop) {\n    var desc;\n    for (var proto = obj; !desc && proto; proto = Object.getPrototypeOf(proto)) {\n        desc = Object.getOwnPropertyDescriptor(proto, prop);\n    }\n    return desc;\n}\nexport function omit(source) {\n    var dest = {}, discard = {};\n    for (var i = 1; i < arguments.length; i++) {\n        discard[arguments[i]] = true;\n    }\n    for (var name in source) {\n        if (!discard.hasOwnProperty(name) && source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function transform(dest, source, fun) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            var value = fun(source[name], name);\n            value === void 0 || (dest[name] = value);\n        }\n    }\n    return dest;\n}\nexport function fastAssign(dest, source) {\n    for (var name in source) {\n        dest[name] = source[name];\n    }\n    return dest;\n}\nexport function fastDefaults(dest, source) {\n    for (var name in source) {\n        if (dest[name] === void 0) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function assign(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && assign(dest, other);\n        }\n    }\n    return dest;\n}\nexport function defaults(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name) && !dest.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && defaults(dest, other);\n        }\n    }\n    return dest;\n}\nObject.setPrototypeOf || (Object.setPrototypeOf = defaults);\nexport function keys(o) {\n    return o ? Object.keys(o) : [];\n}\nexport function once(func) {\n    var memo, first = true;\n    return function () {\n        if (first) {\n            first = false;\n            memo = func.apply(this, arguments);\n            func = null;\n        }\n        return memo;\n    };\n}\nvar ArrayProto = Array.prototype, DateProto = Date.prototype, ObjectProto = Object.prototype;\nexport function notEqual(a, b) {\n    if (a === b)\n        return false;\n    if (a && b && typeof a == 'object' && typeof b == 'object') {\n        var protoA = Object.getPrototypeOf(a);\n        if (protoA !== Object.getPrototypeOf(b))\n            return true;\n        switch (protoA) {\n            case DateProto: return +a !== +b;\n            case ArrayProto: return arraysNotEqual(a, b);\n            case ObjectProto:\n            case null:\n                return objectsNotEqual(a, b);\n        }\n    }\n    return true;\n}\nfunction objectsNotEqual(a, b) {\n    var keysA = Object.keys(a);\n    if (keysA.length !== Object.keys(b).length)\n        return true;\n    for (var i = 0; i < keysA.length; i++) {\n        var key = keysA[i];\n        if (!b.hasOwnProperty(key) || notEqual(a[key], b[key])) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction arraysNotEqual(a, b) {\n    if (a.length !== b.length)\n        return true;\n    for (var i = 0; i < a.length; i++) {\n        if (notEqual(a[i], b[i]))\n            return true;\n    }\n    return false;\n}\n//# sourceMappingURL=tools.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\n            t[p[i]] = s[p[i]];\n    return t;\n};\nimport { assign, getBaseClass, defaults, transform } from './tools';\nvar Mixable = (function () {\n    function Mixable() {\n    }\n    Mixable.define = function (protoProps, staticProps) {\n        if (protoProps === void 0) { protoProps = {}; }\n        var BaseClass = getBaseClass(this);\n        staticProps && assign(this, staticProps);\n        var mixins = protoProps.mixins, defineMixin = __rest(protoProps, [\"mixins\"]);\n        mixins && this.mixins.merge(mixins);\n        this.mixins.mergeObject(this.prototype, defineMixin, true);\n        this.mixins.mergeObject(this.prototype, this.mixins.getStaticDefinitions(BaseClass), true);\n        this.onDefine && this.onDefine(this.mixins.definitions, BaseClass);\n        this.mixins.mergeInheritedMembers(BaseClass);\n        return this;\n    };\n    Mixable.extend = function (spec, statics) {\n        var TheSubclass;\n        if (spec && spec.hasOwnProperty('constructor')) {\n            TheSubclass = spec.constructor;\n            __extends(TheSubclass, this);\n        }\n        else {\n            TheSubclass = (function (_super) {\n                __extends(Subclass, _super);\n                function Subclass() {\n                    return _super !== null && _super.apply(this, arguments) || this;\n                }\n                return Subclass;\n            }(this));\n        }\n        predefine(TheSubclass);\n        spec && TheSubclass.define(spec, statics);\n        return TheSubclass;\n    };\n    return Mixable;\n}());\nexport { Mixable };\nexport function predefine(Constructor) {\n    var BaseClass = getBaseClass(Constructor);\n    Constructor.__super__ = BaseClass.prototype;\n    Constructor.define || MixinsState.get(Mixable).populate(Constructor);\n    MixinsState.get(Constructor);\n    Constructor.onExtend && Constructor.onExtend(BaseClass);\n}\nexport function define(ClassOrDefinition) {\n    if (typeof ClassOrDefinition === 'function') {\n        predefine(ClassOrDefinition);\n        ClassOrDefinition.define();\n    }\n    else {\n        return function (Ctor) {\n            predefine(Ctor);\n            Ctor.define(ClassOrDefinition);\n        };\n    }\n}\nexport function definitions(rules) {\n    return function (Class) {\n        var mixins = MixinsState.get(Class);\n        mixins.definitionRules = defaults(rules, mixins.definitionRules);\n    };\n}\nexport function definitionDecorator(definitionKey, value) {\n    return function (proto, name) {\n        MixinsState\n            .get(proto.constructor)\n            .mergeObject(proto, (_a = {},\n            _a[definitionKey] = (_b = {},\n                _b[name] = value,\n                _b),\n            _a));\n        var _a, _b;\n    };\n}\nvar MixinsState = (function () {\n    function MixinsState(Class) {\n        this.Class = Class;\n        this.definitions = {};\n        var mixins = getBaseClass(Class).mixins;\n        this.mergeRules = (mixins && mixins.mergeRules) || {};\n        this.definitionRules = (mixins && mixins.definitionRules) || {};\n        this.appliedMixins = (mixins && mixins.appliedMixins) || [];\n    }\n    MixinsState.get = function (Class) {\n        var mixins = Class.mixins;\n        return mixins && Class === mixins.Class ? mixins :\n            Class.mixins = new MixinsState(Class);\n    };\n    MixinsState.prototype.getStaticDefinitions = function (BaseClass) {\n        var definitions = {}, Class = this.Class;\n        return transform(definitions, this.definitionRules, function (rule, name) {\n            if (BaseClass[name] !== Class[name]) {\n                return Class[name];\n            }\n        });\n    };\n    MixinsState.prototype.merge = function (mixins) {\n        var proto = this.Class.prototype, mergeRules = this.mergeRules;\n        var appliedMixins = this.appliedMixins = this.appliedMixins.slice();\n        for (var _i = 0, mixins_1 = mixins; _i < mixins_1.length; _i++) {\n            var mixin = mixins_1[_i];\n            if (Array.isArray(mixin)) {\n                this.merge(mixin);\n            }\n            else if (appliedMixins.indexOf(mixin) < 0) {\n                appliedMixins.push(mixin);\n                if (typeof mixin === 'function') {\n                    if (getBaseClass(mixin) !== Object) {\n                        console.log('Mixin error');\n                    }\n                    this.mergeObject(this.Class, mixin);\n                    var sourceMixins = mixin.mixins;\n                    if (sourceMixins) {\n                        this.mergeRules = defaults({}, this.mergeRules, sourceMixins.mergeRules);\n                        this.definitionRules = defaults({}, this.definitionRules, sourceMixins.definitionRules);\n                        this.appliedMixins = this.appliedMixins.concat(sourceMixins.appliedMixins);\n                    }\n                    this.mergeObject(proto, mixin.prototype);\n                }\n                else {\n                    this.mergeObject(proto, mixin);\n                }\n            }\n        }\n    };\n    MixinsState.prototype.populate = function () {\n        var ctors = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            ctors[_i] = arguments[_i];\n        }\n        for (var _a = 0, ctors_1 = ctors; _a < ctors_1.length; _a++) {\n            var Ctor = ctors_1[_a];\n            MixinsState.get(Ctor).merge([this.Class]);\n        }\n    };\n    MixinsState.prototype.mergeObject = function (dest, source, unshift) {\n        var _this = this;\n        forEachOwnProp(source, function (name) {\n            var sourceProp = Object.getOwnPropertyDescriptor(source, name);\n            var rule;\n            if (rule = _this.definitionRules[name]) {\n                assignProperty(_this.definitions, name, sourceProp, rule, unshift);\n            }\n            if (!rule || rule === mixinRules.protoValue) {\n                assignProperty(dest, name, sourceProp, _this.mergeRules[name], unshift);\n            }\n        });\n    };\n    MixinsState.prototype.mergeInheritedMembers = function (BaseClass) {\n        var _a = this, mergeRules = _a.mergeRules, Class = _a.Class;\n        if (mergeRules) {\n            var proto = Class.prototype, baseProto = BaseClass.prototype;\n            for (var name_1 in mergeRules) {\n                var rule = mergeRules[name_1];\n                if (proto.hasOwnProperty(name_1) && name_1 in baseProto) {\n                    proto[name_1] = resolveRule(proto[name_1], baseProto[name_1], rule);\n                }\n            }\n        }\n    };\n    return MixinsState;\n}());\nexport { MixinsState };\nvar dontMix = {\n    function: {\n        length: true,\n        prototype: true,\n        caller: true,\n        arguments: true,\n        name: true,\n        __super__: true\n    },\n    object: {\n        constructor: true\n    }\n};\nfunction forEachOwnProp(object, fun) {\n    var ignore = dontMix[typeof object];\n    for (var _i = 0, _a = Object.getOwnPropertyNames(object); _i < _a.length; _i++) {\n        var name_2 = _a[_i];\n        name_2 in ignore || fun(name_2);\n    }\n}\nexport var mixins = function () {\n    var list = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        list[_i] = arguments[_i];\n    }\n    return (function (Class) { return MixinsState.get(Class).merge(list); });\n};\nexport var mixinRules = (function (rules) { return (function (Class) {\n    var mixins = MixinsState.get(Class);\n    mixins.mergeRules = defaults(rules, mixins.mergeRules);\n}); });\nmixinRules.value = function (a, b) { return a; };\nmixinRules.protoValue = function (a, b) { return a; };\nmixinRules.merge = function (a, b) { return defaults({}, a, b); };\nmixinRules.pipe = function (a, b) { return (function (x) {\n    return a.call(this, b.call(this, x));\n}); };\nmixinRules.defaults = function (a, b) { return (function () {\n    return defaults(a.apply(this, arguments), b.apply(this, arguments));\n}); };\nmixinRules.classFirst = function (a, b) { return (function () {\n    a.apply(this, arguments);\n    b.apply(this, arguments);\n}); };\nmixinRules.classLast = function (a, b) { return (function () {\n    b.apply(this, arguments);\n    a.apply(this, arguments);\n}); };\nmixinRules.every = function (a, b) { return (function () {\n    return a.apply(this, arguments) && b.apply(this, arguments);\n}); };\nmixinRules.some = function (a, b) { return (function () {\n    return a.apply(this, arguments) || b.apply(this, arguments);\n}); };\nfunction assignProperty(dest, name, sourceProp, rule, unshift) {\n    if (dest.hasOwnProperty(name)) {\n        var destProp = Object.getOwnPropertyDescriptor(dest, name);\n        if (destProp.configurable && 'value' in destProp) {\n            dest[name] = unshift ?\n                resolveRule(sourceProp.value, destProp.value, rule) :\n                resolveRule(destProp.value, sourceProp.value, rule);\n        }\n    }\n    else {\n        Object.defineProperty(dest, name, sourceProp);\n    }\n}\nfunction resolveRule(dest, source, rule) {\n    if (dest === void 0)\n        return source;\n    if (!rule || source === void 0)\n        return dest;\n    return rule(dest, source);\n}\n//# sourceMappingURL=mixins.js.map","import { once as _once } from './tools';\nvar EventMap = (function () {\n    function EventMap(map) {\n        this.handlers = [];\n        if (map) {\n            if (map instanceof EventMap) {\n                this.handlers = map.handlers.slice();\n            }\n            else {\n                map && this.addEventsMap(map);\n            }\n        }\n    }\n    EventMap.prototype.merge = function (map) {\n        this.handlers = this.handlers.concat(map.handlers);\n    };\n    EventMap.prototype.addEventsMap = function (map) {\n        for (var names in map) {\n            this.addEvent(names, map[names]);\n        }\n    };\n    EventMap.prototype.bubbleEvents = function (names) {\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_1 = _a[_i];\n            this.addEvent(name_1, getBubblingHandler(name_1));\n        }\n    };\n    EventMap.prototype.addEvent = function (names, callback) {\n        var handlers = this.handlers;\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_2 = _a[_i];\n            handlers.push(new EventDescriptor(name_2, callback));\n        }\n    };\n    EventMap.prototype.subscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_1 = _a[_i];\n            on(source, event_1.name, event_1.callback, target);\n        }\n    };\n    EventMap.prototype.unsubscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_2 = _a[_i];\n            off(source, event_2.name, event_2.callback, target);\n        }\n    };\n    return EventMap;\n}());\nexport { EventMap };\nvar EventDescriptor = (function () {\n    function EventDescriptor(name, callback) {\n        this.name = name;\n        if (callback === true) {\n            this.callback = getBubblingHandler(name);\n        }\n        else if (typeof callback === 'string') {\n            this.callback =\n                function localCallback() {\n                    var handler = this[callback];\n                    handler && handler.apply(this, arguments);\n                };\n        }\n        else {\n            this.callback = callback;\n        }\n    }\n    return EventDescriptor;\n}());\nexport { EventDescriptor };\nvar _bubblingHandlers = {};\nfunction getBubblingHandler(event) {\n    return _bubblingHandlers[event] || (_bubblingHandlers[event] = function (a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, event, a, b, c, d, e);\n        if (c !== void 0)\n            trigger3(this, event, a, b, c);\n        else\n            trigger2(this, event, a, b);\n    });\n}\nvar EventHandler = (function () {\n    function EventHandler(callback, context, next) {\n        if (next === void 0) { next = null; }\n        this.callback = callback;\n        this.context = context;\n        this.next = next;\n    }\n    return EventHandler;\n}());\nexport { EventHandler };\nfunction listOff(_events, name, callback, context) {\n    var head = _events[name];\n    var filteredHead, prev;\n    for (var ev = head; ev; ev = ev.next) {\n        if ((callback && callback !== ev.callback && callback !== ev.callback._callback) ||\n            (context && context !== ev.context)) {\n            prev = ev;\n            filteredHead || (filteredHead = ev);\n        }\n        else {\n            if (prev)\n                prev.next = ev.next;\n        }\n    }\n    if (head !== filteredHead)\n        _events[name] = filteredHead;\n}\nfunction listSend2(head, a, b) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b);\n}\nfunction listSend3(head, a, b, c) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c);\n}\nfunction listSend4(head, a, b, c, d) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d);\n}\nfunction listSend5(head, a, b, c, d, e) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e);\n}\nfunction listSend6(head, a, b, c, d, e, f) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e, f);\n}\nexport function on(source, name, callback, context) {\n    if (callback) {\n        var _events = source._events || (source._events = Object.create(null));\n        _events[name] = new EventHandler(callback, context, _events[name]);\n    }\n}\nexport function once(source, name, callback, context) {\n    if (callback) {\n        var once_1 = _once(function () {\n            off(source, name, once_1);\n            callback.apply(this, arguments);\n        });\n        once_1._callback = callback;\n        on(source, name, once_1, context);\n    }\n}\nexport function off(source, name, callback, context) {\n    var _events = source._events;\n    if (_events) {\n        if (callback || context) {\n            if (name) {\n                listOff(_events, name, callback, context);\n            }\n            else {\n                for (var name_3 in _events) {\n                    listOff(_events, name_3, callback, context);\n                }\n            }\n        }\n        else if (name) {\n            _events[name] = void 0;\n        }\n        else {\n            source._events = void 0;\n        }\n    }\n}\nvar eventSplitter = /\\s+/;\nexport function strings(api, source, events, callback, context) {\n    if (eventSplitter.test(events)) {\n        var names = events.split(eventSplitter);\n        for (var _i = 0, names_1 = names; _i < names_1.length; _i++) {\n            var name_4 = names_1[_i];\n            api(source, name_4, callback, context);\n        }\n    }\n    else\n        api(source, events, callback, context);\n}\nexport function trigger2(self, name, a, b) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend2(queue, a, b);\n        listSend3(all, name, a, b);\n    }\n}\n;\nexport function trigger3(self, name, a, b, c) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend3(queue, a, b, c);\n        listSend4(all, name, a, b, c);\n    }\n}\n;\nexport function trigger5(self, name, a, b, c, d, e) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend5(queue, a, b, c, d, e);\n        listSend6(all, name, a, b, c, d, e);\n    }\n}\n;\n//# sourceMappingURL=eventsource.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { define, mixinRules, definitions } from './mixins';\nimport { omit, transform } from './tools';\nimport { EventMap } from './eventsource';\nimport * as _eventsApi from './eventsource';\nvar EventHandler = _eventsApi.EventHandler, strings = _eventsApi.strings, on = _eventsApi.on, off = _eventsApi.off, once = _eventsApi.once, trigger5 = _eventsApi.trigger5, trigger2 = _eventsApi.trigger2, trigger3 = _eventsApi.trigger3;\nvar eventSplitter = /\\s+/;\nvar _idCount = 0;\nfunction uniqueId() {\n    return 'l' + _idCount++;\n}\nexport { EventMap };\nvar Messenger = (function () {\n    function Messenger() {\n        this._events = void 0;\n        this._listeningTo = void 0;\n        this.cid = uniqueId();\n        this.initialize.apply(this, arguments);\n    }\n    Messenger.onDefine = function (_a, BaseClass) {\n        var localEvents = _a.localEvents, _localEvents = _a._localEvents, properties = _a.properties;\n        if (localEvents || _localEvents) {\n            var eventsMap = new EventMap(this.prototype._localEvents);\n            localEvents && eventsMap.addEventsMap(localEvents);\n            _localEvents && eventsMap.merge(_localEvents);\n            this.prototype._localEvents = eventsMap;\n        }\n        if (properties) {\n            Object.defineProperties(this.prototype, transform({}, properties, toPropertyDescriptor));\n        }\n    };\n    Messenger.prototype.initialize = function () { };\n    Messenger.prototype.on = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(on, this, events, callback, context);\n        else\n            for (var name_1 in events)\n                strings(on, this, name_1, events[name_1], context || callback);\n        return this;\n    };\n    Messenger.prototype.once = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(once, this, events, callback, context);\n        else\n            for (var name_2 in events)\n                strings(once, this, name_2, events[name_2], context || callback);\n        return this;\n    };\n    Messenger.prototype.off = function (events, callback, context) {\n        if (!events)\n            off(this, void 0, callback, context);\n        else if (typeof events === 'string')\n            strings(off, this, events, callback, context);\n        else\n            for (var name_3 in events)\n                strings(off, this, name_3, events[name_3], context || callback);\n        return this;\n    };\n    Messenger.prototype.trigger = function (name, a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, name, a, b, c, d, e);\n        else if (c !== void 0)\n            trigger3(this, name, a, b, c);\n        else\n            trigger2(this, name, a, b);\n        return this;\n    };\n    Messenger.prototype.listenTo = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.on(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.listenToOnce = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.once(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.stopListening = function (a_source, a, b) {\n        var _listeningTo = this._listeningTo;\n        if (_listeningTo) {\n            var removeAll = !(a || b), second = !b && typeof a === 'object' ? this : b;\n            if (a_source) {\n                var source = _listeningTo[a_source.cid];\n                if (source) {\n                    if (removeAll)\n                        delete _listeningTo[a_source.cid];\n                    source.off(a, second, this);\n                }\n            }\n            else if (a_source == null) {\n                for (var cid in _listeningTo)\n                    _listeningTo[cid].off(a, second, this);\n                if (removeAll)\n                    (this._listeningTo = void 0);\n            }\n        }\n        return this;\n    };\n    Messenger.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        this.stopListening();\n        this.off();\n        this._disposed = true;\n    };\n    Messenger = __decorate([\n        define,\n        definitions({\n            properties: mixinRules.merge,\n            localEvents: mixinRules.merge\n        })\n    ], Messenger);\n    return Messenger;\n}());\nexport { Messenger };\nexport var Events = omit(Messenger.prototype, 'constructor', 'initialize');\nfunction toPropertyDescriptor(x) {\n    if (x) {\n        return typeof x === 'function' ? { get: x } : x;\n    }\n}\nfunction addReference(listener, source) {\n    var listeningTo = listener._listeningTo || (listener._listeningTo = Object.create(null)), cid = source.cid || (source.cid = uniqueId());\n    listeningTo[cid] = source;\n}\n//# sourceMappingURL=events.js.map","var referenceMask = /\\^|([^.]+)/g;\nvar CompiledReference = (function () {\n    function CompiledReference(reference, splitTail) {\n        if (splitTail === void 0) { splitTail = false; }\n        var path = reference\n            .match(referenceMask)\n            .map(function (key) {\n            if (key === '^')\n                return 'getOwner()';\n            if (key[0] === '~')\n                return \"getStore().get(\\\"\" + key.substr(1) + \"\\\")\";\n            return key;\n        });\n        this.tail = splitTail && path.pop();\n        this.local = !path.length;\n        path.unshift('self');\n        this.resolve = new Function('self', \"return \" + path.join('.') + \";\");\n    }\n    return CompiledReference;\n}());\nexport { CompiledReference };\nexport function resolveReference(root, reference, action) {\n    var path = reference.match(referenceMask), skip = path.length - 1;\n    var self = root;\n    for (var i = 0; i < skip; i++) {\n        var key = path[i];\n        switch (key) {\n            case '~':\n                self = self.getStore();\n                break;\n            case '^':\n                self = self.getOwner();\n                break;\n            default: self = self.get(key);\n        }\n        if (!self)\n            return;\n    }\n    return action(self, path[skip]);\n}\n//# sourceMappingURL=traversable.js.map","import { transactionApi } from \"../../transactions\";\nvar _begin = transactionApi.begin, _markAsDirty = transactionApi.markAsDirty, commit = transactionApi.commit;\nimport { eventsApi } from '../../object-plus';\nvar trigger3 = eventsApi.trigger3;\nexport function setAttribute(record, name, value) {\n    var isRoot = begin(record), options = {};\n    if (record._attributes[name].doUpdate(value, record, options)) {\n        markAsDirty(record, options);\n        trigger3(record, 'change:' + name, record, record.attributes[name], options);\n    }\n    isRoot && commit(record);\n}\nfunction begin(record) {\n    if (_begin(record)) {\n        record._previousAttributes = new record.AttributesCopy(record.attributes);\n        record._changedAttributes = null;\n        return true;\n    }\n    return false;\n}\nfunction markAsDirty(record, options) {\n    if (record._changedAttributes) {\n        record._changedAttributes = null;\n    }\n    return _markAsDirty(record, options);\n}\nexport var UpdateRecordMixin = {\n    transaction: function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        fun.call(this, this);\n        isRoot && commit(this);\n    },\n    _onChildrenChange: function (child, options) {\n        var _ownerKey = child._ownerKey, attribute = this._attributes[_ownerKey];\n        if (!attribute || attribute.propagateChanges)\n            this.forceAttributeChange(_ownerKey, options);\n    },\n    forceAttributeChange: function (key, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger3(this, 'change:' + key, this, this.attributes[key], options);\n        }\n        isRoot && commit(this);\n    },\n    _createTransaction: function (a_values, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), changes = [], nested = [], _attributes = this._attributes, values = options.parse ? this.parse(a_values, options) : a_values;\n        var unknown;\n        if (shouldBeAnObject(this, values)) {\n            for (var name_1 in values) {\n                var spec = _attributes[name_1];\n                if (spec) {\n                    if (spec.doUpdate(values[name_1], this, options, nested)) {\n                        changes.push(name_1);\n                    }\n                }\n                else {\n                    unknown || (unknown = []);\n                    unknown.push(\"'\" + name_1 + \"'\");\n                }\n            }\n            if (unknown) {\n            }\n        }\n        if (changes.length && markAsDirty(this, options)) {\n            return new RecordTransaction(this, isRoot, nested, changes);\n        }\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var pendingTransaction = nested_1[_i];\n            pendingTransaction.commit(this);\n        }\n        isRoot && commit(this);\n    }\n};\nexport function constructorsMixin(attrDefs) {\n    var attrs = Object.keys(attrDefs);\n    var AttributesCopy = new Function('values', \"\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = values.\" + attr + \";\\n        \"; }).join('') + \"\\n    \");\n    AttributesCopy.prototype = Object.prototype;\n    var Attributes = new Function('record', 'values', 'options', \"\\n        var _attrs = record._attributes;\\n\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = _attrs.\" + attr + \".doInit( values.\" + attr + \", record, options );\\n        \"; }).join('') + \"\\n    \");\n    Attributes.prototype = Object.prototype;\n    return { Attributes: Attributes, AttributesCopy: AttributesCopy };\n}\nexport function shouldBeAnObject(record, values) {\n    if (values && values.constructor === Object)\n        return true;\n    record._log('warn', 'update with non-object is ignored!', { values: values });\n    return false;\n}\nvar RecordTransaction = (function () {\n    function RecordTransaction(object, isRoot, nested, changes) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.nested = nested;\n        this.changes = changes;\n    }\n    RecordTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, changes = _a.changes;\n        for (var _i = 0, nested_2 = nested; _i < nested_2.length; _i++) {\n            var transaction = nested_2[_i];\n            transaction.commit(object);\n        }\n        var attributes = object.attributes, _isDirty = object._isDirty;\n        for (var _b = 0, changes_1 = changes; _b < changes_1.length; _b++) {\n            var key = changes_1[_b];\n            trigger3(object, 'change:' + key, object, attributes[key], _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return RecordTransaction;\n}());\nexport { RecordTransaction };\n//# sourceMappingURL=updates.js.map","import { setAttribute } from './updates';\nimport { tools } from '../../object-plus';\nvar notEqual = tools.notEqual, assign = tools.assign;\nvar emptyOptions = {};\nvar AnyType = (function () {\n    function AnyType(name, a_options) {\n        this.name = name;\n        this.getHook = null;\n        this.options = a_options;\n        var options = assign({ getHooks: [], transforms: [], changeHandlers: [] }, a_options);\n        options.getHooks = options.getHooks.slice();\n        options.transforms = options.transforms.slice();\n        options.changeHandlers = options.changeHandlers.slice();\n        var value = options.value, type = options.type, parse = options.parse, toJSON = options.toJSON, changeEvents = options.changeEvents, validate = options.validate, getHooks = options.getHooks, transforms = options.transforms, changeHandlers = options.changeHandlers;\n        this.value = value;\n        this.type = type;\n        if (!options.hasCustomDefault && type) {\n            this.defaultValue = this.create;\n        }\n        else if (tools.isValidJSON(value)) {\n            this.defaultValue = new Function(\"return \" + JSON.stringify(value) + \";\");\n        }\n        else {\n            this.defaultValue = this.defaultValue;\n        }\n        this.propagateChanges = changeEvents !== false;\n        this.toJSON = toJSON === void 0 ? this.toJSON : toJSON;\n        this.validate = validate || this.validate;\n        if (options.isRequired) {\n            this.validate = wrapIsRequired(this.validate);\n        }\n        transforms.unshift(this.convert);\n        this.parse = parse || this.parse;\n        if (this.get)\n            getHooks.unshift(this.get);\n        this.initialize.call(this, options);\n        if (getHooks.length) {\n            var getHook_1 = this.getHook = getHooks.reduce(chainGetHooks);\n            var validate_1 = this.validate;\n            this.validate = function (record, value, key) {\n                return validate_1.call(this, record, getHook_1.call(record, value, key), key);\n            };\n        }\n        this.transform = transforms.length ? transforms.reduce(chainTransforms) : this.transform;\n        this.handleChange = changeHandlers.length ? changeHandlers.reduce(chainChangeHandlers) : this.handleChange;\n    }\n    AnyType.create = function (options, name) {\n        var type = options.type, AttributeCtor = options._attribute || (type ? type._attribute : AnyType);\n        return new AttributeCtor(name, options);\n    };\n    AnyType.prototype.canBeUpdated = function (prev, next, options) { };\n    AnyType.prototype.transform = function (next, prev, model, options) { return next; };\n    AnyType.prototype.convert = function (next, prev, model, options) { return next; };\n    AnyType.prototype.isChanged = function (a, b) {\n        return notEqual(a, b);\n    };\n    AnyType.prototype.handleChange = function (next, prev, model, options) { };\n    AnyType.prototype.create = function () { return void 0; };\n    AnyType.prototype.clone = function (value, record) {\n        return value;\n    };\n    AnyType.prototype.dispose = function (record, value) {\n        this.handleChange(void 0, value, record, emptyOptions);\n    };\n    AnyType.prototype.validate = function (record, value, key) { };\n    AnyType.prototype.toJSON = function (value, key) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    AnyType.prototype.createPropertyDescriptor = function () {\n        var _a = this, name = _a.name, getHook = _a.getHook;\n        if (name !== 'id') {\n            return {\n                set: function (value) {\n                    setAttribute(this, name, value);\n                },\n                get: (getHook ?\n                    function () {\n                        return getHook.call(this, this.attributes[name], name);\n                    } :\n                    function () { return this.attributes[name]; })\n            };\n        }\n    };\n    AnyType.prototype.initialize = function (name, options) { };\n    AnyType.prototype.doInit = function (value, record, options) {\n        var v = value === void 0 ? this.defaultValue() : value, x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AnyType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        var next = this.transform(value, prev, record, options);\n        attributes[name] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AnyType.prototype._log = function (level, text, value, record) {\n        tools.log(level, \"[Attribute Update Error] \" + record.getClassName() + \".\" + this.name + \": \" + text, {\n            'Record': record,\n            'Attribute definition': this,\n            'Prev. value': record.attributes[this.name],\n            'New value': value\n        });\n    };\n    AnyType.prototype.defaultValue = function () {\n        return this.value;\n    };\n    return AnyType;\n}());\nexport { AnyType };\nfunction chainGetHooks(prevHook, nextHook) {\n    return function (value, name) {\n        return nextHook.call(this, prevHook.call(this, value, name), name);\n    };\n}\nfunction chainTransforms(prevTransform, nextTransform) {\n    return function (next, prev, record, options) {\n        return nextTransform.call(this, prevTransform.call(this, next, prev, record, options), prev, record, options);\n    };\n}\nfunction chainChangeHandlers(prevHandler, nextHandler) {\n    return function (next, prev, record, options) {\n        prevHandler.call(this, next, prev, record, options);\n        nextHandler.call(this, next, prev, record, options);\n    };\n}\nfunction wrapIsRequired(validate) {\n    return function (record, value, key) {\n        return value ? validate.call(this, record, value, key) : 'Required';\n    };\n}\n//# sourceMappingURL=any.js.map","import { Transactional } from '../../transactions';\nimport { EventMap, definitionDecorator, tools } from '../../object-plus';\nvar assign = tools.assign;\nvar ChainableAttributeSpec = (function () {\n    function ChainableAttributeSpec(options) {\n        this.options = { getHooks: [], transforms: [], changeHandlers: [] };\n        if (options)\n            assign(this.options, options);\n    }\n    ChainableAttributeSpec.prototype.check = function (check, error) {\n        function validate(model, value, name) {\n            if (!check.call(model, value, name)) {\n                var msg = error || check.error || name + ' is not valid';\n                return typeof msg === 'function' ? msg.call(model, name) : msg;\n            }\n        }\n        var prev = this.options.validate;\n        return this.metadata({\n            validate: prev ? (function (model, value, name) {\n                return prev(model, value, name) || validate(model, value, name);\n            }) : validate\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"asProp\", {\n        get: function () {\n            return definitionDecorator('attributes', this);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"isRequired\", {\n        get: function () {\n            return this.metadata({ isRequired: true });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.watcher = function (ref) {\n        return this.metadata({ _onChange: ref });\n    };\n    ChainableAttributeSpec.prototype.parse = function (fun) {\n        return this.metadata({ parse: fun });\n    };\n    ChainableAttributeSpec.prototype.toJSON = function (fun) {\n        return this.metadata({\n            toJSON: typeof fun === 'function' ? fun : (fun ? function (x) { return x && x.toJSON(); } : emptyFunction)\n        });\n    };\n    ChainableAttributeSpec.prototype.get = function (fun) {\n        return this.metadata({\n            getHooks: this.options.getHooks.concat(fun)\n        });\n    };\n    ChainableAttributeSpec.prototype.set = function (fun) {\n        function handleSetHook(next, prev, record, options) {\n            if (this.isChanged(next, prev)) {\n                var changed = fun.call(record, next, this.name);\n                return changed === void 0 ? prev : this.convert(changed, prev, record, options);\n            }\n            return prev;\n        }\n        return this.metadata({\n            transforms: this.options.transforms.concat(handleSetHook)\n        });\n    };\n    ChainableAttributeSpec.prototype.changeEvents = function (events) {\n        return this.metadata({ changeEvents: events });\n    };\n    ChainableAttributeSpec.prototype.events = function (map) {\n        var eventMap = new EventMap(map);\n        function handleEventsSubscribtion(next, prev, record) {\n            prev && prev.trigger && eventMap.unsubscribe(record, prev);\n            next && next.trigger && eventMap.subscribe(record, next);\n        }\n        return this.metadata({\n            changeHandlers: this.options.changeHandlers.concat(handleEventsSubscribtion)\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"has\", {\n        get: function () {\n            return this;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.metadata = function (options) {\n        var cloned = new ChainableAttributeSpec(this.options);\n        assign(cloned.options, options);\n        return cloned;\n    };\n    ChainableAttributeSpec.prototype.value = function (x) {\n        return this.metadata({ value: x, hasCustomDefault: true });\n    };\n    return ChainableAttributeSpec;\n}());\nexport { ChainableAttributeSpec };\nfunction emptyFunction() { }\nFunction.prototype.value = function (x) {\n    return new ChainableAttributeSpec({ type: this, value: x, hasCustomDefault: true });\n};\nObject.defineProperty(Function.prototype, 'isRequired', {\n    get: function () { return this._isRequired || this.has.isRequired; },\n    set: function (x) { this._isRequired = x; }\n});\nObject.defineProperty(Function.prototype, 'asProp', {\n    get: function () { return this.has.asProp; },\n});\nObject.defineProperty(Function.prototype, 'has', {\n    get: function () {\n        return this._has || new ChainableAttributeSpec({\n            type: this,\n            value: this._attribute.defaultValue,\n            hasCustomDefault: this._attribute.defaultValue !== void 0\n        });\n    },\n    set: function (value) { this._has = value; }\n});\nexport function toAttributeOptions(spec) {\n    var attrSpec;\n    if (typeof spec === 'function') {\n        attrSpec = spec.has;\n    }\n    else if (spec && spec instanceof ChainableAttributeSpec) {\n        attrSpec = spec;\n    }\n    else {\n        var type = inferType(spec);\n        if (type && type.prototype instanceof Transactional) {\n            attrSpec = type.shared.value(spec);\n        }\n        else {\n            attrSpec = new ChainableAttributeSpec({ type: type, value: spec, hasCustomDefault: true });\n        }\n    }\n    return attrSpec.options;\n}\nfunction inferType(value) {\n    switch (typeof value) {\n        case 'number':\n            return Number;\n        case 'string':\n            return String;\n        case 'boolean':\n            return Boolean;\n        case 'undefined':\n            return void 0;\n        case 'object':\n            return value ? value.constructor : void 0;\n    }\n}\n//# sourceMappingURL=attrDef.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AnyType } from './any';\nimport { ChainableAttributeSpec } from './attrDef';\nvar DateProto = Date.prototype;\nvar DateType = (function (_super) {\n    __extends(DateType, _super);\n    function DateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DateType.prototype.create = function () {\n        return new Date();\n    };\n    DateType.prototype.convert = function (next, a, record) {\n        if (next == null || next instanceof Date)\n            return next;\n        var date = new Date(next), timestamp = date.getTime();\n        if (timestamp !== timestamp) {\n            this._log('warn', 'assigned with Invalid Date', next, record);\n        }\n        return date;\n    };\n    DateType.prototype.validate = function (model, value, name) {\n        if (value != null) {\n            var timestamp = value.getTime();\n            if (timestamp !== timestamp)\n                return name + ' is Invalid Date';\n        }\n    };\n    DateType.prototype.toJSON = function (value) { return value && value.toISOString(); };\n    DateType.prototype.isChanged = function (a, b) { return (a && a.getTime()) !== (b && b.getTime()); };\n    DateType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.defaultValue() : value, void 0, record, options);\n    };\n    DateType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return this.isChanged(prev, attributes[name] = this.transform(value, prev, record, options));\n    };\n    DateType.prototype.clone = function (value) { return value && new Date(value.getTime()); };\n    DateType.prototype.dispose = function () { };\n    return DateType;\n}(AnyType));\nexport { DateType };\nDate._attribute = DateType;\nvar msDatePattern = /\\/Date\\(([0-9]+)\\)\\//;\nvar MSDateType = (function (_super) {\n    __extends(MSDateType, _super);\n    function MSDateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    MSDateType.prototype.convert = function (next) {\n        if (typeof next === 'string') {\n            var msDate = msDatePattern.exec(next);\n            if (msDate) {\n                return new Date(Number(msDate[1]));\n            }\n        }\n        return DateType.prototype.convert.apply(this, arguments);\n    };\n    MSDateType.prototype.toJSON = function (value) { return value && \"/Date(\" + value.getTime() + \")/\"; };\n    return MSDateType;\n}(DateType));\nexport { MSDateType };\nvar TimestampType = (function (_super) {\n    __extends(TimestampType, _super);\n    function TimestampType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimestampType.prototype.toJSON = function (value) { return value && value.getTime(); };\n    return TimestampType;\n}(DateType));\nexport { TimestampType };\nObject.defineProperties(Date, {\n    microsoft: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: MSDateType\n            });\n        }\n    },\n    timestamp: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: TimestampType\n            });\n        }\n    }\n});\nfunction supportsDate(date) {\n    return !isNaN((new Date(date)).getTime());\n}\nif (!supportsDate('2011-11-29T15:52:30.5') ||\n    !supportsDate('2011-11-29T15:52:30.52') ||\n    !supportsDate('2011-11-29T15:52:18.867') ||\n    !supportsDate('2011-11-29T15:52:18.867Z') ||\n    !supportsDate('2011-11-29T15:52:18.867-03:30')) {\n    DateType.prototype.convert = function (value) {\n        return value == null || value instanceof Date ? value : new Date(safeParseDate(value));\n    };\n}\nvar numericKeys = [1, 4, 5, 6, 7, 10, 11], isoDatePattern = /^(\\d{4}|[+\\-]\\d{6})(?:-(\\d{2})(?:-(\\d{2}))?)?(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(?:(Z)|([+\\-])(\\d{2})(?::(\\d{2}))?)?)?$/;\nfunction safeParseDate(date) {\n    var timestamp, struct, minutesOffset = 0;\n    if ((struct = isoDatePattern.exec(date))) {\n        for (var i = 0, k; (k = numericKeys[i]); ++i) {\n            struct[k] = +struct[k] || 0;\n        }\n        struct[2] = (+struct[2] || 1) - 1;\n        struct[3] = +struct[3] || 1;\n        if (struct[8] !== 'Z' && struct[9] !== undefined) {\n            minutesOffset = struct[10] * 60 + struct[11];\n            if (struct[9] === '+') {\n                minutesOffset = 0 - minutesOffset;\n            }\n        }\n        timestamp =\n            Date.UTC(struct[1], struct[2], struct[3], struct[4], struct[5] + minutesOffset, struct[6], struct[7]);\n    }\n    else {\n        timestamp = Date.parse(date);\n    }\n    return timestamp;\n}\n//# sourceMappingURL=date.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AnyType } from './any';\nvar ImmutableClassType = (function (_super) {\n    __extends(ImmutableClassType, _super);\n    function ImmutableClassType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ImmutableClassType.prototype.create = function () {\n        return new this.type();\n    };\n    ImmutableClassType.prototype.convert = function (next) {\n        return next == null || next instanceof this.type ? next : new this.type(next);\n    };\n    ImmutableClassType.prototype.toJSON = function (value) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    ImmutableClassType.prototype.clone = function (value) {\n        return new this.type(this.toJSON(value));\n    };\n    ImmutableClassType.prototype.isChanged = function (a, b) {\n        return a !== b;\n    };\n    return ImmutableClassType;\n}(AnyType));\nFunction.prototype._attribute = ImmutableClassType;\nvar PrimitiveType = (function (_super) {\n    __extends(PrimitiveType, _super);\n    function PrimitiveType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PrimitiveType.prototype.dispose = function () { };\n    PrimitiveType.prototype.create = function () { return this.type(); };\n    PrimitiveType.prototype.toJSON = function (value) { return value; };\n    PrimitiveType.prototype.convert = function (next) { return next == null ? next : this.type(next); };\n    PrimitiveType.prototype.isChanged = function (a, b) { return a !== b; };\n    PrimitiveType.prototype.clone = function (value) { return value; };\n    PrimitiveType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.value : value, void 0, record, options);\n    };\n    PrimitiveType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return prev !== (attributes[name] = this.transform(value, prev, record, options));\n    };\n    PrimitiveType.prototype.initialize = function () {\n        if (!this.options.hasCustomDefault) {\n            this.value = this.type();\n        }\n    };\n    return PrimitiveType;\n}(AnyType));\nexport { PrimitiveType };\nBoolean._attribute = String._attribute = PrimitiveType;\nvar NumericType = (function (_super) {\n    __extends(NumericType, _super);\n    function NumericType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    NumericType.prototype.create = function () {\n        return 0;\n    };\n    NumericType.prototype.convert = function (next, prev, record) {\n        var num = next == null ? next : this.type(next);\n        if (num !== num) {\n            this._log('warn', 'assigned with Invalid Number', next, record);\n        }\n        return num;\n    };\n    NumericType.prototype.validate = function (model, value, name) {\n        if (value != null && !isFinite(value)) {\n            return name + ' is not valid number';\n        }\n    };\n    return NumericType;\n}(PrimitiveType));\nexport { NumericType };\nNumber._attribute = NumericType;\nfunction Integer(x) {\n    return x ? Math.round(x) : 0;\n}\nInteger._attribute = NumericType;\nNumber.integer = Integer;\nif (typeof window !== 'undefined') {\n    window.Integer = Number.integer;\n}\nvar ArrayType = (function (_super) {\n    __extends(ArrayType, _super);\n    function ArrayType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ArrayType.prototype.toJSON = function (value) { return value; };\n    ArrayType.prototype.dispose = function () { };\n    ArrayType.prototype.create = function () { return []; };\n    ArrayType.prototype.convert = function (next, prev, record) {\n        if (next == null || Array.isArray(next))\n            return next;\n        this._log('warn', 'assignment of non-array to Array attribute is ignored', next, record);\n        return [];\n    };\n    ArrayType.prototype.clone = function (value) {\n        return value && value.slice();\n    };\n    return ArrayType;\n}(AnyType));\nexport { ArrayType };\nArray._attribute = ArrayType;\nvar ObjectType = (function (_super) {\n    __extends(ObjectType, _super);\n    function ObjectType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ObjectType.prototype.create = function () { return {}; };\n    ObjectType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'object')\n            return next;\n        this._log('warn', 'assignment of non-object to Object attribute is ignored', next, record);\n        return {};\n    };\n    return ObjectType;\n}(AnyType));\nexport { ObjectType };\nObject._attribute = ObjectType;\nexport function doNothing() { }\nvar FunctionType = (function (_super) {\n    __extends(FunctionType, _super);\n    function FunctionType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    FunctionType.prototype.toJSON = function (value) { return void 0; };\n    FunctionType.prototype.create = function () { return doNothing; };\n    FunctionType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'function')\n            return next;\n        this._log('warn', 'assigned with non-function', next, record);\n        return doNothing;\n    };\n    FunctionType.prototype.clone = function (value) { return value; };\n    return FunctionType;\n}(AnyType));\nexport { FunctionType };\nFunction._attribute = FunctionType;\n//# sourceMappingURL=basic.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AnyType } from './any';\nimport { ItemsBehavior, transactionApi } from '../../transactions';\nimport { eventsApi } from '../../object-plus';\nvar on = eventsApi.on, off = eventsApi.off, free = transactionApi.free, aquire = transactionApi.aquire;\nvar shareAndListen = ItemsBehavior.listen | ItemsBehavior.share;\nvar SharedType = (function (_super) {\n    __extends(SharedType, _super);\n    function SharedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    SharedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value, record) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    SharedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    SharedType.prototype.clone = function (value, record) {\n        if (!value || value._owner !== record)\n            return value;\n        var clone = value.clone();\n        aquire(record, clone, this.name);\n        return clone;\n    };\n    SharedType.prototype.toJSON = function () { };\n    SharedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null && !(next instanceof this.type)) {\n            return next;\n        }\n    };\n    SharedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null || next instanceof this.type)\n            return next;\n        var implicitObject = new this.type(next, options, shareAndListen);\n        aquire(record, implicitObject, this.name);\n        return implicitObject;\n    };\n    SharedType.prototype.validate = function (model, value, name) { };\n    SharedType.prototype.create = function () {\n        return null;\n    };\n    SharedType.prototype._handleChange = function (next, prev, record) {\n        if (prev) {\n            if (prev._owner === record) {\n                free(record, prev);\n                prev.dispose();\n            }\n            else {\n                off(prev, prev._changeEventName, this._onChange, record);\n            }\n        }\n        if (next) {\n            if (next._owner !== record) {\n                on(next, next._changeEventName, this._onChange, record);\n            }\n        }\n    };\n    SharedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    SharedType.prototype.initialize = function (options) {\n        var attribute = this;\n        this._onChange = this.propagateChanges ? function (child, options, initiator) {\n            this === initiator || this.forceAttributeChange(attribute.name, options);\n        } : ignore;\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    return SharedType;\n}(AnyType));\nexport { SharedType };\nfunction ignore() { }\n//# sourceMappingURL=shared.js.map","var __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nimport { tools as _, eventsApi } from '../../object-plus';\nexport * from './any';\nexport * from './owned';\nexport * from './date';\nexport * from './basic';\nexport * from './shared';\nexport * from './updates';\nexport * from './attrDef';\nimport { AnyType } from './any';\nimport { constructorsMixin } from './updates';\nimport { toAttributeOptions, ChainableAttributeSpec } from './attrDef';\nimport { CompiledReference } from '../../traversable';\nexport default function (attributesDefinition, baseClassAttributes) {\n    var myAttributes = _.transform({}, attributesDefinition, createAttribute), allAttributes = _.defaults({}, myAttributes, baseClassAttributes);\n    var ConstructorsMixin = constructorsMixin(allAttributes);\n    return __assign({}, ConstructorsMixin, { _attributes: new ConstructorsMixin.AttributesCopy(allAttributes), _attributesArray: Object.keys(allAttributes).map(function (key) { return allAttributes[key]; }), properties: _.transform({}, myAttributes, function (x) { return x.createPropertyDescriptor(); }), _toJSON: createToJSON(allAttributes) }, parseMixin(allAttributes), localEventsMixin(myAttributes));\n}\nexport function createAttribute(spec, name) {\n    return AnyType.create(toAttributeOptions(spec), name);\n}\nfunction parseMixin(attributes) {\n    var attrsWithParse = Object.keys(attributes).filter(function (name) { return attributes[name].parse; });\n    return attrsWithParse.length ? {\n        _parse: new Function('json', \"\\n            var _attrs = this._attributes;\\n\\n            \" + attrsWithParse.map(function (name) { return \"                \\n                json.\" + name + \" === void 0 || ( json.\" + name + \" = _attrs.\" + name + \".parse.call( this, json.\" + name + \", \\\"\" + name + \"\\\" ) );\\n            \"; }).join('') + \"\\n\\n            return json;\\n        \")\n    } : {};\n}\nfunction createToJSON(attributes) {\n    return new Function(\"\\n        var json = {},\\n            v = this.attributes,\\n            a = this._attributes;\\n\\n        \" + Object.keys(attributes).map(function (key) {\n        if (attributes[key].toJSON) {\n            return \"json.\" + key + \" = a.\" + key + \".toJSON.call( this, v.\" + key + \", '\" + key + \"' );\";\n        }\n    }).join('\\n') + \"\\n\\n        return json;\\n    \");\n}\nexport function createSharedTypeSpec(Constructor, Attribute) {\n    if (!Constructor.hasOwnProperty('shared')) {\n        Object.defineProperty(Constructor, 'shared', {\n            get: function () {\n                return new ChainableAttributeSpec({\n                    value: null,\n                    type: Constructor,\n                    _attribute: Attribute\n                });\n            }\n        });\n    }\n}\nfunction localEventsMixin(attrSpecs) {\n    var _localEvents;\n    for (var key in attrSpecs) {\n        var attribute = attrSpecs[key], _onChange = attribute.options._onChange;\n        if (_onChange) {\n            _localEvents || (_localEvents = new eventsApi.EventMap());\n            _localEvents.addEvent('change:' + key, typeof _onChange === 'string' ?\n                createWatcherFromRef(_onChange, key) :\n                wrapWatcher(_onChange, key));\n        }\n    }\n    return _localEvents ? { _localEvents: _localEvents } : {};\n}\nfunction wrapWatcher(watcher, key) {\n    return function (record, value) {\n        watcher.call(record, value, key);\n    };\n}\nfunction createWatcherFromRef(ref, key) {\n    var _a = new CompiledReference(ref, true), local = _a.local, resolve = _a.resolve, tail = _a.tail;\n    return local ?\n        function (record, value) {\n            record[tail](value, key);\n        } :\n        function (record, value) {\n            resolve(record)[tail](value, key);\n        };\n}\n//# sourceMappingURL=index.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { tools, definitions, mixinRules, define } from '../object-plus';\nimport { Transactional } from '../transactions';\nimport { AnyType, AggregatedType, setAttribute, UpdateRecordMixin } from './attributes';\nvar assign = tools.assign, isEmpty = tools.isEmpty, log = tools.log;\nvar _cidCounter = 0;\nvar Record = (function (_super) {\n    __extends(Record, _super);\n    function Record(a_values, a_options) {\n        var _this = _super.call(this, _cidCounter++) || this;\n        _this.attributes = {};\n        var options = a_options || {}, values = (options.parse ? _this.parse(a_values, options) : a_values) || {};\n        if (log.level > 1)\n            typeCheck(_this, values);\n        _this.attributes = _this._previousAttributes = new _this.Attributes(_this, values, options);\n        _this.initialize(a_values, a_options);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Record_1 = Record;\n    Record.onDefine = function (definition, BaseClass) { };\n    Record.defaults = function (attrs) {\n        return this.extend({ attributes: attrs });\n    };\n    Record.prototype.previousAttributes = function () { return new this.AttributesCopy(this._previousAttributes); };\n    Object.defineProperty(Record.prototype, \"__inner_state__\", {\n        get: function () { return this.attributes; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Record.prototype, \"changed\", {\n        get: function () {\n            var changed = this._changedAttributes;\n            if (!changed) {\n                var prev = this._previousAttributes;\n                changed = {};\n                var _a = this, _attributes = _a._attributes, attributes = _a.attributes;\n                for (var _i = 0, _b = this._attributesArray; _i < _b.length; _i++) {\n                    var attr = _b[_i];\n                    var key = attr.name, value = attributes[key];\n                    if (attr.isChanged(value, prev[key])) {\n                        changed[key] = value;\n                    }\n                }\n                this._changedAttributes = changed;\n            }\n            return changed;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.changedAttributes = function (diff) {\n        if (!diff)\n            return this.hasChanged() ? assign({}, this.changed) : false;\n        var val, changed = false, old = this._transaction ? this._previousAttributes : this.attributes, attrSpecs = this._attributes;\n        for (var attr in diff) {\n            if (!attrSpecs[attr].isChanged(old[attr], (val = diff[attr])))\n                continue;\n            (changed || (changed = {}))[attr] = val;\n        }\n        return changed;\n    };\n    Record.prototype.hasChanged = function (key) {\n        var _previousAttributes = this._previousAttributes;\n        if (!_previousAttributes)\n            return false;\n        return key ?\n            this._attributes[key].isChanged(this.attributes[key], _previousAttributes[key]) :\n            !isEmpty(this.changed);\n    };\n    Record.prototype.previous = function (key) {\n        if (key) {\n            var _previousAttributes = this._previousAttributes;\n            if (_previousAttributes)\n                return _previousAttributes[key];\n        }\n        return null;\n    };\n    Record.prototype.isNew = function () {\n        return this.id == null;\n    };\n    Record.prototype.has = function (key) {\n        return this[key] != void 0;\n    };\n    Record.prototype.unset = function (key, options) {\n        var value = this[key];\n        this.set((_a = {}, _a[key] = void 0, _a), options);\n        return value;\n        var _a;\n    };\n    Record.prototype.clear = function (options) {\n        var _this = this;\n        var nullify = options && options.nullify;\n        this.transaction(function () {\n            _this.forEachAttr(_this.attributes, function (value, key) { return _this[key] = nullify ? null : void 0; });\n        }, options);\n        return this;\n    };\n    Record.prototype.getOwner = function () {\n        var owner = this._owner;\n        return this._ownerKey ? owner : owner && owner._owner;\n    };\n    Object.defineProperty(Record.prototype, \"id\", {\n        get: function () { return this.attributes[this.idAttribute]; },\n        set: function (x) { setAttribute(this, this.idAttribute, x); },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.forEachAttr = function (attrs, iteratee) {\n        var _attributes = this._attributes;\n        var unknown;\n        for (var name_1 in attrs) {\n            var spec = _attributes[name_1];\n            if (spec) {\n                iteratee(attrs[name_1], name_1, spec);\n            }\n            else {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_1 + \"'\");\n            }\n        }\n        if (unknown) {\n            this._log('warn', \"attributes \" + unknown.join(', ') + \" are not defined\", {\n                attributes: attrs\n            });\n        }\n    };\n    Record.prototype.each = function (iteratee, context) {\n        var fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee, attributes = this.attributes;\n        for (var key in this.attributes) {\n            var value = attributes[key];\n            if (value !== void 0)\n                fun(value, key);\n        }\n    };\n    Record.prototype.keys = function () {\n        var keys = [];\n        this.each(function (value, key) { return value === void 0 || keys.push(key); });\n        return keys;\n    };\n    Record.prototype.values = function () {\n        return this.map(function (value) { return value; });\n    };\n    Record.prototype._toJSON = function () { return {}; };\n    Record.prototype._parse = function (data) { return data; };\n    Record.prototype.defaults = function (values) {\n        var defaults = {}, _attributes = this._attributes;\n        for (var key in _attributes) {\n            var value = values[key];\n            defaults[key] = value === void 0 ? _attributes[key].defaultValue() : value;\n        }\n        return defaults;\n    };\n    Record.prototype.initialize = function (values, options) { };\n    Record.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var copy = new this.constructor(this.attributes, { clone: true });\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Record.prototype.deepClone = function () { return this.clone(); };\n    ;\n    Record.prototype._validateNested = function (errors) {\n        var _this = this;\n        var length = 0;\n        this.forEachAttr(this.attributes, function (value, name, attribute) {\n            var error = attribute.validate(_this, value, name);\n            if (error) {\n                errors[name] = error;\n                length++;\n            }\n        });\n        return length;\n    };\n    Record.prototype.get = function (key) {\n        return this[key];\n    };\n    Record.prototype.toJSON = function () {\n        var _this = this;\n        var json = {};\n        this.forEachAttr(this.attributes, function (value, key, _a) {\n            var toJSON = _a.toJSON;\n            if (value !== void 0) {\n                var asJson = toJSON.call(_this, value, key);\n                if (asJson !== void 0)\n                    json[key] = asJson;\n            }\n        });\n        return json;\n    };\n    Record.prototype.parse = function (data, options) {\n        return this._parse(data);\n    };\n    Record.prototype.deepSet = function (name, value, options) {\n        var _this = this;\n        this.transaction(function () {\n            var path = name.split('.'), l = path.length - 1, attr = path[l];\n            var model = _this;\n            for (var i = 0; i < l; i++) {\n                var key = path[i];\n                var next = model.get ? model.get(key) : model[key];\n                if (!next) {\n                    var attrSpecs = model._attributes;\n                    if (attrSpecs) {\n                        var newModel = attrSpecs[key].create();\n                        if (options && options.nullify && newModel._attributes) {\n                            newModel.clear(options);\n                        }\n                        model[key] = next = newModel;\n                    }\n                    else\n                        return;\n                }\n                model = next;\n            }\n            if (model.set) {\n                model.set((_a = {}, _a[attr] = value, _a), options);\n            }\n            else {\n                model[attr] = value;\n            }\n            var _a;\n        });\n        return this;\n    };\n    Object.defineProperty(Record.prototype, \"collection\", {\n        get: function () {\n            return this._ownerKey ? null : this._owner;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.dispose = function () {\n        var _this = this;\n        if (this._disposed)\n            return;\n        this.forEachAttr(this.attributes, function (value, key, attribute) {\n            attribute.dispose(_this, value);\n        });\n        _super.prototype.dispose.call(this);\n    };\n    Record.prototype._log = function (level, text, props) {\n        tools.log(level, '[Record] ' + text, __assign({ 'Record': this, 'Attributes definition:': this._attributes }, props));\n    };\n    Record.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Record';\n    };\n    Record.prototype._createTransaction = function (values, options) { return void 0; };\n    Record = Record_1 = __decorate([\n        define({\n            cidPrefix: 'm',\n            _changeEventName: 'change',\n            idAttribute: 'id'\n        }),\n        definitions({\n            defaults: mixinRules.merge,\n            attributes: mixinRules.merge,\n            collection: mixinRules.merge,\n            Collection: mixinRules.value,\n            idAttribute: mixinRules.protoValue\n        })\n    ], Record);\n    return Record;\n    var Record_1;\n}(Transactional));\nexport { Record };\n;\nassign(Record.prototype, UpdateRecordMixin);\nvar BaseRecordAttributes = (function () {\n    function BaseRecordAttributes(record, x, options) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributes;\n}());\nRecord.prototype.Attributes = BaseRecordAttributes;\nvar BaseRecordAttributesCopy = (function () {\n    function BaseRecordAttributesCopy(x) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributesCopy;\n}());\nRecord.prototype.AttributesCopy = BaseRecordAttributesCopy;\nvar IdAttribute = AnyType.create({ value: void 0 }, 'id');\nRecord.prototype._attributes = { id: IdAttribute };\nRecord.prototype._attributesArray = [IdAttribute];\nRecord.prototype.defaults = function (attrs) {\n    if (attrs === void 0) { attrs = {}; }\n    return { id: attrs.id };\n};\nRecord._attribute = AggregatedType;\nimport { shouldBeAnObject } from './attributes';\nfunction typeCheck(record, values) {\n    if (shouldBeAnObject(record, values)) {\n        var _attributes = record._attributes;\n        var unknown = void 0;\n        for (var name_2 in values) {\n            if (!_attributes[name_2]) {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_2 + \"'\");\n            }\n        }\n        if (unknown) {\n            record._log('warn', \"undefined attributes \" + unknown.join(', ') + \" are ignored.\", { values: values });\n        }\n    }\n}\n//# sourceMappingURL=record.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\n            t[p[i]] = s[p[i]];\n    return t;\n};\nimport { Record } from './record';\nimport { tools, predefine } from '../object-plus';\nimport compile from './attributes';\nimport { Transactional } from '../transactions';\nimport { ChainableAttributeSpec, createSharedTypeSpec, AggregatedType, SharedType } from './attributes';\nexport * from './attributes';\nexport { Record, ChainableAttributeSpec };\nvar assign = tools.assign, defaults = tools.defaults, omit = tools.omit, getBaseClass = tools.getBaseClass;\nRecord.onExtend = function (BaseClass) {\n    Transactional.onExtend.call(this, BaseClass);\n    var Class = this;\n    var DefaultCollection = (function (_super) {\n        __extends(DefaultCollection, _super);\n        function DefaultCollection() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultCollection.model = Class;\n        DefaultCollection = __decorate([\n            predefine\n        ], DefaultCollection);\n        return DefaultCollection;\n    }(BaseClass.Collection));\n    this.DefaultCollection = DefaultCollection;\n    if (Class.Collection === BaseClass.Collection) {\n        this.Collection = DefaultCollection;\n    }\n    createSharedTypeSpec(this, SharedType);\n};\nRecord.onDefine = function (definition, BaseClass) {\n    var baseProto = BaseClass.prototype;\n    var _a = compile(this.attributes = getAttributes(definition), baseProto._attributes), properties = _a.properties, _localEvents = _a._localEvents, dynamicMixin = __rest(_a, [\"properties\", \"_localEvents\"]);\n    assign(this.prototype, dynamicMixin);\n    definition.properties = defaults(definition.properties || {}, properties);\n    definition._localEvents = _localEvents;\n    Transactional.onDefine.call(this, definition, BaseClass);\n    this.DefaultCollection.define(definition.collection || {});\n    this.Collection = definition.Collection;\n    this.Collection.prototype.model = this;\n};\nRecord._attribute = AggregatedType;\ncreateSharedTypeSpec(Record, SharedType);\nfunction getAttributes(_a) {\n    var defaults = _a.defaults, attributes = _a.attributes, idAttribute = _a.idAttribute;\n    var definition = attributes || defaults || {};\n    if (idAttribute && !(idAttribute in definition)) {\n        definition[idAttribute] = void 0;\n    }\n    return definition;\n}\nexport function attr(proto, attrName) {\n    if (attrName) {\n        if (typeof Reflect !== 'undefined' && Reflect.getMetadata) {\n            Reflect\n                .getMetadata(\"design:type\", proto, attrName)\n                .asProp(proto, attrName);\n        }\n        else {\n            proto._log('error', 'Add import \"reflect-metadata\"; as the first line of your app.');\n        }\n    }\n    else {\n        return proto.asProp;\n    }\n}\nexport function prop(spec) {\n    return spec.asProp;\n}\n//# sourceMappingURL=index.js.map","import { ItemsBehavior, transactionApi } from '../transactions';\nimport { eventsApi } from '../object-plus';\nvar EventMap = eventsApi.EventMap, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, _aquire = transactionApi.aquire, _free = transactionApi.free;\nexport function dispose(collection) {\n    var models = collection.models;\n    collection.models = [];\n    collection._byId = {};\n    freeAll(collection, models);\n    return models;\n}\nexport function convertAndAquire(collection, attrs, options) {\n    var model = collection.model;\n    var record;\n    if (collection._shared) {\n        record = attrs instanceof model ? attrs : model.create(attrs, options);\n        if (collection._shared & ItemsBehavior.listen) {\n            on(record, record._changeEventName, collection._onChildrenChange, collection);\n        }\n    }\n    else {\n        record = attrs instanceof model ? (options.merge ? attrs.clone() : attrs) : model.create(attrs, options);\n        if (!_aquire(collection, record)) {\n            var errors = collection._aggregationError || (collection._aggregationError = []);\n            errors.push(record);\n        }\n    }\n    var _itemEvents = collection._itemEvents;\n    _itemEvents && _itemEvents.subscribe(collection, record);\n    return record;\n}\nexport function free(owner, child, unset) {\n    if (owner._shared) {\n        if (owner._shared & ItemsBehavior.listen) {\n            off(child, child._changeEventName, owner._onChildrenChange, owner);\n        }\n    }\n    else {\n        _free(owner, child);\n        unset || child.dispose();\n    }\n    var _itemEvents = owner._itemEvents;\n    _itemEvents && _itemEvents.unsubscribe(owner, child);\n}\nexport function freeAll(collection, children) {\n    for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {\n        var child = children_1[_i];\n        free(collection, child);\n    }\n    return children;\n}\nexport function sortElements(collection, options) {\n    var _comparator = collection._comparator;\n    if (_comparator && options.sort !== false) {\n        collection.models.sort(_comparator);\n        return true;\n    }\n    return false;\n}\nexport function addIndex(index, model) {\n    index[model.cid] = model;\n    var id = model.id;\n    if (id != null) {\n        index[id] = model;\n    }\n}\nexport function removeIndex(index, model) {\n    delete index[model.cid];\n    var id = model.id;\n    if (id != null) {\n        delete index[id];\n    }\n}\nexport function updateIndex(index, model) {\n    delete index[model.previous(model.idAttribute)];\n    var id = model.id;\n    id == null || (index[id] = model);\n}\nvar CollectionTransaction = (function () {\n    function CollectionTransaction(object, isRoot, added, removed, nested, sorted) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.added = added;\n        this.removed = removed;\n        this.nested = nested;\n        this.sorted = sorted;\n    }\n    CollectionTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, _isDirty = object._isDirty;\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var transaction = nested_1[_i];\n            transaction.commit(object);\n        }\n        if (object._aggregationError) {\n            logAggregationError(object);\n        }\n        for (var _b = 0, nested_2 = nested; _b < nested_2.length; _b++) {\n            var transaction = nested_2[_b];\n            trigger2(object, 'change', transaction.object, _isDirty);\n        }\n        var _c = this, added = _c.added, removed = _c.removed;\n        for (var _d = 0, added_1 = added; _d < added_1.length; _d++) {\n            var record = added_1[_d];\n            trigger3(record, 'add', record, object, _isDirty);\n            trigger3(object, 'add', record, object, _isDirty);\n        }\n        for (var _e = 0, removed_1 = removed; _e < removed_1.length; _e++) {\n            var record = removed_1[_e];\n            trigger3(record, 'remove', record, object, _isDirty);\n            trigger3(object, 'remove', record, object, _isDirty);\n        }\n        if (this.sorted) {\n            trigger2(object, 'sort', object, _isDirty);\n        }\n        if (added.length || removed.length) {\n            trigger2(object, 'update', object, _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return CollectionTransaction;\n}());\nexport { CollectionTransaction };\nexport function logAggregationError(collection) {\n    collection._log('error', 'added records already have an owner', collection._aggregationError);\n    collection._aggregationError = void 0;\n}\n//# sourceMappingURL=commons.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, sortElements, convertAndAquire, addIndex, updateIndex } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nexport function addTransaction(collection, items, options, merge) {\n    var isRoot = begin(collection), nested = [];\n    var added = appendElements(collection, items, nested, options, merge);\n    if (added.length || nested.length) {\n        var needSort = sortOrMoveElements(collection, added, options);\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, [], nested, needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction sortOrMoveElements(collection, added, options) {\n    var at = options.at;\n    if (at != null) {\n        var length_1 = collection.models.length - added.length;\n        at = Number(at);\n        if (at < 0)\n            at += length_1 + 1;\n        if (at < 0)\n            at = 0;\n        if (at > length_1)\n            at = length_1;\n        moveElements(collection.models, at, added);\n        return false;\n    }\n    return sortElements(collection, options);\n}\nfunction moveElements(source, at, added) {\n    for (var j = source.length - 1, i = j - added.length; i >= at; i--, j--) {\n        source[j] = source[i];\n    }\n    for (i = 0, j = at; i < added.length; i++, j++) {\n        source[j] = added[i];\n    }\n}\nfunction appendElements(collection, a_items, nested, a_options, forceMerge) {\n    var _byId = collection._byId, models = collection.models, merge = (forceMerge || a_options.merge) && !collection._shared, parse = a_options.parse, idAttribute = collection.model.prototype.idAttribute, prevLength = models.length;\n    for (var _i = 0, a_items_1 = a_items; _i < a_items_1.length; _i++) {\n        var item = a_items_1[_i];\n        var model = item ? _byId[item[idAttribute]] || _byId[item.cid] : null;\n        if (model) {\n            if (merge && item !== model) {\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, a_options);\n                transaction && nested.push(transaction);\n                if (model.hasChanged(idAttribute)) {\n                    updateIndex(_byId, model);\n                }\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, a_options);\n            models.push(model);\n            addIndex(_byId, model);\n        }\n    }\n    return models.slice(prevLength);\n}\n//# sourceMappingURL=add.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, convertAndAquire, free, sortElements, addIndex, freeAll } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nvar silentOptions = { silent: true };\nexport function emptySetTransaction(collection, items, options, silent) {\n    var isRoot = begin(collection);\n    var added = _reallocateEmpty(collection, items, options);\n    if (added.length) {\n        var needSort = sortElements(collection, options);\n        if (markAsDirty(collection, silent ? silentOptions : options)) {\n            return new CollectionTransaction(collection, isRoot, added.slice(), [], [], needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nexport function setTransaction(collection, items, options) {\n    var isRoot = begin(collection), nested = [];\n    var previous = collection.models, added = _reallocate(collection, items, nested, options);\n    var reusedCount = collection.models.length - added.length, removed = reusedCount < previous.length ? (reusedCount ? _garbageCollect(collection, previous) :\n        freeAll(collection, previous)) : [];\n    var addedOrChanged = nested.length || added.length, sorted = (sortElements(collection, options) && addedOrChanged) || added.length || options.sorted;\n    if (addedOrChanged || removed.length || sorted) {\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, removed, nested, sorted);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction _garbageCollect(collection, previous) {\n    var _byId = collection._byId, removed = [];\n    for (var _i = 0, previous_1 = previous; _i < previous_1.length; _i++) {\n        var record = previous_1[_i];\n        if (!_byId[record.cid]) {\n            removed.push(record);\n            free(collection, record);\n        }\n    }\n    return removed;\n}\nfunction _reallocate(collection, source, nested, options) {\n    var models = Array(source.length), _byId = {}, merge = (options.merge == null ? true : options.merge) && !collection._shared, _prevById = collection._byId, prevModels = collection.models, idAttribute = collection.model.prototype.idAttribute, toAdd = [], orderKept = true;\n    for (var i = 0, j = 0; i < source.length; i++) {\n        var item = source[i], model = null;\n        if (item) {\n            var id = item[idAttribute], cid = item.cid;\n            if (_byId[id] || _byId[cid])\n                continue;\n            model = _prevById[id] || _prevById[cid];\n        }\n        if (model) {\n            if (merge && item !== model) {\n                if (orderKept && prevModels[j] !== model)\n                    orderKept = false;\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, options);\n                transaction && nested.push(transaction);\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, options);\n            toAdd.push(model);\n        }\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    collection.models = models;\n    collection._byId = _byId;\n    if (!orderKept)\n        options.sorted = true;\n    return toAdd;\n}\nfunction _reallocateEmpty(self, source, options) {\n    var len = source ? source.length : 0, models = Array(len), _byId = {}, idAttribute = self.model.prototype.idAttribute;\n    for (var i = 0, j = 0; i < len; i++) {\n        var src = source[i];\n        if (src && (_byId[src[idAttribute]] || _byId[src.cid])) {\n            continue;\n        }\n        var model = convertAndAquire(self, src, options);\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    self._byId = _byId;\n    return self.models = models;\n}\n//# sourceMappingURL=set.js.map","import { free, CollectionTransaction, removeIndex } from './commons';\nimport { eventsApi } from '../object-plus';\nimport { transactionApi } from '../transactions';\nvar trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, markAsDirty = transactionApi.markAsDirty, begin = transactionApi.begin, commit = transactionApi.commit;\nexport function removeOne(collection, el, options) {\n    var model = collection.get(el);\n    if (model) {\n        var isRoot = begin(collection), models = collection.models;\n        models.splice(models.indexOf(model), 1);\n        removeIndex(collection._byId, model);\n        var notify = markAsDirty(collection, options);\n        if (notify) {\n            trigger3(model, 'remove', model, collection, options);\n            trigger3(collection, 'remove', model, collection, options);\n        }\n        free(collection, model, options.unset);\n        notify && trigger2(collection, 'update', collection, options);\n        isRoot && commit(collection);\n        return model;\n    }\n}\n;\nexport function removeMany(collection, toRemove, options) {\n    var removed = _removeFromIndex(collection, toRemove);\n    if (removed.length) {\n        var isRoot = begin(collection);\n        _reallocate(collection, removed.length);\n        if (markAsDirty(collection, options)) {\n            var transaction = new CollectionTransaction(collection, isRoot, [], removed, [], false);\n            transaction.commit();\n        }\n        else {\n            isRoot && commit(collection);\n        }\n    }\n    return removed;\n}\n;\nfunction _removeFromIndex(collection, toRemove) {\n    var removed = Array(toRemove.length), _byId = collection._byId;\n    for (var i = 0, j = 0; i < toRemove.length; i++) {\n        var model = collection.get(toRemove[i]);\n        if (model) {\n            removed[j++] = model;\n            removeIndex(_byId, model);\n            free(collection, model);\n        }\n    }\n    removed.length = j;\n    return removed;\n}\nfunction _reallocate(collection, removed) {\n    var prev = collection.models, models = collection.models = Array(prev.length - removed), _byId = collection._byId;\n    for (var i = 0, j = 0; i < prev.length; i++) {\n        var model = prev[i];\n        if (_byId[model.cid]) {\n            models[j++] = model;\n        }\n    }\n    models.length = j;\n}\n//# sourceMappingURL=remove.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { define, tools, eventsApi, EventMap, definitions, mixinRules, Mixable } from '../object-plus';\nimport { ItemsBehavior, transactionApi, Transactional } from '../transactions';\nimport { Record, SharedType, AggregatedType, createSharedTypeSpec } from '../record';\nimport { free, sortElements, dispose, updateIndex } from './commons';\nimport { addTransaction } from './add';\nimport { setTransaction, emptySetTransaction } from './set';\nimport { removeOne, removeMany } from './remove';\nvar trigger2 = eventsApi.trigger2, on = eventsApi.on, off = eventsApi.off, begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, omit = tools.omit, log = tools.log, assign = tools.assign, defaults = tools.defaults, assignToClassProto = tools.assignToClassProto;\nvar _count = 0;\nvar silentOptions = { silent: true };\nvar slice = Array.prototype.slice;\nvar CollectionRefsType = (function (_super) {\n    __extends(CollectionRefsType, _super);\n    function CollectionRefsType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    CollectionRefsType.defaultValue = [];\n    return CollectionRefsType;\n}(SharedType));\nvar Collection = (function (_super) {\n    __extends(Collection, _super);\n    function Collection(records, options, shared) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this, _count++) || this;\n        _this.models = [];\n        _this._byId = {};\n        _this.comparator = _this.comparator;\n        if (options.comparator !== void 0) {\n            _this.comparator = options.comparator;\n            options.comparator = void 0;\n        }\n        _this.model = _this.model;\n        if (options.model) {\n            _this.model = options.model;\n            options.model = void 0;\n        }\n        _this.idAttribute = _this.model.prototype.idAttribute;\n        _this._shared = shared || 0;\n        if (records) {\n            var elements = toElements(_this, records, options);\n            emptySetTransaction(_this, elements, options, true);\n        }\n        _this.initialize.apply(_this, arguments);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Collection_1 = Collection;\n    Collection.prototype.createSubset = function (models, options) {\n        var SubsetOf = this.constructor.subsetOf(this).options.type, subset = new SubsetOf(models, options);\n        subset.resolve(this);\n        return subset;\n    };\n    Collection.onExtend = function (BaseClass) {\n        var Ctor = this;\n        this._SubsetOf = null;\n        function RefsCollection(a, b, listen) {\n            Ctor.call(this, a, b, ItemsBehavior.share | (listen ? ItemsBehavior.listen : 0));\n        }\n        Mixable.mixins.populate(RefsCollection);\n        RefsCollection.prototype = this.prototype;\n        RefsCollection._attribute = CollectionRefsType;\n        this.Refs = this.Subset = RefsCollection;\n        Transactional.onExtend.call(this, BaseClass);\n        createSharedTypeSpec(this, SharedType);\n    };\n    Collection.onDefine = function (definition, BaseClass) {\n        if (definition.itemEvents) {\n            var eventsMap = new EventMap(BaseClass.prototype._itemEvents);\n            eventsMap.addEventsMap(definition.itemEvents);\n            this.prototype._itemEvents = eventsMap;\n        }\n        if (definition.comparator)\n            this.prototype.comparator = definition.comparator;\n        Transactional.onDefine.call(this, definition);\n    };\n    Object.defineProperty(Collection.prototype, \"__inner_state__\", {\n        get: function () { return this.models; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Collection.prototype, \"comparator\", {\n        get: function () { return this._comparator; },\n        set: function (x) {\n            var _this = this;\n            var compare;\n            switch (typeof x) {\n                case 'string':\n                    this._comparator = function (a, b) {\n                        var aa = a[x], bb = b[x];\n                        if (aa === bb)\n                            return 0;\n                        return aa < bb ? -1 : +1;\n                    };\n                    break;\n                case 'function':\n                    if (x.length === 1) {\n                        this._comparator = function (a, b) {\n                            var aa = x.call(_this, a), bb = x.call(_this, b);\n                            if (aa === bb)\n                                return 0;\n                            return aa < bb ? -1 : +1;\n                        };\n                    }\n                    else {\n                        this._comparator = function (a, b) { return x.call(_this, a, b); };\n                    }\n                    break;\n                default:\n                    this._comparator = null;\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.getStore = function () {\n        return this._store || (this._store = this._owner ? this._owner.getStore() : this._defaultStore);\n    };\n    Collection.prototype._onChildrenChange = function (record, options, initiator) {\n        if (options === void 0) { options = {}; }\n        if (initiator === this)\n            return;\n        var idAttribute = this.idAttribute;\n        if (record.hasChanged(idAttribute)) {\n            updateIndex(this._byId, record);\n        }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger2(this, 'change', record, options);\n        }\n        isRoot && commit(this);\n    };\n    Collection.prototype.get = function (objOrId) {\n        if (objOrId == null)\n            return;\n        if (typeof objOrId === 'object') {\n            var id = objOrId[this.idAttribute];\n            return (id !== void 0 && this._byId[id]) || this._byId[objOrId.cid];\n        }\n        else {\n            return this._byId[objOrId];\n        }\n    };\n    Collection.prototype.each = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            fun(models[i], i);\n        }\n    };\n    Collection.prototype.every = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (!fun(models[i], i))\n                return false;\n        }\n        return true;\n    };\n    Collection.prototype.filter = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        return this.map(function (x, i) { return fun(x, i) ? x : void 0; });\n    };\n    Collection.prototype.find = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (fun(models[i], i))\n                return models[i];\n        }\n        return null;\n    };\n    Collection.prototype.some = function (iteratee, context) {\n        return Boolean(this.find(iteratee, context));\n    };\n    Collection.prototype.map = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models, mapped = Array(models.length);\n        var j = 0;\n        for (var i = 0; i < models.length; i++) {\n            var x = fun(models[i], i);\n            x === void 0 || (mapped[j++] = x);\n        }\n        mapped.length = j;\n        return mapped;\n    };\n    Collection.prototype._validateNested = function (errors) {\n        if (this._shared)\n            return 0;\n        var count = 0;\n        this.each(function (record) {\n            var error = record.validationError;\n            if (error) {\n                errors[record.cid] = error;\n                count++;\n            }\n        });\n        return count;\n    };\n    Collection.prototype.initialize = function () { };\n    Object.defineProperty(Collection.prototype, \"length\", {\n        get: function () { return this.models.length; },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.first = function () { return this.models[0]; };\n    Collection.prototype.last = function () { return this.models[this.models.length - 1]; };\n    Collection.prototype.at = function (a_index) {\n        var index = a_index < 0 ? a_index + this.models.length : a_index;\n        return this.models[index];\n    };\n    Collection.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var models = this._shared & ItemsBehavior.share ? this.models : this.map(function (model) { return model.clone(); }), copy = new this.constructor(models, { model: this.model, comparator: this.comparator }, this._shared);\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Collection.prototype.toJSON = function () {\n        return this.models.map(function (model) { return model.toJSON(); });\n    };\n    Collection.prototype.set = function (elements, options) {\n        if (elements === void 0) { elements = []; }\n        if (options === void 0) { options = {}; }\n        if (options.add !== void 0) {\n            this._log('warn', \"Collection.set doesn't support 'add' option, behaving as if options.add === true.\", options);\n        }\n        if (options.reset) {\n            this.reset(elements, options);\n        }\n        else {\n            var transaction = this._createTransaction(elements, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Collection.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        var aggregated = !this._shared;\n        for (var _i = 0, _a = this.models; _i < _a.length; _i++) {\n            var record = _a[_i];\n            free(this, record);\n            if (aggregated)\n                record.dispose();\n        }\n        _super.prototype.dispose.call(this);\n    };\n    Collection.prototype.reset = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), previousModels = dispose(this);\n        if (a_elements) {\n            emptySetTransaction(this, toElements(this, a_elements, options), options, true);\n        }\n        markAsDirty(this, options);\n        options.silent || trigger2(this, 'reset', this, defaults({ previousModels: previousModels }, options));\n        isRoot && commit(this);\n        return this.models;\n    };\n    Collection.prototype.add = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options), transaction = this.models.length ?\n            addTransaction(this, elements, options) :\n            emptySetTransaction(this, elements, options);\n        if (transaction) {\n            transaction.commit();\n            return transaction.added;\n        }\n    };\n    Collection.prototype.remove = function (recordsOrIds, options) {\n        if (options === void 0) { options = {}; }\n        if (recordsOrIds) {\n            return Array.isArray(recordsOrIds) ?\n                removeMany(this, recordsOrIds, options) :\n                removeOne(this, recordsOrIds, options);\n        }\n        return [];\n    };\n    Collection.prototype._createTransaction = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options);\n        if (this.models.length) {\n            return options.remove === false ?\n                addTransaction(this, elements, options, true) :\n                setTransaction(this, elements, options);\n        }\n        else {\n            return emptySetTransaction(this, elements, options);\n        }\n    };\n    Collection.prototype.pluck = function (key) {\n        return this.models.map(function (model) { return model[key]; });\n    };\n    Collection.prototype.sort = function (options) {\n        if (options === void 0) { options = {}; }\n        if (sortElements(this, options)) {\n            var isRoot = begin(this);\n            if (markAsDirty(this, options)) {\n                trigger2(this, 'sort', this, options);\n            }\n            isRoot && commit(this);\n        }\n        return this;\n    };\n    Collection.prototype.push = function (model, options) {\n        return this.add(model, assign({ at: this.length }, options));\n    };\n    Collection.prototype.pop = function (options) {\n        var model = this.at(this.length - 1);\n        this.remove(model, options);\n        return model;\n    };\n    Collection.prototype.unset = function (modelOrId, options) {\n        var value = this.get(modelOrId);\n        this.remove(modelOrId, __assign({ unset: true }, options));\n        return value;\n    };\n    Collection.prototype.unshift = function (model, options) {\n        return this.add(model, assign({ at: 0 }, options));\n    };\n    Collection.prototype.shift = function (options) {\n        var model = this.at(0);\n        this.remove(model, options);\n        return model;\n    };\n    Collection.prototype.slice = function () {\n        return slice.apply(this.models, arguments);\n    };\n    Collection.prototype.indexOf = function (modelOrId) {\n        var record = this.get(modelOrId);\n        return this.models.indexOf(record);\n    };\n    Collection.prototype.modelId = function (attrs) {\n        return attrs[this.model.prototype.idAttribute];\n    };\n    Collection.prototype.toggle = function (model, a_next) {\n        var prev = Boolean(this.get(model)), next = a_next === void 0 ? !prev : Boolean(a_next);\n        if (prev !== next) {\n            if (prev) {\n                this.remove(model);\n            }\n            else {\n                this.add(model);\n            }\n        }\n        return next;\n    };\n    Collection.prototype._log = function (level, text, value) {\n        tools.log(level, \"[Collection Update] \" + this.model.prototype.getClassName() + \".\" + this.getClassName() + \": \" + text, {\n            Argument: value,\n            'Attributes spec': this.model.prototype._attributes\n        });\n    };\n    Collection.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Collection';\n    };\n    Collection._attribute = AggregatedType;\n    Collection = Collection_1 = __decorate([\n        define({\n            cidPrefix: 'c',\n            model: Record,\n            _changeEventName: 'changes',\n            _aggregationError: null\n        }),\n        definitions({\n            comparator: mixinRules.value,\n            model: mixinRules.protoValue,\n            itemEvents: mixinRules.merge\n        })\n    ], Collection);\n    return Collection;\n    var Collection_1;\n}(Transactional));\nexport { Collection };\nfunction toElements(collection, elements, options) {\n    var parsed = options.parse ? collection.parse(elements, options) : elements;\n    return Array.isArray(parsed) ? parsed : [parsed];\n}\ncreateSharedTypeSpec(Collection, SharedType);\nRecord.Collection = Collection;\nfunction bindContext(fun, context) {\n    return context !== void 0 ? function (v, k) { return fun.call(context, v, k); } : fun;\n}\nfunction toPredicateFunction(iteratee, context) {\n    if (typeof iteratee === 'object') {\n        return function (x) {\n            for (var key in iteratee) {\n                if (iteratee[key] !== x[key])\n                    return false;\n            }\n            return true;\n        };\n    }\n    return bindContext(iteratee, context);\n}\n//# sourceMappingURL=index.js.map","import { CompiledReference } from '../traversable';\nexport function parseReference(collectionRef) {\n    switch (typeof collectionRef) {\n        case 'function':\n            return function (root) { return collectionRef.call(root); };\n        case 'object':\n            return function () { return collectionRef; };\n        case 'string':\n            var resolve = new CompiledReference(collectionRef).resolve;\n            return resolve;\n    }\n}\n//# sourceMappingURL=commons.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Collection } from '../collection';\nimport { tools, define } from '../object-plus';\nimport { parseReference } from './commons';\nimport { ChainableAttributeSpec } from '../record';\nimport { ItemsBehavior, transactionApi } from '../transactions';\nvar fastDefaults = tools.fastDefaults;\nCollection.subsetOf = function subsetOf(masterCollection) {\n    var SubsetOf = this._SubsetOf || (this._SubsetOf = defineSubsetCollection(this)), getMasterCollection = parseReference(masterCollection), typeSpec = new ChainableAttributeSpec({\n        type: SubsetOf\n    });\n    return typeSpec.get(function (refs) {\n        !refs || refs.resolvedWith || refs.resolve(getMasterCollection(this));\n        return refs;\n    });\n};\nvar subsetOfBehavior = ItemsBehavior.share | ItemsBehavior.persistent;\nfunction defineSubsetCollection(CollectionConstructor) {\n    var SubsetOfCollection = (function (_super) {\n        __extends(SubsetOfCollection, _super);\n        function SubsetOfCollection(recordsOrIds, options) {\n            var _this = _super.call(this, [], options, subsetOfBehavior) || this;\n            _this.resolvedWith = null;\n            _this.refs = toArray(recordsOrIds);\n            return _this;\n        }\n        Object.defineProperty(SubsetOfCollection.prototype, \"__inner_state__\", {\n            get: function () { return this.refs || this.models; },\n            enumerable: true,\n            configurable: true\n        });\n        SubsetOfCollection.prototype.add = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, toAdd = toArray(a_elements);\n            if (resolvedWith) {\n                return _super.prototype.add.call(this, resolveRefs(resolvedWith, toAdd), options);\n            }\n            else {\n                if (toAdd.length) {\n                    var isRoot = transactionApi.begin(this);\n                    this.refs = this.refs ? this.refs.concat(toAdd) : toAdd;\n                    transactionApi.markAsDirty(this, options);\n                    isRoot && transactionApi.commit(this);\n                }\n            }\n        };\n        SubsetOfCollection.prototype.reset = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype.reset.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options) || [];\n        };\n        SubsetOfCollection.prototype._createTransaction = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype._createTransaction.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options);\n        };\n        SubsetOfCollection.prototype.toJSON = function () {\n            return this.refs ?\n                this.refs.map(function (objOrId) { return objOrId.id || objOrId; }) :\n                this.models.map(function (model) { return model.id; });\n        };\n        SubsetOfCollection.prototype._validateNested = function () { return 0; };\n        SubsetOfCollection.prototype.clone = function (owner) {\n            var Ctor = this.constructor, copy = new Ctor([], {\n                model: this.model,\n                comparator: this.comparator\n            });\n            if (this.resolvedWith) {\n                copy.resolvedWith = this.resolvedWith;\n                copy.reset(this.models, { silent: true });\n            }\n            else {\n                copy.refs = this.refs;\n            }\n            return copy;\n        };\n        SubsetOfCollection.prototype.parse = function (raw) {\n            return raw;\n        };\n        SubsetOfCollection.prototype.resolve = function (collection) {\n            if (collection && collection.length) {\n                this.resolvedWith = collection;\n                if (this.refs) {\n                    this.reset(this.refs, { silent: true });\n                    this.refs = null;\n                }\n            }\n            return this;\n        };\n        SubsetOfCollection.prototype.getModelIds = function () { return this.toJSON(); };\n        SubsetOfCollection.prototype.toggle = function (modelOrId, val) {\n            return _super.prototype.toggle.call(this, this.resolvedWith.get(modelOrId), val);\n        };\n        SubsetOfCollection.prototype.addAll = function () {\n            if (this.resolvedWith) {\n                this.set(this.resolvedWith.models);\n                return this.models;\n            }\n            throw new Error(\"Cannot add elemens because the subset collection is not resolved yet.\");\n        };\n        SubsetOfCollection.prototype.toggleAll = function () {\n            return this.length ? this.reset() : this.addAll();\n        };\n        SubsetOfCollection = __decorate([\n            define\n        ], SubsetOfCollection);\n        return SubsetOfCollection;\n    }(CollectionConstructor));\n    return SubsetOfCollection;\n}\nfunction resolveRefs(master, elements) {\n    var records = [];\n    for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n        var el = elements_1[_i];\n        var record = master.get(el);\n        if (record)\n            records.push(record);\n    }\n    return records;\n}\nfunction delaySet(collection, elements, options) {\n    if (tools.notEqual(collection.refs, elements)) {\n        var isRoot = transactionApi.begin(collection);\n        collection.refs = elements;\n        transactionApi.markAsDirty(collection, options);\n        isRoot && transactionApi.commit(collection);\n    }\n}\nfunction toArray(elements) {\n    return Array.isArray(elements) ? elements : [elements];\n}\n//# sourceMappingURL=subsetOf.js.map","import * as tools from './tools';\nexport { tools };\nexport * from './mixins';\nexport * from './events';\nimport * as eventsApi from './eventsource';\nexport { eventsApi };\nimport { Mixable } from './mixins';\nObject.extend = function (protoProps, staticProps) { return Mixable.extend(protoProps, staticProps); };\nObject.assign || (Object.assign = tools.assign);\nObject.log = tools.log;\n//# sourceMappingURL=index.js.map","var ValidationError = (function () {\n    function ValidationError(obj) {\n        this.length = obj._validateNested(this.nested = {});\n        if (this.error = obj.validate(obj)) {\n            this.length++;\n        }\n    }\n    ValidationError.prototype.each = function (iteratee) {\n        var _a = this, error = _a.error, nested = _a.nested;\n        if (error)\n            iteratee(error, null);\n        for (var key in nested) {\n            iteratee(nested[key], key);\n        }\n    };\n    ValidationError.prototype.eachError = function (iteratee, object) {\n        this.each(function (value, key) {\n            if (value instanceof ValidationError) {\n                value.eachError(iteratee, object.get(key));\n            }\n            else {\n                iteratee(value, key, object);\n            }\n        });\n    };\n    return ValidationError;\n}());\nexport { ValidationError };\n//# sourceMappingURL=validation.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Messenger, tools, mixins, eventsApi, define } from './object-plus';\nimport { ValidationError } from './validation';\nimport { resolveReference } from './traversable';\nvar assign = tools.assign, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off;\nexport var ItemsBehavior;\n(function (ItemsBehavior) {\n    ItemsBehavior[ItemsBehavior[\"share\"] = 1] = \"share\";\n    ItemsBehavior[ItemsBehavior[\"listen\"] = 2] = \"listen\";\n    ItemsBehavior[ItemsBehavior[\"persistent\"] = 4] = \"persistent\";\n})(ItemsBehavior || (ItemsBehavior = {}));\nvar Transactional = (function () {\n    function Transactional(cid) {\n        this._events = void 0;\n        this._changeToken = {};\n        this._transaction = false;\n        this._isDirty = null;\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this._validationError = void 0;\n        this.cid = this.cidPrefix + cid;\n    }\n    Transactional_1 = Transactional;\n    Transactional.onExtend = function (BaseClass) {\n        if (BaseClass.create === this.create) {\n            this.create = Transactional_1.create;\n        }\n    };\n    Transactional.create = function (a, b) {\n        return new this(a, b);\n    };\n    Transactional.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this.off();\n        this.stopListening();\n        this._disposed = true;\n    };\n    Transactional.prototype.initialize = function () { };\n    Transactional.prototype.onChanges = function (handler, target) {\n        on(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.offChanges = function (handler, target) {\n        off(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.listenToChanges = function (target, handler) {\n        this.listenTo(target, target._changeEventName, handler);\n    };\n    Transactional.prototype.transaction = function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = transactionApi.begin(this);\n        var update = fun.call(this, this);\n        update && this.set(update);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.updateEach = function (iteratee, options) {\n        var isRoot = transactionApi.begin(this);\n        this.each(iteratee);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.set = function (values, options) {\n        if (values) {\n            var transaction = this._createTransaction(values, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Transactional.prototype.assignFrom = function (source) {\n        return this.set(source.__inner_state__ || source, { merge: true });\n    };\n    Transactional.prototype.parse = function (data, options) { return data; };\n    Transactional.prototype.deepGet = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.get ? object.get(key) : object[key]; });\n    };\n    Transactional.prototype.getOwner = function () {\n        return this._owner;\n    };\n    Transactional.prototype.getStore = function () {\n        var _owner = this._owner;\n        return _owner ? _owner.getStore() : this._defaultStore;\n    };\n    Transactional.prototype.map = function (iteratee, context) {\n        var arr = [], fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = fun(val, key);\n            if (result !== void 0)\n                arr.push(result);\n        });\n        return arr;\n    };\n    Transactional.prototype.mapObject = function (iteratee, context) {\n        var obj = {}, fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = iteratee(val, key);\n            if (result !== void 0)\n                obj[key] = result;\n        });\n        return obj;\n    };\n    Object.defineProperty(Transactional.prototype, \"validationError\", {\n        get: function () {\n            var error = this._validationError || (this._validationError = new ValidationError(this));\n            return error.length ? error : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Transactional.prototype.validate = function (obj) { };\n    Transactional.prototype.getValidationError = function (key) {\n        var error = this.validationError;\n        return (key ? error && error.nested[key] : error) || null;\n    };\n    Transactional.prototype.deepValidationError = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.getValidationError(key); });\n    };\n    Transactional.prototype.eachValidationError = function (iteratee) {\n        var validationError = this.validationError;\n        validationError && validationError.eachError(iteratee, this);\n    };\n    Transactional.prototype.isValid = function (key) {\n        return !this.getValidationError(key);\n    };\n    Transactional.prototype.valueOf = function () { return this.cid; };\n    Transactional.prototype.toString = function () { return this.cid; };\n    Transactional.prototype.getClassName = function () {\n        var name = this.constructor.name;\n        if (name !== 'Subclass')\n            return name;\n    };\n    Transactional = Transactional_1 = __decorate([\n        define,\n        mixins(Messenger)\n    ], Transactional);\n    return Transactional;\n    var Transactional_1;\n}());\nexport { Transactional };\nexport var transactionApi = {\n    begin: function (object) {\n        return object._transaction ? false : (object._transaction = true);\n    },\n    markAsDirty: function (object, options) {\n        var dirty = !options.silent;\n        if (dirty)\n            object._isDirty = options;\n        object._changeToken = {};\n        object._validationError = void 0;\n        return dirty;\n    },\n    commit: function (object, initiator) {\n        var originalOptions = object._isDirty;\n        if (originalOptions) {\n            while (object._isDirty) {\n                var options = object._isDirty;\n                object._isDirty = null;\n                trigger3(object, object._changeEventName, object, options, initiator);\n            }\n            object._transaction = false;\n            var _owner = object._owner;\n            if (_owner && _owner !== initiator) {\n                _owner._onChildrenChange(object, originalOptions);\n            }\n        }\n        else {\n            object._isDirty = null;\n            object._transaction = false;\n        }\n    },\n    aquire: function (owner, child, key) {\n        if (!child._owner) {\n            child._owner = owner;\n            child._ownerKey = key;\n            return true;\n        }\n        return child._owner === owner;\n    },\n    free: function (owner, child) {\n        if (owner === child._owner) {\n            child._owner = void 0;\n            child._ownerKey = void 0;\n        }\n    }\n};\n//# sourceMappingURL=transactions.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AnyType } from './any';\nimport { transactionApi, ItemsBehavior } from '../../transactions';\nvar free = transactionApi.free, aquire = transactionApi.aquire;\nvar AggregatedType = (function (_super) {\n    __extends(AggregatedType, _super);\n    function AggregatedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    AggregatedType.prototype.clone = function (value) {\n        return value ? value.clone() : value;\n    };\n    AggregatedType.prototype.toJSON = function (x) { return x && x.toJSON(); };\n    AggregatedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AggregatedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AggregatedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null) {\n            if (next instanceof this.type) {\n                if (options.merge)\n                    return next.__inner_state__;\n            }\n            else {\n                return next;\n            }\n        }\n    };\n    AggregatedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null)\n            return next;\n        if (next instanceof this.type) {\n            if (next._shared && !(next._shared & ItemsBehavior.persistent)) {\n                this._log('error', 'aggregated collection attribute is assigned with shared collection', next, record);\n            }\n            return options.merge ? next.clone() : next;\n        }\n        return this.type.create(next, options);\n    };\n    AggregatedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    AggregatedType.prototype.validate = function (record, value) {\n        var error = value && value.validationError;\n        if (error)\n            return error;\n    };\n    AggregatedType.prototype.create = function () {\n        return this.type.create();\n    };\n    AggregatedType.prototype.initialize = function (options) {\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    AggregatedType.prototype._handleChange = function (next, prev, record) {\n        if (prev) {\n            free(record, prev);\n            prev.dispose();\n        }\n        if (next && !aquire(record, next, this.name)) {\n            this._log('error', 'aggregated attribute assigned with object already having an owner', next, record);\n        }\n    };\n    return AggregatedType;\n}(AnyType));\nexport { AggregatedType };\n//# sourceMappingURL=owned.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AnyType } from '../record';\nimport { parseReference } from './commons';\nimport { Record } from '../record';\nimport { ChainableAttributeSpec } from '../record';\nvar RecordRefType = (function (_super) {\n    __extends(RecordRefType, _super);\n    function RecordRefType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RecordRefType.prototype.toJSON = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.clone = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.isChanged = function (a, b) {\n        var aId = a && (a.id == null ? a : a.id), bId = b && (b.id == null ? b : b.id);\n        return aId !== bId;\n    };\n    RecordRefType.prototype.validate = function (model, value, name) { };\n    return RecordRefType;\n}(AnyType));\nRecord.from = function from(masterCollection) {\n    var getMasterCollection = parseReference(masterCollection);\n    var typeSpec = new ChainableAttributeSpec({\n        value: null,\n        _attribute: RecordRefType\n    });\n    return typeSpec\n        .get(function (objOrId, name) {\n        if (typeof objOrId === 'object')\n            return objOrId;\n        var collection = getMasterCollection(this);\n        var record = null;\n        if (collection && collection.length) {\n            record = collection.get(objOrId) || null;\n            this.attributes[name] = record;\n            record && this._attributes[name].handleChange(record, null, this, {});\n        }\n        return record;\n    });\n};\n//# sourceMappingURL=from.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Record } from '../record';\nimport { Transactional } from '../transactions';\nvar _store = null;\nvar Store = (function (_super) {\n    __extends(Store, _super);\n    function Store() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Store.prototype.getStore = function () { return this; };\n    Store.prototype.get = function (name) {\n        var local = this[name];\n        if (local || this === this._defaultStore)\n            return local;\n        return this._owner ? this._owner.get(name) : this._defaultStore.get(name);\n    };\n    Object.defineProperty(Store, \"global\", {\n        get: function () { return _store; },\n        set: function (store) {\n            if (_store) {\n                _store.dispose();\n            }\n            Transactional.prototype._defaultStore = _store = store;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Store;\n}(Record));\nexport { Store };\nStore.global = new Store();\n//# sourceMappingURL=store.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nexport * from './object-plus';\nexport * from './collection';\nexport * from './relations';\nexport * from './record';\nimport { Events } from './object-plus/';\nexport var on = (_a = Events, _a.on), off = _a.off, trigger = _a.trigger, once = _a.once, listenTo = _a.listenTo, stopListening = _a.stopListening, listenToOnce = _a.listenToOnce;\nimport { Record as Model } from './record';\nimport { define, Mixable as Class } from './object-plus/';\nexport { Model, Class };\nexport function attributes(attrDefs) {\n    var DefaultRecord = (function (_super) {\n        __extends(DefaultRecord, _super);\n        function DefaultRecord() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultRecord.attributes = attrDefs;\n        DefaultRecord = __decorate([\n            define\n        ], DefaultRecord);\n        return DefaultRecord;\n    }(Model));\n    return DefaultRecord;\n}\nimport { ChainableAttributeSpec } from './record';\nexport function value(x) {\n    return new ChainableAttributeSpec({ value: x });\n}\nexport function transaction(method) {\n    return function () {\n        var _this = this;\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var result;\n        this.transaction(function () {\n            result = method.apply(_this, args);\n        });\n        return result;\n    };\n}\nvar _a;\n//# sourceMappingURL=index.js.map"],"names":["isValidJSON","value","proto","Object","getPrototypeOf","prototype","Array","every","getBaseClass","Class","constructor","isEmpty","obj","key","hasOwnProperty","someArray","arr","fun","result","i","length","someObject","some","ArrayProto","predicate","x","omit","source","dest","discard","arguments","name","transform","assign","other","defaults","once","func","memo","first","apply","this","notEqual","a","b","protoA","DateProto","arraysNotEqual","ObjectProto","objectsNotEqual","keysA","keys","predefine","Constructor","BaseClass","__super__","define","MixinsState","get","Mixable","populate","onExtend","ClassOrDefinition","Ctor","definitions","rules","mixins","definitionRules","definitionDecorator","definitionKey","mergeObject","_a","_b","forEachOwnProp","object","ignore","dontMix","_i","getOwnPropertyNames","name_2","assignProperty","sourceProp","rule","unshift","destProp","getOwnPropertyDescriptor","configurable","resolveRule","defineProperty","getBubblingHandler","event","_bubblingHandlers","c","d","e","trigger5","trigger3","trigger2","listOff","_events","callback","context","filteredHead","prev","head","ev","next","_callback","listSend2","call","listSend3","listSend4","listSend5","listSend6","f","on","create","EventHandler","once_1","_once","off","name_3","strings","api","events","eventSplitter","test","names_1","split","self","queue","all","uniqueId","_idCount","toPropertyDescriptor","addReference","listener","_listeningTo","cid","resolveReference","root","reference","action","path","match","referenceMask","skip","getStore","getOwner","setAttribute","record","isRoot","begin","options","_attributes","doUpdate","markAsDirty","attributes","commit","_begin","_previousAttributes","AttributesCopy","_changedAttributes","_markAsDirty","constructorsMixin","attrDefs","attrs","Function","map","attr","join","Attributes","shouldBeAnObject","values","_log","chainGetHooks","prevHook","nextHook","chainTransforms","prevTransform","nextTransform","chainChangeHandlers","prevHandler","nextHandler","wrapIsRequired","validate","emptyFunction","toAttributeOptions","spec","attrSpec","has","ChainableAttributeSpec","type","inferType","Transactional","shared","hasCustomDefault","Number","String","Boolean","supportsDate","date","isNaN","Date","getTime","safeParseDate","timestamp","struct","minutesOffset","isoDatePattern","exec","k","numericKeys","undefined","UTC","parse","Integer","Math","round","doNothing","createAttribute","AnyType","parseMixin","attrsWithParse","filter","_parse","createToJSON","toJSON","createSharedTypeSpec","Attribute","_attribute","localEventsMixin","attrSpecs","_localEvents","_onChange","eventsApi.EventMap","addEvent","createWatcherFromRef","wrapWatcher","watcher","ref","CompiledReference","local","resolve","tail","typeCheck","unknown","push","getAttributes","idAttribute","definition","dispose","collection","models","_byId","freeAll","convertAndAquire","model","_shared","ItemsBehavior","listen","_changeEventName","_onChildrenChange","merge","clone","_aquire","_aggregationError","_itemEvents","subscribe","free","owner","child","unset","_free","unsubscribe","children","children_1","sortElements","_comparator","sort","addIndex","index","id","removeIndex","updateIndex","previous","logAggregationError","addTransaction","items","nested","added","appendElements","needSort","sortOrMoveElements","CollectionTransaction","at","length_1","moveElements","j","a_items","a_options","forceMerge","prevLength","a_items_1","item","transaction","_createTransaction","hasChanged","slice","emptySetTransaction","silent","_reallocateEmpty","silentOptions","setTransaction","_reallocate","reusedCount","removed","_garbageCollect","addedOrChanged","sorted","previous_1","_prevById","prevModels","toAdd","orderKept","len","src","removeOne","el","splice","indexOf","notify","removeMany","toRemove","_removeFromIndex","toElements","elements","parsed","isArray","bindContext","v","toPredicateFunction","iteratee","parseReference","collectionRef","defineSubsetCollection","CollectionConstructor","_super","SubsetOfCollection","recordsOrIds","_this","subsetOfBehavior","resolvedWith","refs","toArray","__extends","enumerable","add","a_elements","resolveRefs","transactionApi","concat","reset","delaySet","objOrId","_validateNested","copy","comparator","raw","getModelIds","toggle","modelOrId","val","addAll","set","Error","toggleAll","__decorate","master","records","elements_1","tools.notEqual","levelToNumber","none","error","warn","info","log","debug","a_level","a_msg","a_props","msg","props","level","levelAsNumber","throw","logger","stop","process","env","NODE_ENV","console","args","name_1","setPrototypeOf","names","prop","desc","o","extendStatics","__proto__","p","__","__rest","s","t","getOwnPropertySymbols","protoProps","staticProps","defineMixin","getStaticDefinitions","onDefine","mergeInheritedMembers","extend","statics","TheSubclass","Subclass","mergeRules","appliedMixins","mixins_1","mixin","sourceMixins","ctors","ctors_1","mixinRules","protoValue","baseProto","function","caller","list","pipe","classFirst","classLast","EventMap","handlers","addEventsMap","bubbleEvents","EventDescriptor","target","event_1","event_2","handler","decorators","r","Reflect","decorate","_eventsApi.strings","_eventsApi.on","_eventsApi.off","_eventsApi.once","_eventsApi.trigger5","_eventsApi.trigger2","_eventsApi.trigger3","Messenger","initialize","localEvents","properties","eventsMap","defineProperties","trigger","listenTo","listenToOnce","stopListening","a_source","removeAll","second","_disposed","Events","tools.assign","tools.log","ValidationError","each","eachError","splitTail","substr","pop","eventsApi.trigger3","eventsApi.on","eventsApi.off","_changeToken","_transaction","_isDirty","_owner","_ownerKey","_validationError","cidPrefix","Transactional_1","onChanges","offChanges","listenToChanges","update","updateEach","assignFrom","__inner_state__","data","deepGet","_defaultStore","mapObject","getValidationError","validationError","deepValidationError","eachValidationError","isValid","valueOf","toString","getClassName","dirty","initiator","originalOptions","aquire","UpdateRecordMixin","attribute","propagateChanges","forceAttributeChange","a_values","changes","RecordTransaction","nested_1","nested_2","changes_1","emptyOptions","getHook","getHooks","transforms","changeHandlers","changeEvents","defaultValue","tools.isValidJSON","JSON","stringify","isRequired","convert","getHook_1","reduce","validate_1","handleChange","canBeUpdated","isChanged","createPropertyDescriptor","doInit","text","Record","Attribute definition","Prev. value","New value","AggregatedType","nestedTransaction","persistent","_handleChange","check","metadata","changed","eventMap","cloned","_isRequired","asProp","_has","DateType","toISOString","msDatePattern","MSDateType","msDate","TimestampType","microsoft","ImmutableClassType","PrimitiveType","NumericType","num","isFinite","integer","window","ArrayType","ObjectType","FunctionType","shareAndListen","share","SharedType","implicitObject","__assign","n","attributesDefinition","baseClassAttributes","myAttributes","_.transform","allAttributes","_.defaults","ConstructorsMixin","_attributesArray","_toJSON","tools.isEmpty","_cidCounter","previousAttributes","changedAttributes","diff","old","isNew","clear","nullify","forEachAttr","pinStore","deepClone","errors","json","asJson","deepSet","l","newModel","Attributes definition:","Collection","BaseRecordAttributes","BaseRecordAttributesCopy","IdAttribute","tools.defaults","DefaultCollection","compile","dynamicMixin","eventsApi.trigger2","_c","_d","added_1","_e","removed_1","_count","CollectionRefsType","createSubset","subset","SubsetOf","subsetOf","RefsCollection","_SubsetOf","Refs","Subset","itemEvents","aa","bb","_store","find","mapped","count","last","a_index","aggregated","previousModels","remove","pluck","shift","modelId","a_next","Argument","Attributes spec","RecordRefType","from","masterCollection","getMasterCollection","Store","store","global","DefaultRecord","Model","method","attrName","getMetadata"],"mappings":"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"}
