{"version":3,"file":"index.js","sources":["../node_modules/tslib/tslib.es6.js","../lib/object-plus/tools.js","../lib/object-plus/mixins.js","../lib/object-plus/eventsource.js","../lib/object-plus/events.js","../lib/traversable.js","../lib/record/attributes/updates.js","../lib/record/attributes/any.js","../lib/record/attributes/attrDef.js","../lib/record/attributes/date.js","../lib/record/attributes/basic.js","../lib/record/attributes/shared.js","../lib/record/attributes/index.js","../lib/record/record.js","../lib/record/index.js","../lib/collection/commons.js","../lib/collection/add.js","../lib/collection/set.js","../lib/collection/remove.js","../lib/collection/index.js","../lib/relations/commons.js","../lib/relations/subsetOf.js","../lib/object-plus/index.js","../lib/validation.js","../lib/transactions.js","../lib/record/attributes/owned.js","../lib/relations/from.js","../lib/relations/store.js","../lib/index.js"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = Object.setPrototypeOf ||\r\n    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);  }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { if (o[n]) i[n] = function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; }; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator];\r\n    return m ? m.call(o) : typeof __values === \"function\" ? __values(o) : o[Symbol.iterator]();\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n","var levelToNumber = {\n    none: 0, error: 1, warn: 2, info: 3, log: 4, debug: 5\n};\nexport var log = function (a_level, a_msg, a_props) {\n    var levelAsNumber = levelToNumber[a_level], msg, props, level;\n    if (levelAsNumber === void 0 && !a_props) {\n        levelAsNumber = 4;\n        msg = a_level;\n        props = a_msg;\n        level = 'log';\n    }\n    else {\n        msg = a_msg, level = a_level, props = a_props;\n    }\n    if (levelAsNumber <= log.level) {\n        if (levelAsNumber <= log.throw || !log.logger) {\n            var error = new Error(msg);\n            error.props = props;\n            throw error;\n        }\n        else {\n            log.logger(level, msg, props);\n            if (levelAsNumber <= log.stop) {\n                debugger;\n            }\n        }\n    }\n};\nlog.level = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'production' ? 1 : 2;\nlog.throw = 0;\nlog.stop = 0;\nif (typeof console !== 'undefined') {\n    log.logger = function _console(level, error, props) {\n        var args = [error];\n        for (var name_1 in props) {\n            args.push(\"\\n\\t\" + name_1 + \":\", props[name_1]);\n        }\n        console[level].apply(console, args);\n    };\n}\nexport function isValidJSON(value) {\n    if (value === null) {\n        return true;\n    }\n    switch (typeof value) {\n        case 'number':\n        case 'string':\n        case 'boolean':\n            return true;\n        case 'object':\n            var proto = Object.getPrototypeOf(value);\n            if (proto === Object.prototype || proto === Array.prototype) {\n                return every(value, isValidJSON);\n            }\n    }\n    return false;\n}\nexport function getBaseClass(Class) {\n    return Object.getPrototypeOf(Class.prototype).constructor;\n}\nexport function assignToClassProto(Class, definition) {\n    var names = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        names[_i - 2] = arguments[_i];\n    }\n    for (var _a = 0, names_1 = names; _a < names_1.length; _a++) {\n        var name_2 = names_1[_a];\n        var value = definition[name_2];\n        value === void 0 || (Class.prototype[name_2] = value);\n    }\n}\nexport function isEmpty(obj) {\n    if (obj) {\n        for (var key in obj) {\n            if (obj.hasOwnProperty(key)) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\nfunction someArray(arr, fun) {\n    var result;\n    for (var i = 0; i < arr.length; i++) {\n        if (result = fun(arr[i], i)) {\n            return result;\n        }\n    }\n}\nfunction someObject(obj, fun) {\n    var result;\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            if (result = fun(obj[key], key)) {\n                return result;\n            }\n        }\n    }\n}\nexport function some(obj, fun) {\n    if (Object.getPrototypeOf(obj) === ArrayProto) {\n        return someArray(obj, fun);\n    }\n    else {\n        return someObject(obj, fun);\n    }\n}\nexport function every(obj, predicate) {\n    return !some(obj, function (x) { return !predicate(x); });\n}\nexport function getPropertyDescriptor(obj, prop) {\n    var desc;\n    for (var proto = obj; !desc && proto; proto = Object.getPrototypeOf(proto)) {\n        desc = Object.getOwnPropertyDescriptor(proto, prop);\n    }\n    return desc;\n}\nexport function omit(source) {\n    var dest = {}, discard = {};\n    for (var i = 1; i < arguments.length; i++) {\n        discard[arguments[i]] = true;\n    }\n    for (var name in source) {\n        if (!discard.hasOwnProperty(name) && source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function transform(dest, source, fun) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            var value = fun(source[name], name);\n            value === void 0 || (dest[name] = value);\n        }\n    }\n    return dest;\n}\nexport function fastAssign(dest, source) {\n    for (var name in source) {\n        dest[name] = source[name];\n    }\n    return dest;\n}\nexport function fastDefaults(dest, source) {\n    for (var name in source) {\n        if (dest[name] === void 0) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function assign(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && assign(dest, other);\n        }\n    }\n    return dest;\n}\nexport function defaults(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name) && !dest.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && defaults(dest, other);\n        }\n    }\n    return dest;\n}\nObject.setPrototypeOf || (Object.setPrototypeOf = defaults);\nexport function keys(o) {\n    return o ? Object.keys(o) : [];\n}\nexport function once(func) {\n    var memo, first = true;\n    return function () {\n        if (first) {\n            first = false;\n            memo = func.apply(this, arguments);\n            func = null;\n        }\n        return memo;\n    };\n}\nvar ArrayProto = Array.prototype, DateProto = Date.prototype, ObjectProto = Object.prototype;\nexport function notEqual(a, b) {\n    if (a === b)\n        return false;\n    if (a && b && typeof a == 'object' && typeof b == 'object') {\n        var protoA = Object.getPrototypeOf(a);\n        if (protoA !== Object.getPrototypeOf(b))\n            return true;\n        switch (protoA) {\n            case DateProto: return +a !== +b;\n            case ArrayProto: return arraysNotEqual(a, b);\n            case ObjectProto:\n            case null:\n                return objectsNotEqual(a, b);\n        }\n    }\n    return true;\n}\nfunction objectsNotEqual(a, b) {\n    var keysA = Object.keys(a);\n    if (keysA.length !== Object.keys(b).length)\n        return true;\n    for (var i = 0; i < keysA.length; i++) {\n        var key = keysA[i];\n        if (!b.hasOwnProperty(key) || notEqual(a[key], b[key])) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction arraysNotEqual(a, b) {\n    if (a.length !== b.length)\n        return true;\n    for (var i = 0; i < a.length; i++) {\n        if (notEqual(a[i], b[i]))\n            return true;\n    }\n    return false;\n}\n//# sourceMappingURL=tools.js.map","import * as tslib_1 from \"tslib\";\nimport { assign, getBaseClass, defaults, transform } from './tools';\nimport { __extends } from 'tslib';\nvar Mixable = (function () {\n    function Mixable() {\n    }\n    Mixable.define = function (protoProps, staticProps) {\n        if (protoProps === void 0) { protoProps = {}; }\n        var BaseClass = getBaseClass(this);\n        staticProps && assign(this, staticProps);\n        var mixins = protoProps.mixins, defineMixin = tslib_1.__rest(protoProps, [\"mixins\"]);\n        mixins && this.mixins.merge(mixins);\n        this.mixins.mergeObject(this.prototype, defineMixin, true);\n        this.mixins.mergeObject(this.prototype, this.mixins.getStaticDefinitions(BaseClass), true);\n        this.onDefine && this.onDefine(this.mixins.definitions, BaseClass);\n        this.mixins.mergeInheritedMembers(BaseClass);\n        return this;\n    };\n    Mixable.extend = function (spec, statics) {\n        var TheSubclass;\n        if (spec && spec.hasOwnProperty('constructor')) {\n            TheSubclass = spec.constructor;\n            __extends(TheSubclass, this);\n        }\n        else {\n            TheSubclass = (function (_super) {\n                tslib_1.__extends(Subclass, _super);\n                function Subclass() {\n                    return _super !== null && _super.apply(this, arguments) || this;\n                }\n                return Subclass;\n            }(this));\n        }\n        predefine(TheSubclass);\n        spec && TheSubclass.define(spec, statics);\n        return TheSubclass;\n    };\n    return Mixable;\n}());\nexport { Mixable };\nexport function predefine(Constructor) {\n    var BaseClass = getBaseClass(Constructor);\n    Constructor.__super__ = BaseClass.prototype;\n    Constructor.define || MixinsState.get(Mixable).populate(Constructor);\n    MixinsState.get(Constructor);\n    Constructor.onExtend && Constructor.onExtend(BaseClass);\n}\nexport function define(ClassOrDefinition) {\n    if (typeof ClassOrDefinition === 'function') {\n        predefine(ClassOrDefinition);\n        ClassOrDefinition.define();\n    }\n    else {\n        return function (Ctor) {\n            predefine(Ctor);\n            Ctor.define(ClassOrDefinition);\n        };\n    }\n}\nexport function definitions(rules) {\n    return function (Class) {\n        var mixins = MixinsState.get(Class);\n        mixins.definitionRules = defaults(rules, mixins.definitionRules);\n    };\n}\nexport function definitionDecorator(definitionKey, value) {\n    return function (proto, name) {\n        MixinsState\n            .get(proto.constructor)\n            .mergeObject(proto, (_a = {},\n            _a[definitionKey] = (_b = {},\n                _b[name] = value,\n                _b),\n            _a));\n        var _a, _b;\n    };\n}\nvar MixinsState = (function () {\n    function MixinsState(Class) {\n        this.Class = Class;\n        this.definitions = {};\n        var mixins = getBaseClass(Class).mixins;\n        this.mergeRules = (mixins && mixins.mergeRules) || {};\n        this.definitionRules = (mixins && mixins.definitionRules) || {};\n        this.appliedMixins = (mixins && mixins.appliedMixins) || [];\n    }\n    MixinsState.get = function (Class) {\n        var mixins = Class.mixins;\n        return mixins && Class === mixins.Class ? mixins :\n            Class.mixins = new MixinsState(Class);\n    };\n    MixinsState.prototype.getStaticDefinitions = function (BaseClass) {\n        var definitions = {}, Class = this.Class;\n        return transform(definitions, this.definitionRules, function (rule, name) {\n            if (BaseClass[name] !== Class[name]) {\n                return Class[name];\n            }\n        });\n    };\n    MixinsState.prototype.merge = function (mixins) {\n        var proto = this.Class.prototype, mergeRules = this.mergeRules;\n        var appliedMixins = this.appliedMixins = this.appliedMixins.slice();\n        for (var _i = 0, mixins_1 = mixins; _i < mixins_1.length; _i++) {\n            var mixin = mixins_1[_i];\n            if (Array.isArray(mixin)) {\n                this.merge(mixin);\n            }\n            else if (appliedMixins.indexOf(mixin) < 0) {\n                appliedMixins.push(mixin);\n                if (typeof mixin === 'function') {\n                    if (getBaseClass(mixin) !== Object) {\n                        console.log('Mixin error');\n                    }\n                    this.mergeObject(this.Class, mixin);\n                    var sourceMixins = mixin.mixins;\n                    if (sourceMixins) {\n                        this.mergeRules = defaults({}, this.mergeRules, sourceMixins.mergeRules);\n                        this.definitionRules = defaults({}, this.definitionRules, sourceMixins.definitionRules);\n                        this.appliedMixins = this.appliedMixins.concat(sourceMixins.appliedMixins);\n                    }\n                    this.mergeObject(proto, mixin.prototype);\n                }\n                else {\n                    this.mergeObject(proto, mixin);\n                }\n            }\n        }\n    };\n    MixinsState.prototype.populate = function () {\n        var ctors = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            ctors[_i] = arguments[_i];\n        }\n        for (var _a = 0, ctors_1 = ctors; _a < ctors_1.length; _a++) {\n            var Ctor = ctors_1[_a];\n            MixinsState.get(Ctor).merge([this.Class]);\n        }\n    };\n    MixinsState.prototype.mergeObject = function (dest, source, unshift) {\n        var _this = this;\n        forEachOwnProp(source, function (name) {\n            var sourceProp = Object.getOwnPropertyDescriptor(source, name);\n            var rule;\n            if (rule = _this.definitionRules[name]) {\n                assignProperty(_this.definitions, name, sourceProp, rule, unshift);\n            }\n            if (!rule || rule === mixinRules.protoValue) {\n                assignProperty(dest, name, sourceProp, _this.mergeRules[name], unshift);\n            }\n        });\n    };\n    MixinsState.prototype.mergeInheritedMembers = function (BaseClass) {\n        var _a = this, mergeRules = _a.mergeRules, Class = _a.Class;\n        if (mergeRules) {\n            var proto = Class.prototype, baseProto = BaseClass.prototype;\n            for (var name_1 in mergeRules) {\n                var rule = mergeRules[name_1];\n                if (proto.hasOwnProperty(name_1) && name_1 in baseProto) {\n                    proto[name_1] = resolveRule(proto[name_1], baseProto[name_1], rule);\n                }\n            }\n        }\n    };\n    return MixinsState;\n}());\nexport { MixinsState };\nvar dontMix = {\n    function: {\n        length: true,\n        prototype: true,\n        caller: true,\n        arguments: true,\n        name: true,\n        __super__: true\n    },\n    object: {\n        constructor: true,\n        toString: false,\n        valueOf: false\n    }\n};\nfunction forEachOwnProp(object, fun) {\n    var ignore = dontMix[typeof object];\n    for (var _i = 0, _a = Object.getOwnPropertyNames(object); _i < _a.length; _i++) {\n        var name_2 = _a[_i];\n        ignore[name_2] || fun(name_2);\n    }\n}\nexport var mixins = function () {\n    var list = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        list[_i] = arguments[_i];\n    }\n    return (function (Class) { return MixinsState.get(Class).merge(list); });\n};\nexport var mixinRules = (function (rules) { return (function (Class) {\n    var mixins = MixinsState.get(Class);\n    mixins.mergeRules = defaults(rules, mixins.mergeRules);\n}); });\nmixinRules.value = function (a, b) { return a; };\nmixinRules.protoValue = function (a, b) { return a; };\nmixinRules.merge = function (a, b) { return defaults({}, a, b); };\nmixinRules.pipe = function (a, b) { return (function (x) {\n    return a.call(this, b.call(this, x));\n}); };\nmixinRules.defaults = function (a, b) { return (function () {\n    return defaults(a.apply(this, arguments), b.apply(this, arguments));\n}); };\nmixinRules.classFirst = function (a, b) { return (function () {\n    a.apply(this, arguments);\n    b.apply(this, arguments);\n}); };\nmixinRules.classLast = function (a, b) { return (function () {\n    b.apply(this, arguments);\n    a.apply(this, arguments);\n}); };\nmixinRules.every = function (a, b) { return (function () {\n    return a.apply(this, arguments) && b.apply(this, arguments);\n}); };\nmixinRules.some = function (a, b) { return (function () {\n    return a.apply(this, arguments) || b.apply(this, arguments);\n}); };\nfunction assignProperty(dest, name, sourceProp, rule, unshift) {\n    if (dest.hasOwnProperty(name)) {\n        var destProp = Object.getOwnPropertyDescriptor(dest, name);\n        if (destProp.configurable && 'value' in destProp) {\n            dest[name] = unshift ?\n                resolveRule(sourceProp.value, destProp.value, rule) :\n                resolveRule(destProp.value, sourceProp.value, rule);\n        }\n    }\n    else {\n        Object.defineProperty(dest, name, sourceProp);\n    }\n}\nfunction resolveRule(dest, source, rule) {\n    if (dest === void 0)\n        return source;\n    if (!rule || source === void 0)\n        return dest;\n    return rule(dest, source);\n}\n//# sourceMappingURL=mixins.js.map","import { once as _once } from './tools';\nvar EventMap = (function () {\n    function EventMap(map) {\n        this.handlers = [];\n        if (map) {\n            if (map instanceof EventMap) {\n                this.handlers = map.handlers.slice();\n            }\n            else {\n                map && this.addEventsMap(map);\n            }\n        }\n    }\n    EventMap.prototype.merge = function (map) {\n        this.handlers = this.handlers.concat(map.handlers);\n    };\n    EventMap.prototype.addEventsMap = function (map) {\n        for (var names in map) {\n            this.addEvent(names, map[names]);\n        }\n    };\n    EventMap.prototype.bubbleEvents = function (names) {\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_1 = _a[_i];\n            this.addEvent(name_1, getBubblingHandler(name_1));\n        }\n    };\n    EventMap.prototype.addEvent = function (names, callback) {\n        var handlers = this.handlers;\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_2 = _a[_i];\n            handlers.push(new EventDescriptor(name_2, callback));\n        }\n    };\n    EventMap.prototype.subscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_1 = _a[_i];\n            on(source, event_1.name, event_1.callback, target);\n        }\n    };\n    EventMap.prototype.unsubscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_2 = _a[_i];\n            off(source, event_2.name, event_2.callback, target);\n        }\n    };\n    return EventMap;\n}());\nexport { EventMap };\nvar EventDescriptor = (function () {\n    function EventDescriptor(name, callback) {\n        this.name = name;\n        if (callback === true) {\n            this.callback = getBubblingHandler(name);\n        }\n        else if (typeof callback === 'string') {\n            this.callback =\n                function localCallback() {\n                    var handler = this[callback];\n                    handler && handler.apply(this, arguments);\n                };\n        }\n        else {\n            this.callback = callback;\n        }\n    }\n    return EventDescriptor;\n}());\nexport { EventDescriptor };\nvar _bubblingHandlers = {};\nfunction getBubblingHandler(event) {\n    return _bubblingHandlers[event] || (_bubblingHandlers[event] = function (a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, event, a, b, c, d, e);\n        if (c !== void 0)\n            trigger3(this, event, a, b, c);\n        else\n            trigger2(this, event, a, b);\n    });\n}\nvar EventHandler = (function () {\n    function EventHandler(callback, context, next) {\n        if (next === void 0) { next = null; }\n        this.callback = callback;\n        this.context = context;\n        this.next = next;\n    }\n    return EventHandler;\n}());\nexport { EventHandler };\nfunction listOff(_events, name, callback, context) {\n    var head = _events[name];\n    var filteredHead, prev;\n    for (var ev = head; ev; ev = ev.next) {\n        if ((callback && callback !== ev.callback && callback !== ev.callback._callback) ||\n            (context && context !== ev.context)) {\n            prev = ev;\n            filteredHead || (filteredHead = ev);\n        }\n        else {\n            if (prev)\n                prev.next = ev.next;\n        }\n    }\n    if (head !== filteredHead)\n        _events[name] = filteredHead;\n}\nfunction listSend2(head, a, b) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b);\n}\nfunction listSend3(head, a, b, c) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c);\n}\nfunction listSend4(head, a, b, c, d) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d);\n}\nfunction listSend5(head, a, b, c, d, e) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e);\n}\nfunction listSend6(head, a, b, c, d, e, f) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e, f);\n}\nexport function on(source, name, callback, context) {\n    if (callback) {\n        var _events = source._events || (source._events = Object.create(null));\n        _events[name] = new EventHandler(callback, context, _events[name]);\n    }\n}\nexport function once(source, name, callback, context) {\n    if (callback) {\n        var once_1 = _once(function () {\n            off(source, name, once_1);\n            callback.apply(this, arguments);\n        });\n        once_1._callback = callback;\n        on(source, name, once_1, context);\n    }\n}\nexport function off(source, name, callback, context) {\n    var _events = source._events;\n    if (_events) {\n        if (callback || context) {\n            if (name) {\n                listOff(_events, name, callback, context);\n            }\n            else {\n                for (var name_3 in _events) {\n                    listOff(_events, name_3, callback, context);\n                }\n            }\n        }\n        else if (name) {\n            _events[name] = void 0;\n        }\n        else {\n            source._events = void 0;\n        }\n    }\n}\nvar eventSplitter = /\\s+/;\nexport function strings(api, source, events, callback, context) {\n    if (eventSplitter.test(events)) {\n        var names = events.split(eventSplitter);\n        for (var _i = 0, names_1 = names; _i < names_1.length; _i++) {\n            var name_4 = names_1[_i];\n            api(source, name_4, callback, context);\n        }\n    }\n    else\n        api(source, events, callback, context);\n}\nexport function trigger2(self, name, a, b) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend2(queue, a, b);\n        listSend3(all, name, a, b);\n    }\n}\n;\nexport function trigger3(self, name, a, b, c) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend3(queue, a, b, c);\n        listSend4(all, name, a, b, c);\n    }\n}\n;\nexport function trigger5(self, name, a, b, c, d, e) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend5(queue, a, b, c, d, e);\n        listSend6(all, name, a, b, c, d, e);\n    }\n}\n;\n//# sourceMappingURL=eventsource.js.map","import * as tslib_1 from \"tslib\";\nimport { define, mixinRules, definitions } from './mixins';\nimport { omit, transform } from './tools';\nimport { EventMap } from './eventsource';\nimport * as _eventsApi from './eventsource';\nvar EventHandler = _eventsApi.EventHandler, strings = _eventsApi.strings, on = _eventsApi.on, off = _eventsApi.off, once = _eventsApi.once, trigger5 = _eventsApi.trigger5, trigger2 = _eventsApi.trigger2, trigger3 = _eventsApi.trigger3;\nvar eventSplitter = /\\s+/;\nvar _idCount = 0;\nfunction uniqueId() {\n    return 'l' + _idCount++;\n}\nexport { EventMap };\nvar Messenger = (function () {\n    function Messenger() {\n        this._events = void 0;\n        this._listeningTo = void 0;\n        this.cid = uniqueId();\n        this.initialize.apply(this, arguments);\n    }\n    Messenger.onDefine = function (_a, BaseClass) {\n        var localEvents = _a.localEvents, _localEvents = _a._localEvents, properties = _a.properties;\n        if (localEvents || _localEvents) {\n            var eventsMap = new EventMap(this.prototype._localEvents);\n            localEvents && eventsMap.addEventsMap(localEvents);\n            _localEvents && eventsMap.merge(_localEvents);\n            this.prototype._localEvents = eventsMap;\n        }\n        if (properties) {\n            Object.defineProperties(this.prototype, transform({}, properties, toPropertyDescriptor));\n        }\n    };\n    Messenger.prototype.initialize = function () { };\n    Messenger.prototype.on = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(on, this, events, callback, context);\n        else\n            for (var name_1 in events)\n                strings(on, this, name_1, events[name_1], context || callback);\n        return this;\n    };\n    Messenger.prototype.once = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(once, this, events, callback, context);\n        else\n            for (var name_2 in events)\n                strings(once, this, name_2, events[name_2], context || callback);\n        return this;\n    };\n    Messenger.prototype.off = function (events, callback, context) {\n        if (!events)\n            off(this, void 0, callback, context);\n        else if (typeof events === 'string')\n            strings(off, this, events, callback, context);\n        else\n            for (var name_3 in events)\n                strings(off, this, name_3, events[name_3], context || callback);\n        return this;\n    };\n    Messenger.prototype.trigger = function (name, a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, name, a, b, c, d, e);\n        else if (c !== void 0)\n            trigger3(this, name, a, b, c);\n        else\n            trigger2(this, name, a, b);\n        return this;\n    };\n    Messenger.prototype.listenTo = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.on(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.listenToOnce = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.once(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.stopListening = function (a_source, a, b) {\n        var _listeningTo = this._listeningTo;\n        if (_listeningTo) {\n            var removeAll = !(a || b), second = !b && typeof a === 'object' ? this : b;\n            if (a_source) {\n                var source = _listeningTo[a_source.cid];\n                if (source) {\n                    if (removeAll)\n                        delete _listeningTo[a_source.cid];\n                    source.off(a, second, this);\n                }\n            }\n            else if (a_source == null) {\n                for (var cid in _listeningTo)\n                    _listeningTo[cid].off(a, second, this);\n                if (removeAll)\n                    (this._listeningTo = void 0);\n            }\n        }\n        return this;\n    };\n    Messenger.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        this.stopListening();\n        this.off();\n        this._disposed = true;\n    };\n    Messenger = tslib_1.__decorate([\n        define,\n        definitions({\n            properties: mixinRules.merge,\n            localEvents: mixinRules.merge\n        })\n    ], Messenger);\n    return Messenger;\n}());\nexport { Messenger };\nexport var Events = omit(Messenger.prototype, 'constructor', 'initialize');\nfunction toPropertyDescriptor(x) {\n    if (x) {\n        return typeof x === 'function' ? { get: x } : x;\n    }\n}\nfunction addReference(listener, source) {\n    var listeningTo = listener._listeningTo || (listener._listeningTo = Object.create(null)), cid = source.cid || (source.cid = uniqueId());\n    listeningTo[cid] = source;\n}\n//# sourceMappingURL=events.js.map","var referenceMask = /\\^|([^.]+)/g;\nvar CompiledReference = (function () {\n    function CompiledReference(reference, splitTail) {\n        if (splitTail === void 0) { splitTail = false; }\n        var path = reference\n            .match(referenceMask)\n            .map(function (key) {\n            if (key === '^')\n                return 'getOwner()';\n            if (key[0] === '~')\n                return \"getStore().get(\\\"\" + key.substr(1) + \"\\\")\";\n            return key;\n        });\n        this.tail = splitTail && path.pop();\n        this.local = !path.length;\n        path.unshift('self');\n        this.resolve = new Function('self', \"return \" + path.join('.') + \";\");\n    }\n    return CompiledReference;\n}());\nexport { CompiledReference };\nexport function resolveReference(root, reference, action) {\n    var path = reference.match(referenceMask), skip = path.length - 1;\n    var self = root;\n    for (var i = 0; i < skip; i++) {\n        var key = path[i];\n        switch (key) {\n            case '~':\n                self = self.getStore();\n                break;\n            case '^':\n                self = self.getOwner();\n                break;\n            default: self = self.get(key);\n        }\n        if (!self)\n            return;\n    }\n    return action(self, path[skip]);\n}\n//# sourceMappingURL=traversable.js.map","import { transactionApi } from \"../../transactions\";\nvar _begin = transactionApi.begin, _markAsDirty = transactionApi.markAsDirty, commit = transactionApi.commit;\nimport { eventsApi } from '../../object-plus';\nvar trigger3 = eventsApi.trigger3;\nexport function setAttribute(record, name, value) {\n    var isRoot = begin(record), options = {};\n    if (record._attributes[name].doUpdate(value, record, options)) {\n        markAsDirty(record, options);\n        trigger3(record, 'change:' + name, record, record.attributes[name], options);\n    }\n    isRoot && commit(record);\n}\nfunction begin(record) {\n    if (_begin(record)) {\n        record._previousAttributes = new record.AttributesCopy(record.attributes);\n        record._changedAttributes = null;\n        return true;\n    }\n    return false;\n}\nfunction markAsDirty(record, options) {\n    if (record._changedAttributes) {\n        record._changedAttributes = null;\n    }\n    return _markAsDirty(record, options);\n}\nexport var UpdateRecordMixin = {\n    transaction: function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        fun.call(this, this);\n        isRoot && commit(this);\n    },\n    _onChildrenChange: function (child, options) {\n        var _ownerKey = child._ownerKey, attribute = this._attributes[_ownerKey];\n        if (!attribute || attribute.propagateChanges)\n            this.forceAttributeChange(_ownerKey, options);\n    },\n    forceAttributeChange: function (key, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger3(this, 'change:' + key, this, this.attributes[key], options);\n        }\n        isRoot && commit(this);\n    },\n    _createTransaction: function (a_values, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), changes = [], nested = [], _attributes = this._attributes, values = options.parse ? this.parse(a_values, options) : a_values;\n        var unknown;\n        if (shouldBeAnObject(this, values)) {\n            for (var name_1 in values) {\n                var spec = _attributes[name_1];\n                if (spec) {\n                    if (spec.doUpdate(values[name_1], this, options, nested)) {\n                        changes.push(name_1);\n                    }\n                }\n                else {\n                    unknown || (unknown = []);\n                    unknown.push(\"'\" + name_1 + \"'\");\n                }\n            }\n            if (unknown) {\n            }\n        }\n        if (changes.length && markAsDirty(this, options)) {\n            return new RecordTransaction(this, isRoot, nested, changes);\n        }\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var pendingTransaction = nested_1[_i];\n            pendingTransaction.commit(this);\n        }\n        isRoot && commit(this);\n    }\n};\nexport function constructorsMixin(attrDefs) {\n    var attrs = Object.keys(attrDefs);\n    var AttributesCopy = new Function('values', \"\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = values.\" + attr + \";\\n        \"; }).join('') + \"\\n    \");\n    AttributesCopy.prototype = Object.prototype;\n    var Attributes = new Function('record', 'values', 'options', \"\\n        var _attrs = record._attributes;\\n\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = _attrs.\" + attr + \".doInit( values.\" + attr + \", record, options );\\n        \"; }).join('') + \"\\n    \");\n    Attributes.prototype = Object.prototype;\n    return { Attributes: Attributes, AttributesCopy: AttributesCopy };\n}\nexport function shouldBeAnObject(record, values) {\n    if (values && values.constructor === Object)\n        return true;\n    record._log('warn', 'update with non-object is ignored!', { values: values });\n    return false;\n}\nvar RecordTransaction = (function () {\n    function RecordTransaction(object, isRoot, nested, changes) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.nested = nested;\n        this.changes = changes;\n    }\n    RecordTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, changes = _a.changes;\n        for (var _i = 0, nested_2 = nested; _i < nested_2.length; _i++) {\n            var transaction = nested_2[_i];\n            transaction.commit(object);\n        }\n        var attributes = object.attributes, _isDirty = object._isDirty;\n        for (var _b = 0, changes_1 = changes; _b < changes_1.length; _b++) {\n            var key = changes_1[_b];\n            trigger3(object, 'change:' + key, object, attributes[key], _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return RecordTransaction;\n}());\nexport { RecordTransaction };\n//# sourceMappingURL=updates.js.map","import { setAttribute } from './updates';\nimport { tools } from '../../object-plus';\nvar notEqual = tools.notEqual, assign = tools.assign;\nvar emptyOptions = {};\nvar AnyType = (function () {\n    function AnyType(name, a_options) {\n        this.name = name;\n        this.getHook = null;\n        this.options = a_options;\n        var options = assign({ getHooks: [], transforms: [], changeHandlers: [] }, a_options);\n        options.getHooks = options.getHooks.slice();\n        options.transforms = options.transforms.slice();\n        options.changeHandlers = options.changeHandlers.slice();\n        var value = options.value, type = options.type, parse = options.parse, toJSON = options.toJSON, changeEvents = options.changeEvents, validate = options.validate, getHooks = options.getHooks, transforms = options.transforms, changeHandlers = options.changeHandlers;\n        this.value = value;\n        this.type = type;\n        if (!options.hasCustomDefault && type) {\n            this.defaultValue = this.create;\n        }\n        else if (tools.isValidJSON(value)) {\n            this.defaultValue = new Function(\"return \" + JSON.stringify(value) + \";\");\n        }\n        else {\n            this.defaultValue = this.defaultValue;\n        }\n        this.propagateChanges = changeEvents !== false;\n        this.toJSON = toJSON === void 0 ? this.toJSON : toJSON;\n        this.validate = validate || this.validate;\n        if (options.isRequired) {\n            this.validate = wrapIsRequired(this.validate);\n        }\n        transforms.unshift(this.convert);\n        this.parse = parse || this.parse;\n        if (this.get)\n            getHooks.unshift(this.get);\n        this.initialize.call(this, options);\n        if (getHooks.length) {\n            var getHook_1 = this.getHook = getHooks.reduce(chainGetHooks);\n            var validate_1 = this.validate;\n            this.validate = function (record, value, key) {\n                return validate_1.call(this, record, getHook_1.call(record, value, key), key);\n            };\n        }\n        this.transform = transforms.length ? transforms.reduce(chainTransforms) : this.transform;\n        this.handleChange = changeHandlers.length ? changeHandlers.reduce(chainChangeHandlers) : this.handleChange;\n    }\n    AnyType.create = function (options, name) {\n        var type = options.type, AttributeCtor = options._attribute || (type ? type._attribute : AnyType);\n        return new AttributeCtor(name, options);\n    };\n    AnyType.prototype.canBeUpdated = function (prev, next, options) { };\n    AnyType.prototype.transform = function (next, prev, model, options) { return next; };\n    AnyType.prototype.convert = function (next, prev, model, options) { return next; };\n    AnyType.prototype.isChanged = function (a, b) {\n        return notEqual(a, b);\n    };\n    AnyType.prototype.handleChange = function (next, prev, model, options) { };\n    AnyType.prototype.create = function () { return void 0; };\n    AnyType.prototype.clone = function (value, record) {\n        return value;\n    };\n    AnyType.prototype.dispose = function (record, value) {\n        this.handleChange(void 0, value, record, emptyOptions);\n    };\n    AnyType.prototype.validate = function (record, value, key) { };\n    AnyType.prototype.toJSON = function (value, key) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    AnyType.prototype.createPropertyDescriptor = function () {\n        var _a = this, name = _a.name, getHook = _a.getHook;\n        if (name !== 'id') {\n            return {\n                set: function (value) {\n                    setAttribute(this, name, value);\n                },\n                get: (getHook ?\n                    function () {\n                        return getHook.call(this, this.attributes[name], name);\n                    } :\n                    function () { return this.attributes[name]; })\n            };\n        }\n    };\n    AnyType.prototype.initialize = function (name, options) { };\n    AnyType.prototype.doInit = function (value, record, options) {\n        var v = value === void 0 ? this.defaultValue() : value, x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AnyType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        var next = this.transform(value, prev, record, options);\n        attributes[name] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AnyType.prototype._log = function (level, text, value, record) {\n        tools.log(level, \"[Attribute Update Error] \" + record.getClassName() + \".\" + this.name + \": \" + text, {\n            'Record': record,\n            'Attribute definition': this,\n            'Prev. value': record.attributes[this.name],\n            'New value': value\n        });\n    };\n    AnyType.prototype.defaultValue = function () {\n        return this.value;\n    };\n    return AnyType;\n}());\nexport { AnyType };\nfunction chainGetHooks(prevHook, nextHook) {\n    return function (value, name) {\n        return nextHook.call(this, prevHook.call(this, value, name), name);\n    };\n}\nfunction chainTransforms(prevTransform, nextTransform) {\n    return function (next, prev, record, options) {\n        return nextTransform.call(this, prevTransform.call(this, next, prev, record, options), prev, record, options);\n    };\n}\nfunction chainChangeHandlers(prevHandler, nextHandler) {\n    return function (next, prev, record, options) {\n        prevHandler.call(this, next, prev, record, options);\n        nextHandler.call(this, next, prev, record, options);\n    };\n}\nfunction wrapIsRequired(validate) {\n    return function (record, value, key) {\n        return value ? validate.call(this, record, value, key) : 'Required';\n    };\n}\n//# sourceMappingURL=any.js.map","import { Transactional } from '../../transactions';\nimport { EventMap, definitionDecorator, tools } from '../../object-plus';\nvar assign = tools.assign;\nvar ChainableAttributeSpec = (function () {\n    function ChainableAttributeSpec(options) {\n        this.options = { getHooks: [], transforms: [], changeHandlers: [] };\n        if (options)\n            assign(this.options, options);\n    }\n    ChainableAttributeSpec.prototype.check = function (check, error) {\n        function validate(model, value, name) {\n            if (!check.call(model, value, name)) {\n                var msg = error || check.error || name + ' is not valid';\n                return typeof msg === 'function' ? msg.call(model, name) : msg;\n            }\n        }\n        var prev = this.options.validate;\n        return this.metadata({\n            validate: prev ? (function (model, value, name) {\n                return prev(model, value, name) || validate(model, value, name);\n            }) : validate\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"asProp\", {\n        get: function () {\n            return definitionDecorator('attributes', this);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"isRequired\", {\n        get: function () {\n            return this.metadata({ isRequired: true });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.watcher = function (ref) {\n        return this.metadata({ _onChange: ref });\n    };\n    ChainableAttributeSpec.prototype.parse = function (fun) {\n        return this.metadata({ parse: fun });\n    };\n    ChainableAttributeSpec.prototype.toJSON = function (fun) {\n        return this.metadata({\n            toJSON: typeof fun === 'function' ? fun : (fun ? function (x) { return x && x.toJSON(); } : emptyFunction)\n        });\n    };\n    ChainableAttributeSpec.prototype.get = function (fun) {\n        return this.metadata({\n            getHooks: this.options.getHooks.concat(fun)\n        });\n    };\n    ChainableAttributeSpec.prototype.set = function (fun) {\n        function handleSetHook(next, prev, record, options) {\n            if (this.isChanged(next, prev)) {\n                var changed = fun.call(record, next, this.name);\n                return changed === void 0 ? prev : this.convert(changed, prev, record, options);\n            }\n            return prev;\n        }\n        return this.metadata({\n            transforms: this.options.transforms.concat(handleSetHook)\n        });\n    };\n    ChainableAttributeSpec.prototype.changeEvents = function (events) {\n        return this.metadata({ changeEvents: events });\n    };\n    ChainableAttributeSpec.prototype.events = function (map) {\n        var eventMap = new EventMap(map);\n        function handleEventsSubscribtion(next, prev, record) {\n            prev && prev.trigger && eventMap.unsubscribe(record, prev);\n            next && next.trigger && eventMap.subscribe(record, next);\n        }\n        return this.metadata({\n            changeHandlers: this.options.changeHandlers.concat(handleEventsSubscribtion)\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"has\", {\n        get: function () {\n            return this;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.metadata = function (options) {\n        var cloned = new ChainableAttributeSpec(this.options);\n        assign(cloned.options, options);\n        return cloned;\n    };\n    ChainableAttributeSpec.prototype.value = function (x) {\n        return this.metadata({ value: x, hasCustomDefault: true });\n    };\n    return ChainableAttributeSpec;\n}());\nexport { ChainableAttributeSpec };\nfunction emptyFunction() { }\nFunction.prototype.value = function (x) {\n    return new ChainableAttributeSpec({ type: this, value: x, hasCustomDefault: true });\n};\nObject.defineProperty(Function.prototype, 'isRequired', {\n    get: function () { return this._isRequired || this.has.isRequired; },\n    set: function (x) { this._isRequired = x; }\n});\nObject.defineProperty(Function.prototype, 'asProp', {\n    get: function () { return this.has.asProp; },\n});\nObject.defineProperty(Function.prototype, 'has', {\n    get: function () {\n        return this._has || new ChainableAttributeSpec({\n            type: this,\n            value: this._attribute.defaultValue,\n            hasCustomDefault: this._attribute.defaultValue !== void 0\n        });\n    },\n    set: function (value) { this._has = value; }\n});\nexport function toAttributeOptions(spec) {\n    var attrSpec;\n    if (typeof spec === 'function') {\n        attrSpec = spec.has;\n    }\n    else if (spec && spec instanceof ChainableAttributeSpec) {\n        attrSpec = spec;\n    }\n    else {\n        var type = inferType(spec);\n        if (type && type.prototype instanceof Transactional) {\n            attrSpec = type.shared.value(spec);\n        }\n        else {\n            attrSpec = new ChainableAttributeSpec({ type: type, value: spec, hasCustomDefault: true });\n        }\n    }\n    return attrSpec.options;\n}\nfunction inferType(value) {\n    switch (typeof value) {\n        case 'number':\n            return Number;\n        case 'string':\n            return String;\n        case 'boolean':\n            return Boolean;\n        case 'undefined':\n            return void 0;\n        case 'object':\n            return value ? value.constructor : void 0;\n    }\n}\n//# sourceMappingURL=attrDef.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { ChainableAttributeSpec } from './attrDef';\nvar DateProto = Date.prototype;\nvar DateType = (function (_super) {\n    tslib_1.__extends(DateType, _super);\n    function DateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DateType.prototype.create = function () {\n        return new Date();\n    };\n    DateType.prototype.convert = function (next, a, record) {\n        if (next == null || next instanceof Date)\n            return next;\n        var date = new Date(next), timestamp = date.getTime();\n        if (timestamp !== timestamp) {\n            this._log('warn', 'assigned with Invalid Date', next, record);\n        }\n        return date;\n    };\n    DateType.prototype.validate = function (model, value, name) {\n        if (value != null) {\n            var timestamp = value.getTime();\n            if (timestamp !== timestamp)\n                return name + ' is Invalid Date';\n        }\n    };\n    DateType.prototype.toJSON = function (value) { return value && value.toISOString(); };\n    DateType.prototype.isChanged = function (a, b) { return (a && a.getTime()) !== (b && b.getTime()); };\n    DateType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.defaultValue() : value, void 0, record, options);\n    };\n    DateType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return this.isChanged(prev, attributes[name] = this.transform(value, prev, record, options));\n    };\n    DateType.prototype.clone = function (value) { return value && new Date(value.getTime()); };\n    DateType.prototype.dispose = function () { };\n    return DateType;\n}(AnyType));\nexport { DateType };\nDate._attribute = DateType;\nvar msDatePattern = /\\/Date\\(([0-9]+)\\)\\//;\nvar MSDateType = (function (_super) {\n    tslib_1.__extends(MSDateType, _super);\n    function MSDateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    MSDateType.prototype.convert = function (next) {\n        if (typeof next === 'string') {\n            var msDate = msDatePattern.exec(next);\n            if (msDate) {\n                return new Date(Number(msDate[1]));\n            }\n        }\n        return DateType.prototype.convert.apply(this, arguments);\n    };\n    MSDateType.prototype.toJSON = function (value) { return value && \"/Date(\" + value.getTime() + \")/\"; };\n    return MSDateType;\n}(DateType));\nexport { MSDateType };\nvar TimestampType = (function (_super) {\n    tslib_1.__extends(TimestampType, _super);\n    function TimestampType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimestampType.prototype.toJSON = function (value) { return value && value.getTime(); };\n    return TimestampType;\n}(DateType));\nexport { TimestampType };\nObject.defineProperties(Date, {\n    microsoft: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: MSDateType\n            });\n        }\n    },\n    timestamp: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: TimestampType\n            });\n        }\n    }\n});\nfunction supportsDate(date) {\n    return !isNaN((new Date(date)).getTime());\n}\nif (!supportsDate('2011-11-29T15:52:30.5') ||\n    !supportsDate('2011-11-29T15:52:30.52') ||\n    !supportsDate('2011-11-29T15:52:18.867') ||\n    !supportsDate('2011-11-29T15:52:18.867Z') ||\n    !supportsDate('2011-11-29T15:52:18.867-03:30')) {\n    DateType.prototype.convert = function (value) {\n        return value == null || value instanceof Date ? value : new Date(safeParseDate(value));\n    };\n}\nvar numericKeys = [1, 4, 5, 6, 7, 10, 11], isoDatePattern = /^(\\d{4}|[+\\-]\\d{6})(?:-(\\d{2})(?:-(\\d{2}))?)?(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(?:(Z)|([+\\-])(\\d{2})(?::(\\d{2}))?)?)?$/;\nfunction safeParseDate(date) {\n    var timestamp, struct, minutesOffset = 0;\n    if ((struct = isoDatePattern.exec(date))) {\n        for (var i = 0, k; (k = numericKeys[i]); ++i) {\n            struct[k] = +struct[k] || 0;\n        }\n        struct[2] = (+struct[2] || 1) - 1;\n        struct[3] = +struct[3] || 1;\n        if (struct[8] !== 'Z' && struct[9] !== undefined) {\n            minutesOffset = struct[10] * 60 + struct[11];\n            if (struct[9] === '+') {\n                minutesOffset = 0 - minutesOffset;\n            }\n        }\n        timestamp =\n            Date.UTC(struct[1], struct[2], struct[3], struct[4], struct[5] + minutesOffset, struct[6], struct[7]);\n    }\n    else {\n        timestamp = Date.parse(date);\n    }\n    return timestamp;\n}\n//# sourceMappingURL=date.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nvar ImmutableClassType = (function (_super) {\n    tslib_1.__extends(ImmutableClassType, _super);\n    function ImmutableClassType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ImmutableClassType.prototype.create = function () {\n        return new this.type();\n    };\n    ImmutableClassType.prototype.convert = function (next) {\n        return next == null || next instanceof this.type ? next : new this.type(next);\n    };\n    ImmutableClassType.prototype.toJSON = function (value) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    ImmutableClassType.prototype.clone = function (value) {\n        return new this.type(this.toJSON(value));\n    };\n    ImmutableClassType.prototype.isChanged = function (a, b) {\n        return a !== b;\n    };\n    return ImmutableClassType;\n}(AnyType));\nFunction.prototype._attribute = ImmutableClassType;\nvar PrimitiveType = (function (_super) {\n    tslib_1.__extends(PrimitiveType, _super);\n    function PrimitiveType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PrimitiveType.prototype.dispose = function () { };\n    PrimitiveType.prototype.create = function () { return this.type(); };\n    PrimitiveType.prototype.toJSON = function (value) { return value; };\n    PrimitiveType.prototype.convert = function (next) { return next == null ? next : this.type(next); };\n    PrimitiveType.prototype.isChanged = function (a, b) { return a !== b; };\n    PrimitiveType.prototype.clone = function (value) { return value; };\n    PrimitiveType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.value : value, void 0, record, options);\n    };\n    PrimitiveType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return prev !== (attributes[name] = this.transform(value, prev, record, options));\n    };\n    PrimitiveType.prototype.initialize = function () {\n        if (!this.options.hasCustomDefault) {\n            this.value = this.type();\n        }\n    };\n    return PrimitiveType;\n}(AnyType));\nexport { PrimitiveType };\nBoolean._attribute = String._attribute = PrimitiveType;\nvar NumericType = (function (_super) {\n    tslib_1.__extends(NumericType, _super);\n    function NumericType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    NumericType.prototype.create = function () {\n        return 0;\n    };\n    NumericType.prototype.convert = function (next, prev, record) {\n        var num = next == null ? next : this.type(next);\n        if (num !== num) {\n            this._log('warn', 'assigned with Invalid Number', next, record);\n        }\n        return num;\n    };\n    NumericType.prototype.validate = function (model, value, name) {\n        if (value != null && !isFinite(value)) {\n            return name + ' is not valid number';\n        }\n    };\n    return NumericType;\n}(PrimitiveType));\nexport { NumericType };\nNumber._attribute = NumericType;\nfunction Integer(x) {\n    return x ? Math.round(x) : 0;\n}\nInteger._attribute = NumericType;\nNumber.integer = Integer;\nif (typeof window !== 'undefined') {\n    window.Integer = Number.integer;\n}\nvar ArrayType = (function (_super) {\n    tslib_1.__extends(ArrayType, _super);\n    function ArrayType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ArrayType.prototype.toJSON = function (value) { return value; };\n    ArrayType.prototype.dispose = function () { };\n    ArrayType.prototype.create = function () { return []; };\n    ArrayType.prototype.convert = function (next, prev, record) {\n        if (next == null || Array.isArray(next))\n            return next;\n        this._log('warn', 'assignment of non-array to Array attribute is ignored', next, record);\n        return [];\n    };\n    ArrayType.prototype.clone = function (value) {\n        return value && value.slice();\n    };\n    return ArrayType;\n}(AnyType));\nexport { ArrayType };\nArray._attribute = ArrayType;\nvar ObjectType = (function (_super) {\n    tslib_1.__extends(ObjectType, _super);\n    function ObjectType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ObjectType.prototype.create = function () { return {}; };\n    ObjectType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'object')\n            return next;\n        this._log('warn', 'assignment of non-object to Object attribute is ignored', next, record);\n        return {};\n    };\n    return ObjectType;\n}(AnyType));\nexport { ObjectType };\nObject._attribute = ObjectType;\nexport function doNothing() { }\nvar FunctionType = (function (_super) {\n    tslib_1.__extends(FunctionType, _super);\n    function FunctionType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    FunctionType.prototype.toJSON = function (value) { return void 0; };\n    FunctionType.prototype.create = function () { return doNothing; };\n    FunctionType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'function')\n            return next;\n        this._log('warn', 'assigned with non-function', next, record);\n        return doNothing;\n    };\n    FunctionType.prototype.clone = function (value) { return value; };\n    return FunctionType;\n}(AnyType));\nexport { FunctionType };\nFunction._attribute = FunctionType;\n//# sourceMappingURL=basic.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { ItemsBehavior, transactionApi } from '../../transactions';\nimport { eventsApi } from '../../object-plus';\nvar on = eventsApi.on, off = eventsApi.off, free = transactionApi.free, aquire = transactionApi.aquire;\nvar shareAndListen = ItemsBehavior.listen | ItemsBehavior.share;\nvar SharedType = (function (_super) {\n    tslib_1.__extends(SharedType, _super);\n    function SharedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    SharedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value, record) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    SharedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    SharedType.prototype.clone = function (value, record) {\n        if (!value || value._owner !== record)\n            return value;\n        var clone = value.clone();\n        aquire(record, clone, this.name);\n        return clone;\n    };\n    SharedType.prototype.toJSON = function () { };\n    SharedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null && !(next instanceof this.type)) {\n            return next;\n        }\n    };\n    SharedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null || next instanceof this.type)\n            return next;\n        var implicitObject = new this.type(next, options, shareAndListen);\n        aquire(record, implicitObject, this.name);\n        return implicitObject;\n    };\n    SharedType.prototype.validate = function (model, value, name) { };\n    SharedType.prototype.create = function () {\n        return null;\n    };\n    SharedType.prototype._handleChange = function (next, prev, record, options) {\n        if (prev) {\n            if (prev._owner === record) {\n                free(record, prev);\n                options.unset || prev.dispose();\n            }\n            else {\n                off(prev, prev._changeEventName, this._onChange, record);\n            }\n        }\n        if (next) {\n            if (next._owner !== record) {\n                on(next, next._changeEventName, this._onChange, record);\n            }\n        }\n    };\n    SharedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    SharedType.prototype.initialize = function (options) {\n        var attribute = this;\n        this._onChange = this.propagateChanges ? function (child, options, initiator) {\n            this === initiator || this.forceAttributeChange(attribute.name, options);\n        } : ignore;\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    return SharedType;\n}(AnyType));\nexport { SharedType };\nfunction ignore() { }\n//# sourceMappingURL=shared.js.map","import * as tslib_1 from \"tslib\";\nimport { tools as _, eventsApi } from '../../object-plus';\nexport * from './any';\nexport * from './owned';\nexport * from './date';\nexport * from './basic';\nexport * from './shared';\nexport * from './updates';\nexport * from './attrDef';\nimport { AnyType } from './any';\nimport { constructorsMixin } from './updates';\nimport { toAttributeOptions, ChainableAttributeSpec } from './attrDef';\nimport { CompiledReference } from '../../traversable';\nexport default function (attributesDefinition, baseClassAttributes) {\n    var myAttributes = _.transform({}, attributesDefinition, createAttribute), allAttributes = _.defaults({}, myAttributes, baseClassAttributes);\n    var ConstructorsMixin = constructorsMixin(allAttributes);\n    return tslib_1.__assign({}, ConstructorsMixin, { _attributes: new ConstructorsMixin.AttributesCopy(allAttributes), _attributesArray: Object.keys(allAttributes).map(function (key) { return allAttributes[key]; }), properties: _.transform({}, myAttributes, function (x) { return x.createPropertyDescriptor(); }), _toJSON: createToJSON(allAttributes) }, parseMixin(allAttributes), localEventsMixin(myAttributes));\n}\nexport function createAttribute(spec, name) {\n    return AnyType.create(toAttributeOptions(spec), name);\n}\nfunction parseMixin(attributes) {\n    var attrsWithParse = Object.keys(attributes).filter(function (name) { return attributes[name].parse; });\n    return attrsWithParse.length ? {\n        _parse: new Function('json', \"\\n            var _attrs = this._attributes;\\n\\n            \" + attrsWithParse.map(function (name) { return \"                \\n                json.\" + name + \" === void 0 || ( json.\" + name + \" = _attrs.\" + name + \".parse.call( this, json.\" + name + \", \\\"\" + name + \"\\\" ) );\\n            \"; }).join('') + \"\\n\\n            return json;\\n        \")\n    } : {};\n}\nfunction createToJSON(attributes) {\n    return new Function(\"\\n        var json = {},\\n            v = this.attributes,\\n            a = this._attributes;\\n\\n        \" + Object.keys(attributes).map(function (key) {\n        if (attributes[key].toJSON) {\n            return \"json.\" + key + \" = a.\" + key + \".toJSON.call( this, v.\" + key + \", '\" + key + \"' );\";\n        }\n    }).join('\\n') + \"\\n\\n        return json;\\n    \");\n}\nexport function createSharedTypeSpec(Constructor, Attribute) {\n    if (!Constructor.hasOwnProperty('shared')) {\n        Object.defineProperty(Constructor, 'shared', {\n            get: function () {\n                return new ChainableAttributeSpec({\n                    value: null,\n                    type: Constructor,\n                    _attribute: Attribute\n                });\n            }\n        });\n    }\n}\nfunction localEventsMixin(attrSpecs) {\n    var _localEvents;\n    for (var key in attrSpecs) {\n        var attribute = attrSpecs[key], _onChange = attribute.options._onChange;\n        if (_onChange) {\n            _localEvents || (_localEvents = new eventsApi.EventMap());\n            _localEvents.addEvent('change:' + key, typeof _onChange === 'string' ?\n                createWatcherFromRef(_onChange, key) :\n                wrapWatcher(_onChange, key));\n        }\n    }\n    return _localEvents ? { _localEvents: _localEvents } : {};\n}\nfunction wrapWatcher(watcher, key) {\n    return function (record, value) {\n        watcher.call(record, value, key);\n    };\n}\nfunction createWatcherFromRef(ref, key) {\n    var _a = new CompiledReference(ref, true), local = _a.local, resolve = _a.resolve, tail = _a.tail;\n    return local ?\n        function (record, value) {\n            record[tail](value, key);\n        } :\n        function (record, value) {\n            resolve(record)[tail](value, key);\n        };\n}\n//# sourceMappingURL=index.js.map","import * as tslib_1 from \"tslib\";\nimport { tools, definitions, mixinRules, define } from '../object-plus';\nimport { Transactional } from '../transactions';\nimport { AnyType, AggregatedType, setAttribute, UpdateRecordMixin } from './attributes';\nvar assign = tools.assign, isEmpty = tools.isEmpty, log = tools.log;\nvar _cidCounter = 0;\nvar Record = (function (_super) {\n    tslib_1.__extends(Record, _super);\n    function Record(a_values, a_options) {\n        var _this = _super.call(this, _cidCounter++) || this;\n        _this.attributes = {};\n        var options = a_options || {}, values = (options.parse ? _this.parse(a_values, options) : a_values) || {};\n        if (log.level > 1)\n            typeCheck(_this, values);\n        _this._previousAttributes = _this.attributes = new _this.Attributes(_this, values, options);\n        _this.initialize(a_values, a_options);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Record_1 = Record;\n    Record.onDefine = function (definition, BaseClass) { };\n    Record.defaults = function (attrs) {\n        return this.extend({ attributes: attrs });\n    };\n    Record.prototype.previousAttributes = function () { return new this.AttributesCopy(this._previousAttributes); };\n    Object.defineProperty(Record.prototype, \"__inner_state__\", {\n        get: function () { return this.attributes; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Record.prototype, \"changed\", {\n        get: function () {\n            var changed = this._changedAttributes;\n            if (!changed) {\n                var prev = this._previousAttributes;\n                changed = {};\n                var _a = this, _attributes = _a._attributes, attributes = _a.attributes;\n                for (var _i = 0, _b = this._attributesArray; _i < _b.length; _i++) {\n                    var attr = _b[_i];\n                    var key = attr.name, value = attributes[key];\n                    if (attr.isChanged(value, prev[key])) {\n                        changed[key] = value;\n                    }\n                }\n                this._changedAttributes = changed;\n            }\n            return changed;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.changedAttributes = function (diff) {\n        if (!diff)\n            return this.hasChanged() ? assign({}, this.changed) : false;\n        var val, changed = false, old = this._transaction ? this._previousAttributes : this.attributes, attrSpecs = this._attributes;\n        for (var attr in diff) {\n            if (!attrSpecs[attr].isChanged(old[attr], (val = diff[attr])))\n                continue;\n            (changed || (changed = {}))[attr] = val;\n        }\n        return changed;\n    };\n    Record.prototype.hasChanged = function (key) {\n        var _previousAttributes = this._previousAttributes;\n        if (!_previousAttributes)\n            return false;\n        return key ?\n            this._attributes[key].isChanged(this.attributes[key], _previousAttributes[key]) :\n            !isEmpty(this.changed);\n    };\n    Record.prototype.previous = function (key) {\n        if (key) {\n            var _previousAttributes = this._previousAttributes;\n            if (_previousAttributes)\n                return _previousAttributes[key];\n        }\n        return null;\n    };\n    Record.prototype.isNew = function () {\n        return this.id == null;\n    };\n    Record.prototype.has = function (key) {\n        return this[key] != void 0;\n    };\n    Record.prototype.unset = function (key, options) {\n        var value = this[key];\n        this.set((_a = {}, _a[key] = void 0, _a), tslib_1.__assign({ unset: true }, options));\n        return value;\n        var _a;\n    };\n    Record.prototype.clear = function (options) {\n        var _this = this;\n        var nullify = options && options.nullify;\n        this.transaction(function () {\n            _this.forEachAttr(_this.attributes, function (value, key) { return _this[key] = nullify ? null : void 0; });\n        }, options);\n        return this;\n    };\n    Record.prototype.getOwner = function () {\n        var owner = this._owner;\n        return this._ownerKey ? owner : owner && owner._owner;\n    };\n    Object.defineProperty(Record.prototype, \"id\", {\n        get: function () { return this.attributes[this.idAttribute]; },\n        set: function (x) { setAttribute(this, this.idAttribute, x); },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.forEachAttr = function (attrs, iteratee) {\n        var _attributes = this._attributes;\n        var unknown;\n        for (var name_1 in attrs) {\n            var spec = _attributes[name_1];\n            if (spec) {\n                iteratee(attrs[name_1], name_1, spec);\n            }\n            else {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_1 + \"'\");\n            }\n        }\n        if (unknown) {\n            this._log('warn', \"attributes \" + unknown.join(', ') + \" are not defined\", {\n                attributes: attrs\n            });\n        }\n    };\n    Record.prototype.each = function (iteratee, context) {\n        var fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee, attributes = this.attributes;\n        for (var key in this.attributes) {\n            var value = attributes[key];\n            if (value !== void 0)\n                fun(value, key);\n        }\n    };\n    Record.prototype.keys = function () {\n        var keys = [];\n        this.each(function (value, key) { return value === void 0 || keys.push(key); });\n        return keys;\n    };\n    Record.prototype.values = function () {\n        return this.map(function (value) { return value; });\n    };\n    Record.prototype._toJSON = function () { return {}; };\n    Record.prototype._parse = function (data) { return data; };\n    Record.prototype.defaults = function (values) {\n        if (values === void 0) { values = {}; }\n        var defaults = {}, _attributesArray = this._attributesArray;\n        for (var _i = 0, _attributesArray_1 = _attributesArray; _i < _attributesArray_1.length; _i++) {\n            var attr = _attributesArray_1[_i];\n            var key = attr.name, value = values[key];\n            defaults[key] = value === void 0 ? attr.defaultValue() : value;\n        }\n        return defaults;\n    };\n    Record.prototype.initialize = function (values, options) { };\n    Record.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var copy = new this.constructor(this.attributes, { clone: true });\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Record.prototype.deepClone = function () { return this.clone(); };\n    ;\n    Record.prototype._validateNested = function (errors) {\n        var _this = this;\n        var length = 0;\n        this.forEachAttr(this.attributes, function (value, name, attribute) {\n            var error = attribute.validate(_this, value, name);\n            if (error) {\n                errors[name] = error;\n                length++;\n            }\n        });\n        return length;\n    };\n    Record.prototype.get = function (key) {\n        return this[key];\n    };\n    Record.prototype.toJSON = function () {\n        var _this = this;\n        var json = {};\n        this.forEachAttr(this.attributes, function (value, key, _a) {\n            var toJSON = _a.toJSON;\n            if (value !== void 0) {\n                var asJson = toJSON.call(_this, value, key);\n                if (asJson !== void 0)\n                    json[key] = asJson;\n            }\n        });\n        return json;\n    };\n    Record.prototype.parse = function (data, options) {\n        return this._parse(data);\n    };\n    Record.prototype.deepSet = function (name, value, options) {\n        var _this = this;\n        this.transaction(function () {\n            var path = name.split('.'), l = path.length - 1, attr = path[l];\n            var model = _this;\n            for (var i = 0; i < l; i++) {\n                var key = path[i];\n                var next = model.get ? model.get(key) : model[key];\n                if (!next) {\n                    var attrSpecs = model._attributes;\n                    if (attrSpecs) {\n                        var newModel = attrSpecs[key].create();\n                        if (options && options.nullify && newModel._attributes) {\n                            newModel.clear(options);\n                        }\n                        model[key] = next = newModel;\n                    }\n                    else\n                        return;\n                }\n                model = next;\n            }\n            if (model.set) {\n                model.set((_a = {}, _a[attr] = value, _a), options);\n            }\n            else {\n                model[attr] = value;\n            }\n            var _a;\n        });\n        return this;\n    };\n    Object.defineProperty(Record.prototype, \"collection\", {\n        get: function () {\n            return this._ownerKey ? null : this._owner;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.dispose = function () {\n        var _this = this;\n        if (this._disposed)\n            return;\n        this.forEachAttr(this.attributes, function (value, key, attribute) {\n            attribute.dispose(_this, value);\n        });\n        _super.prototype.dispose.call(this);\n    };\n    Record.prototype._log = function (level, text, props) {\n        tools.log(level, '[Record] ' + text, tslib_1.__assign({ 'Record': this, 'Attributes definition:': this._attributes }, props));\n    };\n    Record.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Record';\n    };\n    Record.prototype._createTransaction = function (values, options) { return void 0; };\n    Record = Record_1 = tslib_1.__decorate([\n        define({\n            cidPrefix: 'm',\n            _changeEventName: 'change',\n            idAttribute: 'id'\n        }),\n        definitions({\n            defaults: mixinRules.merge,\n            attributes: mixinRules.merge,\n            collection: mixinRules.merge,\n            Collection: mixinRules.value,\n            idAttribute: mixinRules.protoValue\n        })\n    ], Record);\n    return Record;\n    var Record_1;\n}(Transactional));\nexport { Record };\n;\nassign(Record.prototype, UpdateRecordMixin);\nvar BaseRecordAttributes = (function () {\n    function BaseRecordAttributes(record, x, options) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributes;\n}());\nRecord.prototype.Attributes = BaseRecordAttributes;\nvar BaseRecordAttributesCopy = (function () {\n    function BaseRecordAttributesCopy(x) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributesCopy;\n}());\nRecord.prototype.AttributesCopy = BaseRecordAttributesCopy;\nvar IdAttribute = AnyType.create({ value: void 0 }, 'id');\nRecord.prototype._attributes = { id: IdAttribute };\nRecord.prototype._attributesArray = [IdAttribute];\nRecord._attribute = AggregatedType;\nimport { shouldBeAnObject } from './attributes';\nfunction typeCheck(record, values) {\n    if (shouldBeAnObject(record, values)) {\n        var _attributes = record._attributes;\n        var unknown = void 0;\n        for (var name_2 in values) {\n            if (!_attributes[name_2]) {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_2 + \"'\");\n            }\n        }\n        if (unknown) {\n            record._log('warn', \"undefined attributes \" + unknown.join(', ') + \" are ignored.\", { values: values });\n        }\n    }\n}\n//# sourceMappingURL=record.js.map","import * as tslib_1 from \"tslib\";\nimport { Record } from './record';\nimport { tools, predefine } from '../object-plus';\nimport compile from './attributes';\nimport { Transactional } from '../transactions';\nimport { createSharedTypeSpec, AggregatedType, SharedType } from './attributes';\nexport * from './attributes';\nexport { Record };\nvar assign = tools.assign, defaults = tools.defaults, omit = tools.omit, getBaseClass = tools.getBaseClass;\nRecord.onExtend = function (BaseClass) {\n    Transactional.onExtend.call(this, BaseClass);\n    var Class = this;\n    var DefaultCollection = (function (_super) {\n        tslib_1.__extends(DefaultCollection, _super);\n        function DefaultCollection() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultCollection.model = Class;\n        DefaultCollection = tslib_1.__decorate([\n            predefine\n        ], DefaultCollection);\n        return DefaultCollection;\n    }(BaseClass.Collection));\n    this.DefaultCollection = DefaultCollection;\n    if (Class.Collection === BaseClass.Collection) {\n        this.Collection = DefaultCollection;\n    }\n    createSharedTypeSpec(this, SharedType);\n};\nRecord.onDefine = function (definition, BaseClass) {\n    var baseProto = BaseClass.prototype;\n    var _a = compile(this.attributes = getAttributes(definition), baseProto._attributes), properties = _a.properties, _localEvents = _a._localEvents, dynamicMixin = tslib_1.__rest(_a, [\"properties\", \"_localEvents\"]);\n    assign(this.prototype, dynamicMixin);\n    definition.properties = defaults(definition.properties || {}, properties);\n    definition._localEvents = _localEvents;\n    Transactional.onDefine.call(this, definition, BaseClass);\n    this.DefaultCollection.define(definition.collection || {});\n    this.Collection = definition.Collection;\n    this.Collection.prototype.model = this;\n};\nRecord._attribute = AggregatedType;\ncreateSharedTypeSpec(Record, SharedType);\nfunction getAttributes(_a) {\n    var defaults = _a.defaults, attributes = _a.attributes, idAttribute = _a.idAttribute;\n    var definition = attributes || defaults || {};\n    if (idAttribute && !(idAttribute in definition)) {\n        definition[idAttribute] = void 0;\n    }\n    return definition;\n}\nexport function attr(proto, attrName) {\n    if (attrName) {\n        if (typeof Reflect !== 'undefined' && Reflect.getMetadata) {\n            Reflect\n                .getMetadata(\"design:type\", proto, attrName)\n                .asProp(proto, attrName);\n        }\n        else {\n            proto._log('error', 'Add import \"reflect-metadata\"; as the first line of your app.');\n        }\n    }\n    else {\n        return proto.asProp;\n    }\n}\nexport function prop(spec) {\n    return spec.asProp;\n}\n//# sourceMappingURL=index.js.map","import { ItemsBehavior, transactionApi } from '../transactions';\nimport { eventsApi } from '../object-plus';\nvar EventMap = eventsApi.EventMap, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, _aquire = transactionApi.aquire, _free = transactionApi.free;\nexport function dispose(collection) {\n    var models = collection.models;\n    collection.models = [];\n    collection._byId = {};\n    freeAll(collection, models);\n    return models;\n}\nexport function convertAndAquire(collection, attrs, options) {\n    var model = collection.model;\n    var record;\n    if (collection._shared) {\n        record = attrs instanceof model ? attrs : model.create(attrs, options);\n        if (collection._shared & ItemsBehavior.listen) {\n            on(record, record._changeEventName, collection._onChildrenChange, collection);\n        }\n    }\n    else {\n        record = attrs instanceof model ? (options.merge ? attrs.clone() : attrs) : model.create(attrs, options);\n        if (!_aquire(collection, record)) {\n            var errors = collection._aggregationError || (collection._aggregationError = []);\n            errors.push(record);\n        }\n    }\n    var _itemEvents = collection._itemEvents;\n    _itemEvents && _itemEvents.subscribe(collection, record);\n    return record;\n}\nexport function free(owner, child, unset) {\n    if (owner._shared) {\n        if (owner._shared & ItemsBehavior.listen) {\n            off(child, child._changeEventName, owner._onChildrenChange, owner);\n        }\n    }\n    else {\n        _free(owner, child);\n        unset || child.dispose();\n    }\n    var _itemEvents = owner._itemEvents;\n    _itemEvents && _itemEvents.unsubscribe(owner, child);\n}\nexport function freeAll(collection, children) {\n    for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {\n        var child = children_1[_i];\n        free(collection, child);\n    }\n    return children;\n}\nexport function sortElements(collection, options) {\n    var _comparator = collection._comparator;\n    if (_comparator && options.sort !== false) {\n        collection.models.sort(_comparator);\n        return true;\n    }\n    return false;\n}\nexport function addIndex(index, model) {\n    index[model.cid] = model;\n    var id = model.id;\n    if (id != null) {\n        index[id] = model;\n    }\n}\nexport function removeIndex(index, model) {\n    delete index[model.cid];\n    var id = model.id;\n    if (id != null) {\n        delete index[id];\n    }\n}\nexport function updateIndex(index, model) {\n    delete index[model.previous(model.idAttribute)];\n    var id = model.id;\n    id == null || (index[id] = model);\n}\nvar CollectionTransaction = (function () {\n    function CollectionTransaction(object, isRoot, added, removed, nested, sorted) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.added = added;\n        this.removed = removed;\n        this.nested = nested;\n        this.sorted = sorted;\n    }\n    CollectionTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, _isDirty = object._isDirty;\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var transaction = nested_1[_i];\n            transaction.commit(object);\n        }\n        if (object._aggregationError) {\n            logAggregationError(object);\n        }\n        for (var _b = 0, nested_2 = nested; _b < nested_2.length; _b++) {\n            var transaction = nested_2[_b];\n            trigger2(object, 'change', transaction.object, _isDirty);\n        }\n        var _c = this, added = _c.added, removed = _c.removed;\n        for (var _d = 0, added_1 = added; _d < added_1.length; _d++) {\n            var record = added_1[_d];\n            trigger3(record, 'add', record, object, _isDirty);\n            trigger3(object, 'add', record, object, _isDirty);\n        }\n        for (var _e = 0, removed_1 = removed; _e < removed_1.length; _e++) {\n            var record = removed_1[_e];\n            trigger3(record, 'remove', record, object, _isDirty);\n            trigger3(object, 'remove', record, object, _isDirty);\n        }\n        if (this.sorted) {\n            trigger2(object, 'sort', object, _isDirty);\n        }\n        if (added.length || removed.length) {\n            trigger2(object, 'update', object, _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return CollectionTransaction;\n}());\nexport { CollectionTransaction };\nexport function logAggregationError(collection) {\n    collection._log('error', 'added records already have an owner', collection._aggregationError);\n    collection._aggregationError = void 0;\n}\n//# sourceMappingURL=commons.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, sortElements, convertAndAquire, addIndex, updateIndex } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nexport function addTransaction(collection, items, options, merge) {\n    var isRoot = begin(collection), nested = [];\n    var added = appendElements(collection, items, nested, options, merge);\n    if (added.length || nested.length) {\n        var needSort = sortOrMoveElements(collection, added, options);\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, [], nested, needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction sortOrMoveElements(collection, added, options) {\n    var at = options.at;\n    if (at != null) {\n        var length_1 = collection.models.length - added.length;\n        at = Number(at);\n        if (at < 0)\n            at += length_1 + 1;\n        if (at < 0)\n            at = 0;\n        if (at > length_1)\n            at = length_1;\n        moveElements(collection.models, at, added);\n        return false;\n    }\n    return sortElements(collection, options);\n}\nfunction moveElements(source, at, added) {\n    for (var j = source.length - 1, i = j - added.length; i >= at; i--, j--) {\n        source[j] = source[i];\n    }\n    for (i = 0, j = at; i < added.length; i++, j++) {\n        source[j] = added[i];\n    }\n}\nfunction appendElements(collection, a_items, nested, a_options, forceMerge) {\n    var _byId = collection._byId, models = collection.models, merge = (forceMerge || a_options.merge) && !collection._shared, parse = a_options.parse, idAttribute = collection.model.prototype.idAttribute, prevLength = models.length;\n    for (var _i = 0, a_items_1 = a_items; _i < a_items_1.length; _i++) {\n        var item = a_items_1[_i];\n        var model = item ? _byId[item[idAttribute]] || _byId[item.cid] : null;\n        if (model) {\n            if (merge && item !== model) {\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, a_options);\n                transaction && nested.push(transaction);\n                if (model.hasChanged(idAttribute)) {\n                    updateIndex(_byId, model);\n                }\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, a_options);\n            models.push(model);\n            addIndex(_byId, model);\n        }\n    }\n    return models.slice(prevLength);\n}\n//# sourceMappingURL=add.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, convertAndAquire, free, sortElements, addIndex, freeAll } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nvar silentOptions = { silent: true };\nexport function emptySetTransaction(collection, items, options, silent) {\n    var isRoot = begin(collection);\n    var added = _reallocateEmpty(collection, items, options);\n    if (added.length) {\n        var needSort = sortElements(collection, options);\n        if (markAsDirty(collection, silent ? silentOptions : options)) {\n            return new CollectionTransaction(collection, isRoot, added.slice(), [], [], needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nexport function setTransaction(collection, items, options) {\n    var isRoot = begin(collection), nested = [];\n    var previous = collection.models, added = _reallocate(collection, items, nested, options);\n    var reusedCount = collection.models.length - added.length, removed = reusedCount < previous.length ? (reusedCount ? _garbageCollect(collection, previous) :\n        freeAll(collection, previous)) : [];\n    var addedOrChanged = nested.length || added.length, sorted = (sortElements(collection, options) && addedOrChanged) || added.length || options.sorted;\n    if (addedOrChanged || removed.length || sorted) {\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, removed, nested, sorted);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction _garbageCollect(collection, previous) {\n    var _byId = collection._byId, removed = [];\n    for (var _i = 0, previous_1 = previous; _i < previous_1.length; _i++) {\n        var record = previous_1[_i];\n        if (!_byId[record.cid]) {\n            removed.push(record);\n            free(collection, record);\n        }\n    }\n    return removed;\n}\nfunction _reallocate(collection, source, nested, options) {\n    var models = Array(source.length), _byId = {}, merge = (options.merge == null ? true : options.merge) && !collection._shared, _prevById = collection._byId, prevModels = collection.models, idAttribute = collection.model.prototype.idAttribute, toAdd = [], orderKept = true;\n    for (var i = 0, j = 0; i < source.length; i++) {\n        var item = source[i], model = null;\n        if (item) {\n            var id = item[idAttribute], cid = item.cid;\n            if (_byId[id] || _byId[cid])\n                continue;\n            model = _prevById[id] || _prevById[cid];\n        }\n        if (model) {\n            if (merge && item !== model) {\n                if (orderKept && prevModels[j] !== model)\n                    orderKept = false;\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, options);\n                transaction && nested.push(transaction);\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, options);\n            toAdd.push(model);\n        }\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    collection.models = models;\n    collection._byId = _byId;\n    if (!orderKept)\n        options.sorted = true;\n    return toAdd;\n}\nfunction _reallocateEmpty(self, source, options) {\n    var len = source ? source.length : 0, models = Array(len), _byId = {}, idAttribute = self.model.prototype.idAttribute;\n    for (var i = 0, j = 0; i < len; i++) {\n        var src = source[i];\n        if (src && (_byId[src[idAttribute]] || _byId[src.cid])) {\n            continue;\n        }\n        var model = convertAndAquire(self, src, options);\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    self._byId = _byId;\n    return self.models = models;\n}\n//# sourceMappingURL=set.js.map","import { free, CollectionTransaction, removeIndex } from './commons';\nimport { eventsApi } from '../object-plus';\nimport { transactionApi } from '../transactions';\nvar trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, markAsDirty = transactionApi.markAsDirty, begin = transactionApi.begin, commit = transactionApi.commit;\nexport function removeOne(collection, el, options) {\n    var model = collection.get(el);\n    if (model) {\n        var isRoot = begin(collection), models = collection.models;\n        models.splice(models.indexOf(model), 1);\n        removeIndex(collection._byId, model);\n        var notify = markAsDirty(collection, options);\n        if (notify) {\n            trigger3(model, 'remove', model, collection, options);\n            trigger3(collection, 'remove', model, collection, options);\n        }\n        free(collection, model, options.unset);\n        notify && trigger2(collection, 'update', collection, options);\n        isRoot && commit(collection);\n        return model;\n    }\n}\n;\nexport function removeMany(collection, toRemove, options) {\n    var removed = _removeFromIndex(collection, toRemove, options.unset);\n    if (removed.length) {\n        var isRoot = begin(collection);\n        _reallocate(collection, removed.length);\n        if (markAsDirty(collection, options)) {\n            var transaction = new CollectionTransaction(collection, isRoot, [], removed, [], false);\n            transaction.commit();\n        }\n        else {\n            isRoot && commit(collection);\n        }\n    }\n    return removed;\n}\n;\nfunction _removeFromIndex(collection, toRemove, unset) {\n    var removed = Array(toRemove.length), _byId = collection._byId;\n    for (var i = 0, j = 0; i < toRemove.length; i++) {\n        var model = collection.get(toRemove[i]);\n        if (model) {\n            removed[j++] = model;\n            removeIndex(_byId, model);\n            free(collection, model, unset);\n        }\n    }\n    removed.length = j;\n    return removed;\n}\nfunction _reallocate(collection, removed) {\n    var prev = collection.models, models = collection.models = Array(prev.length - removed), _byId = collection._byId;\n    for (var i = 0, j = 0; i < prev.length; i++) {\n        var model = prev[i];\n        if (_byId[model.cid]) {\n            models[j++] = model;\n        }\n    }\n    models.length = j;\n}\n//# sourceMappingURL=remove.js.map","import * as tslib_1 from \"tslib\";\nimport { define, tools, eventsApi, EventMap, definitions, mixinRules, Mixable } from '../object-plus';\nimport { ItemsBehavior, transactionApi, Transactional } from '../transactions';\nimport { Record, SharedType, AggregatedType, createSharedTypeSpec } from '../record';\nimport { free, sortElements, dispose, updateIndex } from './commons';\nimport { addTransaction } from './add';\nimport { setTransaction, emptySetTransaction } from './set';\nimport { removeOne, removeMany } from './remove';\nvar trigger2 = eventsApi.trigger2, on = eventsApi.on, off = eventsApi.off, begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, omit = tools.omit, log = tools.log, assign = tools.assign, defaults = tools.defaults, assignToClassProto = tools.assignToClassProto;\nvar _count = 0;\nvar slice = Array.prototype.slice;\nvar CollectionRefsType = (function (_super) {\n    tslib_1.__extends(CollectionRefsType, _super);\n    function CollectionRefsType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    CollectionRefsType.defaultValue = [];\n    return CollectionRefsType;\n}(SharedType));\nvar Collection = (function (_super) {\n    tslib_1.__extends(Collection, _super);\n    function Collection(records, options, shared) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this, _count++) || this;\n        _this.models = [];\n        _this._byId = {};\n        _this.comparator = _this.comparator;\n        if (options.comparator !== void 0) {\n            _this.comparator = options.comparator;\n            options.comparator = void 0;\n        }\n        _this.model = _this.model;\n        if (options.model) {\n            _this.model = options.model;\n            options.model = void 0;\n        }\n        _this.idAttribute = _this.model.prototype.idAttribute;\n        _this._shared = shared || 0;\n        if (records) {\n            var elements = toElements(_this, records, options);\n            emptySetTransaction(_this, elements, options, true);\n        }\n        _this.initialize.apply(_this, arguments);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Collection_1 = Collection;\n    Collection.prototype.createSubset = function (models, options) {\n        var SubsetOf = this.constructor.subsetOf(this).options.type, subset = new SubsetOf(models, options);\n        subset.resolve(this);\n        return subset;\n    };\n    Collection.onExtend = function (BaseClass) {\n        var Ctor = this;\n        this._SubsetOf = null;\n        function RefsCollection(a, b, listen) {\n            Ctor.call(this, a, b, ItemsBehavior.share | (listen ? ItemsBehavior.listen : 0));\n        }\n        Mixable.mixins.populate(RefsCollection);\n        RefsCollection.prototype = this.prototype;\n        RefsCollection._attribute = CollectionRefsType;\n        this.Refs = this.Subset = RefsCollection;\n        Transactional.onExtend.call(this, BaseClass);\n        createSharedTypeSpec(this, SharedType);\n    };\n    Collection.onDefine = function (definition, BaseClass) {\n        if (definition.itemEvents) {\n            var eventsMap = new EventMap(BaseClass.prototype._itemEvents);\n            eventsMap.addEventsMap(definition.itemEvents);\n            this.prototype._itemEvents = eventsMap;\n        }\n        if (definition.comparator)\n            this.prototype.comparator = definition.comparator;\n        Transactional.onDefine.call(this, definition);\n    };\n    Object.defineProperty(Collection.prototype, \"__inner_state__\", {\n        get: function () { return this.models; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Collection.prototype, \"comparator\", {\n        get: function () { return this._comparator; },\n        set: function (x) {\n            var _this = this;\n            var compare;\n            switch (typeof x) {\n                case 'string':\n                    this._comparator = function (a, b) {\n                        var aa = a[x], bb = b[x];\n                        if (aa === bb)\n                            return 0;\n                        return aa < bb ? -1 : +1;\n                    };\n                    break;\n                case 'function':\n                    if (x.length === 1) {\n                        this._comparator = function (a, b) {\n                            var aa = x.call(_this, a), bb = x.call(_this, b);\n                            if (aa === bb)\n                                return 0;\n                            return aa < bb ? -1 : +1;\n                        };\n                    }\n                    else {\n                        this._comparator = function (a, b) { return x.call(_this, a, b); };\n                    }\n                    break;\n                default:\n                    this._comparator = null;\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.getStore = function () {\n        return this._store || (this._store = this._owner ? this._owner.getStore() : this._defaultStore);\n    };\n    Collection.prototype._onChildrenChange = function (record, options, initiator) {\n        if (options === void 0) { options = {}; }\n        if (initiator === this)\n            return;\n        var idAttribute = this.idAttribute;\n        if (record.hasChanged(idAttribute)) {\n            updateIndex(this._byId, record);\n        }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger2(this, 'change', record, options);\n        }\n        isRoot && commit(this);\n    };\n    Collection.prototype.get = function (objOrId) {\n        if (objOrId == null)\n            return;\n        if (typeof objOrId === 'object') {\n            var id = objOrId[this.idAttribute];\n            return (id !== void 0 && this._byId[id]) || this._byId[objOrId.cid];\n        }\n        else {\n            return this._byId[objOrId];\n        }\n    };\n    Collection.prototype.each = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            fun(models[i], i);\n        }\n    };\n    Collection.prototype.every = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (!fun(models[i], i))\n                return false;\n        }\n        return true;\n    };\n    Collection.prototype.filter = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        return this.map(function (x, i) { return fun(x, i) ? x : void 0; });\n    };\n    Collection.prototype.find = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (fun(models[i], i))\n                return models[i];\n        }\n        return null;\n    };\n    Collection.prototype.some = function (iteratee, context) {\n        return Boolean(this.find(iteratee, context));\n    };\n    Collection.prototype.map = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models, mapped = Array(models.length);\n        var j = 0;\n        for (var i = 0; i < models.length; i++) {\n            var x = fun(models[i], i);\n            x === void 0 || (mapped[j++] = x);\n        }\n        mapped.length = j;\n        return mapped;\n    };\n    Collection.prototype._validateNested = function (errors) {\n        if (this._shared)\n            return 0;\n        var count = 0;\n        this.each(function (record) {\n            var error = record.validationError;\n            if (error) {\n                errors[record.cid] = error;\n                count++;\n            }\n        });\n        return count;\n    };\n    Collection.prototype.initialize = function () { };\n    Object.defineProperty(Collection.prototype, \"length\", {\n        get: function () { return this.models.length; },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.first = function () { return this.models[0]; };\n    Collection.prototype.last = function () { return this.models[this.models.length - 1]; };\n    Collection.prototype.at = function (a_index) {\n        var index = a_index < 0 ? a_index + this.models.length : a_index;\n        return this.models[index];\n    };\n    Collection.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var models = this._shared & ItemsBehavior.share ? this.models : this.map(function (model) { return model.clone(); }), copy = new this.constructor(models, { model: this.model, comparator: this.comparator }, this._shared);\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Collection.prototype.toJSON = function () {\n        return this.models.map(function (model) { return model.toJSON(); });\n    };\n    Collection.prototype.set = function (elements, options) {\n        if (elements === void 0) { elements = []; }\n        if (options === void 0) { options = {}; }\n        if (options.add !== void 0) {\n            this._log('warn', \"Collection.set doesn't support 'add' option, behaving as if options.add === true.\", options);\n        }\n        if (options.reset) {\n            this.reset(elements, options);\n        }\n        else {\n            var transaction = this._createTransaction(elements, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Collection.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        var aggregated = !this._shared;\n        for (var _i = 0, _a = this.models; _i < _a.length; _i++) {\n            var record = _a[_i];\n            free(this, record);\n            if (aggregated)\n                record.dispose();\n        }\n        _super.prototype.dispose.call(this);\n    };\n    Collection.prototype.reset = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), previousModels = dispose(this);\n        if (a_elements) {\n            emptySetTransaction(this, toElements(this, a_elements, options), options, true);\n        }\n        markAsDirty(this, options);\n        options.silent || trigger2(this, 'reset', this, defaults({ previousModels: previousModels }, options));\n        isRoot && commit(this);\n        return this.models;\n    };\n    Collection.prototype.add = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options), transaction = this.models.length ?\n            addTransaction(this, elements, options) :\n            emptySetTransaction(this, elements, options);\n        if (transaction) {\n            transaction.commit();\n            return transaction.added;\n        }\n    };\n    Collection.prototype.remove = function (recordsOrIds, options) {\n        if (options === void 0) { options = {}; }\n        if (recordsOrIds) {\n            return Array.isArray(recordsOrIds) ?\n                removeMany(this, recordsOrIds, options) :\n                removeOne(this, recordsOrIds, options);\n        }\n        return [];\n    };\n    Collection.prototype._createTransaction = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options);\n        if (this.models.length) {\n            return options.remove === false ?\n                addTransaction(this, elements, options, true) :\n                setTransaction(this, elements, options);\n        }\n        else {\n            return emptySetTransaction(this, elements, options);\n        }\n    };\n    Collection.prototype.pluck = function (key) {\n        return this.models.map(function (model) { return model[key]; });\n    };\n    Collection.prototype.sort = function (options) {\n        if (options === void 0) { options = {}; }\n        if (sortElements(this, options)) {\n            var isRoot = begin(this);\n            if (markAsDirty(this, options)) {\n                trigger2(this, 'sort', this, options);\n            }\n            isRoot && commit(this);\n        }\n        return this;\n    };\n    Collection.prototype.push = function (model, options) {\n        return this.add(model, assign({ at: this.length }, options));\n    };\n    Collection.prototype.pop = function (options) {\n        var model = this.at(this.length - 1);\n        this.remove(model, tslib_1.__assign({ unset: true }, options));\n        return model;\n    };\n    Collection.prototype.unset = function (modelOrId, options) {\n        var value = this.get(modelOrId);\n        this.remove(modelOrId, tslib_1.__assign({ unset: true }, options));\n        return value;\n    };\n    Collection.prototype.unshift = function (model, options) {\n        return this.add(model, assign({ at: 0 }, options));\n    };\n    Collection.prototype.shift = function (options) {\n        var model = this.at(0);\n        this.remove(model, tslib_1.__assign({ unset: true }, options));\n        return model;\n    };\n    Collection.prototype.slice = function () {\n        return slice.apply(this.models, arguments);\n    };\n    Collection.prototype.indexOf = function (modelOrId) {\n        var record = this.get(modelOrId);\n        return this.models.indexOf(record);\n    };\n    Collection.prototype.modelId = function (attrs) {\n        return attrs[this.model.prototype.idAttribute];\n    };\n    Collection.prototype.toggle = function (model, a_next) {\n        var prev = Boolean(this.get(model)), next = a_next === void 0 ? !prev : Boolean(a_next);\n        if (prev !== next) {\n            if (prev) {\n                this.remove(model);\n            }\n            else {\n                this.add(model);\n            }\n        }\n        return next;\n    };\n    Collection.prototype._log = function (level, text, value) {\n        tools.log(level, \"[Collection Update] \" + this.model.prototype.getClassName() + \".\" + this.getClassName() + \": \" + text, {\n            Argument: value,\n            'Attributes spec': this.model.prototype._attributes\n        });\n    };\n    Collection.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Collection';\n    };\n    Collection._attribute = AggregatedType;\n    Collection = Collection_1 = tslib_1.__decorate([\n        define({\n            cidPrefix: 'c',\n            model: Record,\n            _changeEventName: 'changes',\n            _aggregationError: null\n        }),\n        definitions({\n            comparator: mixinRules.value,\n            model: mixinRules.protoValue,\n            itemEvents: mixinRules.merge\n        })\n    ], Collection);\n    return Collection;\n    var Collection_1;\n}(Transactional));\nexport { Collection };\nfunction toElements(collection, elements, options) {\n    var parsed = options.parse ? collection.parse(elements, options) : elements;\n    return Array.isArray(parsed) ? parsed : [parsed];\n}\ncreateSharedTypeSpec(Collection, SharedType);\nRecord.Collection = Collection;\nfunction bindContext(fun, context) {\n    return context !== void 0 ? function (v, k) { return fun.call(context, v, k); } : fun;\n}\nfunction toPredicateFunction(iteratee, context) {\n    if (typeof iteratee === 'object') {\n        return function (x) {\n            for (var key in iteratee) {\n                if (iteratee[key] !== x[key])\n                    return false;\n            }\n            return true;\n        };\n    }\n    return bindContext(iteratee, context);\n}\n//# sourceMappingURL=index.js.map","import { CompiledReference } from '../traversable';\nexport function parseReference(collectionRef) {\n    switch (typeof collectionRef) {\n        case 'function':\n            return function (root) { return collectionRef.call(root); };\n        case 'object':\n            return function () { return collectionRef; };\n        case 'string':\n            var resolve = new CompiledReference(collectionRef).resolve;\n            return resolve;\n    }\n}\n//# sourceMappingURL=commons.js.map","import * as tslib_1 from \"tslib\";\nimport { Collection } from '../collection';\nimport { tools, define } from '../object-plus';\nimport { parseReference } from './commons';\nimport { ChainableAttributeSpec } from '../record';\nimport { ItemsBehavior, transactionApi } from '../transactions';\nvar fastDefaults = tools.fastDefaults;\nCollection.subsetOf = function subsetOf(masterCollection) {\n    var SubsetOf = this._SubsetOf || (this._SubsetOf = defineSubsetCollection(this)), getMasterCollection = parseReference(masterCollection), typeSpec = new ChainableAttributeSpec({\n        type: SubsetOf\n    });\n    return typeSpec.get(function (refs) {\n        !refs || refs.resolvedWith || refs.resolve(getMasterCollection(this));\n        return refs;\n    });\n};\nvar subsetOfBehavior = ItemsBehavior.share | ItemsBehavior.persistent;\nfunction defineSubsetCollection(CollectionConstructor) {\n    var SubsetOfCollection = (function (_super) {\n        tslib_1.__extends(SubsetOfCollection, _super);\n        function SubsetOfCollection(recordsOrIds, options) {\n            var _this = _super.call(this, [], options, subsetOfBehavior) || this;\n            _this.resolvedWith = null;\n            _this.refs = toArray(recordsOrIds);\n            return _this;\n        }\n        Object.defineProperty(SubsetOfCollection.prototype, \"__inner_state__\", {\n            get: function () { return this.refs || this.models; },\n            enumerable: true,\n            configurable: true\n        });\n        SubsetOfCollection.prototype.add = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, toAdd = toArray(a_elements);\n            if (resolvedWith) {\n                return _super.prototype.add.call(this, resolveRefs(resolvedWith, toAdd), options);\n            }\n            else {\n                if (toAdd.length) {\n                    var isRoot = transactionApi.begin(this);\n                    this.refs = this.refs ? this.refs.concat(toAdd) : toAdd.slice();\n                    transactionApi.markAsDirty(this, options);\n                    isRoot && transactionApi.commit(this);\n                }\n            }\n        };\n        SubsetOfCollection.prototype.reset = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype.reset.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options) || [];\n        };\n        SubsetOfCollection.prototype._createTransaction = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype._createTransaction.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options);\n        };\n        SubsetOfCollection.prototype.toJSON = function () {\n            return this.refs ?\n                this.refs.map(function (objOrId) { return objOrId.id || objOrId; }) :\n                this.models.map(function (model) { return model.id; });\n        };\n        SubsetOfCollection.prototype._validateNested = function () { return 0; };\n        SubsetOfCollection.prototype.clone = function (owner) {\n            var Ctor = this.constructor, copy = new Ctor([], {\n                model: this.model,\n                comparator: this.comparator\n            });\n            if (this.resolvedWith) {\n                copy.resolvedWith = this.resolvedWith;\n                copy.reset(this.models, { silent: true });\n            }\n            else {\n                copy.refs = this.refs.slice();\n            }\n            return copy;\n        };\n        SubsetOfCollection.prototype.parse = function (raw) {\n            return raw;\n        };\n        SubsetOfCollection.prototype.resolve = function (collection) {\n            if (collection && collection.length) {\n                this.resolvedWith = collection;\n                if (this.refs) {\n                    this.reset(this.refs, { silent: true });\n                    this.refs = null;\n                }\n            }\n            return this;\n        };\n        SubsetOfCollection.prototype.getModelIds = function () { return this.toJSON(); };\n        SubsetOfCollection.prototype.toggle = function (modelOrId, val) {\n            return _super.prototype.toggle.call(this, this.resolvedWith.get(modelOrId), val);\n        };\n        SubsetOfCollection.prototype.addAll = function () {\n            if (this.resolvedWith) {\n                this.set(this.resolvedWith.models);\n                return this.models;\n            }\n            throw new Error(\"Cannot add elemens because the subset collection is not resolved yet.\");\n        };\n        SubsetOfCollection.prototype.toggleAll = function () {\n            return this.length ? this.reset() : this.addAll();\n        };\n        SubsetOfCollection = tslib_1.__decorate([\n            define\n        ], SubsetOfCollection);\n        return SubsetOfCollection;\n    }(CollectionConstructor));\n    SubsetOfCollection.prototype._itemEvents = void 0;\n    return SubsetOfCollection;\n}\nfunction resolveRefs(master, elements) {\n    var records = [];\n    for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n        var el = elements_1[_i];\n        var record = master.get(el);\n        if (record)\n            records.push(record);\n    }\n    return records;\n}\nfunction delaySet(collection, elements, options) {\n    if (tools.notEqual(collection.refs, elements)) {\n        var isRoot = transactionApi.begin(collection);\n        collection.refs = elements.slice();\n        transactionApi.markAsDirty(collection, options);\n        isRoot && transactionApi.commit(collection);\n    }\n}\nfunction toArray(elements) {\n    return elements ? (Array.isArray(elements) ? elements : [elements]) : [];\n}\n//# sourceMappingURL=subsetOf.js.map","import * as tools from './tools';\nexport { tools };\nexport * from './mixins';\nexport * from './events';\nimport * as eventsApi from './eventsource';\nexport { eventsApi };\nimport { Mixable } from './mixins';\nObject.extend = function (protoProps, staticProps) { return Mixable.extend(protoProps, staticProps); };\nObject.assign || (Object.assign = tools.assign);\nObject.log = tools.log;\n//# sourceMappingURL=index.js.map","var ValidationError = (function () {\n    function ValidationError(obj) {\n        this.length = obj._validateNested(this.nested = {});\n        if (this.error = obj.validate(obj)) {\n            this.length++;\n        }\n    }\n    ValidationError.prototype.each = function (iteratee) {\n        var _a = this, error = _a.error, nested = _a.nested;\n        if (error)\n            iteratee(error, null);\n        for (var key in nested) {\n            iteratee(nested[key], key);\n        }\n    };\n    ValidationError.prototype.eachError = function (iteratee, object) {\n        this.each(function (value, key) {\n            if (value instanceof ValidationError) {\n                value.eachError(iteratee, object.get(key));\n            }\n            else {\n                iteratee(value, key, object);\n            }\n        });\n    };\n    return ValidationError;\n}());\nexport { ValidationError };\n//# sourceMappingURL=validation.js.map","import * as tslib_1 from \"tslib\";\nimport { Messenger, tools, mixins, eventsApi, define } from './object-plus';\nimport { ValidationError } from './validation';\nimport { resolveReference } from './traversable';\nvar assign = tools.assign, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off;\nexport var ItemsBehavior;\n(function (ItemsBehavior) {\n    ItemsBehavior[ItemsBehavior[\"share\"] = 1] = \"share\";\n    ItemsBehavior[ItemsBehavior[\"listen\"] = 2] = \"listen\";\n    ItemsBehavior[ItemsBehavior[\"persistent\"] = 4] = \"persistent\";\n})(ItemsBehavior || (ItemsBehavior = {}));\nvar Transactional = (function () {\n    function Transactional(cid) {\n        this._events = void 0;\n        this._changeToken = {};\n        this._transaction = false;\n        this._isDirty = null;\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this._validationError = void 0;\n        this.cid = this.cidPrefix + cid;\n    }\n    Transactional_1 = Transactional;\n    Transactional.onExtend = function (BaseClass) {\n        if (BaseClass.create === this.create) {\n            this.create = Transactional_1.create;\n        }\n    };\n    Transactional.create = function (a, b) {\n        return new this(a, b);\n    };\n    Transactional.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this.off();\n        this.stopListening();\n        this._disposed = true;\n    };\n    Transactional.prototype.initialize = function () { };\n    Transactional.prototype.onChanges = function (handler, target) {\n        on(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.offChanges = function (handler, target) {\n        off(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.listenToChanges = function (target, handler) {\n        this.listenTo(target, target._changeEventName, handler);\n    };\n    Transactional.prototype.transaction = function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = transactionApi.begin(this);\n        var update = fun.call(this, this);\n        update && this.set(update);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.updateEach = function (iteratee, options) {\n        var isRoot = transactionApi.begin(this);\n        this.each(iteratee);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.set = function (values, options) {\n        if (values) {\n            var transaction = this._createTransaction(values, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Transactional.prototype.assignFrom = function (source) {\n        return this.set(source.__inner_state__ || source, { merge: true });\n    };\n    Transactional.prototype.parse = function (data, options) { return data; };\n    Transactional.prototype.deepGet = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.get ? object.get(key) : object[key]; });\n    };\n    Transactional.prototype.getOwner = function () {\n        return this._owner;\n    };\n    Transactional.prototype.getStore = function () {\n        var _owner = this._owner;\n        return _owner ? _owner.getStore() : this._defaultStore;\n    };\n    Transactional.prototype.map = function (iteratee, context) {\n        var arr = [], fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = fun(val, key);\n            if (result !== void 0)\n                arr.push(result);\n        });\n        return arr;\n    };\n    Transactional.prototype.mapObject = function (iteratee, context) {\n        var obj = {}, fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = iteratee(val, key);\n            if (result !== void 0)\n                obj[key] = result;\n        });\n        return obj;\n    };\n    Object.defineProperty(Transactional.prototype, \"validationError\", {\n        get: function () {\n            var error = this._validationError || (this._validationError = new ValidationError(this));\n            return error.length ? error : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Transactional.prototype.validate = function (obj) { };\n    Transactional.prototype.getValidationError = function (key) {\n        var error = this.validationError;\n        return (key ? error && error.nested[key] : error) || null;\n    };\n    Transactional.prototype.deepValidationError = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.getValidationError(key); });\n    };\n    Transactional.prototype.eachValidationError = function (iteratee) {\n        var validationError = this.validationError;\n        validationError && validationError.eachError(iteratee, this);\n    };\n    Transactional.prototype.isValid = function (key) {\n        return !this.getValidationError(key);\n    };\n    Transactional.prototype.valueOf = function () { return this.cid; };\n    Transactional.prototype.toString = function () { return this.cid; };\n    Transactional.prototype.getClassName = function () {\n        var name = this.constructor.name;\n        if (name !== 'Subclass')\n            return name;\n    };\n    Transactional = Transactional_1 = tslib_1.__decorate([\n        define,\n        mixins(Messenger)\n    ], Transactional);\n    return Transactional;\n    var Transactional_1;\n}());\nexport { Transactional };\nexport var transactionApi = {\n    begin: function (object) {\n        return object._transaction ? false : (object._transaction = true);\n    },\n    markAsDirty: function (object, options) {\n        var dirty = !options.silent;\n        if (dirty)\n            object._isDirty = options;\n        object._changeToken = {};\n        object._validationError = void 0;\n        return dirty;\n    },\n    commit: function (object, initiator) {\n        var originalOptions = object._isDirty;\n        if (originalOptions) {\n            while (object._isDirty) {\n                var options = object._isDirty;\n                object._isDirty = null;\n                trigger3(object, object._changeEventName, object, options, initiator);\n            }\n            object._transaction = false;\n            var _owner = object._owner;\n            if (_owner && _owner !== initiator) {\n                _owner._onChildrenChange(object, originalOptions);\n            }\n        }\n        else {\n            object._isDirty = null;\n            object._transaction = false;\n        }\n    },\n    aquire: function (owner, child, key) {\n        if (!child._owner) {\n            child._owner = owner;\n            child._ownerKey = key;\n            return true;\n        }\n        return child._owner === owner;\n    },\n    free: function (owner, child) {\n        if (owner === child._owner) {\n            child._owner = void 0;\n            child._ownerKey = void 0;\n        }\n    }\n};\n//# sourceMappingURL=transactions.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from './any';\nimport { transactionApi, ItemsBehavior } from '../../transactions';\nvar free = transactionApi.free, aquire = transactionApi.aquire;\nvar AggregatedType = (function (_super) {\n    tslib_1.__extends(AggregatedType, _super);\n    function AggregatedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    AggregatedType.prototype.clone = function (value) {\n        return value ? value.clone() : value;\n    };\n    AggregatedType.prototype.toJSON = function (x) { return x && x.toJSON(); };\n    AggregatedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AggregatedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AggregatedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null) {\n            if (next instanceof this.type) {\n                if (options.merge)\n                    return next.__inner_state__;\n            }\n            else {\n                return next;\n            }\n        }\n    };\n    AggregatedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null)\n            return next;\n        if (next instanceof this.type) {\n            if (next._shared && !(next._shared & ItemsBehavior.persistent)) {\n                this._log('error', 'aggregated collection attribute is assigned with shared collection', next, record);\n            }\n            return options.merge ? next.clone() : next;\n        }\n        return this.type.create(next, options);\n    };\n    AggregatedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    AggregatedType.prototype.validate = function (record, value) {\n        var error = value && value.validationError;\n        if (error)\n            return error;\n    };\n    AggregatedType.prototype.create = function () {\n        return this.type.create();\n    };\n    AggregatedType.prototype.initialize = function (options) {\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    AggregatedType.prototype._handleChange = function (next, prev, record, options) {\n        if (prev) {\n            free(record, prev);\n            options.unset || prev.dispose();\n        }\n        if (next && !aquire(record, next, this.name)) {\n            this._log('error', 'aggregated attribute assigned with object already having an owner', next, record);\n        }\n    };\n    return AggregatedType;\n}(AnyType));\nexport { AggregatedType };\n//# sourceMappingURL=owned.js.map","import * as tslib_1 from \"tslib\";\nimport { AnyType } from '../record';\nimport { parseReference } from './commons';\nimport { Record } from '../record';\nimport { ChainableAttributeSpec } from '../record';\nvar RecordRefType = (function (_super) {\n    tslib_1.__extends(RecordRefType, _super);\n    function RecordRefType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RecordRefType.prototype.toJSON = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.clone = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.isChanged = function (a, b) {\n        var aId = a && (a.id == null ? a : a.id), bId = b && (b.id == null ? b : b.id);\n        return aId !== bId;\n    };\n    RecordRefType.prototype.validate = function (model, value, name) { };\n    return RecordRefType;\n}(AnyType));\nRecord.from = function from(masterCollection) {\n    var getMasterCollection = parseReference(masterCollection);\n    var typeSpec = new ChainableAttributeSpec({\n        value: null,\n        _attribute: RecordRefType\n    });\n    return typeSpec\n        .get(function (objOrId, name) {\n        if (typeof objOrId === 'object')\n            return objOrId;\n        var collection = getMasterCollection(this);\n        var record = null;\n        if (collection && collection.length) {\n            record = collection.get(objOrId) || null;\n            this.attributes[name] = record;\n            record && this._attributes[name].handleChange(record, null, this, {});\n        }\n        return record;\n    });\n};\n//# sourceMappingURL=from.js.map","import * as tslib_1 from \"tslib\";\nimport { Record } from '../record';\nimport { Transactional } from '../transactions';\nvar _store = null;\nvar Store = (function (_super) {\n    tslib_1.__extends(Store, _super);\n    function Store() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Store.prototype.getStore = function () { return this; };\n    Store.prototype.get = function (name) {\n        var local = this[name];\n        if (local || this === this._defaultStore)\n            return local;\n        return this._owner ? this._owner.get(name) : this._defaultStore.get(name);\n    };\n    Object.defineProperty(Store, \"global\", {\n        get: function () { return _store; },\n        set: function (store) {\n            if (_store) {\n                _store.dispose();\n            }\n            Transactional.prototype._defaultStore = _store = store;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Store;\n}(Record));\nexport { Store };\nStore.global = new Store();\n//# sourceMappingURL=store.js.map","import * as tslib_1 from \"tslib\";\nexport * from './object-plus';\nexport * from './collection';\nexport * from './relations';\nexport * from './record';\nimport { Events } from './object-plus/';\nexport var on = (_a = Events, _a.on), off = _a.off, trigger = _a.trigger, once = _a.once, listenTo = _a.listenTo, stopListening = _a.stopListening, listenToOnce = _a.listenToOnce;\nimport { Record as Model } from './record';\nimport { define, Mixable as Class } from './object-plus/';\nexport { Model, Class };\nexport function attributes(attrDefs) {\n    var DefaultRecord = (function (_super) {\n        tslib_1.__extends(DefaultRecord, _super);\n        function DefaultRecord() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultRecord.attributes = attrDefs;\n        DefaultRecord = tslib_1.__decorate([\n            define\n        ], DefaultRecord);\n        return DefaultRecord;\n    }(Model));\n    return DefaultRecord;\n}\nimport { ChainableAttributeSpec } from './record';\nexport function value(x) {\n    return new ChainableAttributeSpec({ value: x });\n}\nexport function transaction(method) {\n    return function () {\n        var _this = this;\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var result;\n        this.transaction(function () {\n            result = method.apply(_this, args);\n        });\n        return result;\n    };\n}\nvar _a;\n//# sourceMappingURL=index.js.map"],"names":["__extends","d","b","__","this","constructor","extendStatics","prototype","Object","create","__rest","s","e","t","p","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","__decorate","decorators","target","key","desc","c","arguments","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","isValidJSON","value","proto","getPrototypeOf","Array","every","getBaseClass","Class","isEmpty","obj","someArray","arr","fun","result","someObject","some","ArrayProto","predicate","x","omit","source","dest","discard","name","transform","assign","other","defaults","once","func","memo","first","apply","notEqual","a","protoA","DateProto","arraysNotEqual","ObjectProto","objectsNotEqual","keysA","keys","predefine","Constructor","BaseClass","__super__","define","MixinsState","get","Mixable","populate","onExtend","ClassOrDefinition","Ctor","definitions","rules","mixins","definitionRules","definitionDecorator","definitionKey","mergeObject","_a","_b","forEachOwnProp","object","ignore","dontMix","_i","getOwnPropertyNames","name_2","assignProperty","sourceProp","rule","unshift","destProp","configurable","resolveRule","getBubblingHandler","event","_bubblingHandlers","trigger5","trigger3","trigger2","listOff","_events","callback","context","filteredHead","prev","head","ev","next","_callback","listSend2","listSend3","listSend4","listSend5","listSend6","f","on","EventHandler","once_1","_once","off","name_3","strings","api","events","eventSplitter","test","names_1","split","self","queue","all","uniqueId","_idCount","toPropertyDescriptor","addReference","listener","_listeningTo","cid","resolveReference","root","reference","action","path","match","referenceMask","skip","getStore","getOwner","setAttribute","record","isRoot","begin","options","_attributes","doUpdate","markAsDirty","attributes","commit","_begin","_previousAttributes","AttributesCopy","_changedAttributes","_markAsDirty","constructorsMixin","attrDefs","attrs","Function","map","attr","join","Attributes","shouldBeAnObject","values","_log","chainGetHooks","prevHook","nextHook","chainTransforms","prevTransform","nextTransform","chainChangeHandlers","prevHandler","nextHandler","wrapIsRequired","validate","emptyFunction","toAttributeOptions","spec","attrSpec","has","ChainableAttributeSpec","type","inferType","Transactional","shared","hasCustomDefault","Number","String","Boolean","supportsDate","date","isNaN","Date","getTime","safeParseDate","timestamp","struct","minutesOffset","isoDatePattern","exec","k","numericKeys","undefined","UTC","parse","Integer","Math","round","doNothing","createAttribute","AnyType","parseMixin","attrsWithParse","filter","_parse","createToJSON","toJSON","createSharedTypeSpec","Attribute","_attribute","localEventsMixin","attrSpecs","_localEvents","_onChange","eventsApi.EventMap","addEvent","createWatcherFromRef","wrapWatcher","watcher","ref","CompiledReference","local","resolve","tail","typeCheck","unknown","push","getAttributes","idAttribute","definition","dispose","collection","models","_byId","freeAll","convertAndAquire","model","_shared","ItemsBehavior","listen","_changeEventName","_onChildrenChange","merge","clone","_aquire","_aggregationError","_itemEvents","subscribe","free","owner","child","unset","_free","unsubscribe","children","children_1","sortElements","_comparator","sort","addIndex","index","id","removeIndex","updateIndex","previous","logAggregationError","addTransaction","items","nested","added","appendElements","needSort","sortOrMoveElements","CollectionTransaction","at","length_1","moveElements","j","a_items","a_options","forceMerge","prevLength","a_items_1","item","transaction","_createTransaction","hasChanged","slice","emptySetTransaction","silent","_reallocateEmpty","silentOptions","setTransaction","_reallocate","reusedCount","removed","_garbageCollect","addedOrChanged","sorted","previous_1","_prevById","prevModels","toAdd","orderKept","len","src","removeOne","el","splice","notify","removeMany","toRemove","_removeFromIndex","toElements","elements","parsed","isArray","bindContext","v","toPredicateFunction","iteratee","parseReference","collectionRef","defineSubsetCollection","CollectionConstructor","SubsetOfCollection","_super","recordsOrIds","_this","subsetOfBehavior","resolvedWith","refs","toArray","tslib_1.__extends","enumerable","add","a_elements","resolveRefs","transactionApi","concat","reset","delaySet","objOrId","_validateNested","copy","comparator","raw","getModelIds","toggle","modelOrId","val","addAll","set","Error","toggleAll","tslib_1.__decorate","master","records","elements_1","tools.notEqual","setPrototypeOf","__proto__","__assign","n","levelToNumber","none","error","warn","info","log","debug","a_level","a_msg","a_props","msg","props","level","levelAsNumber","throw","logger","stop","process","env","NODE_ENV","console","args","name_1","names","prop","o","protoProps","staticProps","defineMixin","tslib_1.__rest","getStaticDefinitions","onDefine","mergeInheritedMembers","extend","statics","TheSubclass","Subclass","mergeRules","appliedMixins","mixins_1","mixin","sourceMixins","ctors","ctors_1","mixinRules","protoValue","baseProto","function","caller","toString","valueOf","list","pipe","classFirst","classLast","EventMap","handlers","addEventsMap","bubbleEvents","EventDescriptor","event_1","event_2","handler","_eventsApi.strings","_eventsApi.on","_eventsApi.off","_eventsApi.once","_eventsApi.trigger5","_eventsApi.trigger2","_eventsApi.trigger3","Messenger","initialize","localEvents","properties","eventsMap","defineProperties","trigger","listenTo","listenToOnce","stopListening","a_source","removeAll","second","_disposed","Events","tools.assign","tools.log","ValidationError","each","eachError","splitTail","substr","pop","eventsApi.trigger3","eventsApi.on","eventsApi.off","_changeToken","_transaction","_isDirty","_owner","_ownerKey","_validationError","cidPrefix","Transactional_1","onChanges","offChanges","listenToChanges","update","updateEach","assignFrom","__inner_state__","data","deepGet","_defaultStore","mapObject","getValidationError","validationError","deepValidationError","eachValidationError","isValid","getClassName","dirty","initiator","originalOptions","aquire","UpdateRecordMixin","attribute","propagateChanges","forceAttributeChange","a_values","changes","RecordTransaction","nested_1","nested_2","changes_1","emptyOptions","getHook","getHooks","transforms","changeHandlers","changeEvents","defaultValue","tools.isValidJSON","JSON","stringify","isRequired","convert","getHook_1","reduce","validate_1","handleChange","canBeUpdated","isChanged","createPropertyDescriptor","doInit","text","Record","Attribute definition","Prev. value","New value","AggregatedType","nestedTransaction","persistent","_handleChange","check","metadata","changed","eventMap","cloned","_isRequired","asProp","_has","DateType","toISOString","msDatePattern","MSDateType","msDate","TimestampType","microsoft","ImmutableClassType","PrimitiveType","NumericType","num","isFinite","integer","window","ArrayType","ObjectType","FunctionType","shareAndListen","share","SharedType","implicitObject","attributesDefinition","baseClassAttributes","myAttributes","_.transform","allAttributes","_.defaults","ConstructorsMixin","tslib_1.__assign","_attributesArray","_toJSON","tools.isEmpty","_cidCounter","previousAttributes","changedAttributes","diff","old","isNew","clear","nullify","forEachAttr","_attributesArray_1","pinStore","deepClone","errors","json","asJson","deepSet","l","newModel","Attributes definition:","Collection","BaseRecordAttributes","BaseRecordAttributesCopy","IdAttribute","tools.defaults","DefaultCollection","compile","dynamicMixin","eventsApi.trigger2","_c","_d","added_1","_e","removed_1","_count","CollectionRefsType","createSubset","subset","SubsetOf","subsetOf","RefsCollection","_SubsetOf","Refs","Subset","itemEvents","aa","bb","_store","find","mapped","count","last","a_index","aggregated","previousModels","remove","pluck","shift","modelId","a_next","Argument","Attributes spec","RecordRefType","from","masterCollection","getMasterCollection","Store","store","global","DefaultRecord","Model","method","attrName","getMetadata"],"mappings":"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"}