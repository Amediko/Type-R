{"version":3,"file":"index.js","sources":["../lib/object-plus/tools.js","../lib/object-plus/mixins.js","../lib/object-plus/eventsource.js","../lib/object-plus/events.js","../lib/traversable.js","../lib/record/attributes/updates.js","../lib/record/attributes/any.js","../lib/record/attributes/attrDef.js","../lib/record/attributes/date.js","../lib/record/attributes/basic.js","../lib/record/attributes/shared.js","../lib/record/attributes/index.js","../lib/record/record.js","../lib/record/index.js","../lib/collection/commons.js","../lib/collection/add.js","../lib/collection/set.js","../lib/collection/remove.js","../lib/collection/index.js","../lib/relations/commons.js","../lib/relations/subsetOf.js","../lib/object-plus/index.js","../lib/validation.js","../lib/transactions.js","../lib/record/attributes/owned.js","../lib/relations/from.js","../lib/relations/store.js","../lib/index.js"],"sourcesContent":["var levelToNumber = {\n    none: 0, error: 1, warn: 2, info: 3, log: 4, debug: 5\n};\nexport var log = function (a_level, a_msg, a_props) {\n    var levelAsNumber = levelToNumber[a_level], msg, props, level;\n    if (levelAsNumber === void 0 && !a_props) {\n        levelAsNumber = 4;\n        msg = a_level;\n        props = a_msg;\n        level = 'log';\n    }\n    else {\n        msg = a_msg, level = a_level, props = a_props;\n    }\n    if (levelAsNumber <= log.level) {\n        if (levelAsNumber <= log.throw || !log.logger) {\n            var error = new Error(msg);\n            error.props = props;\n            throw error;\n        }\n        else {\n            log.logger(level, msg, props);\n            if (levelAsNumber <= log.stop) {\n                debugger;\n            }\n        }\n    }\n};\nlog.level = typeof process !== 'undefined' && process.env && process.env.NODE_ENV === 'production' ? 1 : 2;\nlog.throw = 0;\nlog.stop = 0;\nif (typeof console !== 'undefined') {\n    log.logger = function _console(level, error, props) {\n        var args = [error];\n        for (var name_1 in props) {\n            args.push(\"\\n\\t\" + name_1 + \":\", props[name_1]);\n        }\n        console[level].apply(console, args);\n    };\n}\nexport function isValidJSON(value) {\n    if (value === null) {\n        return true;\n    }\n    switch (typeof value) {\n        case 'number':\n        case 'string':\n        case 'boolean':\n            return true;\n        case 'object':\n            var proto = Object.getPrototypeOf(value);\n            if (proto === Object.prototype || proto === Array.prototype) {\n                return every(value, isValidJSON);\n            }\n    }\n    return false;\n}\nexport function getBaseClass(Class) {\n    return Object.getPrototypeOf(Class.prototype).constructor;\n}\nexport function assignToClassProto(Class, definition) {\n    var names = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        names[_i - 2] = arguments[_i];\n    }\n    for (var _a = 0, names_1 = names; _a < names_1.length; _a++) {\n        var name_2 = names_1[_a];\n        var value = definition[name_2];\n        value === void 0 || (Class.prototype[name_2] = value);\n    }\n}\nexport function isEmpty(obj) {\n    if (obj) {\n        for (var key in obj) {\n            if (obj.hasOwnProperty(key)) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\nfunction someArray(arr, fun) {\n    var result;\n    for (var i = 0; i < arr.length; i++) {\n        if (result = fun(arr[i], i)) {\n            return result;\n        }\n    }\n}\nfunction someObject(obj, fun) {\n    var result;\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            if (result = fun(obj[key], key)) {\n                return result;\n            }\n        }\n    }\n}\nexport function some(obj, fun) {\n    if (Object.getPrototypeOf(obj) === ArrayProto) {\n        return someArray(obj, fun);\n    }\n    else {\n        return someObject(obj, fun);\n    }\n}\nexport function every(obj, predicate) {\n    return !some(obj, function (x) { return !predicate(x); });\n}\nexport function getPropertyDescriptor(obj, prop) {\n    var desc;\n    for (var proto = obj; !desc && proto; proto = Object.getPrototypeOf(proto)) {\n        desc = Object.getOwnPropertyDescriptor(proto, prop);\n    }\n    return desc;\n}\nexport function omit(source) {\n    var dest = {}, discard = {};\n    for (var i = 1; i < arguments.length; i++) {\n        discard[arguments[i]] = true;\n    }\n    for (var name in source) {\n        if (!discard.hasOwnProperty(name) && source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function transform(dest, source, fun) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            var value = fun(source[name], name);\n            value === void 0 || (dest[name] = value);\n        }\n    }\n    return dest;\n}\nexport function fastAssign(dest, source) {\n    for (var name in source) {\n        dest[name] = source[name];\n    }\n    return dest;\n}\nexport function fastDefaults(dest, source) {\n    for (var name in source) {\n        if (dest[name] === void 0) {\n            dest[name] = source[name];\n        }\n    }\n    return dest;\n}\nexport function assign(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && assign(dest, other);\n        }\n    }\n    return dest;\n}\nexport function defaults(dest, source) {\n    for (var name in source) {\n        if (source.hasOwnProperty(name) && !dest.hasOwnProperty(name)) {\n            dest[name] = source[name];\n        }\n    }\n    if (arguments.length > 2) {\n        for (var i = 2; i < arguments.length; i++) {\n            var other = arguments[i];\n            other && defaults(dest, other);\n        }\n    }\n    return dest;\n}\nObject.setPrototypeOf || (Object.setPrototypeOf = defaults);\nexport function keys(o) {\n    return o ? Object.keys(o) : [];\n}\nexport function once(func) {\n    var memo, first = true;\n    return function () {\n        if (first) {\n            first = false;\n            memo = func.apply(this, arguments);\n            func = null;\n        }\n        return memo;\n    };\n}\nvar ArrayProto = Array.prototype, DateProto = Date.prototype, ObjectProto = Object.prototype;\nexport function notEqual(a, b) {\n    if (a === b)\n        return false;\n    if (a && b && typeof a == 'object' && typeof b == 'object') {\n        var protoA = Object.getPrototypeOf(a);\n        if (protoA !== Object.getPrototypeOf(b))\n            return true;\n        switch (protoA) {\n            case DateProto: return +a !== +b;\n            case ArrayProto: return arraysNotEqual(a, b);\n            case ObjectProto:\n            case null:\n                return objectsNotEqual(a, b);\n        }\n    }\n    return true;\n}\nfunction objectsNotEqual(a, b) {\n    var keysA = Object.keys(a);\n    if (keysA.length !== Object.keys(b).length)\n        return true;\n    for (var i = 0; i < keysA.length; i++) {\n        var key = keysA[i];\n        if (!b.hasOwnProperty(key) || notEqual(a[key], b[key])) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction arraysNotEqual(a, b) {\n    if (a.length !== b.length)\n        return true;\n    for (var i = 0; i < a.length; i++) {\n        if (notEqual(a[i], b[i]))\n            return true;\n    }\n    return false;\n}\n//# sourceMappingURL=tools.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\n            t[p[i]] = s[p[i]];\n    return t;\n};\nimport { assign, getBaseClass, defaults, transform } from './tools';\nvar Mixable = (function () {\n    function Mixable() {\n    }\n    Mixable.define = function (protoProps, staticProps) {\n        if (protoProps === void 0) { protoProps = {}; }\n        var BaseClass = getBaseClass(this);\n        staticProps && assign(this, staticProps);\n        var mixins = protoProps.mixins, defineMixin = __rest(protoProps, [\"mixins\"]);\n        mixins && this.mixins.merge(mixins);\n        this.mixins.mergeObject(this.prototype, defineMixin, true);\n        this.mixins.mergeObject(this.prototype, this.mixins.getStaticDefinitions(BaseClass), true);\n        this.onDefine && this.onDefine(this.mixins.definitions, BaseClass);\n        this.mixins.mergeInheritedMembers(BaseClass);\n        return this;\n    };\n    Mixable.extend = function (spec, statics) {\n        var TheSubclass;\n        if (spec && spec.hasOwnProperty('constructor')) {\n            TheSubclass = spec.constructor;\n            __extends(TheSubclass, this);\n        }\n        else {\n            TheSubclass = (function (_super) {\n                __extends(Subclass, _super);\n                function Subclass() {\n                    return _super !== null && _super.apply(this, arguments) || this;\n                }\n                return Subclass;\n            }(this));\n        }\n        predefine(TheSubclass);\n        spec && TheSubclass.define(spec, statics);\n        return TheSubclass;\n    };\n    return Mixable;\n}());\nexport { Mixable };\nexport function predefine(Constructor) {\n    var BaseClass = getBaseClass(Constructor);\n    Constructor.__super__ = BaseClass.prototype;\n    Constructor.define || MixinsState.get(Mixable).populate(Constructor);\n    MixinsState.get(Constructor);\n    Constructor.onExtend && Constructor.onExtend(BaseClass);\n}\nexport function define(ClassOrDefinition) {\n    if (typeof ClassOrDefinition === 'function') {\n        predefine(ClassOrDefinition);\n        ClassOrDefinition.define();\n    }\n    else {\n        return function (Ctor) {\n            predefine(Ctor);\n            Ctor.define(ClassOrDefinition);\n        };\n    }\n}\nexport function definitions(rules) {\n    return function (Class) {\n        var mixins = MixinsState.get(Class);\n        mixins.definitionRules = defaults(rules, mixins.definitionRules);\n    };\n}\nexport function definitionDecorator(definitionKey, value) {\n    return function (proto, name) {\n        MixinsState\n            .get(proto.constructor)\n            .mergeObject(proto, (_a = {},\n            _a[definitionKey] = (_b = {},\n                _b[name] = value,\n                _b),\n            _a));\n        var _a, _b;\n    };\n}\nvar MixinsState = (function () {\n    function MixinsState(Class) {\n        this.Class = Class;\n        this.definitions = {};\n        var mixins = getBaseClass(Class).mixins;\n        this.mergeRules = (mixins && mixins.mergeRules) || {};\n        this.definitionRules = (mixins && mixins.definitionRules) || {};\n        this.appliedMixins = (mixins && mixins.appliedMixins) || [];\n    }\n    MixinsState.get = function (Class) {\n        var mixins = Class.mixins;\n        return mixins && Class === mixins.Class ? mixins :\n            Class.mixins = new MixinsState(Class);\n    };\n    MixinsState.prototype.getStaticDefinitions = function (BaseClass) {\n        var definitions = {}, Class = this.Class;\n        return transform(definitions, this.definitionRules, function (rule, name) {\n            if (BaseClass[name] !== Class[name]) {\n                return Class[name];\n            }\n        });\n    };\n    MixinsState.prototype.merge = function (mixins) {\n        var proto = this.Class.prototype, mergeRules = this.mergeRules;\n        var appliedMixins = this.appliedMixins = this.appliedMixins.slice();\n        for (var _i = 0, mixins_1 = mixins; _i < mixins_1.length; _i++) {\n            var mixin = mixins_1[_i];\n            if (Array.isArray(mixin)) {\n                this.merge(mixin);\n            }\n            else if (appliedMixins.indexOf(mixin) < 0) {\n                appliedMixins.push(mixin);\n                if (typeof mixin === 'function') {\n                    if (getBaseClass(mixin) !== Object) {\n                        console.log('Mixin error');\n                    }\n                    this.mergeObject(this.Class, mixin);\n                    var sourceMixins = mixin.mixins;\n                    if (sourceMixins) {\n                        this.mergeRules = defaults({}, this.mergeRules, sourceMixins.mergeRules);\n                        this.definitionRules = defaults({}, this.definitionRules, sourceMixins.definitionRules);\n                        this.appliedMixins = this.appliedMixins.concat(sourceMixins.appliedMixins);\n                    }\n                    this.mergeObject(proto, mixin.prototype);\n                }\n                else {\n                    this.mergeObject(proto, mixin);\n                }\n            }\n        }\n    };\n    MixinsState.prototype.populate = function () {\n        var ctors = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            ctors[_i] = arguments[_i];\n        }\n        for (var _a = 0, ctors_1 = ctors; _a < ctors_1.length; _a++) {\n            var Ctor = ctors_1[_a];\n            MixinsState.get(Ctor).merge([this.Class]);\n        }\n    };\n    MixinsState.prototype.mergeObject = function (dest, source, unshift) {\n        var _this = this;\n        forEachOwnProp(source, function (name) {\n            var sourceProp = Object.getOwnPropertyDescriptor(source, name);\n            var rule;\n            if (rule = _this.definitionRules[name]) {\n                assignProperty(_this.definitions, name, sourceProp, rule, unshift);\n            }\n            if (!rule || rule === mixinRules.protoValue) {\n                assignProperty(dest, name, sourceProp, _this.mergeRules[name], unshift);\n            }\n        });\n    };\n    MixinsState.prototype.mergeInheritedMembers = function (BaseClass) {\n        var _a = this, mergeRules = _a.mergeRules, Class = _a.Class;\n        if (mergeRules) {\n            var proto = Class.prototype, baseProto = BaseClass.prototype;\n            for (var name_1 in mergeRules) {\n                var rule = mergeRules[name_1];\n                if (proto.hasOwnProperty(name_1) && name_1 in baseProto) {\n                    proto[name_1] = resolveRule(proto[name_1], baseProto[name_1], rule);\n                }\n            }\n        }\n    };\n    return MixinsState;\n}());\nexport { MixinsState };\nvar dontMix = {\n    function: {\n        length: true,\n        prototype: true,\n        caller: true,\n        arguments: true,\n        name: true,\n        __super__: true\n    },\n    object: {\n        constructor: true\n    }\n};\nfunction forEachOwnProp(object, fun) {\n    var ignore = dontMix[typeof object];\n    for (var _i = 0, _a = Object.getOwnPropertyNames(object); _i < _a.length; _i++) {\n        var name_2 = _a[_i];\n        name_2 in ignore || fun(name_2);\n    }\n}\nexport var mixins = function () {\n    var list = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        list[_i] = arguments[_i];\n    }\n    return (function (Class) { return MixinsState.get(Class).merge(list); });\n};\nexport var mixinRules = (function (rules) { return (function (Class) {\n    var mixins = MixinsState.get(Class);\n    mixins.mergeRules = defaults(rules, mixins.mergeRules);\n}); });\nmixinRules.value = function (a, b) { return a; };\nmixinRules.protoValue = function (a, b) { return a; };\nmixinRules.merge = function (a, b) { return defaults({}, a, b); };\nmixinRules.pipe = function (a, b) { return (function (x) {\n    return a.call(this, b.call(this, x));\n}); };\nmixinRules.defaults = function (a, b) { return (function () {\n    return defaults(a.apply(this, arguments), b.apply(this, arguments));\n}); };\nmixinRules.classFirst = function (a, b) { return (function () {\n    a.apply(this, arguments);\n    b.apply(this, arguments);\n}); };\nmixinRules.classLast = function (a, b) { return (function () {\n    b.apply(this, arguments);\n    a.apply(this, arguments);\n}); };\nmixinRules.every = function (a, b) { return (function () {\n    return a.apply(this, arguments) && b.apply(this, arguments);\n}); };\nmixinRules.some = function (a, b) { return (function () {\n    return a.apply(this, arguments) || b.apply(this, arguments);\n}); };\nfunction assignProperty(dest, name, sourceProp, rule, unshift) {\n    if (dest.hasOwnProperty(name)) {\n        dest[name] = unshift ?\n            resolveRule(sourceProp.value, dest[name], rule) :\n            resolveRule(dest[name], sourceProp.value, rule);\n    }\n    else {\n        Object.defineProperty(dest, name, sourceProp);\n    }\n}\nfunction resolveRule(dest, source, rule) {\n    if (dest === void 0)\n        return source;\n    if (!rule || source === void 0)\n        return dest;\n    return rule(dest, source);\n}\n//# sourceMappingURL=mixins.js.map","import { once as _once } from './tools';\nvar EventMap = (function () {\n    function EventMap(map) {\n        this.handlers = [];\n        if (map) {\n            if (map instanceof EventMap) {\n                this.handlers = map.handlers.slice();\n            }\n            else {\n                map && this.addEventsMap(map);\n            }\n        }\n    }\n    EventMap.prototype.merge = function (map) {\n        this.handlers = this.handlers.concat(map.handlers);\n    };\n    EventMap.prototype.addEventsMap = function (map) {\n        for (var names in map) {\n            this.addEvent(names, map[names]);\n        }\n    };\n    EventMap.prototype.bubbleEvents = function (names) {\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_1 = _a[_i];\n            this.addEvent(name_1, getBubblingHandler(name_1));\n        }\n    };\n    EventMap.prototype.addEvent = function (names, callback) {\n        var handlers = this.handlers;\n        for (var _i = 0, _a = names.split(eventSplitter); _i < _a.length; _i++) {\n            var name_2 = _a[_i];\n            handlers.push(new EventDescriptor(name_2, callback));\n        }\n    };\n    EventMap.prototype.subscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_1 = _a[_i];\n            on(source, event_1.name, event_1.callback, target);\n        }\n    };\n    EventMap.prototype.unsubscribe = function (target, source) {\n        for (var _i = 0, _a = this.handlers; _i < _a.length; _i++) {\n            var event_2 = _a[_i];\n            off(source, event_2.name, event_2.callback, target);\n        }\n    };\n    return EventMap;\n}());\nexport { EventMap };\nvar EventDescriptor = (function () {\n    function EventDescriptor(name, callback) {\n        this.name = name;\n        if (callback === true) {\n            this.callback = getBubblingHandler(name);\n        }\n        else if (typeof callback === 'string') {\n            this.callback =\n                function localCallback() {\n                    var handler = this[callback];\n                    handler && handler.apply(this, arguments);\n                };\n        }\n        else {\n            this.callback = callback;\n        }\n    }\n    return EventDescriptor;\n}());\nexport { EventDescriptor };\nvar _bubblingHandlers = {};\nfunction getBubblingHandler(event) {\n    return _bubblingHandlers[event] || (_bubblingHandlers[event] = function (a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, event, a, b, c, d, e);\n        if (c !== void 0)\n            trigger3(this, event, a, b, c);\n        else\n            trigger2(this, event, a, b);\n    });\n}\nvar EventHandler = (function () {\n    function EventHandler(callback, context, next) {\n        if (next === void 0) { next = null; }\n        this.callback = callback;\n        this.context = context;\n        this.next = next;\n    }\n    return EventHandler;\n}());\nexport { EventHandler };\nfunction listOff(_events, name, callback, context) {\n    var head = _events[name];\n    var filteredHead, prev;\n    for (var ev = head; ev; ev = ev.next) {\n        if ((callback && callback !== ev.callback && callback !== ev.callback._callback) ||\n            (context && context !== ev.context)) {\n            prev = ev;\n            filteredHead || (filteredHead = ev);\n        }\n        else {\n            if (prev)\n                prev.next = ev.next;\n        }\n    }\n    if (head !== filteredHead)\n        _events[name] = filteredHead;\n}\nfunction listSend2(head, a, b) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b);\n}\nfunction listSend3(head, a, b, c) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c);\n}\nfunction listSend4(head, a, b, c, d) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d);\n}\nfunction listSend5(head, a, b, c, d, e) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e);\n}\nfunction listSend6(head, a, b, c, d, e, f) {\n    for (var ev = head; ev; ev = ev.next)\n        ev.callback.call(ev.context, a, b, c, d, e, f);\n}\nexport function on(source, name, callback, context) {\n    if (callback) {\n        var _events = source._events || (source._events = Object.create(null));\n        _events[name] = new EventHandler(callback, context, _events[name]);\n    }\n}\nexport function once(source, name, callback, context) {\n    if (callback) {\n        var once_1 = _once(function () {\n            off(source, name, once_1);\n            callback.apply(this, arguments);\n        });\n        once_1._callback = callback;\n        on(source, name, once_1, context);\n    }\n}\nexport function off(source, name, callback, context) {\n    var _events = source._events;\n    if (_events) {\n        if (callback || context) {\n            if (name) {\n                listOff(_events, name, callback, context);\n            }\n            else {\n                for (var name_3 in _events) {\n                    listOff(_events, name_3, callback, context);\n                }\n            }\n        }\n        else if (name) {\n            _events[name] = void 0;\n        }\n        else {\n            source._events = void 0;\n        }\n    }\n}\nvar eventSplitter = /\\s+/;\nexport function strings(api, source, events, callback, context) {\n    if (eventSplitter.test(events)) {\n        var names = events.split(eventSplitter);\n        for (var _i = 0, names_1 = names; _i < names_1.length; _i++) {\n            var name_4 = names_1[_i];\n            api(source, name_4, callback, context);\n        }\n    }\n    else\n        api(source, events, callback, context);\n}\nexport function trigger2(self, name, a, b) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend2(queue, a, b);\n        listSend3(all, name, a, b);\n    }\n}\n;\nexport function trigger3(self, name, a, b, c) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend3(queue, a, b, c);\n        listSend4(all, name, a, b, c);\n    }\n}\n;\nexport function trigger5(self, name, a, b, c, d, e) {\n    var _events = self._events;\n    if (_events) {\n        var queue = _events[name], all = _events.all;\n        listSend5(queue, a, b, c, d, e);\n        listSend6(all, name, a, b, c, d, e);\n    }\n}\n;\n//# sourceMappingURL=eventsource.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { define, mixinRules, definitions } from './mixins';\nimport { omit, transform } from './tools';\nimport { EventMap } from './eventsource';\nimport * as _eventsApi from './eventsource';\nvar EventHandler = _eventsApi.EventHandler, strings = _eventsApi.strings, on = _eventsApi.on, off = _eventsApi.off, once = _eventsApi.once, trigger5 = _eventsApi.trigger5, trigger2 = _eventsApi.trigger2, trigger3 = _eventsApi.trigger3;\nvar eventSplitter = /\\s+/;\nvar _idCount = 0;\nfunction uniqueId() {\n    return 'l' + _idCount++;\n}\nexport { EventMap };\nvar Messenger = (function () {\n    function Messenger() {\n        this._events = void 0;\n        this._listeningTo = void 0;\n        this.cid = uniqueId();\n        this.initialize.apply(this, arguments);\n    }\n    Messenger.onDefine = function (_a, BaseClass) {\n        var localEvents = _a.localEvents, _localEvents = _a._localEvents, properties = _a.properties;\n        if (localEvents || _localEvents) {\n            var eventsMap = new EventMap(this.prototype._localEvents);\n            localEvents && eventsMap.addEventsMap(localEvents);\n            _localEvents && eventsMap.merge(_localEvents);\n            this.prototype._localEvents = eventsMap;\n        }\n        if (properties) {\n            Object.defineProperties(this.prototype, transform({}, properties, toPropertyDescriptor));\n        }\n    };\n    Messenger.prototype.initialize = function () { };\n    Messenger.prototype.on = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(on, this, events, callback, context);\n        else\n            for (var name_1 in events)\n                strings(on, this, name_1, events[name_1], context || callback);\n        return this;\n    };\n    Messenger.prototype.once = function (events, callback, context) {\n        if (typeof events === 'string')\n            strings(once, this, events, callback, context);\n        else\n            for (var name_2 in events)\n                strings(once, this, name_2, events[name_2], context || callback);\n        return this;\n    };\n    Messenger.prototype.off = function (events, callback, context) {\n        if (!events)\n            off(this, void 0, callback, context);\n        else if (typeof events === 'string')\n            strings(off, this, events, callback, context);\n        else\n            for (var name_3 in events)\n                strings(off, this, name_3, events[name_3], context || callback);\n        return this;\n    };\n    Messenger.prototype.trigger = function (name, a, b, c, d, e) {\n        if (d !== void 0 || e !== void 0)\n            trigger5(this, name, a, b, c, d, e);\n        else if (c !== void 0)\n            trigger3(this, name, a, b, c);\n        else\n            trigger2(this, name, a, b);\n        return this;\n    };\n    Messenger.prototype.listenTo = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.on(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.listenToOnce = function (source, a, b) {\n        if (source) {\n            addReference(this, source);\n            source.once(a, !b && typeof a === 'object' ? this : b, this);\n        }\n        return this;\n    };\n    Messenger.prototype.stopListening = function (a_source, a, b) {\n        var _listeningTo = this._listeningTo;\n        if (_listeningTo) {\n            var removeAll = !(a || b), second = !b && typeof a === 'object' ? this : b;\n            if (a_source) {\n                var source = _listeningTo[a_source.cid];\n                if (source) {\n                    if (removeAll)\n                        delete _listeningTo[a_source.cid];\n                    source.off(a, second, this);\n                }\n            }\n            else if (a_source == null) {\n                for (var cid in _listeningTo)\n                    _listeningTo[cid].off(a, second, this);\n                if (removeAll)\n                    (this._listeningTo = void 0);\n            }\n        }\n        return this;\n    };\n    Messenger.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        this.stopListening();\n        this.off();\n        this._disposed = true;\n    };\n    Messenger = __decorate([\n        define,\n        definitions({\n            properties: mixinRules.merge,\n            localEvents: mixinRules.merge\n        })\n    ], Messenger);\n    return Messenger;\n}());\nexport { Messenger };\nexport var Events = omit(Messenger.prototype, 'constructor', 'initialize');\nfunction toPropertyDescriptor(x) {\n    if (x) {\n        return typeof x === 'function' ? { get: x } : x;\n    }\n}\nfunction addReference(listener, source) {\n    var listeningTo = listener._listeningTo || (listener._listeningTo = Object.create(null)), cid = source.cid || (source.cid = uniqueId());\n    listeningTo[cid] = source;\n}\n//# sourceMappingURL=events.js.map","var referenceMask = /\\^|([^.]+)/g;\nvar CompiledReference = (function () {\n    function CompiledReference(reference, splitTail) {\n        if (splitTail === void 0) { splitTail = false; }\n        var path = reference\n            .match(referenceMask)\n            .map(function (key) {\n            if (key === '^')\n                return 'getOwner()';\n            if (key[0] === '~')\n                return \"getStore().get(\\\"\" + key.substr(1) + \"\\\")\";\n            return key;\n        });\n        this.tail = splitTail && path.pop();\n        this.local = !path.length;\n        path.unshift('self');\n        this.resolve = new Function('self', \"return \" + path.join('.') + \";\");\n    }\n    return CompiledReference;\n}());\nexport { CompiledReference };\nexport function resolveReference(root, reference, action) {\n    var path = reference.match(referenceMask), skip = path.length - 1;\n    var self = root;\n    for (var i = 0; i < skip; i++) {\n        var key = path[i];\n        switch (key) {\n            case '~':\n                self = self.getStore();\n                break;\n            case '^':\n                self = self.getOwner();\n                break;\n            default: self = self.get(key);\n        }\n        if (!self)\n            return;\n    }\n    return action(self, path[skip]);\n}\n//# sourceMappingURL=traversable.js.map","import { transactionApi } from \"../../transactions\";\nvar _begin = transactionApi.begin, _markAsDirty = transactionApi.markAsDirty, commit = transactionApi.commit;\nimport { eventsApi } from '../../object-plus';\nvar trigger3 = eventsApi.trigger3;\nexport function setAttribute(record, name, value) {\n    var isRoot = begin(record), options = {};\n    if (record._attributes[name].doUpdate(value, record, options)) {\n        markAsDirty(record, options);\n        trigger3(record, 'change:' + name, record, record.attributes[name], options);\n    }\n    isRoot && commit(record);\n}\nfunction begin(record) {\n    if (_begin(record)) {\n        record._previousAttributes = new record.AttributesCopy(record.attributes);\n        record._changedAttributes = null;\n        return true;\n    }\n    return false;\n}\nfunction markAsDirty(record, options) {\n    if (record._changedAttributes) {\n        record._changedAttributes = null;\n    }\n    return _markAsDirty(record, options);\n}\nexport var UpdateRecordMixin = {\n    transaction: function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        fun.call(this, this);\n        isRoot && commit(this);\n    },\n    _onChildrenChange: function (child, options) {\n        var _ownerKey = child._ownerKey, attribute = this._attributes[_ownerKey];\n        if (!attribute || attribute.propagateChanges)\n            this.forceAttributeChange(_ownerKey, options);\n    },\n    forceAttributeChange: function (key, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger3(this, 'change:' + key, this, this.attributes[key], options);\n        }\n        isRoot && commit(this);\n    },\n    _createTransaction: function (a_values, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), changes = [], nested = [], _attributes = this._attributes, values = options.parse ? this.parse(a_values, options) : a_values;\n        var unknown;\n        if (shouldBeAnObject(this, values)) {\n            for (var name_1 in values) {\n                var spec = _attributes[name_1];\n                if (spec) {\n                    if (spec.doUpdate(values[name_1], this, options, nested)) {\n                        changes.push(name_1);\n                    }\n                }\n                else {\n                    unknown || (unknown = []);\n                    unknown.push(\"'\" + name_1 + \"'\");\n                }\n            }\n            if (unknown) {\n            }\n        }\n        if (changes.length && markAsDirty(this, options)) {\n            return new RecordTransaction(this, isRoot, nested, changes);\n        }\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var pendingTransaction = nested_1[_i];\n            pendingTransaction.commit(this);\n        }\n        isRoot && commit(this);\n    }\n};\nexport function constructorsMixin(attrDefs) {\n    var attrs = Object.keys(attrDefs);\n    var AttributesCopy = new Function('values', \"\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = values.\" + attr + \";\\n        \"; }).join('') + \"\\n    \");\n    AttributesCopy.prototype = Object.prototype;\n    var Attributes = new Function('record', 'values', 'options', \"\\n        var _attrs = record._attributes;\\n\\n        \" + attrs.map(function (attr) { return \"\\n            this.\" + attr + \" = _attrs.\" + attr + \".doInit( values.\" + attr + \", record, options );\\n        \"; }).join('') + \"\\n    \");\n    Attributes.prototype = Object.prototype;\n    return { Attributes: Attributes, AttributesCopy: AttributesCopy };\n}\nexport function shouldBeAnObject(record, values) {\n    if (values && values.constructor === Object)\n        return true;\n    record._log('warn', 'update with non-object is ignored!', { values: values });\n    return false;\n}\nvar RecordTransaction = (function () {\n    function RecordTransaction(object, isRoot, nested, changes) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.nested = nested;\n        this.changes = changes;\n    }\n    RecordTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, changes = _a.changes;\n        for (var _i = 0, nested_2 = nested; _i < nested_2.length; _i++) {\n            var transaction = nested_2[_i];\n            transaction.commit(object);\n        }\n        var attributes = object.attributes, _isDirty = object._isDirty;\n        for (var _b = 0, changes_1 = changes; _b < changes_1.length; _b++) {\n            var key = changes_1[_b];\n            trigger3(object, 'change:' + key, object, attributes[key], _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return RecordTransaction;\n}());\nexport { RecordTransaction };\n//# sourceMappingURL=updates.js.map","import { setAttribute } from './updates';\nimport { tools } from '../../object-plus';\nvar notEqual = tools.notEqual, assign = tools.assign;\nvar emptyOptions = {};\nvar AnyType = (function () {\n    function AnyType(name, a_options) {\n        this.name = name;\n        this.getHook = null;\n        this.options = a_options;\n        var options = assign({ getHooks: [], transforms: [], changeHandlers: [] }, a_options);\n        options.getHooks = options.getHooks.slice();\n        options.transforms = options.transforms.slice();\n        options.changeHandlers = options.changeHandlers.slice();\n        var value = options.value, type = options.type, parse = options.parse, toJSON = options.toJSON, changeEvents = options.changeEvents, validate = options.validate, getHooks = options.getHooks, transforms = options.transforms, changeHandlers = options.changeHandlers;\n        this.value = value;\n        this.type = type;\n        if (!options.hasCustomDefault && type) {\n            this.defaultValue = this.create;\n        }\n        else if (tools.isValidJSON(value)) {\n            this.defaultValue = new Function(\"return \" + JSON.stringify(value) + \";\");\n        }\n        else {\n            this.defaultValue = this.defaultValue;\n        }\n        this.propagateChanges = changeEvents !== false;\n        this.toJSON = toJSON === void 0 ? this.toJSON : toJSON;\n        this.validate = validate || this.validate;\n        if (options.isRequired) {\n            this.validate = wrapIsRequired(this.validate);\n        }\n        transforms.unshift(this.convert);\n        this.parse = parse || this.parse;\n        if (this.get)\n            getHooks.unshift(this.get);\n        this.initialize.call(this, options);\n        if (getHooks.length) {\n            var getHook_1 = this.getHook = getHooks.reduce(chainGetHooks);\n            var validate_1 = this.validate;\n            this.validate = function (record, value, key) {\n                return validate_1.call(this, record, getHook_1.call(record, value, key), key);\n            };\n        }\n        this.transform = transforms.length ? transforms.reduce(chainTransforms) : this.transform;\n        this.handleChange = changeHandlers.length ? changeHandlers.reduce(chainChangeHandlers) : this.handleChange;\n    }\n    AnyType.create = function (options, name) {\n        var type = options.type, AttributeCtor = options._attribute || (type ? type._attribute : AnyType);\n        return new AttributeCtor(name, options);\n    };\n    AnyType.prototype.canBeUpdated = function (prev, next, options) { };\n    AnyType.prototype.transform = function (next, prev, model, options) { return next; };\n    AnyType.prototype.convert = function (next, prev, model, options) { return next; };\n    AnyType.prototype.isChanged = function (a, b) {\n        return notEqual(a, b);\n    };\n    AnyType.prototype.handleChange = function (next, prev, model, options) { };\n    AnyType.prototype.create = function () { return void 0; };\n    AnyType.prototype.clone = function (value, record) {\n        return value;\n    };\n    AnyType.prototype.dispose = function (record, value) {\n        this.handleChange(void 0, value, record, emptyOptions);\n    };\n    AnyType.prototype.validate = function (record, value, key) { };\n    AnyType.prototype.toJSON = function (value, key) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    AnyType.prototype.createPropertyDescriptor = function () {\n        var _a = this, name = _a.name, getHook = _a.getHook;\n        if (name !== 'id') {\n            return {\n                set: function (value) {\n                    setAttribute(this, name, value);\n                },\n                get: (getHook ?\n                    function () {\n                        return getHook.call(this, this.attributes[name], name);\n                    } :\n                    function () { return this.attributes[name]; })\n            };\n        }\n    };\n    AnyType.prototype.initialize = function (name, options) { };\n    AnyType.prototype.doInit = function (value, record, options) {\n        var v = value === void 0 ? this.defaultValue() : value, x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AnyType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        var next = this.transform(value, prev, record, options);\n        attributes[name] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AnyType.prototype._log = function (level, text, value, record) {\n        tools.log(level, \"[Attribute Update Error] \" + record.getClassName() + \".\" + this.name + \": \" + text, {\n            'Record': record,\n            'Attribute definition': this,\n            'Prev. value': record.attributes[this.name],\n            'New value': value\n        });\n    };\n    AnyType.prototype.defaultValue = function () {\n        return this.value;\n    };\n    return AnyType;\n}());\nexport { AnyType };\nfunction chainGetHooks(prevHook, nextHook) {\n    return function (value, name) {\n        return nextHook.call(this, prevHook.call(this, value, name), name);\n    };\n}\nfunction chainTransforms(prevTransform, nextTransform) {\n    return function (next, prev, record, options) {\n        return nextTransform.call(this, prevTransform.call(this, next, prev, record, options), prev, record, options);\n    };\n}\nfunction chainChangeHandlers(prevHandler, nextHandler) {\n    return function (next, prev, record, options) {\n        prevHandler.call(this, next, prev, record, options);\n        nextHandler.call(this, next, prev, record, options);\n    };\n}\nfunction wrapIsRequired(validate) {\n    return function (record, value, key) {\n        return value ? validate.call(this, record, value, key) : 'Required';\n    };\n}\n//# sourceMappingURL=any.js.map","import { Transactional } from '../../transactions';\nimport { EventMap, definitionDecorator, tools } from '../../object-plus';\nvar assign = tools.assign;\nvar ChainableAttributeSpec = (function () {\n    function ChainableAttributeSpec(options) {\n        this.options = { getHooks: [], transforms: [], changeHandlers: [] };\n        if (options)\n            assign(this.options, options);\n    }\n    ChainableAttributeSpec.prototype.check = function (check, error) {\n        function validate(model, value, name) {\n            if (!check.call(model, value, name)) {\n                var msg = error || check.error || name + ' is not valid';\n                return typeof msg === 'function' ? msg.call(model, name) : msg;\n            }\n        }\n        var prev = this.options.validate;\n        return this.metadata({\n            validate: prev ? (function (model, value, name) {\n                return prev(model, value, name) || validate(model, value, name);\n            }) : validate\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"asProp\", {\n        get: function () {\n            return definitionDecorator('attributes', this);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"isRequired\", {\n        get: function () {\n            return this.metadata({ isRequired: true });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.watcher = function (ref) {\n        return this.metadata({ _onChange: ref });\n    };\n    ChainableAttributeSpec.prototype.parse = function (fun) {\n        return this.metadata({ parse: fun });\n    };\n    ChainableAttributeSpec.prototype.toJSON = function (fun) {\n        return this.metadata({\n            toJSON: typeof fun === 'function' ? fun : (fun ? function (x) { return x && x.toJSON(); } : emptyFunction)\n        });\n    };\n    ChainableAttributeSpec.prototype.get = function (fun) {\n        return this.metadata({\n            getHooks: this.options.getHooks.concat(fun)\n        });\n    };\n    ChainableAttributeSpec.prototype.set = function (fun) {\n        function handleSetHook(next, prev, record, options) {\n            if (this.isChanged(next, prev)) {\n                var changed = fun.call(record, next, this.name);\n                return changed === void 0 ? prev : this.convert(changed, prev, record, options);\n            }\n            return prev;\n        }\n        return this.metadata({\n            transforms: this.options.transforms.concat(handleSetHook)\n        });\n    };\n    ChainableAttributeSpec.prototype.changeEvents = function (events) {\n        return this.metadata({ changeEvents: events });\n    };\n    ChainableAttributeSpec.prototype.events = function (map) {\n        var eventMap = new EventMap(map);\n        function handleEventsSubscribtion(next, prev, record) {\n            prev && prev.trigger && eventMap.unsubscribe(record, prev);\n            next && next.trigger && eventMap.subscribe(record, next);\n        }\n        return this.metadata({\n            changeHandlers: this.options.changeHandlers.concat(handleEventsSubscribtion)\n        });\n    };\n    Object.defineProperty(ChainableAttributeSpec.prototype, \"has\", {\n        get: function () {\n            return this;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ChainableAttributeSpec.prototype.metadata = function (options) {\n        var cloned = new ChainableAttributeSpec(this.options);\n        assign(cloned.options, options);\n        return cloned;\n    };\n    ChainableAttributeSpec.prototype.value = function (x) {\n        return this.metadata({ value: x, hasCustomDefault: true });\n    };\n    return ChainableAttributeSpec;\n}());\nexport { ChainableAttributeSpec };\nfunction emptyFunction() { }\nFunction.prototype.value = function (x) {\n    return new ChainableAttributeSpec({ type: this, value: x, hasCustomDefault: true });\n};\nObject.defineProperty(Function.prototype, 'isRequired', {\n    get: function () { return this._isRequired || this.has.isRequired; },\n    set: function (x) { this._isRequired = x; }\n});\nObject.defineProperty(Function.prototype, 'asProp', {\n    get: function () { return this.has.asProp; },\n});\nObject.defineProperty(Function.prototype, 'has', {\n    get: function () {\n        return this._has || new ChainableAttributeSpec({\n            type: this,\n            value: this._attribute.defaultValue,\n            hasCustomDefault: this._attribute.defaultValue !== void 0\n        });\n    },\n    set: function (value) { this._has = value; }\n});\nexport function toAttributeOptions(spec) {\n    var attrSpec;\n    if (typeof spec === 'function') {\n        attrSpec = spec.has;\n    }\n    else if (spec && spec instanceof ChainableAttributeSpec) {\n        attrSpec = spec;\n    }\n    else {\n        var type = inferType(spec);\n        if (type && type.prototype instanceof Transactional) {\n            attrSpec = type.shared.value(spec);\n        }\n        else {\n            attrSpec = new ChainableAttributeSpec({ type: type, value: spec, hasCustomDefault: true });\n        }\n    }\n    return attrSpec.options;\n}\nfunction inferType(value) {\n    switch (typeof value) {\n        case 'number':\n            return Number;\n        case 'string':\n            return String;\n        case 'boolean':\n            return Boolean;\n        case 'undefined':\n            return void 0;\n        case 'object':\n            return value ? value.constructor : void 0;\n    }\n}\n//# sourceMappingURL=attrDef.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AnyType } from './any';\nimport { ChainableAttributeSpec } from './attrDef';\nvar DateProto = Date.prototype;\nvar DateType = (function (_super) {\n    __extends(DateType, _super);\n    function DateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    DateType.prototype.create = function () {\n        return new Date();\n    };\n    DateType.prototype.convert = function (next, a, record) {\n        if (next == null || next instanceof Date)\n            return next;\n        var date = new Date(next), timestamp = date.getTime();\n        if (timestamp !== timestamp) {\n            this._log('warn', 'assigned with Invalid Date', next, record);\n        }\n        return date;\n    };\n    DateType.prototype.validate = function (model, value, name) {\n        if (value != null) {\n            var timestamp = value.getTime();\n            if (timestamp !== timestamp)\n                return name + ' is Invalid Date';\n        }\n    };\n    DateType.prototype.toJSON = function (value) { return value && value.toISOString(); };\n    DateType.prototype.isChanged = function (a, b) { return (a && a.getTime()) !== (b && b.getTime()); };\n    DateType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.defaultValue() : value, void 0, record, options);\n    };\n    DateType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return this.isChanged(prev, attributes[name] = this.transform(value, prev, record, options));\n    };\n    DateType.prototype.clone = function (value) { return value && new Date(value.getTime()); };\n    DateType.prototype.dispose = function () { };\n    return DateType;\n}(AnyType));\nexport { DateType };\nDate._attribute = DateType;\nvar msDatePattern = /\\/Date\\(([0-9]+)\\)\\//;\nvar MSDateType = (function (_super) {\n    __extends(MSDateType, _super);\n    function MSDateType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    MSDateType.prototype.convert = function (next) {\n        if (typeof next === 'string') {\n            var msDate = msDatePattern.exec(next);\n            if (msDate) {\n                return new Date(Number(msDate[1]));\n            }\n        }\n        return DateType.prototype.convert.apply(this, arguments);\n    };\n    MSDateType.prototype.toJSON = function (value) { return value && \"/Date(\" + value.getTime() + \")/\"; };\n    return MSDateType;\n}(DateType));\nexport { MSDateType };\nvar TimestampType = (function (_super) {\n    __extends(TimestampType, _super);\n    function TimestampType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    TimestampType.prototype.toJSON = function (value) { return value && value.getTime(); };\n    return TimestampType;\n}(DateType));\nexport { TimestampType };\nObject.defineProperties(Date, {\n    microsoft: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: MSDateType\n            });\n        }\n    },\n    timestamp: {\n        get: function () {\n            return new ChainableAttributeSpec({\n                type: Date,\n                _attribute: TimestampType\n            });\n        }\n    }\n});\nfunction supportsDate(date) {\n    return !isNaN((new Date(date)).getTime());\n}\nif (!supportsDate('2011-11-29T15:52:30.5') ||\n    !supportsDate('2011-11-29T15:52:30.52') ||\n    !supportsDate('2011-11-29T15:52:18.867') ||\n    !supportsDate('2011-11-29T15:52:18.867Z') ||\n    !supportsDate('2011-11-29T15:52:18.867-03:30')) {\n    DateType.prototype.convert = function (value) {\n        return value == null || value instanceof Date ? value : new Date(safeParseDate(value));\n    };\n}\nvar numericKeys = [1, 4, 5, 6, 7, 10, 11], isoDatePattern = /^(\\d{4}|[+\\-]\\d{6})(?:-(\\d{2})(?:-(\\d{2}))?)?(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(?:(Z)|([+\\-])(\\d{2})(?::(\\d{2}))?)?)?$/;\nfunction safeParseDate(date) {\n    var timestamp, struct, minutesOffset = 0;\n    if ((struct = isoDatePattern.exec(date))) {\n        for (var i = 0, k; (k = numericKeys[i]); ++i) {\n            struct[k] = +struct[k] || 0;\n        }\n        struct[2] = (+struct[2] || 1) - 1;\n        struct[3] = +struct[3] || 1;\n        if (struct[8] !== 'Z' && struct[9] !== undefined) {\n            minutesOffset = struct[10] * 60 + struct[11];\n            if (struct[9] === '+') {\n                minutesOffset = 0 - minutesOffset;\n            }\n        }\n        timestamp =\n            Date.UTC(struct[1], struct[2], struct[3], struct[4], struct[5] + minutesOffset, struct[6], struct[7]);\n    }\n    else {\n        timestamp = Date.parse(date);\n    }\n    return timestamp;\n}\n//# sourceMappingURL=date.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AnyType } from './any';\nimport { tools } from '../../object-plus';\nvar ImmutableClassType = (function (_super) {\n    __extends(ImmutableClassType, _super);\n    function ImmutableClassType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ImmutableClassType.prototype.create = function () {\n        return new this.type();\n    };\n    ImmutableClassType.prototype.convert = function (next) {\n        return next == null || next instanceof this.type ? next : new this.type(next);\n    };\n    ImmutableClassType.prototype.toJSON = function (value) {\n        return value && value.toJSON ? value.toJSON() : value;\n    };\n    ImmutableClassType.prototype.clone = function (value) {\n        return new this.type(this.toJSON(value));\n    };\n    ImmutableClassType.prototype.isChanged = function (a, b) {\n        return a !== b;\n    };\n    return ImmutableClassType;\n}(AnyType));\nFunction.prototype._attribute = ImmutableClassType;\nvar PrimitiveType = (function (_super) {\n    __extends(PrimitiveType, _super);\n    function PrimitiveType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    PrimitiveType.prototype.dispose = function () { };\n    PrimitiveType.prototype.create = function () { return this.type(); };\n    PrimitiveType.prototype.toJSON = function (value) { return value; };\n    PrimitiveType.prototype.convert = function (next) { return next == null ? next : this.type(next); };\n    PrimitiveType.prototype.isChanged = function (a, b) { return a !== b; };\n    PrimitiveType.prototype.clone = function (value) { return value; };\n    PrimitiveType.prototype.doInit = function (value, record, options) {\n        return this.transform(value === void 0 ? this.value : value, void 0, record, options);\n    };\n    PrimitiveType.prototype.doUpdate = function (value, record, options, nested) {\n        var name = this.name, attributes = record.attributes, prev = attributes[name];\n        return prev !== (attributes[name] = this.transform(value, prev, record, options));\n    };\n    PrimitiveType.prototype.initialize = function () {\n        if (!this.options.hasCustomDefault) {\n            this.value = this.type();\n        }\n    };\n    return PrimitiveType;\n}(AnyType));\nexport { PrimitiveType };\nBoolean._attribute = String._attribute = PrimitiveType;\nvar NumericType = (function (_super) {\n    __extends(NumericType, _super);\n    function NumericType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    NumericType.prototype.create = function () {\n        return 0;\n    };\n    NumericType.prototype.convert = function (next, prev, record) {\n        var num = next == null ? next : this.type(next);\n        if (num !== num) {\n            this._log('warn', 'assigned with Invalid Number', next, record);\n        }\n        return num;\n    };\n    NumericType.prototype.validate = function (model, value, name) {\n        if (value != null && !isFinite(value)) {\n            return name + ' is not valid number';\n        }\n    };\n    return NumericType;\n}(PrimitiveType));\nexport { NumericType };\nNumber._attribute = NumericType;\nfunction Integer(x) {\n    return x ? Math.round(x) : 0;\n}\nInteger._attribute = NumericType;\nNumber.integer = Integer;\nif (typeof window !== 'undefined') {\n    window.Integer = Number.integer;\n}\nvar ArrayType = (function (_super) {\n    __extends(ArrayType, _super);\n    function ArrayType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ArrayType.prototype.toJSON = function (value) { return value; };\n    ArrayType.prototype.dispose = function () { };\n    ArrayType.prototype.create = function () { return []; };\n    ArrayType.prototype.convert = function (next, prev, record) {\n        if (next == null || Array.isArray(next))\n            return next;\n        this._log('warn', 'non-array assignment is ignored', next, record);\n        return [];\n    };\n    ArrayType.prototype.clone = function (value) {\n        return value && value.slice();\n    };\n    return ArrayType;\n}(AnyType));\nexport { ArrayType };\nArray._attribute = ArrayType;\nvar ObjectType = (function (_super) {\n    __extends(ObjectType, _super);\n    function ObjectType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ObjectType.prototype.toJSON = function (value) { return value; };\n    ObjectType.prototype.dispose = function () { };\n    ObjectType.prototype.create = function () { return {}; };\n    ObjectType.prototype.convert = function (next, prev, record) {\n        if (next == null || next.constructor === Object)\n            return next;\n        this._log('warn', 'non-object assignment is ignored', next, record);\n        return {};\n    };\n    ObjectType.prototype.clone = function (value) {\n        return value && tools.assign({}, value);\n    };\n    return ObjectType;\n}(AnyType));\nexport { ObjectType };\nObject._attribute = ObjectType;\nexport function doNothing() { }\nvar FunctionType = (function (_super) {\n    __extends(FunctionType, _super);\n    function FunctionType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    FunctionType.prototype.toJSON = function (value) { return void 0; };\n    FunctionType.prototype.create = function () { return doNothing; };\n    FunctionType.prototype.convert = function (next, prev, record) {\n        if (next == null || typeof next === 'function')\n            return next;\n        this._log('warn', 'assigned with non-function', next, record);\n        return doNothing;\n    };\n    FunctionType.prototype.clone = function (value) { return value; };\n    return FunctionType;\n}(AnyType));\nexport { FunctionType };\nFunction._attribute = FunctionType;\n//# sourceMappingURL=basic.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AnyType } from './any';\nimport { ItemsBehavior, transactionApi } from '../../transactions';\nimport { eventsApi } from '../../object-plus';\nvar on = eventsApi.on, off = eventsApi.off, free = transactionApi.free, aquire = transactionApi.aquire;\nvar shareAndListen = ItemsBehavior.listen | ItemsBehavior.share;\nvar SharedType = (function (_super) {\n    __extends(SharedType, _super);\n    function SharedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    SharedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value, record) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    SharedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    SharedType.prototype.clone = function (value, record) {\n        if (!value || value._owner !== record)\n            return value;\n        var clone = value.clone();\n        aquire(record, clone, this.name);\n        return clone;\n    };\n    SharedType.prototype.toJSON = function () { };\n    SharedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null && !(next instanceof this.type)) {\n            return next;\n        }\n    };\n    SharedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null || next instanceof this.type)\n            return next;\n        var implicitObject = new this.type(next, options, shareAndListen);\n        aquire(record, implicitObject, this.name);\n        return implicitObject;\n    };\n    SharedType.prototype.validate = function (model, value, name) { };\n    SharedType.prototype.create = function () {\n        return null;\n    };\n    SharedType.prototype._handleChange = function (next, prev, record) {\n        if (prev) {\n            if (prev._owner === record) {\n                free(record, prev);\n                prev.dispose();\n            }\n            else {\n                off(prev, prev._changeEventName, this._onChange, record);\n            }\n        }\n        if (next) {\n            if (next._owner !== record) {\n                on(next, next._changeEventName, this._onChange, record);\n            }\n        }\n    };\n    SharedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    SharedType.prototype.initialize = function (options) {\n        var attribute = this;\n        this._onChange = this.propagateChanges ? function (child, options, initiator) {\n            this === initiator || this.forceAttributeChange(attribute.name, options);\n        } : ignore;\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    return SharedType;\n}(AnyType));\nexport { SharedType };\nfunction ignore() { }\n//# sourceMappingURL=shared.js.map","var __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nimport { tools as _, eventsApi } from '../../object-plus';\nexport * from './any';\nexport * from './owned';\nexport * from './date';\nexport * from './basic';\nexport * from './shared';\nexport * from './updates';\nexport * from './attrDef';\nimport { AnyType } from './any';\nimport { constructorsMixin } from './updates';\nimport { toAttributeOptions, ChainableAttributeSpec } from './attrDef';\nimport { CompiledReference } from '../../traversable';\nexport default function (attributesDefinition, baseClassAttributes) {\n    var myAttributes = _.transform({}, attributesDefinition, createAttribute), allAttributes = _.defaults({}, myAttributes, baseClassAttributes);\n    var ConstructorsMixin = constructorsMixin(allAttributes);\n    return __assign({}, ConstructorsMixin, { _attributes: new ConstructorsMixin.AttributesCopy(allAttributes), _attributesArray: Object.keys(allAttributes).map(function (key) { return allAttributes[key]; }), properties: _.transform({}, myAttributes, function (x) { return x.createPropertyDescriptor(); }), _toJSON: createToJSON(allAttributes) }, parseMixin(allAttributes), localEventsMixin(myAttributes));\n}\nexport function createAttribute(spec, name) {\n    return AnyType.create(toAttributeOptions(spec), name);\n}\nfunction parseMixin(attributes) {\n    var attrsWithParse = Object.keys(attributes).filter(function (name) { return attributes[name].parse; });\n    return attrsWithParse.length ? {\n        _parse: new Function('json', \"\\n            var _attrs = this._attributes;\\n\\n            \" + attrsWithParse.map(function (name) { return \"                \\n                json.\" + name + \" === void 0 || ( json.\" + name + \" = _attrs.\" + name + \".parse.call( this, json.\" + name + \", \\\"\" + name + \"\\\" ) );\\n            \"; }).join('') + \"\\n\\n            return json;\\n        \")\n    } : {};\n}\nfunction createToJSON(attributes) {\n    return new Function(\"\\n        var json = {},\\n            v = this.attributes,\\n            a = this._attributes;\\n\\n        \" + Object.keys(attributes).map(function (key) {\n        if (attributes[key].toJSON) {\n            return \"json.\" + key + \" = a.\" + key + \".toJSON.call( this, v.\" + key + \", '\" + key + \"' );\";\n        }\n    }).join('\\n') + \"\\n\\n        return json;\\n    \");\n}\nexport function createSharedTypeSpec(Constructor, Attribute) {\n    if (!Constructor.hasOwnProperty('shared')) {\n        Object.defineProperty(Constructor, 'shared', {\n            get: function () {\n                return new ChainableAttributeSpec({\n                    value: null,\n                    type: Constructor,\n                    _attribute: Attribute\n                });\n            }\n        });\n    }\n}\nfunction localEventsMixin(attrSpecs) {\n    var _localEvents;\n    for (var key in attrSpecs) {\n        var attribute = attrSpecs[key], _onChange = attribute.options._onChange;\n        if (_onChange) {\n            _localEvents || (_localEvents = new eventsApi.EventMap());\n            _localEvents.addEvent('change:' + key, typeof _onChange === 'string' ?\n                createWatcherFromRef(_onChange, key) :\n                wrapWatcher(_onChange, key));\n        }\n    }\n    return _localEvents ? { _localEvents: _localEvents } : {};\n}\nfunction wrapWatcher(watcher, key) {\n    return function (record, value) {\n        watcher.call(record, value, key);\n    };\n}\nfunction createWatcherFromRef(ref, key) {\n    var _a = new CompiledReference(ref, true), local = _a.local, resolve = _a.resolve, tail = _a.tail;\n    return local ?\n        function (record, value) {\n            record[tail](value, key);\n        } :\n        function (record, value) {\n            resolve(record)[tail](value, key);\n        };\n}\n//# sourceMappingURL=index.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { tools, definitions, mixinRules, define } from '../object-plus';\nimport { Transactional } from '../transactions';\nimport { AnyType, AggregatedType, setAttribute, UpdateRecordMixin } from './attributes';\nvar assign = tools.assign, isEmpty = tools.isEmpty, log = tools.log;\nvar _cidCounter = 0;\nvar Record = (function (_super) {\n    __extends(Record, _super);\n    function Record(a_values, a_options) {\n        var _this = _super.call(this, _cidCounter++) || this;\n        _this.attributes = {};\n        var options = a_options || {}, values = (options.parse ? _this.parse(a_values, options) : a_values) || {};\n        if (log.level > 1)\n            typeCheck(_this, values);\n        _this.attributes = _this._previousAttributes = new _this.Attributes(_this, values, options);\n        _this.initialize(a_values, a_options);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Record_1 = Record;\n    Record.onDefine = function (definition, BaseClass) { };\n    Record.defaults = function (attrs) {\n        return this.extend({ attributes: attrs });\n    };\n    Record.prototype.previousAttributes = function () { return new this.AttributesCopy(this._previousAttributes); };\n    Object.defineProperty(Record.prototype, \"__inner_state__\", {\n        get: function () { return this.attributes; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Record.prototype, \"changed\", {\n        get: function () {\n            var changed = this._changedAttributes;\n            if (!changed) {\n                var prev = this._previousAttributes;\n                changed = {};\n                var _a = this, _attributes = _a._attributes, attributes = _a.attributes;\n                for (var _i = 0, _b = this._attributesArray; _i < _b.length; _i++) {\n                    var attr = _b[_i];\n                    var key = attr.name, value = attributes[key];\n                    if (attr.isChanged(value, prev[key])) {\n                        changed[key] = value;\n                    }\n                }\n                this._changedAttributes = changed;\n            }\n            return changed;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.changedAttributes = function (diff) {\n        if (!diff)\n            return this.hasChanged() ? assign({}, this.changed) : false;\n        var val, changed = false, old = this._transaction ? this._previousAttributes : this.attributes, attrSpecs = this._attributes;\n        for (var attr in diff) {\n            if (!attrSpecs[attr].isChanged(old[attr], (val = diff[attr])))\n                continue;\n            (changed || (changed = {}))[attr] = val;\n        }\n        return changed;\n    };\n    Record.prototype.hasChanged = function (key) {\n        var _previousAttributes = this._previousAttributes;\n        if (!_previousAttributes)\n            return false;\n        return key ?\n            this._attributes[key].isChanged(this.attributes[key], _previousAttributes[key]) :\n            !isEmpty(this.changed);\n    };\n    Record.prototype.previous = function (key) {\n        if (key) {\n            var _previousAttributes = this._previousAttributes;\n            if (_previousAttributes)\n                return _previousAttributes[key];\n        }\n        return null;\n    };\n    Record.prototype.isNew = function () {\n        return this.id == null;\n    };\n    Record.prototype.has = function (key) {\n        return this[key] != void 0;\n    };\n    Record.prototype.unset = function (key, options) {\n        var value = this[key];\n        this.set((_a = {}, _a[key] = void 0, _a), options);\n        return value;\n        var _a;\n    };\n    Record.prototype.clear = function (options) {\n        var _this = this;\n        var nullify = options && options.nullify;\n        this.transaction(function () {\n            _this.forEachAttr(_this.attributes, function (value, key) { return _this[key] = nullify ? null : void 0; });\n        }, options);\n        return this;\n    };\n    Record.prototype.getOwner = function () {\n        var owner = this._owner;\n        return this._ownerKey ? owner : owner && owner._owner;\n    };\n    Object.defineProperty(Record.prototype, \"id\", {\n        get: function () { return this.attributes[this.idAttribute]; },\n        set: function (x) { setAttribute(this, this.idAttribute, x); },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.forEachAttr = function (attrs, iteratee) {\n        var _attributes = this._attributes;\n        var unknown;\n        for (var name_1 in attrs) {\n            var spec = _attributes[name_1];\n            if (spec) {\n                iteratee(attrs[name_1], name_1, spec);\n            }\n            else {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_1 + \"'\");\n            }\n        }\n        if (unknown) {\n            this._log('warn', \"attributes \" + unknown.join(', ') + \" are not defined\", {\n                attributes: attrs\n            });\n        }\n    };\n    Record.prototype.each = function (iteratee, context) {\n        var fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee, attributes = this.attributes;\n        for (var key in this.attributes) {\n            var value = attributes[key];\n            if (value !== void 0)\n                fun(value, key);\n        }\n    };\n    Record.prototype.keys = function () {\n        var keys = [];\n        this.each(function (key, value) { return value === void 0 || keys.push(key); });\n        return keys;\n    };\n    Record.prototype.values = function () {\n        return this.map(function (value) { return value; });\n    };\n    Record.prototype._toJSON = function () { return {}; };\n    Record.prototype._parse = function (data) { return data; };\n    Record.prototype.defaults = function (values) {\n        var defaults = {}, _attributes = this._attributes;\n        for (var key in _attributes) {\n            var value = values[key];\n            defaults[key] = value === void 0 ? _attributes[key].defaultValue() : value;\n        }\n        return defaults;\n    };\n    Record.prototype.initialize = function (values, options) { };\n    Record.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var copy = new this.constructor(this.attributes, { clone: true });\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Record.prototype.deepClone = function () { return this.clone(); };\n    ;\n    Record.prototype._validateNested = function (errors) {\n        var _this = this;\n        var length = 0;\n        this.forEachAttr(this.attributes, function (value, name, attribute) {\n            var error = attribute.validate(_this, value, name);\n            if (error) {\n                errors[name] = error;\n                length++;\n            }\n        });\n        return length;\n    };\n    Record.prototype.get = function (key) {\n        return this[key];\n    };\n    Record.prototype.toJSON = function () {\n        var _this = this;\n        var json = {};\n        this.forEachAttr(this.attributes, function (value, key, _a) {\n            var toJSON = _a.toJSON;\n            if (value !== void 0) {\n                var asJson = toJSON.call(_this, value, key);\n                if (asJson !== void 0)\n                    json[key] = asJson;\n            }\n        });\n        return json;\n    };\n    Record.prototype.parse = function (data, options) {\n        return this._parse(data);\n    };\n    Record.prototype.deepSet = function (name, value, options) {\n        var _this = this;\n        this.transaction(function () {\n            var path = name.split('.'), l = path.length - 1, attr = path[l];\n            var model = _this;\n            for (var i = 0; i < l; i++) {\n                var key = path[i];\n                var next = model.get ? model.get(key) : model[key];\n                if (!next) {\n                    var attrSpecs = model._attributes;\n                    if (attrSpecs) {\n                        var newModel = attrSpecs[key].create();\n                        if (options && options.nullify && newModel._attributes) {\n                            newModel.clear(options);\n                        }\n                        model[key] = next = newModel;\n                    }\n                    else\n                        return;\n                }\n                model = next;\n            }\n            if (model.set) {\n                model.set((_a = {}, _a[attr] = value, _a), options);\n            }\n            else {\n                model[attr] = value;\n            }\n            var _a;\n        });\n        return this;\n    };\n    Object.defineProperty(Record.prototype, \"collection\", {\n        get: function () {\n            return this._ownerKey ? null : this._owner;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Record.prototype.dispose = function () {\n        var _this = this;\n        if (this._disposed)\n            return;\n        this.forEachAttr(this.attributes, function (value, key, attribute) {\n            attribute.dispose(_this, value);\n        });\n        _super.prototype.dispose.call(this);\n    };\n    Record.prototype._log = function (level, text, props) {\n        tools.log(level, '[Record] ' + text, __assign({ 'Record': this, 'Attributes definition:': this._attributes }, props));\n    };\n    Record.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Record';\n    };\n    Record.prototype._createTransaction = function (values, options) { return void 0; };\n    Record = Record_1 = __decorate([\n        define({\n            cidPrefix: 'm',\n            _changeEventName: 'change',\n            idAttribute: 'id'\n        }),\n        definitions({\n            defaults: mixinRules.merge,\n            attributes: mixinRules.merge,\n            collection: mixinRules.merge,\n            Collection: mixinRules.value,\n            idAttribute: mixinRules.protoValue\n        })\n    ], Record);\n    return Record;\n    var Record_1;\n}(Transactional));\nexport { Record };\n;\nassign(Record.prototype, UpdateRecordMixin);\nvar BaseRecordAttributes = (function () {\n    function BaseRecordAttributes(record, x, options) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributes;\n}());\nRecord.prototype.Attributes = BaseRecordAttributes;\nvar BaseRecordAttributesCopy = (function () {\n    function BaseRecordAttributesCopy(x) {\n        this.id = x.id;\n    }\n    return BaseRecordAttributesCopy;\n}());\nRecord.prototype.AttributesCopy = BaseRecordAttributesCopy;\nvar IdAttribute = AnyType.create({ value: void 0 }, 'id');\nRecord.prototype._attributes = { id: IdAttribute };\nRecord.prototype._attributesArray = [IdAttribute];\nRecord.prototype.defaults = function (attrs) {\n    if (attrs === void 0) { attrs = {}; }\n    return { id: attrs.id };\n};\nRecord._attribute = AggregatedType;\nimport { shouldBeAnObject } from './attributes';\nfunction typeCheck(record, values) {\n    if (shouldBeAnObject(record, values)) {\n        var _attributes = record._attributes;\n        var unknown = void 0;\n        for (var name_2 in values) {\n            if (!_attributes[name_2]) {\n                unknown || (unknown = []);\n                unknown.push(\"'\" + name_2 + \"'\");\n            }\n        }\n        if (unknown) {\n            record._log('warn', \"undefined attributes \" + unknown.join(', ') + \" are ignored.\", { values: values });\n        }\n    }\n}\n//# sourceMappingURL=record.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\n            t[p[i]] = s[p[i]];\n    return t;\n};\nimport { Record } from './record';\nimport { tools, predefine } from '../object-plus';\nimport compile from './attributes';\nimport { Transactional } from '../transactions';\nimport { ChainableAttributeSpec, createSharedTypeSpec, AggregatedType, SharedType } from './attributes';\nexport * from './attributes';\nexport { Record, ChainableAttributeSpec };\nvar assign = tools.assign, defaults = tools.defaults, omit = tools.omit, getBaseClass = tools.getBaseClass;\nRecord.onExtend = function (BaseClass) {\n    Transactional.onExtend.call(this, BaseClass);\n    var Class = this;\n    var DefaultCollection = (function (_super) {\n        __extends(DefaultCollection, _super);\n        function DefaultCollection() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultCollection.model = Class;\n        DefaultCollection = __decorate([\n            predefine\n        ], DefaultCollection);\n        return DefaultCollection;\n    }(BaseClass.Collection));\n    this.DefaultCollection = DefaultCollection;\n    if (Class.Collection === BaseClass.Collection) {\n        this.Collection = DefaultCollection;\n    }\n    createSharedTypeSpec(this, SharedType);\n};\nRecord.onDefine = function (definition, BaseClass) {\n    var baseProto = BaseClass.prototype;\n    var _a = compile(this.attributes = getAttributes(definition), baseProto._attributes), properties = _a.properties, _localEvents = _a._localEvents, dynamicMixin = __rest(_a, [\"properties\", \"_localEvents\"]);\n    assign(this.prototype, dynamicMixin);\n    definition.properties = defaults(definition.properties || {}, properties);\n    definition._localEvents = _localEvents;\n    Transactional.onDefine.call(this, definition, BaseClass);\n    this.DefaultCollection.define(definition.collection || {});\n    this.Collection = definition.Collection;\n    this.Collection.prototype.model = this;\n};\nRecord._attribute = AggregatedType;\ncreateSharedTypeSpec(Record, SharedType);\nfunction getAttributes(_a) {\n    var defaults = _a.defaults, attributes = _a.attributes, idAttribute = _a.idAttribute;\n    var definition = attributes || defaults || {};\n    if (idAttribute && !(idAttribute in definition)) {\n        definition[idAttribute] = void 0;\n    }\n    return definition;\n}\nexport function attr(proto, attrName) {\n    if (attrName) {\n        if (typeof Reflect !== 'undefined' && Reflect.getMetadata) {\n            Reflect\n                .getMetadata(\"design:type\", proto, attrName)\n                .asProp(proto, attrName);\n        }\n        else {\n            proto._log('error', 'Add import \"reflect-metadata\"; as the first line of your app.');\n        }\n    }\n    else {\n        return proto.asProp;\n    }\n}\nexport function prop(spec) {\n    return spec.asProp;\n}\n//# sourceMappingURL=index.js.map","import { ItemsBehavior, transactionApi } from '../transactions';\nimport { eventsApi } from '../object-plus';\nvar EventMap = eventsApi.EventMap, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, _aquire = transactionApi.aquire, _free = transactionApi.free;\nexport function dispose(collection) {\n    var models = collection.models;\n    collection.models = [];\n    collection._byId = {};\n    freeAll(collection, models);\n    return models;\n}\nexport function convertAndAquire(collection, attrs, options) {\n    var model = collection.model;\n    var record;\n    if (collection._shared) {\n        record = attrs instanceof model ? attrs : model.create(attrs, options);\n        if (collection._shared & ItemsBehavior.listen) {\n            on(record, record._changeEventName, collection._onChildrenChange, collection);\n        }\n    }\n    else {\n        record = attrs instanceof model ? (options.merge ? attrs.clone() : attrs) : model.create(attrs, options);\n        if (!_aquire(collection, record)) {\n            var errors = collection._aggregationError || (collection._aggregationError = []);\n            errors.push(record);\n        }\n    }\n    var _itemEvents = collection._itemEvents;\n    _itemEvents && _itemEvents.subscribe(collection, record);\n    return record;\n}\nexport function free(owner, child, unset) {\n    if (owner._shared) {\n        if (owner._shared & ItemsBehavior.listen) {\n            off(child, child._changeEventName, owner._onChildrenChange, owner);\n        }\n    }\n    else {\n        _free(owner, child);\n        unset || child.dispose();\n    }\n    var _itemEvents = owner._itemEvents;\n    _itemEvents && _itemEvents.unsubscribe(owner, child);\n}\nexport function freeAll(collection, children) {\n    for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {\n        var child = children_1[_i];\n        free(collection, child);\n    }\n    return children;\n}\nexport function sortElements(collection, options) {\n    var _comparator = collection._comparator;\n    if (_comparator && options.sort !== false) {\n        collection.models.sort(_comparator);\n        return true;\n    }\n    return false;\n}\nexport function addIndex(index, model) {\n    index[model.cid] = model;\n    var id = model.id;\n    if (id != null) {\n        index[id] = model;\n    }\n}\nexport function removeIndex(index, model) {\n    delete index[model.cid];\n    var id = model.id;\n    if (id != null) {\n        delete index[id];\n    }\n}\nexport function updateIndex(index, model) {\n    delete index[model.previous(model.idAttribute)];\n    var id = model.id;\n    id == null || (index[id] = model);\n}\nvar CollectionTransaction = (function () {\n    function CollectionTransaction(object, isRoot, added, removed, nested, sorted) {\n        this.object = object;\n        this.isRoot = isRoot;\n        this.added = added;\n        this.removed = removed;\n        this.nested = nested;\n        this.sorted = sorted;\n    }\n    CollectionTransaction.prototype.commit = function (initiator) {\n        var _a = this, nested = _a.nested, object = _a.object, _isDirty = object._isDirty;\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var transaction = nested_1[_i];\n            transaction.commit(object);\n        }\n        if (object._aggregationError) {\n            logAggregationError(object);\n        }\n        for (var _b = 0, nested_2 = nested; _b < nested_2.length; _b++) {\n            var transaction = nested_2[_b];\n            trigger2(object, 'change', transaction.object, _isDirty);\n        }\n        var _c = this, added = _c.added, removed = _c.removed;\n        for (var _d = 0, added_1 = added; _d < added_1.length; _d++) {\n            var record = added_1[_d];\n            trigger3(record, 'add', record, object, _isDirty);\n            trigger3(object, 'add', record, object, _isDirty);\n        }\n        for (var _e = 0, removed_1 = removed; _e < removed_1.length; _e++) {\n            var record = removed_1[_e];\n            trigger3(record, 'remove', record, object, _isDirty);\n            trigger3(object, 'remove', record, object, _isDirty);\n        }\n        if (this.sorted) {\n            trigger2(object, 'sort', object, _isDirty);\n        }\n        if (added.length || removed.length) {\n            trigger2(object, 'update', object, _isDirty);\n        }\n        this.isRoot && commit(object, initiator);\n    };\n    return CollectionTransaction;\n}());\nexport { CollectionTransaction };\nexport function logAggregationError(collection) {\n    collection._log('error', 'added records already have an owner', collection._aggregationError);\n    collection._aggregationError = void 0;\n}\n//# sourceMappingURL=commons.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, sortElements, convertAndAquire, addIndex, updateIndex } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nexport function addTransaction(collection, items, options, merge) {\n    var isRoot = begin(collection), nested = [];\n    var added = appendElements(collection, items, nested, options, merge);\n    if (added.length || nested.length) {\n        var needSort = sortOrMoveElements(collection, added, options);\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, [], nested, needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction sortOrMoveElements(collection, added, options) {\n    var at = options.at;\n    if (at != null) {\n        var length_1 = collection.models.length - added.length;\n        at = Number(at);\n        if (at < 0)\n            at += length_1 + 1;\n        if (at < 0)\n            at = 0;\n        if (at > length_1)\n            at = length_1;\n        moveElements(collection.models, at, added);\n        return false;\n    }\n    return sortElements(collection, options);\n}\nfunction moveElements(source, at, added) {\n    for (var j = source.length - 1, i = j - added.length; i >= at; i--, j--) {\n        source[j] = source[i];\n    }\n    for (i = 0, j = at; i < added.length; i++, j++) {\n        source[j] = added[i];\n    }\n}\nfunction appendElements(collection, a_items, nested, a_options, forceMerge) {\n    var _byId = collection._byId, models = collection.models, merge = (forceMerge || a_options.merge) && !collection._shared, parse = a_options.parse, idAttribute = collection.model.prototype.idAttribute, prevLength = models.length;\n    for (var _i = 0, a_items_1 = a_items; _i < a_items_1.length; _i++) {\n        var item = a_items_1[_i];\n        var model = item ? _byId[item[idAttribute]] || _byId[item.cid] : null;\n        if (model) {\n            if (merge && item !== model) {\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, a_options);\n                transaction && nested.push(transaction);\n                if (model.hasChanged(idAttribute)) {\n                    updateIndex(_byId, model);\n                }\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, a_options);\n            models.push(model);\n            addIndex(_byId, model);\n        }\n    }\n    return models.slice(prevLength);\n}\n//# sourceMappingURL=add.js.map","import { transactionApi } from '../transactions';\nimport { CollectionTransaction, logAggregationError, convertAndAquire, free, sortElements, addIndex, freeAll } from './commons';\nvar begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty;\nvar silentOptions = { silent: true };\nexport function emptySetTransaction(collection, items, options, silent) {\n    var isRoot = begin(collection);\n    var added = _reallocateEmpty(collection, items, options);\n    if (added.length) {\n        var needSort = sortElements(collection, options);\n        if (markAsDirty(collection, silent ? silentOptions : options)) {\n            return new CollectionTransaction(collection, isRoot, added.slice(), [], [], needSort);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nexport function setTransaction(collection, items, options) {\n    var isRoot = begin(collection), nested = [];\n    var previous = collection.models, added = _reallocate(collection, items, nested, options);\n    var reusedCount = collection.models.length - added.length, removed = reusedCount < previous.length ? (reusedCount ? _garbageCollect(collection, previous) :\n        freeAll(collection, previous)) : [];\n    var addedOrChanged = nested.length || added.length, sorted = (sortElements(collection, options) && addedOrChanged) || added.length || options.sorted;\n    if (addedOrChanged || removed.length || sorted) {\n        if (markAsDirty(collection, options)) {\n            return new CollectionTransaction(collection, isRoot, added, removed, nested, sorted);\n        }\n        if (collection._aggregationError)\n            logAggregationError(collection);\n    }\n    isRoot && commit(collection);\n}\n;\nfunction _garbageCollect(collection, previous) {\n    var _byId = collection._byId, removed = [];\n    for (var _i = 0, previous_1 = previous; _i < previous_1.length; _i++) {\n        var record = previous_1[_i];\n        if (!_byId[record.cid]) {\n            removed.push(record);\n            free(collection, record);\n        }\n    }\n    return removed;\n}\nfunction _reallocate(collection, source, nested, options) {\n    var models = Array(source.length), _byId = {}, merge = (options.merge == null ? true : options.merge) && !collection._shared, _prevById = collection._byId, prevModels = collection.models, idAttribute = collection.model.prototype.idAttribute, toAdd = [], orderKept = true;\n    for (var i = 0, j = 0; i < source.length; i++) {\n        var item = source[i], model = null;\n        if (item) {\n            var id = item[idAttribute], cid = item.cid;\n            if (_byId[id] || _byId[cid])\n                continue;\n            model = _prevById[id] || _prevById[cid];\n        }\n        if (model) {\n            if (merge && item !== model) {\n                if (orderKept && prevModels[j] !== model)\n                    orderKept = false;\n                var attrs = item.attributes || item;\n                var transaction = model._createTransaction(attrs, options);\n                transaction && nested.push(transaction);\n            }\n        }\n        else {\n            model = convertAndAquire(collection, item, options);\n            toAdd.push(model);\n        }\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    collection.models = models;\n    collection._byId = _byId;\n    if (!orderKept)\n        options.sorted = true;\n    return toAdd;\n}\nfunction _reallocateEmpty(self, source, options) {\n    var len = source ? source.length : 0, models = Array(len), _byId = {}, idAttribute = self.model.prototype.idAttribute;\n    for (var i = 0, j = 0; i < len; i++) {\n        var src = source[i];\n        if (src && (_byId[src[idAttribute]] || _byId[src.cid])) {\n            continue;\n        }\n        var model = convertAndAquire(self, src, options);\n        models[j++] = model;\n        addIndex(_byId, model);\n    }\n    models.length = j;\n    self._byId = _byId;\n    return self.models = models;\n}\n//# sourceMappingURL=set.js.map","import { free, CollectionTransaction, removeIndex } from './commons';\nimport { eventsApi } from '../object-plus';\nimport { transactionApi } from '../transactions';\nvar trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, markAsDirty = transactionApi.markAsDirty, begin = transactionApi.begin, commit = transactionApi.commit;\nexport function removeOne(collection, el, options) {\n    var model = collection.get(el);\n    if (model) {\n        var isRoot = begin(collection), models = collection.models;\n        models.splice(models.indexOf(model), 1);\n        removeIndex(collection._byId, model);\n        var notify = markAsDirty(collection, options);\n        if (notify) {\n            trigger3(model, 'remove', model, collection, options);\n            trigger3(collection, 'remove', model, collection, options);\n        }\n        free(collection, model, options.unset);\n        notify && trigger2(collection, 'update', collection, options);\n        isRoot && commit(collection);\n        return model;\n    }\n}\n;\nexport function removeMany(collection, toRemove, options) {\n    var removed = _removeFromIndex(collection, toRemove);\n    if (removed.length) {\n        var isRoot = begin(collection);\n        _reallocate(collection, removed.length);\n        if (markAsDirty(collection, options)) {\n            var transaction = new CollectionTransaction(collection, isRoot, [], removed, [], false);\n            transaction.commit();\n        }\n        else {\n            isRoot && commit(collection);\n        }\n    }\n    return removed;\n}\n;\nfunction _removeFromIndex(collection, toRemove) {\n    var removed = Array(toRemove.length), _byId = collection._byId;\n    for (var i = 0, j = 0; i < toRemove.length; i++) {\n        var model = collection.get(toRemove[i]);\n        if (model) {\n            removed[j++] = model;\n            removeIndex(_byId, model);\n            free(collection, model);\n        }\n    }\n    removed.length = j;\n    return removed;\n}\nfunction _reallocate(collection, removed) {\n    var prev = collection.models, models = collection.models = Array(prev.length - removed), _byId = collection._byId;\n    for (var i = 0, j = 0; i < prev.length; i++) {\n        var model = prev[i];\n        if (_byId[model.cid]) {\n            models[j++] = model;\n        }\n    }\n    models.length = j;\n}\n//# sourceMappingURL=remove.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { define, tools, eventsApi, EventMap, definitions, mixinRules, Mixable } from '../object-plus';\nimport { ItemsBehavior, transactionApi, Transactional } from '../transactions';\nimport { Record, SharedType, AggregatedType, createSharedTypeSpec } from '../record';\nimport { free, sortElements, dispose, updateIndex } from './commons';\nimport { addTransaction } from './add';\nimport { setTransaction, emptySetTransaction } from './set';\nimport { removeOne, removeMany } from './remove';\nvar trigger2 = eventsApi.trigger2, on = eventsApi.on, off = eventsApi.off, begin = transactionApi.begin, commit = transactionApi.commit, markAsDirty = transactionApi.markAsDirty, omit = tools.omit, log = tools.log, assign = tools.assign, defaults = tools.defaults, assignToClassProto = tools.assignToClassProto;\nvar _count = 0;\nvar silentOptions = { silent: true };\nvar slice = Array.prototype.slice;\nvar CollectionRefsType = (function (_super) {\n    __extends(CollectionRefsType, _super);\n    function CollectionRefsType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    CollectionRefsType.defaultValue = [];\n    return CollectionRefsType;\n}(SharedType));\nvar Collection = (function (_super) {\n    __extends(Collection, _super);\n    function Collection(records, options, shared) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this, _count++) || this;\n        _this.models = [];\n        _this._byId = {};\n        _this.comparator = _this.comparator;\n        if (options.comparator !== void 0) {\n            _this.comparator = options.comparator;\n            options.comparator = void 0;\n        }\n        _this.model = _this.model;\n        if (options.model) {\n            _this.model = options.model;\n            options.model = void 0;\n        }\n        _this.idAttribute = _this.model.prototype.idAttribute;\n        _this._shared = shared || 0;\n        if (records) {\n            var elements = toElements(_this, records, options);\n            emptySetTransaction(_this, elements, options, true);\n        }\n        _this.initialize.apply(_this, arguments);\n        if (_this._localEvents)\n            _this._localEvents.subscribe(_this, _this);\n        return _this;\n    }\n    Collection_1 = Collection;\n    Collection.prototype.createSubset = function (models, options) {\n        var SubsetOf = this.constructor.subsetOf(this).options.type, subset = new SubsetOf(models, options);\n        subset.resolve(this);\n        return subset;\n    };\n    Collection.onExtend = function (BaseClass) {\n        var Ctor = this;\n        this._SubsetOf = null;\n        function RefsCollection(a, b, listen) {\n            Ctor.call(this, a, b, ItemsBehavior.share | (listen ? ItemsBehavior.listen : 0));\n        }\n        Mixable.mixins.populate(RefsCollection);\n        RefsCollection.prototype = this.prototype;\n        RefsCollection._attribute = CollectionRefsType;\n        this.Refs = this.Subset = RefsCollection;\n        Transactional.onExtend.call(this, BaseClass);\n        createSharedTypeSpec(this, SharedType);\n    };\n    Collection.onDefine = function (definition, BaseClass) {\n        if (definition.itemEvents) {\n            var eventsMap = new EventMap(BaseClass.prototype._itemEvents);\n            eventsMap.addEventsMap(definition.itemEvents);\n            this.prototype._itemEvents = eventsMap;\n        }\n        if (definition.comparator)\n            this.prototype.comparator = definition.comparator;\n        Transactional.onDefine.call(this, definition);\n    };\n    Object.defineProperty(Collection.prototype, \"__inner_state__\", {\n        get: function () { return this.models; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Collection.prototype, \"comparator\", {\n        get: function () { return this._comparator; },\n        set: function (x) {\n            var _this = this;\n            var compare;\n            switch (typeof x) {\n                case 'string':\n                    this._comparator = function (a, b) {\n                        var aa = a[x], bb = b[x];\n                        if (aa === bb)\n                            return 0;\n                        return aa < bb ? -1 : +1;\n                    };\n                    break;\n                case 'function':\n                    if (x.length === 1) {\n                        this._comparator = function (a, b) {\n                            var aa = x.call(_this, a), bb = x.call(_this, b);\n                            if (aa === bb)\n                                return 0;\n                            return aa < bb ? -1 : +1;\n                        };\n                    }\n                    else {\n                        this._comparator = function (a, b) { return x.call(_this, a, b); };\n                    }\n                    break;\n                default:\n                    this._comparator = null;\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.getStore = function () {\n        return this._store || (this._store = this._owner ? this._owner.getStore() : this._defaultStore);\n    };\n    Collection.prototype._onChildrenChange = function (record, options, initiator) {\n        if (options === void 0) { options = {}; }\n        if (initiator === this)\n            return;\n        var idAttribute = this.idAttribute;\n        if (record.hasChanged(idAttribute)) {\n            updateIndex(this._byId, record);\n        }\n        var isRoot = begin(this);\n        if (markAsDirty(this, options)) {\n            trigger2(this, 'change', record, options);\n        }\n        isRoot && commit(this);\n    };\n    Collection.prototype.get = function (objOrId) {\n        if (objOrId == null)\n            return;\n        if (typeof objOrId === 'object') {\n            var id = objOrId[this.idAttribute];\n            return (id !== void 0 && this._byId[id]) || this._byId[objOrId.cid];\n        }\n        else {\n            return this._byId[objOrId];\n        }\n    };\n    Collection.prototype.each = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            fun(models[i], i);\n        }\n    };\n    Collection.prototype.every = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (!fun(models[i], i))\n                return false;\n        }\n        return true;\n    };\n    Collection.prototype.filter = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        return this.map(function (x, i) { return fun(x, i) ? x : void 0; });\n    };\n    Collection.prototype.find = function (iteratee, context) {\n        var fun = toPredicateFunction(iteratee, context), models = this.models;\n        for (var i = 0; i < models.length; i++) {\n            if (fun(models[i], i))\n                return models[i];\n        }\n        return null;\n    };\n    Collection.prototype.some = function (iteratee, context) {\n        return Boolean(this.find(iteratee, context));\n    };\n    Collection.prototype.map = function (iteratee, context) {\n        var fun = bindContext(iteratee, context), models = this.models, mapped = Array(models.length);\n        var j = 0;\n        for (var i = 0; i < models.length; i++) {\n            var x = fun(models[i], i);\n            x === void 0 || (mapped[j++] = x);\n        }\n        mapped.length = j;\n        return mapped;\n    };\n    Collection.prototype._validateNested = function (errors) {\n        if (this._shared)\n            return 0;\n        var count = 0;\n        this.each(function (record) {\n            var error = record.validationError;\n            if (error) {\n                errors[record.cid] = error;\n                count++;\n            }\n        });\n        return count;\n    };\n    Collection.prototype.initialize = function () { };\n    Object.defineProperty(Collection.prototype, \"length\", {\n        get: function () { return this.models.length; },\n        enumerable: true,\n        configurable: true\n    });\n    Collection.prototype.first = function () { return this.models[0]; };\n    Collection.prototype.last = function () { return this.models[this.models.length - 1]; };\n    Collection.prototype.at = function (a_index) {\n        var index = a_index < 0 ? a_index + this.models.length : a_index;\n        return this.models[index];\n    };\n    Collection.prototype.clone = function (options) {\n        if (options === void 0) { options = {}; }\n        var models = this._shared & ItemsBehavior.share ? this.models : this.map(function (model) { return model.clone(); }), copy = new this.constructor(models, { model: this.model, comparator: this.comparator }, this._shared);\n        if (options.pinStore)\n            copy._defaultStore = this.getStore();\n        return copy;\n    };\n    Collection.prototype.toJSON = function () {\n        return this.models.map(function (model) { return model.toJSON(); });\n    };\n    Collection.prototype.set = function (elements, options) {\n        if (elements === void 0) { elements = []; }\n        if (options === void 0) { options = {}; }\n        if (options.add !== void 0) {\n            this._log('warn', \"Collection.set doesn't support 'add' option, behaving as if options.add === true.\", options);\n        }\n        if (options.reset) {\n            this.reset(elements, options);\n        }\n        else {\n            var transaction = this._createTransaction(elements, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Collection.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        var aggregated = !this._shared;\n        for (var _i = 0, _a = this.models; _i < _a.length; _i++) {\n            var record = _a[_i];\n            free(this, record);\n            if (aggregated)\n                record.dispose();\n        }\n        _super.prototype.dispose.call(this);\n    };\n    Collection.prototype.reset = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = begin(this), previousModels = dispose(this);\n        if (a_elements) {\n            emptySetTransaction(this, toElements(this, a_elements, options), options, true);\n        }\n        markAsDirty(this, options);\n        options.silent || trigger2(this, 'reset', this, defaults({ previousModels: previousModels }, options));\n        isRoot && commit(this);\n        return this.models;\n    };\n    Collection.prototype.add = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options), transaction = this.models.length ?\n            addTransaction(this, elements, options) :\n            emptySetTransaction(this, elements, options);\n        if (transaction) {\n            transaction.commit();\n            return transaction.added;\n        }\n    };\n    Collection.prototype.remove = function (recordsOrIds, options) {\n        if (options === void 0) { options = {}; }\n        if (recordsOrIds) {\n            return Array.isArray(recordsOrIds) ?\n                removeMany(this, recordsOrIds, options) :\n                removeOne(this, recordsOrIds, options);\n        }\n        return [];\n    };\n    Collection.prototype._createTransaction = function (a_elements, options) {\n        if (options === void 0) { options = {}; }\n        var elements = toElements(this, a_elements, options);\n        if (this.models.length) {\n            return options.remove === false ?\n                addTransaction(this, elements, options, true) :\n                setTransaction(this, elements, options);\n        }\n        else {\n            return emptySetTransaction(this, elements, options);\n        }\n    };\n    Collection.prototype.pluck = function (key) {\n        return this.models.map(function (model) { return model[key]; });\n    };\n    Collection.prototype.sort = function (options) {\n        if (options === void 0) { options = {}; }\n        if (sortElements(this, options)) {\n            var isRoot = begin(this);\n            if (markAsDirty(this, options)) {\n                trigger2(this, 'sort', this, options);\n            }\n            isRoot && commit(this);\n        }\n        return this;\n    };\n    Collection.prototype.push = function (model, options) {\n        return this.add(model, assign({ at: this.length }, options));\n    };\n    Collection.prototype.pop = function (options) {\n        var model = this.at(this.length - 1);\n        this.remove(model, options);\n        return model;\n    };\n    Collection.prototype.unset = function (modelOrId, options) {\n        var value = this.get(modelOrId);\n        this.remove(modelOrId, __assign({ unset: true }, options));\n        return value;\n    };\n    Collection.prototype.unshift = function (model, options) {\n        return this.add(model, assign({ at: 0 }, options));\n    };\n    Collection.prototype.shift = function (options) {\n        var model = this.at(0);\n        this.remove(model, options);\n        return model;\n    };\n    Collection.prototype.slice = function () {\n        return slice.apply(this.models, arguments);\n    };\n    Collection.prototype.indexOf = function (modelOrId) {\n        var record = this.get(modelOrId);\n        return this.models.indexOf(record);\n    };\n    Collection.prototype.modelId = function (attrs) {\n        return attrs[this.model.prototype.idAttribute];\n    };\n    Collection.prototype.toggle = function (model, a_next) {\n        var prev = Boolean(this.get(model)), next = a_next === void 0 ? !prev : Boolean(a_next);\n        if (prev !== next) {\n            if (prev) {\n                this.remove(model);\n            }\n            else {\n                this.add(model);\n            }\n        }\n        return next;\n    };\n    Collection.prototype._log = function (level, text, value) {\n        tools.log(level, \"[Collection Update] \" + this.model.prototype.getClassName() + \".\" + this.getClassName() + \": \" + text, {\n            Argument: value,\n            'Attributes spec': this.model.prototype._attributes\n        });\n    };\n    Collection.prototype.getClassName = function () {\n        return _super.prototype.getClassName.call(this) || 'Collection';\n    };\n    Collection._attribute = AggregatedType;\n    Collection = Collection_1 = __decorate([\n        define({\n            cidPrefix: 'c',\n            model: Record,\n            _changeEventName: 'changes',\n            _aggregationError: null\n        }),\n        definitions({\n            comparator: mixinRules.value,\n            model: mixinRules.protoValue,\n            itemEvents: mixinRules.merge\n        })\n    ], Collection);\n    return Collection;\n    var Collection_1;\n}(Transactional));\nexport { Collection };\nfunction toElements(collection, elements, options) {\n    var parsed = options.parse ? collection.parse(elements, options) : elements;\n    return Array.isArray(parsed) ? parsed : [parsed];\n}\ncreateSharedTypeSpec(Collection, SharedType);\nRecord.Collection = Collection;\nfunction bindContext(fun, context) {\n    return context !== void 0 ? function (v, k) { return fun.call(context, v, k); } : fun;\n}\nfunction toPredicateFunction(iteratee, context) {\n    if (typeof iteratee === 'object') {\n        return function (x) {\n            for (var key in iteratee) {\n                if (iteratee[key] !== x[key])\n                    return false;\n            }\n            return true;\n        };\n    }\n    return bindContext(iteratee, context);\n}\n//# sourceMappingURL=index.js.map","import { CompiledReference } from '../traversable';\nexport function parseReference(collectionRef) {\n    switch (typeof collectionRef) {\n        case 'function':\n            return function (root) { return collectionRef.call(root); };\n        case 'object':\n            return function () { return collectionRef; };\n        case 'string':\n            var resolve = new CompiledReference(collectionRef).resolve;\n            return resolve;\n    }\n}\n//# sourceMappingURL=commons.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Collection } from '../collection';\nimport { tools, define } from '../object-plus';\nimport { parseReference } from './commons';\nimport { ChainableAttributeSpec } from '../record';\nimport { ItemsBehavior, transactionApi } from '../transactions';\nvar fastDefaults = tools.fastDefaults;\nCollection.subsetOf = function subsetOf(masterCollection) {\n    var SubsetOf = this._SubsetOf || (this._SubsetOf = defineSubsetCollection(this)), getMasterCollection = parseReference(masterCollection), typeSpec = new ChainableAttributeSpec({\n        type: SubsetOf\n    });\n    return typeSpec.get(function (refs) {\n        !refs || refs.resolvedWith || refs.resolve(getMasterCollection(this));\n        return refs;\n    });\n};\nvar subsetOfBehavior = ItemsBehavior.share | ItemsBehavior.persistent;\nfunction defineSubsetCollection(CollectionConstructor) {\n    var SubsetOfCollection = (function (_super) {\n        __extends(SubsetOfCollection, _super);\n        function SubsetOfCollection(recordsOrIds, options) {\n            var _this = _super.call(this, [], options, subsetOfBehavior) || this;\n            _this.resolvedWith = null;\n            _this.refs = toArray(recordsOrIds);\n            return _this;\n        }\n        Object.defineProperty(SubsetOfCollection.prototype, \"__inner_state__\", {\n            get: function () { return this.refs || this.models; },\n            enumerable: true,\n            configurable: true\n        });\n        SubsetOfCollection.prototype.add = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, toAdd = toArray(a_elements);\n            if (resolvedWith) {\n                return _super.prototype.add.call(this, resolveRefs(resolvedWith, toAdd), options);\n            }\n            else {\n                if (toAdd.length) {\n                    var isRoot = transactionApi.begin(this);\n                    this.refs = this.refs ? this.refs.concat(toAdd) : toAdd;\n                    transactionApi.markAsDirty(this, options);\n                    isRoot && transactionApi.commit(this);\n                }\n            }\n        };\n        SubsetOfCollection.prototype.reset = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype.reset.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options) || [];\n        };\n        SubsetOfCollection.prototype._createTransaction = function (a_elements, options) {\n            var resolvedWith = this.resolvedWith, elements = toArray(a_elements);\n            return resolvedWith ?\n                _super.prototype._createTransaction.call(this, resolveRefs(resolvedWith, elements), options) :\n                delaySet(this, elements, options);\n        };\n        SubsetOfCollection.prototype.toJSON = function () {\n            return this.refs ?\n                this.refs.map(function (objOrId) { return objOrId.id || objOrId; }) :\n                this.models.map(function (model) { return model.id; });\n        };\n        SubsetOfCollection.prototype._validateNested = function () { return 0; };\n        SubsetOfCollection.prototype.clone = function (owner) {\n            var Ctor = this.constructor, copy = new Ctor([], {\n                model: this.model,\n                comparator: this.comparator\n            });\n            if (this.resolvedWith) {\n                copy.resolvedWith = this.resolvedWith;\n                copy.reset(this.models, { silent: true });\n            }\n            else {\n                copy.refs = this.refs;\n            }\n            return copy;\n        };\n        SubsetOfCollection.prototype.parse = function (raw) {\n            return raw;\n        };\n        SubsetOfCollection.prototype.resolve = function (collection) {\n            if (collection && collection.length) {\n                this.resolvedWith = collection;\n                if (this.refs) {\n                    this.reset(this.refs, { silent: true });\n                    this.refs = null;\n                }\n            }\n            return this;\n        };\n        SubsetOfCollection.prototype.getModelIds = function () { return this.toJSON(); };\n        SubsetOfCollection.prototype.toggle = function (modelOrId, val) {\n            return _super.prototype.toggle.call(this, this.resolvedWith.get(modelOrId), val);\n        };\n        SubsetOfCollection.prototype.addAll = function () {\n            if (this.resolvedWith) {\n                this.set(this.resolvedWith.models);\n                return this.models;\n            }\n            throw new Error(\"Cannot add elemens because the subset collection is not resolved yet.\");\n        };\n        SubsetOfCollection.prototype.toggleAll = function () {\n            return this.length ? this.reset() : this.addAll();\n        };\n        SubsetOfCollection = __decorate([\n            define\n        ], SubsetOfCollection);\n        return SubsetOfCollection;\n    }(CollectionConstructor));\n    return SubsetOfCollection;\n}\nfunction resolveRefs(master, elements) {\n    var records = [];\n    for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n        var el = elements_1[_i];\n        var record = master.get(el);\n        if (record)\n            records.push(record);\n    }\n    return records;\n}\nfunction delaySet(collection, elements, options) {\n    if (tools.notEqual(collection.refs, elements)) {\n        var isRoot = transactionApi.begin(collection);\n        collection.refs = elements;\n        transactionApi.markAsDirty(collection, options);\n        isRoot && transactionApi.commit(collection);\n    }\n}\nfunction toArray(elements) {\n    return Array.isArray(elements) ? elements : [elements];\n}\n//# sourceMappingURL=subsetOf.js.map","import * as tools from './tools';\nexport { tools };\nexport * from './mixins';\nexport * from './events';\nimport * as eventsApi from './eventsource';\nexport { eventsApi };\nimport { Mixable } from './mixins';\nObject.extend = function (protoProps, staticProps) { return Mixable.extend(protoProps, staticProps); };\nObject.assign || (Object.assign = tools.assign);\nObject.log = tools.log;\n//# sourceMappingURL=index.js.map","var ValidationError = (function () {\n    function ValidationError(obj) {\n        this.length = obj._validateNested(this.nested = {});\n        if (this.error = obj.validate(obj)) {\n            this.length++;\n        }\n    }\n    ValidationError.prototype.each = function (iteratee) {\n        var _a = this, error = _a.error, nested = _a.nested;\n        if (error)\n            iteratee(error, null);\n        for (var key in nested) {\n            iteratee(nested[key], key);\n        }\n    };\n    ValidationError.prototype.eachError = function (iteratee, object) {\n        this.each(function (value, key) {\n            if (value instanceof ValidationError) {\n                value.eachError(iteratee, object.get(key));\n            }\n            else {\n                iteratee(value, key, object);\n            }\n        });\n    };\n    return ValidationError;\n}());\nexport { ValidationError };\n//# sourceMappingURL=validation.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Messenger, tools, mixins, eventsApi, define } from './object-plus';\nimport { ValidationError } from './validation';\nimport { resolveReference } from './traversable';\nvar assign = tools.assign, trigger2 = eventsApi.trigger2, trigger3 = eventsApi.trigger3, on = eventsApi.on, off = eventsApi.off;\nexport var ItemsBehavior;\n(function (ItemsBehavior) {\n    ItemsBehavior[ItemsBehavior[\"share\"] = 1] = \"share\";\n    ItemsBehavior[ItemsBehavior[\"listen\"] = 2] = \"listen\";\n    ItemsBehavior[ItemsBehavior[\"persistent\"] = 4] = \"persistent\";\n})(ItemsBehavior || (ItemsBehavior = {}));\nvar Transactional = (function () {\n    function Transactional(cid) {\n        this._events = void 0;\n        this._changeToken = {};\n        this._transaction = false;\n        this._isDirty = null;\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this._validationError = void 0;\n        this.cid = this.cidPrefix + cid;\n    }\n    Transactional_1 = Transactional;\n    Transactional.onExtend = function (BaseClass) {\n        if (BaseClass.create === this.create) {\n            this.create = Transactional_1.create;\n        }\n    };\n    Transactional.create = function (a, b) {\n        return new this(a, b);\n    };\n    Transactional.prototype.dispose = function () {\n        if (this._disposed)\n            return;\n        this._owner = void 0;\n        this._ownerKey = void 0;\n        this.off();\n        this.stopListening();\n        this._disposed = true;\n    };\n    Transactional.prototype.initialize = function () { };\n    Transactional.prototype.onChanges = function (handler, target) {\n        on(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.offChanges = function (handler, target) {\n        off(this, this._changeEventName, handler, target);\n    };\n    Transactional.prototype.listenToChanges = function (target, handler) {\n        this.listenTo(target, target._changeEventName, handler);\n    };\n    Transactional.prototype.transaction = function (fun, options) {\n        if (options === void 0) { options = {}; }\n        var isRoot = transactionApi.begin(this);\n        var update = fun.call(this, this);\n        update && this.set(update);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.updateEach = function (iteratee, options) {\n        var isRoot = transactionApi.begin(this);\n        this.each(iteratee);\n        isRoot && transactionApi.commit(this);\n    };\n    Transactional.prototype.set = function (values, options) {\n        if (values) {\n            var transaction = this._createTransaction(values, options);\n            transaction && transaction.commit();\n        }\n        return this;\n    };\n    Transactional.prototype.assignFrom = function (source) {\n        return this.set(source.__inner_state__ || source, { merge: true });\n    };\n    Transactional.prototype.parse = function (data, options) { return data; };\n    Transactional.prototype.deepGet = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.get ? object.get(key) : object[key]; });\n    };\n    Transactional.prototype.getOwner = function () {\n        return this._owner;\n    };\n    Transactional.prototype.getStore = function () {\n        var _owner = this._owner;\n        return _owner ? _owner.getStore() : this._defaultStore;\n    };\n    Transactional.prototype.map = function (iteratee, context) {\n        var arr = [], fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = fun(val, key);\n            if (result !== void 0)\n                arr.push(result);\n        });\n        return arr;\n    };\n    Transactional.prototype.mapObject = function (iteratee, context) {\n        var obj = {}, fun = context !== void 0 ? function (v, k) { return iteratee.call(context, v, k); } : iteratee;\n        this.each(function (val, key) {\n            var result = iteratee(val, key);\n            if (result !== void 0)\n                obj[key] = result;\n        });\n        return obj;\n    };\n    Object.defineProperty(Transactional.prototype, \"validationError\", {\n        get: function () {\n            var error = this._validationError || (this._validationError = new ValidationError(this));\n            return error.length ? error : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Transactional.prototype.validate = function (obj) { };\n    Transactional.prototype.getValidationError = function (key) {\n        var error = this.validationError;\n        return (key ? error && error.nested[key] : error) || null;\n    };\n    Transactional.prototype.deepValidationError = function (reference) {\n        return resolveReference(this, reference, function (object, key) { return object.getValidationError(key); });\n    };\n    Transactional.prototype.eachValidationError = function (iteratee) {\n        var validationError = this.validationError;\n        validationError && validationError.eachError(iteratee, this);\n    };\n    Transactional.prototype.isValid = function (key) {\n        return !this.getValidationError(key);\n    };\n    Transactional.prototype.valueOf = function () { return this.cid; };\n    Transactional.prototype.toString = function () { return this.cid; };\n    Transactional.prototype.getClassName = function () {\n        var name = this.constructor.name;\n        if (name !== 'Subclass')\n            return name;\n    };\n    Transactional = Transactional_1 = __decorate([\n        define,\n        mixins(Messenger)\n    ], Transactional);\n    return Transactional;\n    var Transactional_1;\n}());\nexport { Transactional };\nexport var transactionApi = {\n    begin: function (object) {\n        return object._transaction ? false : (object._transaction = true);\n    },\n    markAsDirty: function (object, options) {\n        var dirty = !options.silent;\n        if (dirty)\n            object._isDirty = options;\n        object._changeToken = {};\n        object._validationError = void 0;\n        return dirty;\n    },\n    commit: function (object, initiator) {\n        var originalOptions = object._isDirty;\n        if (originalOptions) {\n            while (object._isDirty) {\n                var options = object._isDirty;\n                object._isDirty = null;\n                trigger3(object, object._changeEventName, object, options, initiator);\n            }\n            object._transaction = false;\n            var _owner = object._owner;\n            if (_owner && _owner !== initiator) {\n                _owner._onChildrenChange(object, originalOptions);\n            }\n        }\n        else {\n            object._isDirty = null;\n            object._transaction = false;\n        }\n    },\n    aquire: function (owner, child, key) {\n        if (!child._owner) {\n            child._owner = owner;\n            child._ownerKey = key;\n            return true;\n        }\n        return child._owner === owner;\n    },\n    free: function (owner, child) {\n        if (owner === child._owner) {\n            child._owner = void 0;\n            child._ownerKey = void 0;\n        }\n    }\n};\n//# sourceMappingURL=transactions.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AnyType } from './any';\nimport { transactionApi, ItemsBehavior } from '../../transactions';\nvar free = transactionApi.free, aquire = transactionApi.aquire;\nvar AggregatedType = (function (_super) {\n    __extends(AggregatedType, _super);\n    function AggregatedType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    AggregatedType.prototype.clone = function (value) {\n        return value ? value.clone() : value;\n    };\n    AggregatedType.prototype.toJSON = function (x) { return x && x.toJSON(); };\n    AggregatedType.prototype.doInit = function (value, record, options) {\n        var v = options.clone ? this.clone(value) : (value === void 0 ? this.defaultValue() : value);\n        var x = this.transform(v, void 0, record, options);\n        this.handleChange(x, void 0, record, options);\n        return x;\n    };\n    AggregatedType.prototype.doUpdate = function (value, record, options, nested) {\n        var key = this.name, attributes = record.attributes;\n        var prev = attributes[key];\n        var update;\n        if (update = this.canBeUpdated(prev, value, options)) {\n            var nestedTransaction = prev._createTransaction(update, options);\n            if (nestedTransaction) {\n                if (nested) {\n                    nested.push(nestedTransaction);\n                }\n                else {\n                    nestedTransaction.commit(record);\n                }\n                if (this.propagateChanges)\n                    return true;\n            }\n            return false;\n        }\n        var next = this.transform(value, prev, record, options);\n        attributes[key] = next;\n        if (this.isChanged(next, prev)) {\n            this.handleChange(next, prev, record, options);\n            return true;\n        }\n        return false;\n    };\n    AggregatedType.prototype.canBeUpdated = function (prev, next, options) {\n        if (prev && next != null) {\n            if (next instanceof this.type) {\n                if (options.merge)\n                    return next.__inner_state__;\n            }\n            else {\n                return next;\n            }\n        }\n    };\n    AggregatedType.prototype.convert = function (next, prev, record, options) {\n        if (next == null)\n            return next;\n        if (next instanceof this.type) {\n            if (next._shared && !(next._shared & ItemsBehavior.persistent)) {\n                this._log('error', 'aggregated collection attribute is assigned with shared collection', next, record);\n            }\n            return options.merge ? next.clone() : next;\n        }\n        return this.type.create(next, options);\n    };\n    AggregatedType.prototype.dispose = function (record, value) {\n        if (value) {\n            this.handleChange(void 0, value, record, {});\n        }\n    };\n    AggregatedType.prototype.validate = function (record, value) {\n        var error = value && value.validationError;\n        if (error)\n            return error;\n    };\n    AggregatedType.prototype.create = function () {\n        return this.type.create();\n    };\n    AggregatedType.prototype.initialize = function (options) {\n        options.changeHandlers.unshift(this._handleChange);\n    };\n    AggregatedType.prototype._handleChange = function (next, prev, record) {\n        if (prev) {\n            free(record, prev);\n            prev.dispose();\n        }\n        if (next && !aquire(record, next, this.name)) {\n            this._log('error', 'aggregated attribute assigned with object already having an owner', next, record);\n        }\n    };\n    return AggregatedType;\n}(AnyType));\nexport { AggregatedType };\n//# sourceMappingURL=owned.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { AnyType } from '../record';\nimport { parseReference } from './commons';\nimport { Record } from '../record';\nimport { ChainableAttributeSpec } from '../record';\nvar RecordRefType = (function (_super) {\n    __extends(RecordRefType, _super);\n    function RecordRefType() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RecordRefType.prototype.toJSON = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.clone = function (value) {\n        return value && typeof value === 'object' ? value.id : value;\n    };\n    RecordRefType.prototype.isChanged = function (a, b) {\n        var aId = a && (a.id == null ? a : a.id), bId = b && (b.id == null ? b : b.id);\n        return aId !== bId;\n    };\n    RecordRefType.prototype.validate = function (model, value, name) { };\n    return RecordRefType;\n}(AnyType));\nRecord.from = function from(masterCollection) {\n    var getMasterCollection = parseReference(masterCollection);\n    var typeSpec = new ChainableAttributeSpec({\n        value: null,\n        _attribute: RecordRefType\n    });\n    return typeSpec\n        .get(function (objOrId, name) {\n        if (typeof objOrId === 'object')\n            return objOrId;\n        var collection = getMasterCollection(this);\n        var record = null;\n        if (collection && collection.length) {\n            record = collection.get(objOrId) || null;\n            this.attributes[name] = record;\n            record && this._attributes[name].handleChange(record, null, this, {});\n        }\n        return record;\n    });\n};\n//# sourceMappingURL=from.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Record } from '../record';\nimport { Transactional } from '../transactions';\nvar _store = null;\nvar Store = (function (_super) {\n    __extends(Store, _super);\n    function Store() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Store.prototype.getStore = function () { return this; };\n    Store.prototype.get = function (name) {\n        var local = this[name];\n        if (local || this === this._defaultStore)\n            return local;\n        return this._owner ? this._owner.get(name) : this._defaultStore.get(name);\n    };\n    Object.defineProperty(Store, \"global\", {\n        get: function () { return _store; },\n        set: function (store) {\n            if (_store) {\n                _store.dispose();\n            }\n            Transactional.prototype._defaultStore = _store = store;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Store;\n}(Record));\nexport { Store };\nStore.global = new Store();\n//# sourceMappingURL=store.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nexport * from './object-plus';\nexport * from './collection';\nexport * from './relations';\nexport * from './record';\nimport { Events } from './object-plus/';\nexport var on = (_a = Events, _a.on), off = _a.off, trigger = _a.trigger, once = _a.once, listenTo = _a.listenTo, stopListening = _a.stopListening, listenToOnce = _a.listenToOnce;\nimport { Record as Model } from './record';\nimport { define, Mixable as Class } from './object-plus/';\nexport { Model, Class };\nexport function attributes(attrDefs) {\n    var DefaultRecord = (function (_super) {\n        __extends(DefaultRecord, _super);\n        function DefaultRecord() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        DefaultRecord.attributes = attrDefs;\n        DefaultRecord = __decorate([\n            define\n        ], DefaultRecord);\n        return DefaultRecord;\n    }(Model));\n    return DefaultRecord;\n}\nimport { ChainableAttributeSpec } from './record';\nexport function value(x) {\n    return new ChainableAttributeSpec({ value: x });\n}\nexport function transaction(method) {\n    return function () {\n        var _this = this;\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var result;\n        this.transaction(function () {\n            result = method.apply(_this, args);\n        });\n        return result;\n    };\n}\nvar _a;\n//# sourceMappingURL=index.js.map"],"names":["isValidJSON","value","proto","Object","getPrototypeOf","prototype","Array","every","getBaseClass","Class","constructor","isEmpty","obj","key","hasOwnProperty","someArray","arr","fun","result","i","length","someObject","some","ArrayProto","predicate","x","omit","source","dest","discard","arguments","name","transform","assign","other","defaults","once","func","memo","first","apply","this","notEqual","a","b","protoA","DateProto","arraysNotEqual","ObjectProto","objectsNotEqual","keysA","keys","predefine","Constructor","BaseClass","__super__","define","MixinsState","get","Mixable","populate","onExtend","ClassOrDefinition","Ctor","definitions","rules","mixins","definitionRules","definitionDecorator","definitionKey","mergeObject","_a","_b","forEachOwnProp","object","ignore","dontMix","_i","getOwnPropertyNames","name_2","assignProperty","sourceProp","rule","unshift","resolveRule","defineProperty","getBubblingHandler","event","_bubblingHandlers","c","d","e","trigger5","trigger3","trigger2","listOff","_events","callback","context","filteredHead","prev","head","ev","next","_callback","listSend2","call","listSend3","listSend4","listSend5","listSend6","f","on","create","EventHandler","once_1","_once","off","name_3","strings","api","events","eventSplitter","test","names_1","split","self","queue","all","uniqueId","_idCount","toPropertyDescriptor","addReference","listener","_listeningTo","cid","resolveReference","root","reference","action","path","match","referenceMask","skip","getStore","getOwner","setAttribute","record","isRoot","begin","options","_attributes","doUpdate","markAsDirty","attributes","commit","_begin","_previousAttributes","AttributesCopy","_changedAttributes","_markAsDirty","constructorsMixin","attrDefs","attrs","Function","map","attr","join","Attributes","shouldBeAnObject","values","_log","chainGetHooks","prevHook","nextHook","chainTransforms","prevTransform","nextTransform","chainChangeHandlers","prevHandler","nextHandler","wrapIsRequired","validate","emptyFunction","toAttributeOptions","spec","attrSpec","has","ChainableAttributeSpec","type","inferType","Transactional","shared","hasCustomDefault","Number","String","Boolean","supportsDate","date","isNaN","Date","getTime","safeParseDate","timestamp","struct","minutesOffset","isoDatePattern","exec","k","numericKeys","undefined","UTC","parse","Integer","Math","round","doNothing","createAttribute","AnyType","parseMixin","attrsWithParse","filter","_parse","createToJSON","toJSON","createSharedTypeSpec","Attribute","_attribute","localEventsMixin","attrSpecs","_localEvents","_onChange","eventsApi.EventMap","addEvent","createWatcherFromRef","wrapWatcher","watcher","ref","CompiledReference","local","resolve","tail","typeCheck","unknown","push","getAttributes","idAttribute","definition","dispose","collection","models","_byId","freeAll","convertAndAquire","model","_shared","ItemsBehavior","listen","_changeEventName","_onChildrenChange","merge","clone","_aquire","_aggregationError","_itemEvents","subscribe","free","owner","child","unset","_free","unsubscribe","children","children_1","sortElements","_comparator","sort","addIndex","index","id","removeIndex","updateIndex","previous","logAggregationError","addTransaction","items","nested","added","appendElements","needSort","sortOrMoveElements","CollectionTransaction","at","length_1","moveElements","j","a_items","a_options","forceMerge","prevLength","a_items_1","item","transaction","_createTransaction","hasChanged","slice","emptySetTransaction","silent","_reallocateEmpty","silentOptions","setTransaction","_reallocate","reusedCount","removed","_garbageCollect","addedOrChanged","sorted","previous_1","_prevById","prevModels","toAdd","orderKept","len","src","removeOne","el","splice","indexOf","notify","removeMany","toRemove","_removeFromIndex","toElements","elements","parsed","isArray","bindContext","v","toPredicateFunction","iteratee","parseReference","collectionRef","defineSubsetCollection","CollectionConstructor","_super","SubsetOfCollection","recordsOrIds","_this","subsetOfBehavior","resolvedWith","refs","toArray","__extends","enumerable","configurable","add","a_elements","resolveRefs","transactionApi","concat","reset","delaySet","objOrId","_validateNested","copy","comparator","raw","getModelIds","toggle","modelOrId","val","addAll","set","Error","toggleAll","__decorate","master","records","elements_1","tools.notEqual","levelToNumber","none","error","warn","info","log","debug","a_level","a_msg","a_props","msg","props","level","levelAsNumber","throw","logger","stop","process","env","NODE_ENV","console","args","name_1","setPrototypeOf","names","prop","desc","getOwnPropertyDescriptor","o","extendStatics","__proto__","p","__","__rest","s","t","getOwnPropertySymbols","protoProps","staticProps","defineMixin","getStaticDefinitions","onDefine","mergeInheritedMembers","extend","statics","TheSubclass","Subclass","mergeRules","appliedMixins","mixins_1","mixin","sourceMixins","ctors","ctors_1","mixinRules","protoValue","baseProto","function","caller","list","pipe","classFirst","classLast","EventMap","handlers","addEventsMap","bubbleEvents","EventDescriptor","target","event_1","event_2","handler","decorators","r","Reflect","decorate","_eventsApi.strings","_eventsApi.on","_eventsApi.off","_eventsApi.once","_eventsApi.trigger5","_eventsApi.trigger2","_eventsApi.trigger3","Messenger","initialize","localEvents","properties","eventsMap","defineProperties","trigger","listenTo","listenToOnce","stopListening","a_source","removeAll","second","_disposed","Events","tools.assign","tools.log","ValidationError","each","eachError","splitTail","substr","pop","eventsApi.trigger3","eventsApi.on","eventsApi.off","_changeToken","_transaction","_isDirty","_owner","_ownerKey","_validationError","cidPrefix","Transactional_1","onChanges","offChanges","listenToChanges","update","updateEach","assignFrom","__inner_state__","data","deepGet","_defaultStore","mapObject","getValidationError","validationError","deepValidationError","eachValidationError","isValid","valueOf","toString","getClassName","dirty","initiator","originalOptions","aquire","UpdateRecordMixin","attribute","propagateChanges","forceAttributeChange","a_values","changes","RecordTransaction","nested_1","nested_2","changes_1","emptyOptions","getHook","getHooks","transforms","changeHandlers","changeEvents","defaultValue","tools.isValidJSON","JSON","stringify","isRequired","convert","getHook_1","reduce","validate_1","handleChange","canBeUpdated","isChanged","createPropertyDescriptor","doInit","text","Record","Attribute definition","Prev. value","New value","AggregatedType","nestedTransaction","persistent","_handleChange","check","metadata","changed","eventMap","cloned","_isRequired","asProp","_has","DateType","toISOString","msDatePattern","MSDateType","msDate","TimestampType","microsoft","ImmutableClassType","PrimitiveType","NumericType","num","isFinite","integer","window","ArrayType","ObjectType","FunctionType","shareAndListen","share","SharedType","implicitObject","__assign","n","attributesDefinition","baseClassAttributes","myAttributes","_.transform","allAttributes","_.defaults","ConstructorsMixin","_attributesArray","_toJSON","tools.isEmpty","_cidCounter","previousAttributes","changedAttributes","diff","old","isNew","clear","nullify","forEachAttr","pinStore","deepClone","errors","json","asJson","deepSet","l","newModel","Attributes definition:","Collection","BaseRecordAttributes","BaseRecordAttributesCopy","IdAttribute","tools.defaults","DefaultCollection","compile","dynamicMixin","eventsApi.trigger2","_c","_d","added_1","_e","removed_1","_count","CollectionRefsType","createSubset","subset","SubsetOf","subsetOf","RefsCollection","_SubsetOf","Refs","Subset","itemEvents","aa","bb","_store","find","mapped","count","last","a_index","aggregated","previousModels","remove","pluck","shift","modelId","a_next","Argument","Attributes spec","RecordRefType","from","masterCollection","getMasterCollection","Store","store","global","DefaultRecord","Model","method","attrName","getMetadata"],"mappings":"yLAwCA,SAAgBA,EAAYC,GACxB,GAAc,OAAVA,EACA,OAAO,EAEX,cAAeA,GACX,IAAK,SACL,IAAK,SACL,IAAK,UACD,OAAO,EACX,IAAK,SACD,IAAIC,EAAQC,OAAOC,eAAeH,GAClC,GAAIC,IAAUC,OAAOE,WAAaH,IAAUI,MAAMD,UAC9C,OAAOE,EAAMN,EAAOD,GAGhC,OAAO,EAEX,SAAgBQ,EAAaC,GACzB,OAAON,OAAOC,eAAeK,EAAMJ,WAAWK,YAalD,SAAgBC,EAAQC,GACpB,GAAIA,EACA,IAAK,IAAIC,KAAOD,EACZ,GAAIA,EAAIE,eAAeD,GACnB,OAAO,EAInB,OAAO,EAEX,SAASE,EAAUC,EAAKC,GAEpB,IAAK,IADDC,EACKC,EAAI,EAAGA,EAAIH,EAAII,OAAQD,IAC5B,GAAID,EAASD,EAAID,EAAIG,GAAIA,GACrB,OAAOD,EAInB,SAASG,EAAWT,EAAKK,GACrB,IAAIC,EACJ,IAAK,IAAIL,KAAOD,EACZ,GAAIA,EAAIE,eAAeD,KACfK,EAASD,EAAIL,EAAIC,GAAMA,IACvB,OAAOK,EAKvB,SAAgBI,EAAKV,EAAKK,GACtB,OAAId,OAAOC,eAAeQ,KAASW,GACxBR,EAAUH,EAAKK,GAGfI,EAAWT,EAAKK,GAG/B,SAAgBV,EAAMK,EAAKY,GACvB,OAAQF,EAAKV,EAAK,SAAUa,GAAK,OAAQD,EAAUC,KASvD,SAAgBC,EAAKC,GAEjB,IAAK,IADDC,KAAWC,KACNV,EAAI,EAAGA,EAAIW,UAAUV,OAAQD,IAClCU,EAAQC,UAAUX,KAAM,EAE5B,IAAK,IAAIY,KAAQJ,GACRE,EAAQf,eAAeiB,IAASJ,EAAOb,eAAeiB,KACvDH,EAAKG,GAAQJ,EAAOI,IAG5B,OAAOH,EAEX,SAAgBI,EAAUJ,EAAMD,EAAQV,GACpC,IAAK,IAAIc,KAAQJ,EACb,GAAIA,EAAOb,eAAeiB,GAAO,CAC7B,IAAI9B,EAAQgB,EAAIU,EAAOI,GAAOA,QACpB,IAAV9B,IAAqB2B,EAAKG,GAAQ9B,GAG1C,OAAO2B,EAgBX,SAAgBK,EAAOL,EAAMD,GACzB,IAAK,IAAII,KAAQJ,EACTA,EAAOb,eAAeiB,KACtBH,EAAKG,GAAQJ,EAAOI,IAG5B,GAAID,UAAUV,OAAS,EACnB,IAAK,IAAID,EAAI,EAAGA,EAAIW,UAAUV,OAAQD,IAAK,CACvC,IAAIe,EAAQJ,UAAUX,GACtBe,GAASD,EAAOL,EAAMM,GAG9B,OAAON,EAEX,SAAgBO,EAASP,EAAMD,GAC3B,IAAK,IAAII,KAAQJ,EACTA,EAAOb,eAAeiB,KAAUH,EAAKd,eAAeiB,KACpDH,EAAKG,GAAQJ,EAAOI,IAG5B,GAAID,UAAUV,OAAS,EACnB,IAAK,IAAID,EAAI,EAAGA,EAAIW,UAAUV,OAAQD,IAAK,CACvC,IAAIe,EAAQJ,UAAUX,GACtBe,GAASC,EAASP,EAAMM,GAGhC,OAAON,EAMX,SAAgBQ,EAAKC,GACjB,IAAIC,EAAMC,GAAQ,EAClB,OAAO,WAMH,OALIA,IACAA,GAAQ,EACRD,EAAOD,EAAKG,MAAMC,KAAMX,WACxBO,EAAO,MAEJC,GAIf,SAAgBI,EAASC,EAAGC,GACxB,GAAID,IAAMC,EACN,OAAO,EACX,GAAID,GAAKC,GAAiB,iBAALD,GAA6B,iBAALC,EAAe,CACxD,IAAIC,EAAS1C,OAAOC,eAAeuC,GACnC,GAAIE,IAAW1C,OAAOC,eAAewC,GACjC,OAAO,EACX,OAAQC,GACJ,KAAKC,GAAW,OAAQH,IAAOC,EAC/B,KAAKrB,GAAY,OAAOwB,EAAeJ,EAAGC,GAC1C,KAAKI,GACL,KAAK,KACD,OAAOC,EAAgBN,EAAGC,IAGtC,OAAO,EAEX,SAASK,EAAgBN,EAAGC,GACxB,IAAIM,EAAQ/C,OAAOgD,KAAKR,GACxB,GAAIO,EAAM9B,SAAWjB,OAAOgD,KAAKP,GAAGxB,OAChC,OAAO,EACX,IAAK,IAAID,EAAI,EAAGA,EAAI+B,EAAM9B,OAAQD,IAAK,CACnC,IAAIN,EAAMqC,EAAM/B,GAChB,IAAKyB,EAAE9B,eAAeD,IAAQ6B,EAASC,EAAE9B,GAAM+B,EAAE/B,IAC7C,OAAO,EAGf,OAAO,EAEX,SAASkC,EAAeJ,EAAGC,GACvB,GAAID,EAAEvB,SAAWwB,EAAExB,OACf,OAAO,EACX,IAAK,IAAID,EAAI,EAAGA,EAAIwB,EAAEvB,OAAQD,IAC1B,GAAIuB,EAASC,EAAExB,GAAIyB,EAAEzB,IACjB,OAAO,EAEf,OAAO,EChLX,SACgBiC,EAAUC,GACtB,IAAIC,EAAY9C,EAAa6C,GAC7BA,EAAYE,UAAYD,EAAUjD,UAClCgD,EAAYG,QAAUC,GAAYC,IAAIC,IAASC,SAASP,GACxDI,GAAYC,IAAIL,GAChBA,EAAYQ,UAAYR,EAAYQ,SAASP,GAEjD,SAAgBE,EAAOM,GACnB,GAAiC,mBAAtBA,EAKP,OAAO,SAAUC,GACbX,EAAUW,GACVA,EAAKP,OAAOM,IANhBV,EAAUU,GACVA,EAAkBN,SAS1B,SAAgBQ,EAAYC,GACxB,OAAO,SAAUxD,GACb,IAAIyD,EAAST,GAAYC,IAAIjD,GAC7ByD,EAAOC,gBAAkBhC,EAAS8B,EAAOC,EAAOC,kBAGxD,SAAgBC,EAAoBC,EAAepE,GAC/C,OAAO,SAAUC,EAAO6B,GACpB0B,GACKC,IAAIxD,EAAMQ,aACV4D,YAAYpE,GAAQqE,KACrBA,EAAGF,IAAkBG,KACjBA,EAAGzC,GAAQ9B,EACXuE,GACJD,IACJ,IAAIA,EAAIC,GAyGhB,SAASC,EAAeC,EAAQzD,GAE5B,IAAK,IADD0D,EAASC,UAAeF,GACnBG,EAAK,EAAGN,EAAKpE,OAAO2E,oBAAoBJ,GAASG,EAAKN,EAAGnD,OAAQyD,IAAM,CAC5E,IAAIE,EAASR,EAAGM,GAChBE,KAAUJ,GAAU1D,EAAI8D,IAqChC,SAASC,EAAepD,EAAMG,EAAMkD,EAAYC,EAAMC,GAC9CvD,EAAKd,eAAeiB,GACpBH,EAAKG,GAAQoD,EACTC,EAAYH,EAAWhF,MAAO2B,EAAKG,GAAOmD,GAC1CE,EAAYxD,EAAKG,GAAOkD,EAAWhF,MAAOiF,GAG9C/E,OAAOkF,eAAezD,EAAMG,EAAMkD,GAG1C,SAASG,EAAYxD,EAAMD,EAAQuD,GAC/B,YAAa,IAATtD,EACOD,EACNuD,QAAmB,IAAXvD,EAENuD,EAAKtD,EAAMD,GADPC,ECrLf,SAAS0D,EAAmBC,GACxB,OAAOC,GAAkBD,KAAWC,GAAkBD,GAAS,SAAU5C,EAAGC,EAAG6C,EAAGC,EAAGC,QACvE,IAAND,QAAsB,IAANC,GAChBC,EAASnD,KAAM8C,EAAO5C,EAAGC,EAAG6C,EAAGC,EAAGC,QAC5B,IAANF,EACAI,EAASpD,KAAM8C,EAAO5C,EAAGC,EAAG6C,GAE5BK,EAASrD,KAAM8C,EAAO5C,EAAGC,KAYrC,SACSmD,EAAQC,EAASjE,EAAMkE,EAAUC,GAGtC,IAAK,IADDC,EAAcC,EADdC,EAAOL,EAAQjE,GAEVuE,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KACvBN,GAAYA,IAAaK,EAAGL,UAAYA,IAAaK,EAAGL,SAASO,WACjEN,GAAWA,IAAYI,EAAGJ,SAC3BE,EAAOE,EACPH,IAAiBA,EAAeG,IAG5BF,IACAA,EAAKG,KAAOD,EAAGC,MAGvBF,IAASF,IACTH,EAAQjE,GAAQoE,GAExB,SAASM,EAAUJ,EAAM1D,EAAGC,GACxB,IAAK,IAAI0D,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KAC5BD,EAAGL,SAASS,KAAKJ,EAAGJ,QAASvD,EAAGC,GAExC,SAAS+D,EAAUN,EAAM1D,EAAGC,EAAG6C,GAC3B,IAAK,IAAIa,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KAC5BD,EAAGL,SAASS,KAAKJ,EAAGJ,QAASvD,EAAGC,EAAG6C,GAE3C,SAASmB,EAAUP,EAAM1D,EAAGC,EAAG6C,EAAGC,GAC9B,IAAK,IAAIY,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KAC5BD,EAAGL,SAASS,KAAKJ,EAAGJ,QAASvD,EAAGC,EAAG6C,EAAGC,GAE9C,SAASmB,EAAUR,EAAM1D,EAAGC,EAAG6C,EAAGC,EAAGC,GACjC,IAAK,IAAIW,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KAC5BD,EAAGL,SAASS,KAAKJ,EAAGJ,QAASvD,EAAGC,EAAG6C,EAAGC,EAAGC,GAEjD,SAASmB,EAAUT,EAAM1D,EAAGC,EAAG6C,EAAGC,EAAGC,EAAGoB,GACpC,IAAK,IAAIT,EAAKD,EAAMC,EAAIA,EAAKA,EAAGC,KAC5BD,EAAGL,SAASS,KAAKJ,EAAGJ,QAASvD,EAAGC,EAAG6C,EAAGC,EAAGC,EAAGoB,GAEpD,SAAgBC,EAAGrF,EAAQI,EAAMkE,EAAUC,GACvC,GAAID,EAAU,CACV,IAAID,EAAUrE,EAAOqE,UAAYrE,EAAOqE,QAAU7F,OAAO8G,OAAO,OAChEjB,EAAQjE,GAAQ,IAAImF,GAAajB,EAAUC,EAASF,EAAQjE,KAGpE,SAAgBK,EAAKT,EAAQI,EAAMkE,EAAUC,GACzC,GAAID,EAAU,CACV,IAAIkB,EAASC,EAAM,WACfC,EAAI1F,EAAQI,EAAMoF,GAClBlB,EAASzD,MAAMC,KAAMX,aAEzBqF,EAAOX,UAAYP,EACnBe,EAAGrF,EAAQI,EAAMoF,EAAQjB,IAGjC,SAAgBmB,EAAI1F,EAAQI,EAAMkE,EAAUC,GACxC,IAAIF,EAAUrE,EAAOqE,QACrB,GAAIA,EACA,GAAIC,GAAYC,EACZ,GAAInE,EACAgE,EAAQC,EAASjE,EAAMkE,EAAUC,QAGjC,IAAK,IAAIoB,KAAUtB,EACfD,EAAQC,EAASsB,EAAQrB,EAAUC,QAItCnE,EACLiE,EAAQjE,QAAQ,EAGhBJ,EAAOqE,aAAU,EAK7B,SAAgBuB,EAAQC,EAAK7F,EAAQ8F,EAAQxB,EAAUC,GACnD,GAAIwB,GAAcC,KAAKF,GAEnB,IAAK,IAAI5C,EAAK,EAAG+C,EADLH,EAAOI,MAAMH,IACS7C,EAAK+C,EAAQxG,OAAQyD,IAEnD2C,EAAI7F,EADSiG,EAAQ/C,GACDoB,EAAUC,QAIlCsB,EAAI7F,EAAQ8F,EAAQxB,EAAUC,GAEtC,SAAgBJ,EAASgC,EAAM/F,EAAMY,EAAGC,GACpC,IAAIoD,EAAU8B,EAAK9B,QACnB,GAAIA,EAAS,CACT,IAAI+B,EAAQ/B,EAAQjE,GAAOiG,EAAMhC,EAAQgC,IACzCvB,EAAUsB,EAAOpF,EAAGC,GACpB+D,EAAUqB,EAAKjG,EAAMY,EAAGC,IAIhC,SAAgBiD,EAASiC,EAAM/F,EAAMY,EAAGC,EAAG6C,GACvC,IAAIO,EAAU8B,EAAK9B,QACnB,GAAIA,EAAS,CACT,IAAI+B,EAAQ/B,EAAQjE,GAAOiG,EAAMhC,EAAQgC,IACzCrB,EAAUoB,EAAOpF,EAAGC,EAAG6C,GACvBmB,EAAUoB,EAAKjG,EAAMY,EAAGC,EAAG6C,IAInC,SAAgBG,EAASkC,EAAM/F,EAAMY,EAAGC,EAAG6C,EAAGC,EAAGC,GAC7C,IAAIK,EAAU8B,EAAK9B,QACnB,GAAIA,EAAS,CACT,IAAI+B,EAAQ/B,EAAQjE,GAAOiG,EAAMhC,EAAQgC,IACzCnB,EAAUkB,EAAOpF,EAAGC,EAAG6C,EAAGC,EAAGC,GAC7BmB,EAAUkB,EAAKjG,EAAMY,EAAGC,EAAG6C,EAAGC,EAAGC,IC1LzC,SAASsC,IACL,MAAO,IAAMC,KA+GjB,SAASC,EAAqB1G,GAC1B,GAAIA,EACA,MAAoB,mBAANA,GAAqBiC,IAAKjC,GAAMA,EAGtD,SAAS2G,EAAaC,EAAU1G,IACV0G,EAASC,eAAiBD,EAASC,aAAenI,OAAO8G,OAAO,QAActF,EAAO4G,MAAQ5G,EAAO4G,IAAMN,MACzGtG,EChHvB,SACgB6G,EAAiBC,EAAMC,EAAWC,GAG9C,IAAK,IAFDC,EAAOF,EAAUG,MAAMC,IAAgBC,EAAOH,EAAKxH,OAAS,EAC5D0G,EAAOW,EACFtH,EAAI,EAAGA,EAAI4H,EAAM5H,IAAK,CAC3B,IAAIN,EAAM+H,EAAKzH,GACf,OAAQN,GACJ,IAAK,IACDiH,EAAOA,EAAKkB,WACZ,MACJ,IAAK,IACDlB,EAAOA,EAAKmB,WACZ,MACJ,QAASnB,EAAOA,EAAKpE,IAAI7C,GAE7B,IAAKiH,EACD,OAER,OAAOa,EAAOb,EAAMc,EAAKG,IClC7B,SAAgBG,EAAaC,EAAQpH,EAAM9B,GACvC,IAAImJ,EAASC,EAAMF,GAASG,KACxBH,EAAOI,YAAYxH,GAAMyH,SAASvJ,EAAOkJ,EAAQG,KACjDG,EAAYN,EAAQG,GACpBzD,GAASsD,EAAQ,UAAYpH,EAAMoH,EAAQA,EAAOO,WAAW3H,GAAOuH,IAExEF,GAAUO,GAAOR,GAErB,SAASE,EAAMF,GACX,QAAIS,GAAOT,KACPA,EAAOU,oBAAsB,IAAIV,EAAOW,eAAeX,EAAOO,YAC9DP,EAAOY,mBAAqB,MACrB,GAIf,SAASN,EAAYN,EAAQG,GAIzB,OAHIH,EAAOY,qBACPZ,EAAOY,mBAAqB,MAEzBC,GAAab,EAAQG,GAoDhC,SAAgBW,EAAkBC,GAC9B,IAAIC,EAAQhK,OAAOgD,KAAK+G,GACpBJ,EAAiB,IAAIM,SAAS,SAAU,aAAeD,EAAME,IAAI,SAAUC,GAAQ,MAAO,sBAAwBA,EAAO,aAAeA,EAAO,gBAAkBC,KAAK,IAAM,UAChLT,EAAezJ,UAAYF,OAAOE,UAClC,IAAImK,EAAa,IAAIJ,SAAS,SAAU,SAAU,UAAW,yDAA2DD,EAAME,IAAI,SAAUC,GAAQ,MAAO,sBAAwBA,EAAO,aAAeA,EAAO,mBAAqBA,EAAO,mCAAqCC,KAAK,IAAM,UAE5R,OADAC,EAAWnK,UAAYF,OAAOE,WACrBmK,WAAYA,EAAYV,eAAgBA,GAErD,SAAgBW,EAAiBtB,EAAQuB,GACrC,SAAIA,GAAUA,EAAOhK,cAAgBP,UAErCgJ,EAAOwB,KAAK,OAAQ,sCAAwCD,OAAQA,KAC7D,GCwBX,SACSE,EAAcC,EAAUC,GAC7B,OAAO,SAAU7K,EAAO8B,GACpB,OAAO+I,EAASpE,KAAKjE,KAAMoI,EAASnE,KAAKjE,KAAMxC,EAAO8B,GAAOA,IAGrE,SAASgJ,EAAgBC,EAAeC,GACpC,OAAO,SAAU1E,EAAMH,EAAM+C,EAAQG,GACjC,OAAO2B,EAAcvE,KAAKjE,KAAMuI,EAActE,KAAKjE,KAAM8D,EAAMH,EAAM+C,EAAQG,GAAUlD,EAAM+C,EAAQG,IAG7G,SAAS4B,EAAoBC,EAAaC,GACtC,OAAO,SAAU7E,EAAMH,EAAM+C,EAAQG,GACjC6B,EAAYzE,KAAKjE,KAAM8D,EAAMH,EAAM+C,EAAQG,GAC3C8B,EAAY1E,KAAKjE,KAAM8D,EAAMH,EAAM+C,EAAQG,IAGnD,SAAS+B,EAAeC,GACpB,OAAO,SAAUnC,EAAQlJ,EAAOY,GAC5B,OAAOZ,EAAQqL,EAAS5E,KAAKjE,KAAM0G,EAAQlJ,EAAOY,GAAO,YCpCjE,SACS0K,KAqBT,SAAgBC,EAAmBC,GAC/B,IAAIC,EACJ,GAAoB,mBAATD,EACPC,EAAWD,EAAKE,SAEf,GAAIF,GAAQA,aAAgBG,GAC7BF,EAAWD,MAEV,CACD,IAAII,EAAOC,EAAUL,GAEjBC,EADAG,GAAQA,EAAKxL,qBAAqB0L,GACvBF,EAAKG,OAAO/L,MAAMwL,GAGlB,IAAIG,IAAyBC,KAAMA,EAAM5L,MAAOwL,EAAMQ,kBAAkB,IAG3F,OAAOP,EAASpC,QAEpB,SAASwC,EAAU7L,GACf,cAAeA,GACX,IAAK,SACD,OAAOiM,OACX,IAAK,SACD,OAAOC,OACX,IAAK,UACD,OAAOC,QACX,IAAK,YACD,OACJ,IAAK,SACD,OAAOnM,EAAQA,EAAMS,iBAAc,GCjD/C,SAAS2L,EAAaC,GAClB,OAAQC,MAAM,IAAKC,KAAKF,GAAOG,WAYnC,SAASC,GAAcJ,GACnB,IAAIK,EAAWC,EAAQC,EAAgB,EACvC,GAAKD,EAASE,GAAeC,KAAKT,GAAQ,CACtC,IAAK,IAAWU,EAAP7L,EAAI,EAAO6L,EAAIC,GAAY9L,KAAOA,EACvCyL,EAAOI,IAAMJ,EAAOI,IAAM,EAE9BJ,EAAO,KAAOA,EAAO,IAAM,GAAK,EAChCA,EAAO,IAAMA,EAAO,IAAM,EACR,MAAdA,EAAO,SAA4BM,IAAdN,EAAO,KAC5BC,EAA6B,GAAbD,EAAO,IAAWA,EAAO,IACvB,MAAdA,EAAO,KACPC,EAAgB,EAAIA,IAG5BF,EACIH,KAAKW,IAAIP,EAAO,GAAIA,EAAO,GAAIA,EAAO,GAAIA,EAAO,GAAIA,EAAO,GAAKC,EAAeD,EAAO,GAAIA,EAAO,SAGtGD,EAAYH,KAAKY,MAAMd,GAE3B,OAAOK,EC7CX,SAASU,GAAQ5L,GACb,OAAOA,EAAI6L,KAAKC,MAAM9L,GAAK,EAiD/B,SAAgB+L,MC9BhB,SACS7I,MClFT,SAAgB8I,GAAgBhC,EAAM1J,GAClC,OAAO2L,GAAQzG,OAAOuE,EAAmBC,GAAO1J,GAEpD,SAAS4L,GAAWjE,GAChB,IAAIkE,EAAiBzN,OAAOgD,KAAKuG,GAAYmE,OAAO,SAAU9L,GAAQ,OAAO2H,EAAW3H,GAAMqL,QAC9F,OAAOQ,EAAexM,QAClB0M,OAAQ,IAAI1D,SAAS,OAAQ,+DAAiEwD,EAAevD,IAAI,SAAUtI,GAAQ,MAAO,0CAA4CA,EAAO,yBAA2BA,EAAO,aAAeA,EAAO,2BAA6BA,EAAO,MAASA,EAAO,yBAA4BwI,KAAK,IAAM,8CAGxV,SAASwD,GAAarE,GAClB,OAAO,IAAIU,SAAS,4GAA8GjK,OAAOgD,KAAKuG,GAAYW,IAAI,SAAUxJ,GACpK,GAAI6I,EAAW7I,GAAKmN,OAChB,MAAO,QAAUnN,EAAM,QAAUA,EAAM,yBAA2BA,EAAM,MAAQA,EAAM,SAE3F0J,KAAK,MAAQ,kCAEpB,SAAgB0D,GAAqB5K,EAAa6K,GACzC7K,EAAYvC,eAAe,WAC5BX,OAAOkF,eAAehC,EAAa,UAC/BK,IAAK,WACD,OAAO,IAAIkI,IACP3L,MAAO,KACP4L,KAAMxI,EACN8K,WAAYD,OAMhC,SAASE,GAAiBC,GACtB,IAAIC,EACJ,IAAK,IAAIzN,KAAOwN,EAAW,CACvB,IAAgCE,EAAhBF,EAAUxN,GAA4ByI,QAAQiF,UAC1DA,IACAD,IAAiBA,EAAe,IAAIE,IACpCF,EAAaG,SAAS,UAAY5N,EAA0B,iBAAd0N,EAC1CG,GAAqBH,EAAW1N,GAChC8N,GAAYJ,EAAW1N,KAGnC,OAAOyN,GAAiBA,aAAcA,MAE1C,SAASK,GAAYC,EAAS/N,GAC1B,OAAO,SAAUsI,EAAQlJ,GACrB2O,EAAQlI,KAAKyC,EAAQlJ,EAAOY,IAGpC,SAAS6N,GAAqBG,EAAKhO,GAC/B,IAAI0D,EAAK,IAAIuK,GAAkBD,GAAK,GAAOE,EAAQxK,EAAGwK,MAAOC,EAAUzK,EAAGyK,QAASC,EAAO1K,EAAG0K,KAC7F,OAAOF,EACH,SAAU5F,EAAQlJ,GACdkJ,EAAO8F,GAAMhP,EAAOY,IAExB,SAAUsI,EAAQlJ,GACd+O,EAAQ7F,GAAQ8F,GAAMhP,EAAOY,IC4OzC,SACSqO,GAAU/F,EAAQuB,GACvB,GAAID,EAAiBtB,EAAQuB,GAAS,CAClC,IAAInB,EAAcJ,EAAOI,YACrB4F,OAAU,EACd,IAAK,IAAIpK,KAAU2F,EACVnB,EAAYxE,KACboK,IAAYA,MACZA,EAAQC,KAAK,IAAMrK,EAAS,MAGhCoK,GACAhG,EAAOwB,KAAK,OAAQ,wBAA0BwE,EAAQ5E,KAAK,MAAQ,iBAAmBG,OAAQA,KCrQ1G,SAAS2E,GAAc9K,GACnB,IAAIpC,EAAWoC,EAAGpC,SAAUuH,EAAanF,EAAGmF,WAAY4F,EAAc/K,EAAG+K,YACrEC,EAAa7F,GAAcvH,MAI/B,OAHImN,GAAiBA,KAAeC,IAChCA,EAAWD,QAAe,GAEvBC,ECrEX,SAAgBC,GAAQC,GACpB,IAAIC,EAASD,EAAWC,OAIxB,OAHAD,EAAWC,UACXD,EAAWE,SACXC,GAAQH,EAAYC,GACbA,EAEX,SAAgBG,GAAiBJ,EAAYtF,EAAOb,GAChD,IACIH,EADA2G,EAAQL,EAAWK,MAEnBL,EAAWM,SACX5G,EAASgB,aAAiB2F,EAAQ3F,EAAQ2F,EAAM7I,OAAOkD,EAAOb,GAC1DmG,EAAWM,QAAUC,GAAcC,QACnCjJ,GAAGmC,EAAQA,EAAO+G,iBAAkBT,EAAWU,kBAAmBV,KAItEtG,EAASgB,aAAiB2F,EAASxG,EAAQ8G,MAAQjG,EAAMkG,QAAUlG,EAAS2F,EAAM7I,OAAOkD,EAAOb,GAC3FgH,GAAQb,EAAYtG,KACRsG,EAAWc,oBAAsBd,EAAWc,uBAClDnB,KAAKjG,IAGpB,IAAIqH,EAAcf,EAAWe,YAE7B,OADAA,GAAeA,EAAYC,UAAUhB,EAAYtG,GAC1CA,EAEX,SAAgBuH,GAAKC,EAAOC,EAAOC,GAC3BF,EAAMZ,QACFY,EAAMZ,QAAUC,GAAcC,QAC9B5I,GAAIuJ,EAAOA,EAAMV,iBAAkBS,EAAMR,kBAAmBQ,IAIhEG,GAAMH,EAAOC,GACbC,GAASD,EAAMpB,WAEnB,IAAIgB,EAAcG,EAAMH,YACxBA,GAAeA,EAAYO,YAAYJ,EAAOC,GAElD,SAAgBhB,GAAQH,EAAYuB,GAChC,IAAK,IAAInM,EAAK,EAAGoM,EAAaD,EAAUnM,EAAKoM,EAAW7P,OAAQyD,IAE5D6L,GAAKjB,EADOwB,EAAWpM,IAG3B,OAAOmM,EAEX,SAAgBE,GAAazB,EAAYnG,GACrC,IAAI6H,EAAc1B,EAAW0B,YAC7B,SAAIA,IAAgC,IAAjB7H,EAAQ8H,QACvB3B,EAAWC,OAAO0B,KAAKD,IAChB,GAIf,SAAgBE,GAASC,EAAOxB,GAC5BwB,EAAMxB,EAAMvH,KAAOuH,EACnB,IAAIyB,EAAKzB,EAAMyB,GACL,MAANA,IACAD,EAAMC,GAAMzB,GAGpB,SAAgB0B,GAAYF,EAAOxB,UACxBwB,EAAMxB,EAAMvH,KACnB,IAAIgJ,EAAKzB,EAAMyB,GACL,MAANA,UACOD,EAAMC,GAGrB,SAAgBE,GAAYH,EAAOxB,UACxBwB,EAAMxB,EAAM4B,SAAS5B,EAAMR,cAClC,IAAIiC,EAAKzB,EAAMyB,GACT,MAANA,IAAeD,EAAMC,GAAMzB,GA6C/B,SACgB6B,GAAoBlC,GAChCA,EAAW9E,KAAK,QAAS,sCAAuC8E,EAAWc,mBAC3Ed,EAAWc,uBAAoB,ECxHnC,SAAgBqB,GAAenC,EAAYoC,EAAOvI,EAAS8G,GACvD,IAAIhH,EAASC,GAAMoG,GAAaqC,KAC5BC,EAAQC,GAAevC,EAAYoC,EAAOC,EAAQxI,EAAS8G,GAC/D,GAAI2B,EAAM3Q,QAAU0Q,EAAO1Q,OAAQ,CAC/B,IAAI6Q,EAAWC,GAAmBzC,EAAYsC,EAAOzI,GACrD,GAAIG,GAAYgG,EAAYnG,GACxB,OAAO,IAAI6I,GAAsB1C,EAAYrG,EAAQ2I,KAAWD,EAAQG,GAExExC,EAAWc,mBACXoB,GAAoBlC,GAE5BrG,GAAUO,GAAO8F,GAGrB,SAASyC,GAAmBzC,EAAYsC,EAAOzI,GAC3C,IAAI8I,EAAK9I,EAAQ8I,GACjB,GAAU,MAANA,EAAY,CACZ,IAAIC,EAAW5C,EAAWC,OAAOtO,OAAS2Q,EAAM3Q,OAShD,OARAgR,EAAKlG,OAAOkG,IACH,IACLA,GAAMC,EAAW,GACjBD,EAAK,IACLA,EAAK,GACLA,EAAKC,IACLD,EAAKC,GACTC,GAAa7C,EAAWC,OAAQ0C,EAAIL,IAC7B,EAEX,OAAOb,GAAazB,EAAYnG,GAEpC,SAASgJ,GAAa3Q,EAAQyQ,EAAIL,GAC9B,IAAK,IAAIQ,EAAI5Q,EAAOP,OAAS,EAAGD,EAAIoR,EAAIR,EAAM3Q,OAAQD,GAAKiR,EAAIjR,IAAKoR,IAChE5Q,EAAO4Q,GAAK5Q,EAAOR,GAEvB,IAAKA,EAAI,EAAGoR,EAAIH,EAAIjR,EAAI4Q,EAAM3Q,OAAQD,IAAKoR,IACvC5Q,EAAO4Q,GAAKR,EAAM5Q,GAG1B,SAAS6Q,GAAevC,EAAY+C,EAASV,EAAQW,EAAWC,GAE5D,IAAK,IADD/C,EAAQF,EAAWE,MAAOD,EAASD,EAAWC,OAAQU,GAASsC,GAAcD,EAAUrC,SAAWX,EAAWM,QAAkCT,GAAjBmD,EAAUrF,MAAqBqC,EAAWK,MAAMzP,UAAUiP,aAAaqD,EAAajD,EAAOtO,OACpNyD,EAAK,EAAG+N,EAAYJ,EAAS3N,EAAK+N,EAAUxR,OAAQyD,IAAM,CAC/D,IAAIgO,EAAOD,EAAU/N,GACjBiL,EAAQ+C,EAAOlD,EAAMkD,EAAKvD,KAAiBK,EAAMkD,EAAKtK,KAAO,KACjE,GAAIuH,GACA,GAAIM,GAASyC,IAAS/C,EAAO,CACzB,IAAI3F,EAAQ0I,EAAKnJ,YAAcmJ,EAC3BC,EAAchD,EAAMiD,mBAAmB5I,EAAOsI,GAClDK,GAAehB,EAAO1C,KAAK0D,GACvBhD,EAAMkD,WAAW1D,IACjBmC,GAAY9B,EAAOG,SAK3BA,EAAQD,GAAiBJ,EAAYoD,EAAMJ,GAC3C/C,EAAON,KAAKU,GACZuB,GAAS1B,EAAOG,GAGxB,OAAOJ,EAAOuD,MAAMN,GC1DxB,SAAgBO,GAAoBzD,EAAYoC,EAAOvI,EAAS6J,GAC5D,IAAI/J,EAASC,GAAMoG,GACfsC,EAAQqB,GAAiB3D,EAAYoC,EAAOvI,GAChD,GAAIyI,EAAM3Q,OAAQ,CACd,IAAI6Q,EAAWf,GAAazB,EAAYnG,GACxC,GAAIG,GAAYgG,EAAY0D,EAASE,GAAgB/J,GACjD,OAAO,IAAI6I,GAAsB1C,EAAYrG,EAAQ2I,EAAMkB,cAAiBhB,GAE5ExC,EAAWc,mBACXoB,GAAoBlC,GAE5BrG,GAAUO,GAAO8F,GAGrB,SAAgB6D,GAAe7D,EAAYoC,EAAOvI,GAC9C,IAAIF,EAASC,GAAMoG,GAAaqC,KAC5BJ,EAAWjC,EAAWC,OAAQqC,EAAQwB,GAAY9D,EAAYoC,EAAOC,EAAQxI,GAC7EkK,EAAc/D,EAAWC,OAAOtO,OAAS2Q,EAAM3Q,OAAQqS,EAAUD,EAAc9B,EAAStQ,OAAUoS,EAAcE,GAAgBjE,EAAYiC,GAC5I9B,GAAQH,EAAYiC,MACpBiC,EAAiB7B,EAAO1Q,QAAU2Q,EAAM3Q,OAAQwS,EAAU1C,GAAazB,EAAYnG,IAAYqK,GAAmB5B,EAAM3Q,QAAUkI,EAAQsK,OAC9I,GAAID,GAAkBF,EAAQrS,QAAUwS,EAAQ,CAC5C,GAAInK,GAAYgG,EAAYnG,GACxB,OAAO,IAAI6I,GAAsB1C,EAAYrG,EAAQ2I,EAAO0B,EAAS3B,EAAQ8B,GAE7EnE,EAAWc,mBACXoB,GAAoBlC,GAE5BrG,GAAUO,GAAO8F,GAGrB,SAASiE,GAAgBjE,EAAYiC,GAEjC,IAAK,IADD/B,EAAQF,EAAWE,MAAO8D,KACrB5O,EAAK,EAAGgP,EAAanC,EAAU7M,EAAKgP,EAAWzS,OAAQyD,IAAM,CAClE,IAAIsE,EAAS0K,EAAWhP,GACnB8K,EAAMxG,EAAOZ,OACdkL,EAAQrE,KAAKjG,GACbuH,GAAKjB,EAAYtG,IAGzB,OAAOsK,EAEX,SAASF,GAAY9D,EAAY9N,EAAQmQ,EAAQxI,GAE7C,IAAK,IADDoG,EAASpP,MAAMqB,EAAOP,QAASuO,KAAYS,GAA0B,MAAjB9G,EAAQ8G,OAAuB9G,EAAQ8G,SAAWX,EAAWM,QAAS+D,EAAYrE,EAAWE,MAAOoE,EAAatE,EAAWC,OAAQJ,EAAcG,EAAWK,MAAMzP,UAAUiP,YAAa0E,KAAYC,GAAY,EACjQ9S,EAAI,EAAGoR,EAAI,EAAGpR,EAAIQ,EAAOP,OAAQD,IAAK,CAC3C,IAAI0R,EAAOlR,EAAOR,GAAI2O,EAAQ,KAC9B,GAAI+C,EAAM,CACN,IAAItB,EAAKsB,EAAKvD,GAAc/G,EAAMsK,EAAKtK,IACvC,GAAIoH,EAAM4B,IAAO5B,EAAMpH,GACnB,SACJuH,EAAQgE,EAAUvC,IAAOuC,EAAUvL,GAEvC,GAAIuH,GACA,GAAIM,GAASyC,IAAS/C,EAAO,CACrBmE,GAAaF,EAAWxB,KAAOzC,IAC/BmE,GAAY,GAChB,IAAI9J,EAAQ0I,EAAKnJ,YAAcmJ,EAC3BC,EAAchD,EAAMiD,mBAAmB5I,EAAOb,GAClDwJ,GAAehB,EAAO1C,KAAK0D,SAI/BhD,EAAQD,GAAiBJ,EAAYoD,EAAMvJ,GAC3C0K,EAAM5E,KAAKU,GAEfJ,EAAO6C,KAAOzC,EACduB,GAAS1B,EAAOG,GAOpB,OALAJ,EAAOtO,OAASmR,EAChB9C,EAAWC,OAASA,EACpBD,EAAWE,MAAQA,EACdsE,IACD3K,EAAQsK,QAAS,GACdI,EAEX,SAASZ,GAAiBtL,EAAMnG,EAAQ2H,GAEpC,IAAK,IADD4K,EAAMvS,EAASA,EAAOP,OAAS,EAAGsO,EAASpP,MAAM4T,GAAMvE,KAAYL,EAAcxH,EAAKgI,MAAMzP,UAAUiP,YACjGnO,EAAI,EAAGoR,EAAI,EAAGpR,EAAI+S,EAAK/S,IAAK,CACjC,IAAIgT,EAAMxS,EAAOR,GACjB,IAAIgT,IAAQxE,EAAMwE,EAAI7E,MAAiBK,EAAMwE,EAAI5L,KAAjD,CAGA,IAAIuH,EAAQD,GAAiB/H,EAAMqM,EAAK7K,GACxCoG,EAAO6C,KAAOzC,EACduB,GAAS1B,EAAOG,IAIpB,OAFAJ,EAAOtO,OAASmR,EAChBzK,EAAK6H,MAAQA,EACN7H,EAAK4H,OAASA,ECvFzB,SAAgB0E,GAAU3E,EAAY4E,EAAI/K,GACtC,IAAIwG,EAAQL,EAAW/L,IAAI2Q,GAC3B,GAAIvE,EAAO,CACP,IAAI1G,EAASC,GAAMoG,GAAaC,EAASD,EAAWC,OACpDA,EAAO4E,OAAO5E,EAAO6E,QAAQzE,GAAQ,GACrC0B,GAAY/B,EAAWE,MAAOG,GAC9B,IAAI0E,EAAS/K,GAAYgG,EAAYnG,GAQrC,OAPIkL,IACA3O,GAASiK,EAAO,SAAUA,EAAOL,EAAYnG,GAC7CzD,GAAS4J,EAAY,SAAUK,EAAOL,EAAYnG,IAEtDoH,GAAKjB,EAAYK,EAAOxG,EAAQuH,OAChC2D,GAAU1O,GAAS2J,EAAY,SAAUA,EAAYnG,GACrDF,GAAUO,GAAO8F,GACVK,GAIf,SAAgB2E,GAAWhF,EAAYiF,EAAUpL,GAC7C,IAAImK,EAAUkB,GAAiBlF,EAAYiF,GAC3C,GAAIjB,EAAQrS,OAAQ,CAChB,IAAIgI,EAASC,GAAMoG,GACnB8D,GAAY9D,EAAYgE,EAAQrS,QAC5BqI,GAAYgG,EAAYnG,GACN,IAAI6I,GAAsB1C,EAAYrG,KAAYqK,MAAa,GACrE9J,SAGZP,GAAUO,GAAO8F,GAGzB,OAAOgE,EAGX,SAASkB,GAAiBlF,EAAYiF,GAElC,IAAK,IADDjB,EAAUnT,MAAMoU,EAAStT,QAASuO,EAAQF,EAAWE,MAChDxO,EAAI,EAAGoR,EAAI,EAAGpR,EAAIuT,EAAStT,OAAQD,IAAK,CAC7C,IAAI2O,EAAQL,EAAW/L,IAAIgR,EAASvT,IAChC2O,IACA2D,EAAQlB,KAAOzC,EACf0B,GAAY7B,EAAOG,GACnBY,GAAKjB,EAAYK,IAIzB,OADA2D,EAAQrS,OAASmR,EACVkB,EAEX,SAASF,GAAY9D,EAAYgE,GAE7B,IAAK,IADDrN,EAAOqJ,EAAWC,OAAQA,EAASD,EAAWC,OAASpP,MAAM8F,EAAKhF,OAASqS,GAAU9D,EAAQF,EAAWE,MACnGxO,EAAI,EAAGoR,EAAI,EAAGpR,EAAIiF,EAAKhF,OAAQD,IAAK,CACzC,IAAI2O,EAAQ1J,EAAKjF,GACbwO,EAAMG,EAAMvH,OACZmH,EAAO6C,KAAOzC,GAGtBJ,EAAOtO,OAASmR,EC8UpB,SACSqC,GAAWnF,EAAYoF,EAAUvL,GACtC,IAAIwL,EAASxL,EAAQ8D,MAAQqC,EAAWrC,MAAMyH,EAAUvL,GAAWuL,EACnE,OAAOvU,MAAMyU,QAAQD,GAAUA,GAAUA,GAI7C,SAASE,GAAY/T,EAAKiF,GACtB,YAAmB,IAAZA,EAAqB,SAAU+O,EAAGjI,GAAK,OAAO/L,EAAIyF,KAAKR,EAAS+O,EAAGjI,IAAQ/L,EAEtF,SAASiU,GAAoBC,EAAUjP,GACnC,MAAwB,iBAAbiP,EACA,SAAU1T,GACb,IAAK,IAAIZ,KAAOsU,EACZ,GAAIA,EAAStU,KAASY,EAAEZ,GACpB,OAAO,EAEf,OAAO,GAGRmU,GAAYG,EAAUjP,GC5Z1B,SAASkP,GAAeC,GAC3B,cAAeA,GACX,IAAK,WACD,OAAO,SAAU5M,GAAQ,OAAO4M,EAAc3O,KAAK+B,IACvD,IAAK,SACD,OAAO,WAAc,OAAO4M,GAChC,IAAK,SAED,OADc,IAAIvG,GAAkBuG,GAAerG,SCwB/D,SAASsG,GAAuBC,GA4F5B,OA3F0B,SAAUC,GAEhC,SAASC,EAAmBC,EAAcpM,GACtC,IAAIqM,EAAQH,EAAO9O,KAAKjE,QAAU6G,EAASsM,KAAqBnT,KAGhE,OAFAkT,EAAME,aAAe,KACrBF,EAAMG,KAAOC,GAAQL,GACdC,EAmFX,OAxFAK,GAAUP,EAAoBD,GAO9BrV,OAAOkF,eAAeoQ,EAAmBpV,UAAW,mBAChDqD,IAAK,WAAc,OAAOjB,KAAKqT,MAAQrT,KAAKiN,QAC5CuG,YAAY,EACZC,cAAc,IAElBT,EAAmBpV,UAAU8V,IAAM,SAAUC,EAAY9M,GACrD,IAAIuM,EAAepT,KAAKoT,aAAc7B,EAAQ+B,GAAQK,GACtD,GAAIP,EACA,OAAOL,EAAOnV,UAAU8V,IAAIzP,KAAKjE,KAAM4T,GAAYR,EAAc7B,GAAQ1K,GAGzE,GAAI0K,EAAM5S,OAAQ,CACd,IAAIgI,EAASkN,GAAejN,MAAM5G,MAClCA,KAAKqT,KAAOrT,KAAKqT,KAAOrT,KAAKqT,KAAKS,OAAOvC,GAASA,EAClDsC,GAAe7M,YAAYhH,KAAM6G,GACjCF,GAAUkN,GAAe3M,OAAOlH,QAI5CgT,EAAmBpV,UAAUmW,MAAQ,SAAUJ,EAAY9M,GACvD,IAAIuM,EAAepT,KAAKoT,aAAchB,EAAWkB,GAAQK,GACzD,OAAOP,EACHL,EAAOnV,UAAUmW,MAAM9P,KAAKjE,KAAM4T,GAAYR,EAAchB,GAAWvL,GACvEmN,GAAShU,KAAMoS,EAAUvL,QAEjCmM,EAAmBpV,UAAU0S,mBAAqB,SAAUqD,EAAY9M,GACpE,IAAIuM,EAAepT,KAAKoT,aAAchB,EAAWkB,GAAQK,GACzD,OAAOP,EACHL,EAAOnV,UAAU0S,mBAAmBrM,KAAKjE,KAAM4T,GAAYR,EAAchB,GAAWvL,GACpFmN,GAAShU,KAAMoS,EAAUvL,IAEjCmM,EAAmBpV,UAAU2N,OAAS,WAClC,OAAOvL,KAAKqT,KACRrT,KAAKqT,KAAKzL,IAAI,SAAUqM,GAAW,OAAOA,EAAQnF,IAAMmF,IACxDjU,KAAKiN,OAAOrF,IAAI,SAAUyF,GAAS,OAAOA,EAAMyB,MAExDkE,EAAmBpV,UAAUsW,gBAAkB,WAAc,OAAO,GACpElB,EAAmBpV,UAAUgQ,MAAQ,SAAUM,GAC3C,IAA6BiG,EAAO,IAAI7S,EAA7BtB,KAAK/B,iBACZoP,MAAOrN,KAAKqN,MACZ+G,WAAYpU,KAAKoU,aASrB,OAPIpU,KAAKoT,cACLe,EAAKf,aAAepT,KAAKoT,aACzBe,EAAKJ,MAAM/T,KAAKiN,QAAUyD,QAAQ,KAGlCyD,EAAKd,KAAOrT,KAAKqT,KAEdc,GAEXnB,EAAmBpV,UAAU+M,MAAQ,SAAU0J,GAC3C,OAAOA,GAEXrB,EAAmBpV,UAAU2O,QAAU,SAAUS,GAQ7C,OAPIA,GAAcA,EAAWrO,SACzBqB,KAAKoT,aAAepG,EAChBhN,KAAKqT,OACLrT,KAAK+T,MAAM/T,KAAKqT,MAAQ3C,QAAQ,IAChC1Q,KAAKqT,KAAO,OAGbrT,MAEXgT,EAAmBpV,UAAU0W,YAAc,WAAc,OAAOtU,KAAKuL,UACrEyH,EAAmBpV,UAAU2W,OAAS,SAAUC,EAAWC,GACvD,OAAO1B,EAAOnV,UAAU2W,OAAOtQ,KAAKjE,KAAMA,KAAKoT,aAAanS,IAAIuT,GAAYC,IAEhFzB,EAAmBpV,UAAU8W,OAAS,WAClC,GAAI1U,KAAKoT,aAEL,OADApT,KAAK2U,IAAI3U,KAAKoT,aAAanG,QACpBjN,KAAKiN,OAEhB,MAAM,IAAI2H,MAAM,0EAEpB5B,EAAmBpV,UAAUiX,UAAY,WACrC,OAAO7U,KAAKrB,OAASqB,KAAK+T,QAAU/T,KAAK0U,UAE7C1B,EAAqB8B,IACjB/T,GACDiS,IAELF,GAGN,SAASc,GAAYmB,EAAQ3C,GAEzB,IAAK,IADD4C,KACK5S,EAAK,EAAG6S,EAAa7C,EAAUhQ,EAAK6S,EAAWtW,OAAQyD,IAAM,CAClE,IAAIwP,EAAKqD,EAAW7S,GAChBsE,EAASqO,EAAO9T,IAAI2Q,GACpBlL,GACAsO,EAAQrI,KAAKjG,GAErB,OAAOsO,EAEX,SAAShB,GAAShH,EAAYoF,EAAUvL,GACpC,GAAIqO,EAAelI,EAAWqG,KAAMjB,GAAW,CAC3C,IAAIzL,EAASkN,GAAejN,MAAMoG,GAClCA,EAAWqG,KAAOjB,EAClByB,GAAe7M,YAAYgG,EAAYnG,GACvCF,GAAUkN,GAAe3M,OAAO8F,IAGxC,SAASsG,GAAQlB,GACb,OAAOvU,MAAMyU,QAAQF,GAAYA,GAAYA,GpBjJjD,IAAI+C,IACAC,KAAM,EAAGC,MAAO,EAAGC,KAAM,EAAGC,KAAM,EAAGC,IAAK,EAAGC,MAAO,GAE7CD,GAAM,SAAUE,EAASC,EAAOC,GACvC,IAA4CC,EAAKC,EAAOC,EAApDC,EAAgBb,GAAcO,GAUlC,QATsB,IAAlBM,GAA6BJ,GAO7BC,EAAMF,EAAOI,EAAQL,EAASI,EAAQF,IANtCI,EAAgB,EAChBH,EAAMH,EACNI,EAAQH,EACRI,EAAQ,OAKRC,GAAiBR,GAAIO,MAAO,CAC5B,GAAIC,GAAiBR,GAAIS,QAAUT,GAAIU,OAAQ,CAC3C,IAAIb,EAAQ,IAAIT,MAAMiB,GAEtB,MADAR,EAAMS,MAAQA,EACRT,EAGNG,GAAIU,OAAOH,EAAOF,EAAKC,GACFN,GAAIW,OAMrCX,GAAIO,MAA2B,oBAAZK,SAA2BA,QAAQC,KAAgC,eAAzBD,QAAQC,IAAIC,SAA4B,EAAI,EACzGd,GAAIS,MAAQ,EACZT,GAAIW,KAAO,EACY,oBAAZI,UACPf,GAAIU,OAAS,SAAkBH,EAAOV,EAAOS,GACzC,IAAIU,GAAQnB,GACZ,IAAK,IAAIoB,KAAUX,EACfU,EAAK7J,KAAK,OAAS8J,EAAS,IAAKX,EAAMW,IAE3CF,QAAQR,GAAOhW,MAAMwW,QAASC,KA+ItC9Y,OAAOgZ,iBAAmBhZ,OAAOgZ,eAAiBhX,GAelD,IAAIZ,GAAajB,MAAMD,UAAWyC,GAAY0J,KAAKnM,UAAW2C,GAAc7C,OAAOE,mFAvInF,SAAmCI,EAAO8O,GAEtC,IAAK,IADD6J,KACKvU,EAAK,EAAGA,EAAK/C,UAAUV,OAAQyD,IACpCuU,EAAMvU,EAAK,GAAK/C,UAAU+C,GAE9B,IAAK,IAAIN,EAAK,EAAGqD,EAAUwR,EAAO7U,EAAKqD,EAAQxG,OAAQmD,IAAM,CACzD,IAAIQ,EAAS6C,EAAQrD,GACjBtE,EAAQsP,EAAWxK,QACb,IAAV9E,IAAqBQ,EAAMJ,UAAU0E,GAAU9E,oDA0CvD,SAAsCW,EAAKyY,GAEvC,IAAK,IADDC,EACKpZ,EAAQU,GAAM0Y,GAAQpZ,EAAOA,EAAQC,OAAOC,eAAeF,GAChEoZ,EAAOnZ,OAAOoZ,yBAAyBrZ,EAAOmZ,GAElD,OAAOC,iCAuBX,SAA2B1X,EAAMD,GAC7B,IAAK,IAAII,KAAQJ,EACbC,EAAKG,GAAQJ,EAAOI,GAExB,OAAOH,gBAEX,SAA6BA,EAAMD,GAC/B,IAAK,IAAII,KAAQJ,OACM,IAAfC,EAAKG,KACLH,EAAKG,GAAQJ,EAAOI,IAG5B,OAAOH,4BA+BX,SAAqB4X,GACjB,OAAOA,EAAIrZ,OAAOgD,KAAKqW,2BCtLvBxD,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAUxCC,GAAkC,SAAUC,EAAGnU,GAC/C,IAAIoU,KACJ,IAAK,IAAIJ,KAAKG,EAAO3Z,OAAOE,UAAUS,eAAe4F,KAAKoT,EAAGH,IAAMhU,EAAE4O,QAAQoF,GAAK,IAC9EI,EAAEJ,GAAKG,EAAEH,IACb,GAAS,MAALG,GAAqD,mBAAjC3Z,OAAO6Z,sBAC3B,IAAK,IAAI7Y,EAAI,EAAGwY,EAAIxZ,OAAO6Z,sBAAsBF,GAAI3Y,EAAIwY,EAAEvY,OAAQD,IAASwE,EAAE4O,QAAQoF,EAAExY,IAAM,IAC1F4Y,EAAEJ,EAAExY,IAAM2Y,EAAEH,EAAExY,KACtB,OAAO4Y,GAGPpW,GAAW,WACX,SAASA,KAiCT,OA/BAA,EAAQH,OAAS,SAAUyW,EAAYC,QAChB,IAAfD,IAAyBA,MAC7B,IAAI3W,EAAY9C,EAAaiC,MAC7ByX,GAAejY,EAAOQ,KAAMyX,GAC5B,IAAIhW,EAAS+V,EAAW/V,OAAQiW,EAAcN,GAAOI,GAAa,WAMlE,OALA/V,GAAUzB,KAAKyB,OAAOkM,MAAMlM,GAC5BzB,KAAKyB,OAAOI,YAAY7B,KAAKpC,UAAW8Z,GAAa,GACrD1X,KAAKyB,OAAOI,YAAY7B,KAAKpC,UAAWoC,KAAKyB,OAAOkW,qBAAqB9W,IAAY,GACrFb,KAAK4X,UAAY5X,KAAK4X,SAAS5X,KAAKyB,OAAOF,YAAaV,GACxDb,KAAKyB,OAAOoW,sBAAsBhX,GAC3Bb,MAEXkB,EAAQ4W,OAAS,SAAU9O,EAAM+O,GAC7B,IAAIC,EAgBJ,OAfIhP,GAAQA,EAAK3K,eAAe,gBAC5B2Z,EAAchP,EAAK/K,YACnBsV,GAAUyE,EAAahY,OAGvBgY,EAAe,SAAUjF,GAErB,SAASkF,IACL,OAAkB,OAAXlF,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAE/D,OAJAuT,GAAU0E,EAAUlF,GAIbkF,GACTjY,MAENW,EAAUqX,GACVhP,GAAQgP,EAAYjX,OAAOiI,EAAM+O,GAC1BC,GAEJ9W,KAwCPF,GAAe,WACf,SAASA,EAAYhD,GACjBgC,KAAKhC,MAAQA,EACbgC,KAAKuB,eACL,IAAIE,EAAS1D,EAAaC,GAAOyD,OACjCzB,KAAKkY,WAAczW,GAAUA,EAAOyW,eACpClY,KAAK0B,gBAAmBD,GAAUA,EAAOC,oBACzC1B,KAAKmY,cAAiB1W,GAAUA,EAAO0W,kBA+E3C,OA7EAnX,EAAYC,IAAM,SAAUjD,GACxB,IAAIyD,EAASzD,EAAMyD,OACnB,OAAOA,GAAUzD,IAAUyD,EAAOzD,MAAQyD,EACtCzD,EAAMyD,OAAS,IAAIT,EAAYhD,IAEvCgD,EAAYpD,UAAU+Z,qBAAuB,SAAU9W,GACnD,IAAsB7C,EAAQgC,KAAKhC,MACnC,OAAOuB,KAAuBS,KAAK0B,gBAAiB,SAAUe,EAAMnD,GAChE,GAAIuB,EAAUvB,KAAUtB,EAAMsB,GAC1B,OAAOtB,EAAMsB,MAIzB0B,EAAYpD,UAAU+P,MAAQ,SAAUlM,GAGpC,IAAK,IAFDhE,EAAQuC,KAAKhC,MAAMJ,UACnBua,EAAgBnY,KAAKmY,cAAgBnY,KAAKmY,cAAc3H,QACnDpO,EAAK,EAAGgW,EAAW3W,EAAQW,EAAKgW,EAASzZ,OAAQyD,IAAM,CAC5D,IAAIiW,EAAQD,EAAShW,GACrB,GAAIvE,MAAMyU,QAAQ+F,GACdrY,KAAK2N,MAAM0K,QAEV,GAAIF,EAAcrG,QAAQuG,GAAS,EAEpC,GADAF,EAAcxL,KAAK0L,GACE,mBAAVA,EAAsB,CACzBta,EAAasa,KAAW3a,QACxB6Y,QAAQf,IAAI,eAEhBxV,KAAK6B,YAAY7B,KAAKhC,MAAOqa,GAC7B,IAAIC,EAAeD,EAAM5W,OACrB6W,IACAtY,KAAKkY,WAAaxY,KAAaM,KAAKkY,WAAYI,EAAaJ,YAC7DlY,KAAK0B,gBAAkBhC,KAAaM,KAAK0B,gBAAiB4W,EAAa5W,iBACvE1B,KAAKmY,cAAgBnY,KAAKmY,cAAcrE,OAAOwE,EAAaH,gBAEhEnY,KAAK6B,YAAYpE,EAAO4a,EAAMza,gBAG9BoC,KAAK6B,YAAYpE,EAAO4a,KAKxCrX,EAAYpD,UAAUuD,SAAW,WAE7B,IAAK,IADDoX,KACKnW,EAAK,EAAGA,EAAK/C,UAAUV,OAAQyD,IACpCmW,EAAMnW,GAAM/C,UAAU+C,GAE1B,IAAK,IAAIN,EAAK,EAAG0W,EAAUD,EAAOzW,EAAK0W,EAAQ7Z,OAAQmD,IAEnDd,EAAYC,IADDuX,EAAQ1W,IACG6L,OAAO3N,KAAKhC,SAG1CgD,EAAYpD,UAAUiE,YAAc,SAAU1C,EAAMD,EAAQwD,GACxD,IAAIwQ,EAAQlT,KACZgC,EAAe9C,EAAQ,SAAUI,GAC7B,IACImD,EADAD,EAAa9E,OAAOoZ,yBAAyB5X,EAAQI,IAErDmD,EAAOyQ,EAAMxR,gBAAgBpC,KAC7BiD,EAAe2Q,EAAM3R,YAAajC,EAAMkD,EAAYC,EAAMC,GAEzDD,GAAQA,IAASgW,GAAWC,YAC7BnW,EAAepD,EAAMG,EAAMkD,EAAY0Q,EAAMgF,WAAW5Y,GAAOoD,MAI3E1B,EAAYpD,UAAUia,sBAAwB,SAAUhX,GACpD,IAAIiB,EAAK9B,KAAMkY,EAAapW,EAAGoW,WAAYla,EAAQ8D,EAAG9D,MACtD,GAAIka,EAAY,CACZ,IAAIza,EAAQO,EAAMJ,UAAW+a,EAAY9X,EAAUjD,UACnD,IAAK,IAAI6Y,KAAUyB,EAAY,CAC3B,IAAIzV,EAAOyV,EAAWzB,GAClBhZ,EAAMY,eAAeoY,IAAWA,KAAUkC,IAC1Clb,EAAMgZ,GAAU9T,EAAYlF,EAAMgZ,GAASkC,EAAUlC,GAAShU,OAKvEzB,KAGPmB,IACAyW,UACIja,QAAQ,EACRf,WAAW,EACXib,QAAQ,EACRxZ,WAAW,EACXC,MAAM,EACNwB,WAAW,GAEfmB,QACIhE,aAAa,IAUVwD,GAAS,WAEhB,IAAK,IADDqX,KACK1W,EAAK,EAAGA,EAAK/C,UAAUV,OAAQyD,IACpC0W,EAAK1W,GAAM/C,UAAU+C,GAEzB,gBAAkBpE,GAAS,OAAOgD,GAAYC,IAAIjD,GAAO2P,MAAMmL,KAExDL,YAAwBjX,GAAS,gBAAkBxD,GAC1D,IAAIyD,EAAST,GAAYC,IAAIjD,GAC7ByD,EAAOyW,WAAaxY,EAAS8B,EAAOC,EAAOyW,cAE/CO,GAAWjb,MAAQ,SAAU0C,EAAGC,GAAK,OAAOD,GAC5CuY,GAAWC,WAAa,SAAUxY,EAAGC,GAAK,OAAOD,GACjDuY,GAAW9K,MAAQ,SAAUzN,EAAGC,GAAK,OAAOT,KAAaQ,EAAGC,IAC5DsY,GAAWM,KAAO,SAAU7Y,EAAGC,GAAK,gBAAkBnB,GAClD,OAAOkB,EAAE+D,KAAKjE,KAAMG,EAAE8D,KAAKjE,KAAMhB,MAErCyZ,GAAW/Y,SAAW,SAAUQ,EAAGC,GAAK,kBACpC,OAAOT,EAASQ,EAAEH,MAAMC,KAAMX,WAAYc,EAAEJ,MAAMC,KAAMX,cAE5DoZ,GAAWO,WAAa,SAAU9Y,EAAGC,GAAK,kBACtCD,EAAEH,MAAMC,KAAMX,WACdc,EAAEJ,MAAMC,KAAMX,aAElBoZ,GAAWQ,UAAY,SAAU/Y,EAAGC,GAAK,kBACrCA,EAAEJ,MAAMC,KAAMX,WACda,EAAEH,MAAMC,KAAMX,aAElBoZ,GAAW3a,MAAQ,SAAUoC,EAAGC,GAAK,kBACjC,OAAOD,EAAEH,MAAMC,KAAMX,YAAcc,EAAEJ,MAAMC,KAAMX,aAErDoZ,GAAW5Z,KAAO,SAAUqB,EAAGC,GAAK,kBAChC,OAAOD,EAAEH,MAAMC,KAAMX,YAAcc,EAAEJ,MAAMC,KAAMX,aC1OrD,IAAI6Z,GAAY,WACZ,SAASA,EAAStR,GACd5H,KAAKmZ,YACDvR,IACIA,aAAesR,EACflZ,KAAKmZ,SAAWvR,EAAIuR,SAAS3I,QAG7B5I,GAAO5H,KAAKoZ,aAAaxR,IAqCrC,OAjCAsR,EAAStb,UAAU+P,MAAQ,SAAU/F,GACjC5H,KAAKmZ,SAAWnZ,KAAKmZ,SAASrF,OAAOlM,EAAIuR,WAE7CD,EAAStb,UAAUwb,aAAe,SAAUxR,GACxC,IAAK,IAAI+O,KAAS/O,EACd5H,KAAKgM,SAAS2K,EAAO/O,EAAI+O,KAGjCuC,EAAStb,UAAUyb,aAAe,SAAU1C,GACxC,IAAK,IAAIvU,EAAK,EAAGN,EAAK6U,EAAMvR,MAAMH,IAAgB7C,EAAKN,EAAGnD,OAAQyD,IAAM,CACpE,IAAIqU,EAAS3U,EAAGM,GAChBpC,KAAKgM,SAASyK,EAAQ5T,EAAmB4T,MAGjDyC,EAAStb,UAAUoO,SAAW,SAAU2K,EAAOnT,GAE3C,IAAK,IADD2V,EAAWnZ,KAAKmZ,SACX/W,EAAK,EAAGN,EAAK6U,EAAMvR,MAAMH,IAAgB7C,EAAKN,EAAGnD,OAAQyD,IAAM,CACpE,IAAIE,EAASR,EAAGM,GAChB+W,EAASxM,KAAK,IAAI2M,GAAgBhX,EAAQkB,MAGlD0V,EAAStb,UAAUoQ,UAAY,SAAUuL,EAAQra,GAC7C,IAAK,IAAIkD,EAAK,EAAGN,EAAK9B,KAAKmZ,SAAU/W,EAAKN,EAAGnD,OAAQyD,IAAM,CACvD,IAAIoX,EAAU1X,EAAGM,GACjBmC,EAAGrF,EAAQsa,EAAQla,KAAMka,EAAQhW,SAAU+V,KAGnDL,EAAStb,UAAU0Q,YAAc,SAAUiL,EAAQra,GAC/C,IAAK,IAAIkD,EAAK,EAAGN,EAAK9B,KAAKmZ,SAAU/W,EAAKN,EAAGnD,OAAQyD,IAAM,CACvD,IAAIqX,EAAU3X,EAAGM,GACjBwC,EAAI1F,EAAQua,EAAQna,KAAMma,EAAQjW,SAAU+V,KAG7CL,KAGPI,GAAmB,WAiBnB,OAhBA,SAAyBha,EAAMkE,GAC3BxD,KAAKV,KAAOA,EAERU,KAAKwD,UADQ,IAAbA,EACgBX,EAAmBvD,GAEV,iBAAbkE,EAER,WACI,IAAIkW,EAAU1Z,KAAKwD,GACnBkW,GAAWA,EAAQ3Z,MAAMC,KAAMX,YAIvBmE,MAMxBT,MAWA0B,GAAgB,WAOhB,OANA,SAAsBjB,EAAUC,EAASK,QACxB,IAATA,IAAmBA,EAAO,MAC9B9D,KAAKwD,SAAWA,EAChBxD,KAAKyD,QAAUA,EACfzD,KAAK8D,KAAOA,MA+EhBmB,GAAgB,sICpKhB6P,GAA0C,SAAU6E,EAAYJ,EAAQnb,EAAKyY,GAC7E,IAA2H5T,EAAvHD,EAAI3D,UAAUV,OAAQib,EAAI5W,EAAI,EAAIuW,EAAkB,OAAT1C,EAAgBA,EAAOnZ,OAAOoZ,yBAAyByC,EAAQnb,GAAOyY,EACrH,GAAuB,iBAAZgD,SAAoD,mBAArBA,QAAQC,SAAyBF,EAAIC,QAAQC,SAASH,EAAYJ,EAAQnb,EAAKyY,QACpH,IAAK,IAAInY,EAAIib,EAAWhb,OAAS,EAAGD,GAAK,EAAGA,KAASuE,EAAI0W,EAAWjb,MAAIkb,GAAK5W,EAAI,EAAIC,EAAE2W,GAAK5W,EAAI,EAAIC,EAAEsW,EAAQnb,EAAKwb,GAAK3W,EAAEsW,EAAQnb,KAASwb,GAChJ,OAAO5W,EAAI,GAAK4W,GAAKlc,OAAOkF,eAAe2W,EAAQnb,EAAKwb,GAAIA,GAMpB9U,GAAUiV,EAAoBxV,GAAKyV,EAAepV,GAAMqV,EAAgBta,GAAOua,EAAiB/W,GAAWgX,EAAqB9W,GAAW+W,EAAqBhX,GAAWiX,EAEnN5U,GAAW,EAKX6U,GAAa,WACb,SAASA,IACLta,KAAKuD,aAAU,EACfvD,KAAK6F,kBAAe,EACpB7F,KAAK8F,IAAMN,IACXxF,KAAKua,WAAWxa,MAAMC,KAAMX,WAmGhC,OAjGAib,EAAU1C,SAAW,SAAU9V,EAAIjB,GAC/B,IAAI2Z,EAAc1Y,EAAG0Y,YAAa3O,EAAe/J,EAAG+J,aAAc4O,EAAa3Y,EAAG2Y,WAClF,GAAID,GAAe3O,EAAc,CAC7B,IAAI6O,EAAY,IAAIxB,GAASlZ,KAAKpC,UAAUiO,cAC5C2O,GAAeE,EAAUtB,aAAaoB,GACtC3O,GAAgB6O,EAAU/M,MAAM9B,GAChC7L,KAAKpC,UAAUiO,aAAe6O,EAE9BD,GACA/c,OAAOid,iBAAiB3a,KAAKpC,UAAW2B,KAAckb,EAAY/U,KAG1E4U,EAAU1c,UAAU2c,WAAa,aACjCD,EAAU1c,UAAU2G,GAAK,SAAUS,EAAQxB,EAAUC,GACjD,GAAsB,iBAAXuB,EACPF,GAAQP,GAAIvE,KAAMgF,EAAQxB,EAAUC,QAEpC,IAAK,IAAIgT,KAAUzR,EACfF,GAAQP,GAAIvE,KAAMyW,EAAQzR,EAAOyR,GAAShT,GAAWD,GAC7D,OAAOxD,MAEXsa,EAAU1c,UAAU+B,KAAO,SAAUqF,EAAQxB,EAAUC,GACnD,GAAsB,iBAAXuB,EACPF,GAAQnF,GAAMK,KAAMgF,EAAQxB,EAAUC,QAEtC,IAAK,IAAInB,KAAU0C,EACfF,GAAQnF,GAAMK,KAAMsC,EAAQ0C,EAAO1C,GAASmB,GAAWD,GAC/D,OAAOxD,MAEXsa,EAAU1c,UAAUgH,IAAM,SAAUI,EAAQxB,EAAUC,GAClD,GAAKuB,EAEA,GAAsB,iBAAXA,EACZF,GAAQF,GAAK5E,KAAMgF,EAAQxB,EAAUC,QAErC,IAAK,IAAIoB,KAAUG,EACfF,GAAQF,GAAK5E,KAAM6E,EAAQG,EAAOH,GAASpB,GAAWD,QAL1DoB,GAAI5E,UAAM,EAAQwD,EAAUC,GAMhC,OAAOzD,MAEXsa,EAAU1c,UAAUgd,QAAU,SAAUtb,EAAMY,EAAGC,EAAG6C,EAAGC,EAAGC,GAOtD,YANU,IAAND,QAAsB,IAANC,EAChBC,GAASnD,KAAMV,EAAMY,EAAGC,EAAG6C,EAAGC,EAAGC,QACtB,IAANF,EACLI,GAASpD,KAAMV,EAAMY,EAAGC,EAAG6C,GAE3BK,GAASrD,KAAMV,EAAMY,EAAGC,GACrBH,MAEXsa,EAAU1c,UAAUid,SAAW,SAAU3b,EAAQgB,EAAGC,GAKhD,OAJIjB,IACAyG,EAAa3F,KAAMd,GACnBA,EAAOqF,GAAGrE,EAAIC,GAAkB,iBAAND,EAAwBC,EAAPH,KAAUA,OAElDA,MAEXsa,EAAU1c,UAAUkd,aAAe,SAAU5b,EAAQgB,EAAGC,GAKpD,OAJIjB,IACAyG,EAAa3F,KAAMd,GACnBA,EAAOS,KAAKO,EAAIC,GAAkB,iBAAND,EAAwBC,EAAPH,KAAUA,OAEpDA,MAEXsa,EAAU1c,UAAUmd,cAAgB,SAAUC,EAAU9a,EAAGC,GACvD,IAAI0F,EAAe7F,KAAK6F,aACxB,GAAIA,EAAc,CACd,IAAIoV,IAAc/a,GAAKC,GAAI+a,EAAU/a,GAAkB,iBAAND,EAAwBC,EAAPH,KAClE,GAAIgb,EAAU,CACV,IAAI9b,EAAS2G,EAAamV,EAASlV,KAC/B5G,IACI+b,UACOpV,EAAamV,EAASlV,KACjC5G,EAAO0F,IAAI1E,EAAGgb,EAAQlb,YAGzB,GAAgB,MAAZgb,EAAkB,CACvB,IAAK,IAAIlV,KAAOD,EACZA,EAAaC,GAAKlB,IAAI1E,EAAGgb,EAAQlb,MACjCib,IACCjb,KAAK6F,kBAAe,IAGjC,OAAO7F,MAEXsa,EAAU1c,UAAUmP,QAAU,WACtB/M,KAAKmb,YAETnb,KAAK+a,gBACL/a,KAAK4E,MACL5E,KAAKmb,WAAY,IAErBb,EAAYxF,IACR/T,EACAQ,GACIkZ,WAAYhC,GAAW9K,MACvB6M,YAAa/B,GAAW9K,SAE7B2M,MAIIc,GAASnc,EAAKqb,GAAU1c,UAAW,cAAe,ckBrH7DF,OAAOoa,OAAS,SAAUN,EAAYC,GAAe,OAAOvW,GAAQ4W,OAAON,EAAYC,IACvF/Z,OAAO8B,SAAW9B,OAAO8B,OAAS6b,GAClC3d,OAAO8X,IAAM8F,GCTb,ICUW/N,GDVPgO,GAAmB,WACnB,SAASA,EAAgBpd,GACrB6B,KAAKrB,OAASR,EAAI+V,gBAAgBlU,KAAKqP,YACnCrP,KAAKqV,MAAQlX,EAAI0K,SAAS1K,KAC1B6B,KAAKrB,SAqBb,OAlBA4c,EAAgB3d,UAAU4d,KAAO,SAAU9I,GACvC,IAAI5Q,EAAK9B,KAAMqV,EAAQvT,EAAGuT,MAAOhG,EAASvN,EAAGuN,OACzCgG,GACA3C,EAAS2C,EAAO,MACpB,IAAK,IAAIjX,KAAOiR,EACZqD,EAASrD,EAAOjR,GAAMA,IAG9Bmd,EAAgB3d,UAAU6d,UAAY,SAAU/I,EAAUzQ,GACtDjC,KAAKwb,KAAK,SAAUhe,EAAOY,GACnBZ,aAAiB+d,EACjB/d,EAAMie,UAAU/I,EAAUzQ,EAAOhB,IAAI7C,IAGrCsU,EAASlV,EAAOY,EAAK6D,MAI1BsZ,KlBzBPlV,GAAgB,cAChBgG,GAAqB,WAiBrB,OAhBA,SAA2BpG,EAAWyV,QAChB,IAAdA,IAAwBA,GAAY,GACxC,IAAIvV,EAAOF,EACNG,MAAMC,IACNuB,IAAI,SAAUxJ,GACf,MAAY,MAARA,EACO,aACI,MAAXA,EAAI,GACG,mBAAsBA,EAAIud,OAAO,GAAK,KAC1Cvd,IAEX4B,KAAKwM,KAAOkP,GAAavV,EAAKyV,MAC9B5b,KAAKsM,OAASnG,EAAKxH,OACnBwH,EAAKzD,QAAQ,QACb1C,KAAKuM,QAAU,IAAI5E,SAAS,OAAQ,UAAYxB,EAAK2B,KAAK,KAAO,SmBhBrEgN,GAA0C,SAAU6E,EAAYJ,EAAQnb,EAAKyY,GAC7E,IAA2H5T,EAAvHD,EAAI3D,UAAUV,OAAQib,EAAI5W,EAAI,EAAIuW,EAAkB,OAAT1C,EAAgBA,EAAOnZ,OAAOoZ,yBAAyByC,EAAQnb,GAAOyY,EACrH,GAAuB,iBAAZgD,SAAoD,mBAArBA,QAAQC,SAAyBF,EAAIC,QAAQC,SAASH,EAAYJ,EAAQnb,EAAKyY,QACpH,IAAK,IAAInY,EAAIib,EAAWhb,OAAS,EAAGD,GAAK,EAAGA,KAASuE,EAAI0W,EAAWjb,MAAIkb,GAAK5W,EAAI,EAAIC,EAAE2W,GAAK5W,EAAI,EAAIC,EAAEsW,EAAQnb,EAAKwb,GAAK3W,EAAEsW,EAAQnb,KAASwb,GAChJ,OAAO5W,EAAI,GAAK4W,GAAKlc,OAAOkF,eAAe2W,EAAQnb,EAAKwb,GAAIA,GAKNxW,GAAWyY,EAAoBtX,GAAKuX,EAAclX,GAAMmX,GAElH,SAAWxO,GACPA,EAAcA,EAAqB,MAAI,GAAK,QAC5CA,EAAcA,EAAsB,OAAI,GAAK,SAC7CA,EAAcA,EAA0B,WAAI,GAAK,aAHrD,CAIGA,KAAkBA,QACrB,IAAIjE,GAAiB,WACjB,SAASA,EAAcxD,GACnB9F,KAAKuD,aAAU,EACfvD,KAAKgc,gBACLhc,KAAKic,cAAe,EACpBjc,KAAKkc,SAAW,KAChBlc,KAAKmc,YAAS,EACdnc,KAAKoc,eAAY,EACjBpc,KAAKqc,sBAAmB,EACxBrc,KAAK8F,IAAM9F,KAAKsc,UAAYxW,EAmHhC,OAjHAyW,EAAkBjT,EAClBA,EAAclI,SAAW,SAAUP,GAC3BA,EAAU2D,SAAWxE,KAAKwE,SAC1BxE,KAAKwE,OAAS+X,EAAgB/X,SAGtC8E,EAAc9E,OAAS,SAAUtE,EAAGC,GAChC,OAAO,IAAIH,KAAKE,EAAGC,IAEvBmJ,EAAc1L,UAAUmP,QAAU,WAC1B/M,KAAKmb,YAETnb,KAAKmc,YAAS,EACdnc,KAAKoc,eAAY,EACjBpc,KAAK4E,MACL5E,KAAK+a,gBACL/a,KAAKmb,WAAY,IAErB7R,EAAc1L,UAAU2c,WAAa,aACrCjR,EAAc1L,UAAU4e,UAAY,SAAU9C,EAASH,GACnDhV,GAAGvE,KAAMA,KAAKyN,iBAAkBiM,EAASH,IAE7CjQ,EAAc1L,UAAU6e,WAAa,SAAU/C,EAASH,GACpD3U,GAAI5E,KAAMA,KAAKyN,iBAAkBiM,EAASH,IAE9CjQ,EAAc1L,UAAU8e,gBAAkB,SAAUnD,EAAQG,GACxD1Z,KAAK6a,SAAStB,EAAQA,EAAO9L,iBAAkBiM,IAEnDpQ,EAAc1L,UAAUyS,YAAc,SAAU7R,EAAKqI,QACjC,IAAZA,IAAsBA,MAC1B,IAAIF,EAASkN,GAAejN,MAAM5G,MAC9B2c,EAASne,EAAIyF,KAAKjE,KAAMA,MAC5B2c,GAAU3c,KAAK2U,IAAIgI,GACnBhW,GAAUkN,GAAe3M,OAAOlH,OAEpCsJ,EAAc1L,UAAUgf,WAAa,SAAUlK,EAAU7L,GACrD,IAAIF,EAASkN,GAAejN,MAAM5G,MAClCA,KAAKwb,KAAK9I,GACV/L,GAAUkN,GAAe3M,OAAOlH,OAEpCsJ,EAAc1L,UAAU+W,IAAM,SAAU1M,EAAQpB,GAC5C,GAAIoB,EAAQ,CACR,IAAIoI,EAAcrQ,KAAKsQ,mBAAmBrI,EAAQpB,GAClDwJ,GAAeA,EAAYnJ,SAE/B,OAAOlH,MAEXsJ,EAAc1L,UAAUif,WAAa,SAAU3d,GAC3C,OAAOc,KAAK2U,IAAIzV,EAAO4d,iBAAmB5d,GAAUyO,OAAO,KAE/DrE,EAAc1L,UAAU+M,MAAQ,SAAUoS,EAAMlW,GAAW,OAAOkW,GAClEzT,EAAc1L,UAAUof,QAAU,SAAU/W,GACxC,OAAOF,EAAiB/F,KAAMiG,EAAW,SAAUhE,EAAQ7D,GAAO,OAAO6D,EAAOhB,IAAMgB,EAAOhB,IAAI7C,GAAO6D,EAAO7D,MAEnHkL,EAAc1L,UAAU4I,SAAW,WAC/B,OAAOxG,KAAKmc,QAEhB7S,EAAc1L,UAAU2I,SAAW,WAC/B,IAAI4V,EAASnc,KAAKmc,OAClB,OAAOA,EAASA,EAAO5V,WAAavG,KAAKid,eAE7C3T,EAAc1L,UAAUgK,IAAM,SAAU8K,EAAUjP,GAC9C,IAAIlF,KAAUC,OAAkB,IAAZiF,EAAqB,SAAU+O,EAAGjI,GAAK,OAAOmI,EAASzO,KAAKR,EAAS+O,EAAGjI,IAAQmI,EAMpG,OALA1S,KAAKwb,KAAK,SAAU/G,EAAKrW,GACrB,IAAIK,EAASD,EAAIiW,EAAKrW,QACP,IAAXK,GACAF,EAAIoO,KAAKlO,KAEVF,GAEX+K,EAAc1L,UAAUsf,UAAY,SAAUxK,EAAUjP,GACpD,IAAItF,KAMJ,OALA6B,KAAKwb,KAAK,SAAU/G,EAAKrW,GACrB,IAAIK,EAASiU,EAAS+B,EAAKrW,QACZ,IAAXK,IACAN,EAAIC,GAAOK,KAEZN,GAEXT,OAAOkF,eAAe0G,EAAc1L,UAAW,mBAC3CqD,IAAK,WACD,IAAIoU,EAAQrV,KAAKqc,mBAAqBrc,KAAKqc,iBAAmB,IAAId,GAAgBvb,OAClF,OAAOqV,EAAM1W,OAAS0W,EAAQ,MAElC7B,YAAY,EACZC,cAAc,IAElBnK,EAAc1L,UAAUiL,SAAW,SAAU1K,KAC7CmL,EAAc1L,UAAUuf,mBAAqB,SAAU/e,GACnD,IAAIiX,EAAQrV,KAAKod,gBACjB,OAAQhf,EAAMiX,GAASA,EAAMhG,OAAOjR,GAAOiX,IAAU,MAEzD/L,EAAc1L,UAAUyf,oBAAsB,SAAUpX,GACpD,OAAOF,EAAiB/F,KAAMiG,EAAW,SAAUhE,EAAQ7D,GAAO,OAAO6D,EAAOkb,mBAAmB/e,MAEvGkL,EAAc1L,UAAU0f,oBAAsB,SAAU5K,GACpD,IAAI0K,EAAkBpd,KAAKod,gBAC3BA,GAAmBA,EAAgB3B,UAAU/I,EAAU1S,OAE3DsJ,EAAc1L,UAAU2f,QAAU,SAAUnf,GACxC,OAAQ4B,KAAKmd,mBAAmB/e,IAEpCkL,EAAc1L,UAAU4f,QAAU,WAAc,OAAOxd,KAAK8F,KAC5DwD,EAAc1L,UAAU6f,SAAW,WAAc,OAAOzd,KAAK8F,KAC7DwD,EAAc1L,UAAU8f,aAAe,WACnC,IAAIpe,EAAOU,KAAK/B,YAAYqB,KAC5B,GAAa,aAATA,EACA,OAAOA,GAEfgK,EAAgBiT,EAAkBzH,IAC9B/T,EACAU,GAAO6Y,KACRhR,GAEH,IAAIiT,KAGG1I,IACPjN,MAAO,SAAU3E,GACb,OAAOA,EAAOga,eAAwBha,EAAOga,cAAe,IAEhEjV,YAAa,SAAU/E,EAAQ4E,GAC3B,IAAI8W,GAAS9W,EAAQ6J,OAKrB,OAJIiN,IACA1b,EAAOia,SAAWrV,GACtB5E,EAAO+Z,gBACP/Z,EAAOoa,sBAAmB,EACnBsB,GAEXzW,OAAQ,SAAUjF,EAAQ2b,GACtB,IAAIC,EAAkB5b,EAAOia,SAC7B,GAAI2B,EAAiB,CACjB,KAAO5b,EAAOia,UAAU,CACpB,IAAIrV,EAAU5E,EAAOia,SACrBja,EAAOia,SAAW,KAClB9Y,GAASnB,EAAQA,EAAOwL,iBAAkBxL,EAAQ4E,EAAS+W,GAE/D3b,EAAOga,cAAe,EACtB,IAAIE,EAASla,EAAOka,OAChBA,GAAUA,IAAWyB,GACrBzB,EAAOzO,kBAAkBzL,EAAQ4b,QAIrC5b,EAAOia,SAAW,KAClBja,EAAOga,cAAe,GAG9B6B,OAAQ,SAAU5P,EAAOC,EAAO/P,GAC5B,OAAK+P,EAAMgO,OAKJhO,EAAMgO,SAAWjO,GAJpBC,EAAMgO,OAASjO,EACfC,EAAMiO,UAAYhe,GACX,IAIf6P,KAAM,SAAUC,EAAOC,GACfD,IAAUC,EAAMgO,SAChBhO,EAAMgO,YAAS,EACfhO,EAAMiO,eAAY,KlBzL1BjV,GAAS0M,GAAejN,MAAOW,GAAesM,GAAe7M,YAAaE,GAAS2M,GAAe3M,OAElG9D,GAAWyY,EAuBJkC,IACP1N,YAAa,SAAU7R,EAAKqI,QACR,IAAZA,IAAsBA,MAC1B,IAAIF,EAASC,EAAM5G,MACnBxB,EAAIyF,KAAKjE,KAAMA,MACf2G,GAAUO,GAAOlH,OAErB0N,kBAAmB,SAAUS,EAAOtH,GAChC,IAAIuV,EAAYjO,EAAMiO,UAAW4B,EAAYhe,KAAK8G,YAAYsV,GACzD4B,IAAaA,EAAUC,kBACxBje,KAAKke,qBAAqB9B,EAAWvV,IAE7CqX,qBAAsB,SAAU9f,EAAKyI,QACjB,IAAZA,IAAsBA,MAC1B,IAAIF,EAASC,EAAM5G,MACfgH,EAAYhH,KAAM6G,IAClBzD,GAASpD,KAAM,UAAY5B,EAAK4B,KAAMA,KAAKiH,WAAW7I,GAAMyI,GAEhEF,GAAUO,GAAOlH,OAErBsQ,mBAAoB,SAAU6N,EAAUtX,QACpB,IAAZA,IAAsBA,MAC1B,IACI6F,EADA/F,EAASC,EAAM5G,MAAOoe,KAAc/O,KAAavI,EAAc9G,KAAK8G,YAAamB,EAASpB,EAAQ8D,MAAQ3K,KAAK2K,MAAMwT,EAAUtX,GAAWsX,EAE9I,GAAInW,EAAiBhI,KAAMiI,GACvB,IAAK,IAAIwO,KAAUxO,EAAQ,CACvB,IAAIe,EAAOlC,EAAY2P,GACnBzN,EACIA,EAAKjC,SAASkB,EAAOwO,GAASzW,KAAM6G,EAASwI,IAC7C+O,EAAQzR,KAAK8J,IAIjB/J,IAAYA,MACZA,EAAQC,KAAK,IAAM8J,EAAS,MAMxC,GAAI2H,EAAQzf,QAAUqI,EAAYhH,KAAM6G,GACpC,OAAO,IAAIwX,GAAkBre,KAAM2G,EAAQ0I,EAAQ+O,GAEvD,IAAK,IAAIhc,EAAK,EAAGkc,EAAWjP,EAAQjN,EAAKkc,EAAS3f,OAAQyD,IAC7Bkc,EAASlc,GACf8E,OAAOlH,MAE9B2G,GAAUO,GAAOlH,QAiBrBqe,GAAqB,WACrB,SAASA,EAAkBpc,EAAQ0E,EAAQ0I,EAAQ+O,GAC/Cpe,KAAKiC,OAASA,EACdjC,KAAK2G,OAASA,EACd3G,KAAKqP,OAASA,EACdrP,KAAKoe,QAAUA,EAenB,OAbAC,EAAkBzgB,UAAUsJ,OAAS,SAAU0W,GAE3C,IAAK,IADD9b,EAAK9B,KAAMqP,EAASvN,EAAGuN,OAAQpN,EAASH,EAAGG,OAAQmc,EAAUtc,EAAGsc,QAC3Dhc,EAAK,EAAGmc,EAAWlP,EAAQjN,EAAKmc,EAAS5f,OAAQyD,IACpCmc,EAASnc,GACf8E,OAAOjF,GAGvB,IAAK,IADDgF,EAAahF,EAAOgF,WAAYiV,EAAWja,EAAOia,SAC7Cna,EAAK,EAAGyc,EAAYJ,EAASrc,EAAKyc,EAAU7f,OAAQoD,IAAM,CAC/D,IAAI3D,EAAMogB,EAAUzc,GACpBqB,GAASnB,EAAQ,UAAY7D,EAAK6D,EAAQgF,EAAW7I,GAAM8d,GAE/Dlc,KAAK2G,QAAUO,GAAOjF,EAAQ2b,IAE3BS,KC5GPpe,GAAWiV,EAAgB1V,GAAS6b,EACpCoD,MACAxT,GAAW,WACX,SAASA,EAAQ3L,EAAM0Q,GACnBhQ,KAAKV,KAAOA,EACZU,KAAK0e,QAAU,KACf1e,KAAK6G,QAAUmJ,EACf,IAAInJ,EAAUrH,IAASmf,YAAcC,cAAgBC,mBAAsB7O,GAC3EnJ,EAAQ8X,SAAW9X,EAAQ8X,SAASnO,QACpC3J,EAAQ+X,WAAa/X,EAAQ+X,WAAWpO,QACxC3J,EAAQgY,eAAiBhY,EAAQgY,eAAerO,QAChD,IAAIhT,EAAQqJ,EAAQrJ,MAAO4L,EAAOvC,EAAQuC,KAAMuB,EAAQ9D,EAAQ8D,MAAOY,EAAS1E,EAAQ0E,OAAQuT,EAAejY,EAAQiY,aAAcjW,EAAWhC,EAAQgC,SAAU8V,EAAW9X,EAAQ8X,SAAUC,EAAa/X,EAAQ+X,WAAYC,EAAiBhY,EAAQgY,eAuBzP,GAtBA7e,KAAKxC,MAAQA,EACbwC,KAAKoJ,KAAOA,GACPvC,EAAQ2C,kBAAoBJ,EAC7BpJ,KAAK+e,aAAe/e,KAAKwE,OAEpBwa,EAAkBxhB,GACvBwC,KAAK+e,aAAe,IAAIpX,SAAS,UAAYsX,KAAKC,UAAU1hB,GAAS,KAGrEwC,KAAK+e,aAAe/e,KAAK+e,aAE7B/e,KAAKie,kBAAoC,IAAjBa,EACxB9e,KAAKuL,YAAoB,IAAXA,EAAoBvL,KAAKuL,OAASA,EAChDvL,KAAK6I,SAAWA,GAAY7I,KAAK6I,SAC7BhC,EAAQsY,aACRnf,KAAK6I,SAAWD,EAAe5I,KAAK6I,WAExC+V,EAAWlc,QAAQ1C,KAAKof,SACxBpf,KAAK2K,MAAQA,GAAS3K,KAAK2K,MACvB3K,KAAKiB,KACL0d,EAASjc,QAAQ1C,KAAKiB,KAC1BjB,KAAKua,WAAWtW,KAAKjE,KAAM6G,GACvB8X,EAAShgB,OAAQ,CACjB,IAAI0gB,EAAYrf,KAAK0e,QAAUC,EAASW,OAAOnX,GAC3CoX,EAAavf,KAAK6I,SACtB7I,KAAK6I,SAAW,SAAUnC,EAAQlJ,EAAOY,GACrC,OAAOmhB,EAAWtb,KAAKjE,KAAM0G,EAAQ2Y,EAAUpb,KAAKyC,EAAQlJ,EAAOY,GAAMA,IAGjF4B,KAAKT,UAAYqf,EAAWjgB,OAASigB,EAAWU,OAAOhX,GAAmBtI,KAAKT,UAC/ES,KAAKwf,aAAeX,EAAelgB,OAASkgB,EAAeS,OAAO7W,GAAuBzI,KAAKwf,aAkElG,OAhEAvU,EAAQzG,OAAS,SAAUqC,EAASvH,GAChC,IAAI8J,EAAOvC,EAAQuC,KACnB,OAAO,IADkCvC,EAAQ6E,aAAetC,EAAOA,EAAKsC,WAAaT,IAChE3L,EAAMuH,IAEnCoE,EAAQrN,UAAU6hB,aAAe,SAAU9b,EAAMG,EAAM+C,KACvDoE,EAAQrN,UAAU2B,UAAY,SAAUuE,EAAMH,EAAM0J,EAAOxG,GAAW,OAAO/C,GAC7EmH,EAAQrN,UAAUwhB,QAAU,SAAUtb,EAAMH,EAAM0J,EAAOxG,GAAW,OAAO/C,GAC3EmH,EAAQrN,UAAU8hB,UAAY,SAAUxf,EAAGC,GACvC,OAAOF,GAASC,EAAGC,IAEvB8K,EAAQrN,UAAU4hB,aAAe,SAAU1b,EAAMH,EAAM0J,EAAOxG,KAC9DoE,EAAQrN,UAAU4G,OAAS,aAC3ByG,EAAQrN,UAAUgQ,MAAQ,SAAUpQ,EAAOkJ,GACvC,OAAOlJ,GAEXyN,EAAQrN,UAAUmP,QAAU,SAAUrG,EAAQlJ,GAC1CwC,KAAKwf,kBAAa,EAAQhiB,EAAOkJ,EAAQ+X,KAE7CxT,EAAQrN,UAAUiL,SAAW,SAAUnC,EAAQlJ,EAAOY,KACtD6M,EAAQrN,UAAU2N,OAAS,SAAU/N,EAAOY,GACxC,OAAOZ,GAASA,EAAM+N,OAAS/N,EAAM+N,SAAW/N,GAEpDyN,EAAQrN,UAAU+hB,yBAA2B,WACzC,IAAI7d,EAAK9B,KAAMV,EAAOwC,EAAGxC,KAAMof,EAAU5c,EAAG4c,QAC5C,GAAa,OAATpf,EACA,OACIqV,IAAK,SAAUnX,GACXiJ,EAAazG,KAAMV,EAAM9B,IAE7ByD,IAAMyd,EACF,WACI,OAAOA,EAAQza,KAAKjE,KAAMA,KAAKiH,WAAW3H,GAAOA,IAErD,WAAc,OAAOU,KAAKiH,WAAW3H,MAIrD2L,EAAQrN,UAAU2c,WAAa,SAAUjb,EAAMuH,KAC/CoE,EAAQrN,UAAUgiB,OAAS,SAAUpiB,EAAOkJ,EAAQG,GAChD,IAAI2L,OAAc,IAAVhV,EAAmBwC,KAAK+e,eAAiBvhB,EAAOwB,EAAIgB,KAAKT,UAAUiT,OAAG,EAAQ9L,EAAQG,GAE9F,OADA7G,KAAKwf,aAAaxgB,OAAG,EAAQ0H,EAAQG,GAC9B7H,GAEXiM,EAAQrN,UAAUmJ,SAAW,SAAUvJ,EAAOkJ,EAAQG,EAASwI,GAC3D,IAAI/P,EAAOU,KAAKV,KAAM2H,EAAaP,EAAOO,WAAYtD,EAAOsD,EAAW3H,GACpEwE,EAAO9D,KAAKT,UAAU/B,EAAOmG,EAAM+C,EAAQG,GAE/C,OADAI,EAAW3H,GAAQwE,IACf9D,KAAK0f,UAAU5b,EAAMH,KACrB3D,KAAKwf,aAAa1b,EAAMH,EAAM+C,EAAQG,IAC/B,IAIfoE,EAAQrN,UAAUsK,KAAO,SAAU6N,EAAO8J,EAAMriB,EAAOkJ,GACnD4U,GAAUvF,EAAO,4BAA8BrP,EAAOgX,eAAiB,IAAM1d,KAAKV,KAAO,KAAOugB,GAC5FC,OAAUpZ,EACVqZ,uBAAwB/f,KACxBggB,cAAetZ,EAAOO,WAAWjH,KAAKV,MACtC2gB,YAAaziB,KAGrByN,EAAQrN,UAAUmhB,aAAe,WAC7B,OAAO/e,KAAKxC,OAETyN,KkB9GPsI,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAYxClJ,GAAO4F,GAAe5F,KAAM6P,GAASjK,GAAeiK,OACpDoC,GAAkB,SAAUnN,GAE5B,SAASmN,IACL,OAAkB,OAAXnN,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAqF/D,OAvFAuT,GAAU2M,EAAgBnN,GAI1BmN,EAAetiB,UAAUgQ,MAAQ,SAAUpQ,GACvC,OAAOA,EAAQA,EAAMoQ,QAAUpQ,GAEnC0iB,EAAetiB,UAAU2N,OAAS,SAAUvM,GAAK,OAAOA,GAAKA,EAAEuM,UAC/D2U,EAAetiB,UAAUgiB,OAAS,SAAUpiB,EAAOkJ,EAAQG,GACvD,IAAI2L,EAAI3L,EAAQ+G,MAAQ5N,KAAK4N,MAAMpQ,QAAoB,IAAVA,EAAmBwC,KAAK+e,eAAiBvhB,EAClFwB,EAAIgB,KAAKT,UAAUiT,OAAG,EAAQ9L,EAAQG,GAE1C,OADA7G,KAAKwf,aAAaxgB,OAAG,EAAQ0H,EAAQG,GAC9B7H,GAEXkhB,EAAetiB,UAAUmJ,SAAW,SAAUvJ,EAAOkJ,EAAQG,EAASwI,GAClE,IAEIsN,EAFAve,EAAM4B,KAAKV,KAAM2H,EAAaP,EAAOO,WACrCtD,EAAOsD,EAAW7I,GAEtB,GAAIue,EAAS3c,KAAKyf,aAAa9b,EAAMnG,EAAOqJ,GAAU,CAClD,IAAIsZ,EAAoBxc,EAAK2M,mBAAmBqM,EAAQ9V,GACxD,SAAIsZ,IACI9Q,EACAA,EAAO1C,KAAKwT,GAGZA,EAAkBjZ,OAAOR,IAEzB1G,KAAKie,mBAKjB,IAAIna,EAAO9D,KAAKT,UAAU/B,EAAOmG,EAAM+C,EAAQG,GAE/C,OADAI,EAAW7I,GAAO0F,IACd9D,KAAK0f,UAAU5b,EAAMH,KACrB3D,KAAKwf,aAAa1b,EAAMH,EAAM+C,EAAQG,IAC/B,IAIfqZ,EAAetiB,UAAU6hB,aAAe,SAAU9b,EAAMG,EAAM+C,GAC1D,GAAIlD,GAAgB,MAARG,EAAc,CACtB,KAAIA,aAAgB9D,KAAKoJ,MAKrB,OAAOtF,EAJP,GAAI+C,EAAQ8G,MACR,OAAO7J,EAAKgZ,kBAO5BoD,EAAetiB,UAAUwhB,QAAU,SAAUtb,EAAMH,EAAM+C,EAAQG,GAC7D,OAAY,MAAR/C,EACOA,EACPA,aAAgB9D,KAAKoJ,OACjBtF,EAAKwJ,SAAaxJ,EAAKwJ,QAAUC,GAAc6S,YAC/CpgB,KAAKkI,KAAK,QAAS,qEAAsEpE,EAAM4C,GAE5FG,EAAQ8G,MAAQ7J,EAAK8J,QAAU9J,GAEnC9D,KAAKoJ,KAAK5E,OAAOV,EAAM+C,IAElCqZ,EAAetiB,UAAUmP,QAAU,SAAUrG,EAAQlJ,GAC7CA,GACAwC,KAAKwf,kBAAa,EAAQhiB,EAAOkJ,OAGzCwZ,EAAetiB,UAAUiL,SAAW,SAAUnC,EAAQlJ,GAClD,IAAI6X,EAAQ7X,GAASA,EAAM4f,gBAC3B,GAAI/H,EACA,OAAOA,GAEf6K,EAAetiB,UAAU4G,OAAS,WAC9B,OAAOxE,KAAKoJ,KAAK5E,UAErB0b,EAAetiB,UAAU2c,WAAa,SAAU1T,GAC5CA,EAAQgY,eAAenc,QAAQ1C,KAAKqgB,gBAExCH,EAAetiB,UAAUyiB,cAAgB,SAAUvc,EAAMH,EAAM+C,GACvD/C,IACAsK,GAAKvH,EAAQ/C,GACbA,EAAKoJ,WAELjJ,IAASga,GAAOpX,EAAQ5C,EAAM9D,KAAKV,OACnCU,KAAKkI,KAAK,QAAS,oEAAqEpE,EAAM4C,IAG/FwZ,GACTjV,IjBpGEzL,GAAS6b,EACTlS,GAA0B,WAC1B,SAASA,EAAuBtC,GAC5B7G,KAAK6G,SAAY8X,YAAcC,cAAgBC,mBAC3ChY,GACArH,GAAOQ,KAAK6G,QAASA,GAsF7B,OApFAsC,EAAuBvL,UAAU0iB,MAAQ,SAAUA,EAAOjL,GACtD,SAASxM,EAASwE,EAAO7P,EAAO8B,GAC5B,IAAKghB,EAAMrc,KAAKoJ,EAAO7P,EAAO8B,GAAO,CACjC,IAAIuW,EAAMR,GAASiL,EAAMjL,OAAS/V,EAAO,gBACzC,MAAsB,mBAARuW,EAAqBA,EAAI5R,KAAKoJ,EAAO/N,GAAQuW,GAGnE,IAAIlS,EAAO3D,KAAK6G,QAAQgC,SACxB,OAAO7I,KAAKugB,UACR1X,SAAUlF,WAAkB0J,EAAO7P,EAAO8B,GACtC,OAAOqE,EAAK0J,EAAO7P,EAAO8B,IAASuJ,EAASwE,EAAO7P,EAAO8B,IACzDuJ,KAGbnL,OAAOkF,eAAeuG,EAAuBvL,UAAW,UACpDqD,IAAK,WACD,OAAOU,EAAoB,aAAc3B,OAE7CwT,YAAY,EACZC,cAAc,IAElB/V,OAAOkF,eAAeuG,EAAuBvL,UAAW,cACpDqD,IAAK,WACD,OAAOjB,KAAKugB,UAAWpB,YAAY,KAEvC3L,YAAY,EACZC,cAAc,IAElBtK,EAAuBvL,UAAUuO,QAAU,SAAUC,GACjD,OAAOpM,KAAKugB,UAAWzU,UAAWM,KAEtCjD,EAAuBvL,UAAU+M,MAAQ,SAAUnM,GAC/C,OAAOwB,KAAKugB,UAAW5V,MAAOnM,KAElC2K,EAAuBvL,UAAU2N,OAAS,SAAU/M,GAChD,OAAOwB,KAAKugB,UACRhV,OAAuB,mBAAR/M,EAAqBA,EAAOA,EAAM,SAAUQ,GAAK,OAAOA,GAAKA,EAAEuM,UAAczC,KAGpGK,EAAuBvL,UAAUqD,IAAM,SAAUzC,GAC7C,OAAOwB,KAAKugB,UACR5B,SAAU3e,KAAK6G,QAAQ8X,SAAS7K,OAAOtV,MAG/C2K,EAAuBvL,UAAU+W,IAAM,SAAUnW,GAQ7C,OAAOwB,KAAKugB,UACR3B,WAAY5e,KAAK6G,QAAQ+X,WAAW9K,OARxC,SAAuBhQ,EAAMH,EAAM+C,EAAQG,GACvC,GAAI7G,KAAK0f,UAAU5b,EAAMH,GAAO,CAC5B,IAAI6c,EAAUhiB,EAAIyF,KAAKyC,EAAQ5C,EAAM9D,KAAKV,MAC1C,YAAmB,IAAZkhB,EAAqB7c,EAAO3D,KAAKof,QAAQoB,EAAS7c,EAAM+C,EAAQG,GAE3E,OAAOlD,OAMfwF,EAAuBvL,UAAUkhB,aAAe,SAAU9Z,GACtD,OAAOhF,KAAKugB,UAAWzB,aAAc9Z,KAEzCmE,EAAuBvL,UAAUoH,OAAS,SAAU4C,GAChD,IAAI6Y,EAAW,IAAIvH,GAAStR,GAK5B,OAAO5H,KAAKugB,UACR1B,eAAgB7e,KAAK6G,QAAQgY,eAAe/K,OALhD,SAAkChQ,EAAMH,EAAM+C,GAC1C/C,GAAQA,EAAKiX,SAAW6F,EAASnS,YAAY5H,EAAQ/C,GACrDG,GAAQA,EAAK8W,SAAW6F,EAASzS,UAAUtH,EAAQ5C,QAM3DpG,OAAOkF,eAAeuG,EAAuBvL,UAAW,OACpDqD,IAAK,WACD,OAAOjB,MAEXwT,YAAY,EACZC,cAAc,IAElBtK,EAAuBvL,UAAU2iB,SAAW,SAAU1Z,GAClD,IAAI6Z,EAAS,IAAIvX,EAAuBnJ,KAAK6G,SAE7C,OADArH,GAAOkhB,EAAO7Z,QAASA,GAChB6Z,GAEXvX,EAAuBvL,UAAUJ,MAAQ,SAAUwB,GAC/C,OAAOgB,KAAKugB,UAAW/iB,MAAOwB,EAAGwK,kBAAkB,KAEhDL,KAIXxB,SAAS/J,UAAUJ,MAAQ,SAAUwB,GACjC,OAAO,IAAImK,IAAyBC,KAAMpJ,KAAMxC,MAAOwB,EAAGwK,kBAAkB,KAEhF9L,OAAOkF,eAAe+E,SAAS/J,UAAW,cACtCqD,IAAK,WAAc,OAAOjB,KAAK2gB,aAAe3gB,KAAKkJ,IAAIiW,YACvDxK,IAAK,SAAU3V,GAAKgB,KAAK2gB,YAAc3hB,KAE3CtB,OAAOkF,eAAe+E,SAAS/J,UAAW,UACtCqD,IAAK,WAAc,OAAOjB,KAAKkJ,IAAI0X,UAEvCljB,OAAOkF,eAAe+E,SAAS/J,UAAW,OACtCqD,IAAK,WACD,OAAOjB,KAAK6gB,MAAQ,IAAI1X,IACpBC,KAAMpJ,KACNxC,MAAOwC,KAAK0L,WAAWqT,aACvBvV,sBAAmD,IAAjCxJ,KAAK0L,WAAWqT,gBAG1CpK,IAAK,SAAUnX,GAASwC,KAAK6gB,KAAOrjB,KCnHxC,IAAI+V,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAaxC2J,GAAY,SAAU/N,GAEtB,SAAS+N,IACL,OAAkB,OAAX/N,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAgC/D,OAlCAuT,GAAUuN,EAAU/N,GAIpB+N,EAASljB,UAAU4G,OAAS,WACxB,OAAO,IAAIuF,MAEf+W,EAASljB,UAAUwhB,QAAU,SAAUtb,EAAM5D,EAAGwG,GAC5C,GAAY,MAAR5C,GAAgBA,aAAgBiG,KAChC,OAAOjG,EACX,IAAI+F,EAAO,IAAIE,KAAKjG,GAAOoG,EAAYL,EAAKG,UAI5C,OAHIE,IAAcA,GACdlK,KAAKkI,KAAK,OAAQ,6BAA8BpE,EAAM4C,GAEnDmD,GAEXiX,EAASljB,UAAUiL,SAAW,SAAUwE,EAAO7P,EAAO8B,GAClD,GAAa,MAAT9B,EAAe,CACf,IAAI0M,EAAY1M,EAAMwM,UACtB,GAAIE,IAAcA,EACd,OAAO5K,EAAO,qBAG1BwhB,EAASljB,UAAU2N,OAAS,SAAU/N,GAAS,OAAOA,GAASA,EAAMujB,eACrED,EAASljB,UAAU8hB,UAAY,SAAUxf,EAAGC,GAAK,OAAQD,GAAKA,EAAE8J,cAAgB7J,GAAKA,EAAE6J,YACvF8W,EAASljB,UAAUgiB,OAAS,SAAUpiB,EAAOkJ,EAAQG,GACjD,OAAO7G,KAAKT,eAAoB,IAAV/B,EAAmBwC,KAAK+e,eAAiBvhB,OAAO,EAAQkJ,EAAQG,IAE1Fia,EAASljB,UAAUmJ,SAAW,SAAUvJ,EAAOkJ,EAAQG,EAASwI,GAC5D,IAAI/P,EAAOU,KAAKV,KAAM2H,EAAaP,EAAOO,WAAYtD,EAAOsD,EAAW3H,GACxE,OAAOU,KAAK0f,UAAU/b,EAAMsD,EAAW3H,GAAQU,KAAKT,UAAU/B,EAAOmG,EAAM+C,EAAQG,KAEvFia,EAASljB,UAAUgQ,MAAQ,SAAUpQ,GAAS,OAAOA,GAAS,IAAIuM,KAAKvM,EAAMwM,YAC7E8W,EAASljB,UAAUmP,QAAU,aACtB+T,GACT7V,IACFlB,KACK2B,WAAaoV,GAClB,IAAIE,GAAgB,uBAChBC,GAAc,SAAUlO,GAExB,SAASkO,IACL,OAAkB,OAAXlO,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAY/D,OAdAuT,GAAU0N,EAAYlO,GAItBkO,EAAWrjB,UAAUwhB,QAAU,SAAUtb,GACrC,GAAoB,iBAATA,EAAmB,CAC1B,IAAIod,EAASF,GAAc1W,KAAKxG,GAChC,GAAIod,EACA,OAAO,IAAInX,KAAKN,OAAOyX,EAAO,KAGtC,OAAOJ,GAASljB,UAAUwhB,QAAQrf,MAAMC,KAAMX,YAElD4hB,EAAWrjB,UAAU2N,OAAS,SAAU/N,GAAS,OAAOA,GAAS,SAAWA,EAAMwM,UAAY,MACvFiX,GACTH,IAEEK,GAAiB,SAAUpO,GAE3B,SAASoO,IACL,OAAkB,OAAXpO,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAG/D,OALAuT,GAAU4N,EAAepO,GAIzBoO,EAAcvjB,UAAU2N,OAAS,SAAU/N,GAAS,OAAOA,GAASA,EAAMwM,WACnEmX,GACTL,IACFpjB,OACOid,iBAAiB5Q,MACpBqX,WACIngB,IAAK,WACD,OAAO,IAAIkI,IACPC,KAAMW,KACN2B,WAAYuV,OAIxB/W,WACIjJ,IAAK,WACD,OAAO,IAAIkI,IACPC,KAAMW,KACN2B,WAAYyV,SAQvBvX,EAAa,0BACbA,EAAa,2BACbA,EAAa,4BACbA,EAAa,6BACbA,EAAa,mCACdkX,GAASljB,UAAUwhB,QAAU,SAAU5hB,GACnC,OAAgB,MAATA,GAAiBA,aAAiBuM,KAAOvM,EAAQ,IAAIuM,KAAKE,GAAczM,MAGvF,IAAIgN,IAAe,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,IAAKH,GAAiB,qIC9GxDkJ,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAYxCkK,GAAsB,SAAUtO,GAEhC,SAASsO,IACL,OAAkB,OAAXtO,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAiB/D,OAnBAuT,GAAU8N,EAAoBtO,GAI9BsO,EAAmBzjB,UAAU4G,OAAS,WAClC,OAAO,IAAIxE,KAAKoJ,MAEpBiY,EAAmBzjB,UAAUwhB,QAAU,SAAUtb,GAC7C,OAAe,MAARA,GAAgBA,aAAgB9D,KAAKoJ,KAAOtF,EAAO,IAAI9D,KAAKoJ,KAAKtF,IAE5Eud,EAAmBzjB,UAAU2N,OAAS,SAAU/N,GAC5C,OAAOA,GAASA,EAAM+N,OAAS/N,EAAM+N,SAAW/N,GAEpD6jB,EAAmBzjB,UAAUgQ,MAAQ,SAAUpQ,GAC3C,OAAO,IAAIwC,KAAKoJ,KAAKpJ,KAAKuL,OAAO/N,KAErC6jB,EAAmBzjB,UAAU8hB,UAAY,SAAUxf,EAAGC,GAClD,OAAOD,IAAMC,GAEVkhB,GACTpW,IACFtD,SAAS/J,UAAU8N,WAAa2V,GAChC,IAAIC,GAAiB,SAAUvO,GAE3B,SAASuO,IACL,OAAkB,OAAXvO,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAoB/D,OAtBAuT,GAAU+N,EAAevO,GAIzBuO,EAAc1jB,UAAUmP,QAAU,aAClCuU,EAAc1jB,UAAU4G,OAAS,WAAc,OAAOxE,KAAKoJ,QAC3DkY,EAAc1jB,UAAU2N,OAAS,SAAU/N,GAAS,OAAOA,GAC3D8jB,EAAc1jB,UAAUwhB,QAAU,SAAUtb,GAAQ,OAAe,MAARA,EAAeA,EAAO9D,KAAKoJ,KAAKtF,IAC3Fwd,EAAc1jB,UAAU8hB,UAAY,SAAUxf,EAAGC,GAAK,OAAOD,IAAMC,GACnEmhB,EAAc1jB,UAAUgQ,MAAQ,SAAUpQ,GAAS,OAAOA,GAC1D8jB,EAAc1jB,UAAUgiB,OAAS,SAAUpiB,EAAOkJ,EAAQG,GACtD,OAAO7G,KAAKT,eAAoB,IAAV/B,EAAmBwC,KAAKxC,MAAQA,OAAO,EAAQkJ,EAAQG,IAEjFya,EAAc1jB,UAAUmJ,SAAW,SAAUvJ,EAAOkJ,EAAQG,EAASwI,GACjE,IAAI/P,EAAOU,KAAKV,KAAM2H,EAAaP,EAAOO,WAAYtD,EAAOsD,EAAW3H,GACxE,OAAOqE,KAAUsD,EAAW3H,GAAQU,KAAKT,UAAU/B,EAAOmG,EAAM+C,EAAQG,KAE5Eya,EAAc1jB,UAAU2c,WAAa,WAC5Bva,KAAK6G,QAAQ2C,mBACdxJ,KAAKxC,MAAQwC,KAAKoJ,SAGnBkY,GACTrW,IACFtB,QACQ+B,WAAahC,OAAOgC,WAAa4V,GACzC,IAAIC,GAAe,SAAUxO,GAEzB,SAASwO,IACL,OAAkB,OAAXxO,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAiB/D,OAnBAuT,GAAUgO,EAAaxO,GAIvBwO,EAAY3jB,UAAU4G,OAAS,WAC3B,OAAO,GAEX+c,EAAY3jB,UAAUwhB,QAAU,SAAUtb,EAAMH,EAAM+C,GAClD,IAAI8a,EAAc,MAAR1d,EAAeA,EAAO9D,KAAKoJ,KAAKtF,GAI1C,OAHI0d,IAAQA,GACRxhB,KAAKkI,KAAK,OAAQ,+BAAgCpE,EAAM4C,GAErD8a,GAEXD,EAAY3jB,UAAUiL,SAAW,SAAUwE,EAAO7P,EAAO8B,GACrD,GAAa,MAAT9B,IAAkBikB,SAASjkB,GAC3B,OAAO8B,EAAO,wBAGfiiB,GACTD,IACF7X,OACOiC,WAAa6V,GAIpB3W,GAAQc,WAAa6V,GACrB9X,OAAOiY,QAAU9W,GACK,oBAAX+W,SACPA,OAAO/W,QAAUnB,OAAOiY,SAE5B,IAAIE,GAAa,SAAU7O,GAEvB,SAAS6O,IACL,OAAkB,OAAX7O,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAc/D,OAhBAuT,GAAUqO,EAAW7O,GAIrB6O,EAAUhkB,UAAU2N,OAAS,SAAU/N,GAAS,OAAOA,GACvDokB,EAAUhkB,UAAUmP,QAAU,aAC9B6U,EAAUhkB,UAAU4G,OAAS,WAAc,UAC3Cod,EAAUhkB,UAAUwhB,QAAU,SAAUtb,EAAMH,EAAM+C,GAChD,OAAY,MAAR5C,GAAgBjG,MAAMyU,QAAQxO,GACvBA,GACX9D,KAAKkI,KAAK,OAAQ,kCAAmCpE,EAAM4C,QAG/Dkb,EAAUhkB,UAAUgQ,MAAQ,SAAUpQ,GAClC,OAAOA,GAASA,EAAMgT,SAEnBoR,GACT3W,IACFpN,MACM6N,WAAakW,GACnB,IAAIC,GAAc,SAAU9O,GAExB,SAAS8O,IACL,OAAkB,OAAX9O,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAc/D,OAhBAuT,GAAUsO,EAAY9O,GAItB8O,EAAWjkB,UAAU2N,OAAS,SAAU/N,GAAS,OAAOA,GACxDqkB,EAAWjkB,UAAUmP,QAAU,aAC/B8U,EAAWjkB,UAAU4G,OAAS,WAAc,UAC5Cqd,EAAWjkB,UAAUwhB,QAAU,SAAUtb,EAAMH,EAAM+C,GACjD,OAAY,MAAR5C,GAAgBA,EAAK7F,cAAgBP,OAC9BoG,GACX9D,KAAKkI,KAAK,OAAQ,mCAAoCpE,EAAM4C,QAGhEmb,EAAWjkB,UAAUgQ,MAAQ,SAAUpQ,GACnC,OAAOA,GAAS6d,KAAiB7d,IAE9BqkB,GACT5W,IACFvN,OACOgO,WAAamW,GAEpB,IAAIC,GAAgB,SAAU/O,GAE1B,SAAS+O,IACL,OAAkB,OAAX/O,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAW/D,OAbAuT,GAAUuO,EAAc/O,GAIxB+O,EAAalkB,UAAU2N,OAAS,SAAU/N,KAC1CskB,EAAalkB,UAAU4G,OAAS,WAAc,OAAOuG,IACrD+W,EAAalkB,UAAUwhB,QAAU,SAAUtb,EAAMH,EAAM+C,GACnD,OAAY,MAAR5C,GAAgC,mBAATA,EAChBA,GACX9D,KAAKkI,KAAK,OAAQ,6BAA8BpE,EAAM4C,GAC/CqE,KAEX+W,EAAalkB,UAAUgQ,MAAQ,SAAUpQ,GAAS,OAAOA,GAClDskB,GACT7W,IACFtD,SACS+D,WAAaoW,GC1JtB,IAAIvO,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAaxC5S,GAAKuX,EAAclX,GAAMmX,EAAe9N,GAAO4F,GAAe5F,KAAM6P,GAASjK,GAAeiK,OAC5FiE,GAAiBxU,GAAcC,OAASD,GAAcyU,MACtDC,GAAc,SAAUlP,GAExB,SAASkP,IACL,OAAkB,OAAXlP,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAsF/D,OAxFAuT,GAAU0O,EAAYlP,GAItBkP,EAAWrkB,UAAUgiB,OAAS,SAAUpiB,EAAOkJ,EAAQG,GACnD,IAAI2L,EAAI3L,EAAQ+G,MAAQ5N,KAAK4N,MAAMpQ,EAAOkJ,QAAqB,IAAVlJ,EAAmBwC,KAAK+e,eAAiBvhB,EAC1FwB,EAAIgB,KAAKT,UAAUiT,OAAG,EAAQ9L,EAAQG,GAE1C,OADA7G,KAAKwf,aAAaxgB,OAAG,EAAQ0H,EAAQG,GAC9B7H,GAEXijB,EAAWrkB,UAAUmJ,SAAW,SAAUvJ,EAAOkJ,EAAQG,EAASwI,GAC9D,IAEIsN,EAFAve,EAAM4B,KAAKV,KAAM2H,EAAaP,EAAOO,WACrCtD,EAAOsD,EAAW7I,GAEtB,GAAIue,EAAS3c,KAAKyf,aAAa9b,EAAMnG,EAAOqJ,GAAU,CAClD,IAAIsZ,EAAoBxc,EAAK2M,mBAAmBqM,EAAQ9V,GACxD,SAAIsZ,IACI9Q,EACAA,EAAO1C,KAAKwT,GAGZA,EAAkBjZ,OAAOR,IAEzB1G,KAAKie,mBAKjB,IAAIna,EAAO9D,KAAKT,UAAU/B,EAAOmG,EAAM+C,EAAQG,GAE/C,OADAI,EAAW7I,GAAO0F,IACd9D,KAAK0f,UAAU5b,EAAMH,KACrB3D,KAAKwf,aAAa1b,EAAMH,EAAM+C,EAAQG,IAC/B,IAIfob,EAAWrkB,UAAUgQ,MAAQ,SAAUpQ,EAAOkJ,GAC1C,IAAKlJ,GAASA,EAAM2e,SAAWzV,EAC3B,OAAOlJ,EACX,IAAIoQ,EAAQpQ,EAAMoQ,QAElB,OADAkQ,GAAOpX,EAAQkH,EAAO5N,KAAKV,MACpBsO,GAEXqU,EAAWrkB,UAAU2N,OAAS,aAC9B0W,EAAWrkB,UAAU6hB,aAAe,SAAU9b,EAAMG,EAAM+C,GACtD,GAAIlD,GAAgB,MAARG,KAAkBA,aAAgB9D,KAAKoJ,MAC/C,OAAOtF,GAGfme,EAAWrkB,UAAUwhB,QAAU,SAAUtb,EAAMH,EAAM+C,EAAQG,GACzD,GAAY,MAAR/C,GAAgBA,aAAgB9D,KAAKoJ,KACrC,OAAOtF,EACX,IAAIoe,EAAiB,IAAIliB,KAAKoJ,KAAKtF,EAAM+C,EAASkb,IAElD,OADAjE,GAAOpX,EAAQwb,EAAgBliB,KAAKV,MAC7B4iB,GAEXD,EAAWrkB,UAAUiL,SAAW,SAAUwE,EAAO7P,EAAO8B,KACxD2iB,EAAWrkB,UAAU4G,OAAS,WAC1B,OAAO,MAEXyd,EAAWrkB,UAAUyiB,cAAgB,SAAUvc,EAAMH,EAAM+C,GACnD/C,IACIA,EAAKwY,SAAWzV,GAChBuH,GAAKvH,EAAQ/C,GACbA,EAAKoJ,WAGLnI,GAAIjB,EAAMA,EAAK8J,iBAAkBzN,KAAK8L,UAAWpF,IAGrD5C,GACIA,EAAKqY,SAAWzV,GAChBnC,GAAGT,EAAMA,EAAK2J,iBAAkBzN,KAAK8L,UAAWpF,IAI5Dub,EAAWrkB,UAAUmP,QAAU,SAAUrG,EAAQlJ,GACzCA,GACAwC,KAAKwf,kBAAa,EAAQhiB,EAAOkJ,OAGzCub,EAAWrkB,UAAU2c,WAAa,SAAU1T,GACxC,IAAImX,EAAYhe,KAChBA,KAAK8L,UAAY9L,KAAKie,iBAAmB,SAAU9P,EAAOtH,EAAS+W,GAC/D5d,OAAS4d,GAAa5d,KAAKke,qBAAqBF,EAAU1e,KAAMuH,IAChE3E,GACJ2E,EAAQgY,eAAenc,QAAQ1C,KAAKqgB,gBAEjC4B,GACThX,ICzGEkX,GAAsCzkB,OAAO8B,QAAU,SAAS8X,GAChE,IAAK,IAAID,EAAG3Y,EAAI,EAAG0jB,EAAI/iB,UAAUV,OAAQD,EAAI0jB,EAAG1jB,IAAK,CACjD2Y,EAAIhY,UAAUX,GACd,IAAK,IAAIwY,KAAKG,EAAO3Z,OAAOE,UAAUS,eAAe4F,KAAKoT,EAAGH,KACzDI,EAAEJ,GAAKG,EAAEH,IAEjB,OAAOI,MAcI,SAAU+K,EAAsBC,GAC3C,IAAIC,EAAeC,KAAgBH,EAAsBrX,IAAkByX,EAAgBC,KAAeH,EAAcD,GACpHK,EAAoBnb,EAAkBib,GAC1C,OAAON,MAAaQ,GAAqB7b,YAAa,IAAI6b,EAAkBtb,eAAeob,GAAgBG,iBAAkBllB,OAAOgD,KAAK+hB,GAAe7a,IAAI,SAAUxJ,GAAO,OAAOqkB,EAAcrkB,KAAUqc,WAAY+H,KAAgBD,EAAc,SAAUvjB,GAAK,OAAOA,EAAE2gB,6BAAgCkD,QAASvX,GAAamX,IAAkBvX,GAAWuX,GAAgB9W,GAAiB4W,KCvBlYhP,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAUxCgL,GAAsCzkB,OAAO8B,QAAU,SAAS8X,GAChE,IAAK,IAAID,EAAG3Y,EAAI,EAAG0jB,EAAI/iB,UAAUV,OAAQD,EAAI0jB,EAAG1jB,IAAK,CACjD2Y,EAAIhY,UAAUX,GACd,IAAK,IAAIwY,KAAKG,EAAO3Z,OAAOE,UAAUS,eAAe4F,KAAKoT,EAAGH,KACzDI,EAAEJ,GAAKG,EAAEH,IAEjB,OAAOI,GAEPxC,GAA0C,SAAU6E,EAAYJ,EAAQnb,EAAKyY,GAC7E,IAA2H5T,EAAvHD,EAAI3D,UAAUV,OAAQib,EAAI5W,EAAI,EAAIuW,EAAkB,OAAT1C,EAAgBA,EAAOnZ,OAAOoZ,yBAAyByC,EAAQnb,GAAOyY,EACrH,GAAuB,iBAAZgD,SAAoD,mBAArBA,QAAQC,SAAyBF,EAAIC,QAAQC,SAASH,EAAYJ,EAAQnb,EAAKyY,QACpH,IAAK,IAAInY,EAAIib,EAAWhb,OAAS,EAAGD,GAAK,EAAGA,KAASuE,EAAI0W,EAAWjb,MAAIkb,GAAK5W,EAAI,EAAIC,EAAE2W,GAAK5W,EAAI,EAAIC,EAAEsW,EAAQnb,EAAKwb,GAAK3W,EAAEsW,EAAQnb,KAASwb,GAChJ,OAAO5W,EAAI,GAAK4W,GAAKlc,OAAOkF,eAAe2W,EAAQnb,EAAKwb,GAAIA,GAK5Dpa,GAAS6b,EAAcnd,GAAU4kB,EAAetN,GAAM8F,GACtDyH,GAAc,EACdjD,GAAU,SAAU/M,GAEpB,SAAS+M,EAAO3B,EAAUnO,GACtB,IAAIkD,EAAQH,EAAO9O,KAAKjE,KAAM+iB,OAAkB/iB,KAChDkT,EAAMjM,cACN,IAAIJ,EAAUmJ,MAAiB/H,GAAUpB,EAAQ8D,MAAQuI,EAAMvI,MAAMwT,EAAUtX,GAAWsX,OAO1F,OANI3I,GAAIO,MAAQ,GACZtJ,GAAUyG,EAAOjL,GACrBiL,EAAMjM,WAAaiM,EAAM9L,oBAAsB,IAAI8L,EAAMnL,WAAWmL,EAAOjL,EAAQpB,GACnFqM,EAAMqH,WAAW4D,EAAUnO,GACvBkD,EAAMrH,cACNqH,EAAMrH,aAAamC,UAAUkF,EAAOA,GACjCA,EAsPX,OAjQAK,GAAUuM,EAAQ/M,GAaP+M,EACXA,EAAOlI,SAAW,SAAU9K,EAAYjM,KACxCif,EAAOpgB,SAAW,SAAUgI,GACxB,OAAO1H,KAAK8X,QAAS7Q,WAAYS,KAErCoY,EAAOliB,UAAUolB,mBAAqB,WAAc,OAAO,IAAIhjB,KAAKqH,eAAerH,KAAKoH,sBACxF1J,OAAOkF,eAAekd,EAAOliB,UAAW,mBACpCqD,IAAK,WAAc,OAAOjB,KAAKiH,YAC/BuM,YAAY,EACZC,cAAc,IAElB/V,OAAOkF,eAAekd,EAAOliB,UAAW,WACpCqD,IAAK,WACD,IAAIuf,EAAUxgB,KAAKsH,mBACnB,IAAKkZ,EAAS,CACV,IAAI7c,EAAO3D,KAAKoH,oBAChBoZ,KAEA,IAAK,IADD1e,EAAK9B,KAAoCiH,GAAhBnF,EAAGgF,YAA0BhF,EAAGmF,YACpD7E,EAAK,EAAGL,EAAK/B,KAAK4iB,iBAAkBxgB,EAAKL,EAAGpD,OAAQyD,IAAM,CAC/D,IAAIyF,EAAO9F,EAAGK,GACVhE,EAAMyJ,EAAKvI,KAAM9B,EAAQyJ,EAAW7I,GACpCyJ,EAAK6X,UAAUliB,EAAOmG,EAAKvF,MAC3BoiB,EAAQpiB,GAAOZ,GAGvBwC,KAAKsH,mBAAqBkZ,EAE9B,OAAOA,GAEXhN,YAAY,EACZC,cAAc,IAElBqM,EAAOliB,UAAUqlB,kBAAoB,SAAUC,GAC3C,IAAKA,EACD,QAAOljB,KAAKuQ,cAAe/Q,MAAWQ,KAAKwgB,SAC/C,IAAI/L,EAAK+L,GAAU,EAAO2C,EAAMnjB,KAAKic,aAAejc,KAAKoH,oBAAsBpH,KAAKiH,WAAY2E,EAAY5L,KAAK8G,YACjH,IAAK,IAAIe,KAAQqb,EACRtX,EAAU/D,GAAM6X,UAAUyD,EAAItb,GAAQ4M,EAAMyO,EAAKrb,OAErD2Y,IAAYA,OAAe3Y,GAAQ4M,GAExC,OAAO+L,GAEXV,EAAOliB,UAAU2S,WAAa,SAAUnS,GACpC,IAAIgJ,EAAsBpH,KAAKoH,oBAC/B,QAAKA,IAEEhJ,EACH4B,KAAK8G,YAAY1I,GAAKshB,UAAU1f,KAAKiH,WAAW7I,GAAMgJ,EAAoBhJ,KACzEF,GAAQ8B,KAAKwgB,WAEtBV,EAAOliB,UAAUqR,SAAW,SAAU7Q,GAClC,GAAIA,EAAK,CACL,IAAIgJ,EAAsBpH,KAAKoH,oBAC/B,GAAIA,EACA,OAAOA,EAAoBhJ,GAEnC,OAAO,MAEX0hB,EAAOliB,UAAUwlB,MAAQ,WACrB,OAAkB,MAAXpjB,KAAK8O,IAEhBgR,EAAOliB,UAAUsL,IAAM,SAAU9K,GAC7B,YAAoB,GAAb4B,KAAK5B,IAEhB0hB,EAAOliB,UAAUwQ,MAAQ,SAAUhQ,EAAKyI,GACpC,IAAIrJ,EAAQwC,KAAK5B,GAEjB,OADA4B,KAAK2U,KAAK7S,KAASA,EAAG1D,QAAO,EAAQ0D,GAAK+E,GACnCrJ,EACP,IAAIsE,GAERge,EAAOliB,UAAUylB,MAAQ,SAAUxc,GAC/B,IAAIqM,EAAQlT,KACRsjB,EAAUzc,GAAWA,EAAQyc,QAIjC,OAHAtjB,KAAKqQ,YAAY,WACb6C,EAAMqQ,YAAYrQ,EAAMjM,WAAY,SAAUzJ,EAAOY,GAAO,OAAO8U,EAAM9U,GAAOklB,EAAU,UAAO,KAClGzc,GACI7G,MAEX8f,EAAOliB,UAAU4I,SAAW,WACxB,IAAI0H,EAAQlO,KAAKmc,OACjB,OAAOnc,KAAKoc,UAAYlO,EAAQA,GAASA,EAAMiO,QAEnDze,OAAOkF,eAAekd,EAAOliB,UAAW,MACpCqD,IAAK,WAAc,OAAOjB,KAAKiH,WAAWjH,KAAK6M,cAC/C8H,IAAK,SAAU3V,GAAKyH,EAAazG,KAAMA,KAAK6M,YAAa7N,IACzDwU,YAAY,EACZC,cAAc,IAElBqM,EAAOliB,UAAU2lB,YAAc,SAAU7b,EAAOgL,GAC5C,IACIhG,EADA5F,EAAc9G,KAAK8G,YAEvB,IAAK,IAAI2P,KAAU/O,EAAO,CACtB,IAAIsB,EAAOlC,EAAY2P,GACnBzN,EACA0J,EAAShL,EAAM+O,GAASA,EAAQzN,IAGhC0D,IAAYA,MACZA,EAAQC,KAAK,IAAM8J,EAAS,MAGhC/J,GACA1M,KAAKkI,KAAK,OAAQ,cAAgBwE,EAAQ5E,KAAK,MAAQ,oBACnDb,WAAYS,KAIxBoY,EAAOliB,UAAU4d,KAAO,SAAU9I,EAAUjP,GACxC,IAAIjF,OAAkB,IAAZiF,EAAqB,SAAU+O,EAAGjI,GAAK,OAAOmI,EAASzO,KAAKR,EAAS+O,EAAGjI,IAAQmI,EAAUzL,EAAajH,KAAKiH,WACtH,IAAK,IAAI7I,KAAO4B,KAAKiH,WAAY,CAC7B,IAAIzJ,EAAQyJ,EAAW7I,QACT,IAAVZ,GACAgB,EAAIhB,EAAOY,KAGvB0hB,EAAOliB,UAAU8C,KAAO,WACpB,IAAIA,KAEJ,OADAV,KAAKwb,KAAK,SAAUpd,EAAKZ,GAAS,YAAiB,IAAVA,GAAoBkD,EAAKiM,KAAKvO,KAChEsC,GAEXof,EAAOliB,UAAUqK,OAAS,WACtB,OAAOjI,KAAK4H,IAAI,SAAUpK,GAAS,OAAOA,KAE9CsiB,EAAOliB,UAAUilB,QAAU,WAAc,UACzC/C,EAAOliB,UAAUyN,OAAS,SAAU0R,GAAQ,OAAOA,GACnD+C,EAAOliB,UAAU8B,SAAW,SAAUuI,GAClC,IAAIvI,KAAeoH,EAAc9G,KAAK8G,YACtC,IAAK,IAAI1I,KAAO0I,EAAa,CACzB,IAAItJ,EAAQyK,EAAO7J,GACnBsB,EAAStB,QAAiB,IAAVZ,EAAmBsJ,EAAY1I,GAAK2gB,eAAiBvhB,EAEzE,OAAOkC,GAEXogB,EAAOliB,UAAU2c,WAAa,SAAUtS,EAAQpB,KAChDiZ,EAAOliB,UAAUgQ,MAAQ,SAAU/G,QACf,IAAZA,IAAsBA,MAC1B,IAAIsN,EAAO,IAAInU,KAAK/B,YAAY+B,KAAKiH,YAAc2G,OAAO,IAG1D,OAFI/G,EAAQ2c,WACRrP,EAAK8I,cAAgBjd,KAAKuG,YACvB4N,GAEX2L,EAAOliB,UAAU6lB,UAAY,WAAc,OAAOzjB,KAAK4N,SAEvDkS,EAAOliB,UAAUsW,gBAAkB,SAAUwP,GACzC,IAAIxQ,EAAQlT,KACRrB,EAAS,EAQb,OAPAqB,KAAKujB,YAAYvjB,KAAKiH,WAAY,SAAUzJ,EAAO8B,EAAM0e,GACrD,IAAI3I,EAAQ2I,EAAUnV,SAASqK,EAAO1V,EAAO8B,GACzC+V,IACAqO,EAAOpkB,GAAQ+V,EACf1W,OAGDA,GAEXmhB,EAAOliB,UAAUqD,IAAM,SAAU7C,GAC7B,OAAO4B,KAAK5B,IAEhB0hB,EAAOliB,UAAU2N,OAAS,WACtB,IAAI2H,EAAQlT,KACR2jB,KASJ,OARA3jB,KAAKujB,YAAYvjB,KAAKiH,WAAY,SAAUzJ,EAAOY,EAAK0D,GACpD,IAAIyJ,EAASzJ,EAAGyJ,OAChB,QAAc,IAAV/N,EAAkB,CAClB,IAAIomB,EAASrY,EAAOtH,KAAKiP,EAAO1V,EAAOY,QACxB,IAAXwlB,IACAD,EAAKvlB,GAAOwlB,MAGjBD,GAEX7D,EAAOliB,UAAU+M,MAAQ,SAAUoS,EAAMlW,GACrC,OAAO7G,KAAKqL,OAAO0R,IAEvB+C,EAAOliB,UAAUimB,QAAU,SAAUvkB,EAAM9B,EAAOqJ,GAC9C,IAAIqM,EAAQlT,KA6BZ,OA5BAA,KAAKqQ,YAAY,WAGb,IAAK,IAFDlK,EAAO7G,EAAK8F,MAAM,KAAM0e,EAAI3d,EAAKxH,OAAS,EAAGkJ,EAAO1B,EAAK2d,GACzDzW,EAAQ6F,EACHxU,EAAI,EAAGA,EAAIolB,EAAGplB,IAAK,CACxB,IAAIN,EAAM+H,EAAKzH,GACXoF,EAAOuJ,EAAMpM,IAAMoM,EAAMpM,IAAI7C,GAAOiP,EAAMjP,GAC9C,IAAK0F,EAAM,CACP,IAAI8H,EAAYyB,EAAMvG,YACtB,IAAI8E,EAQA,OAPA,IAAImY,EAAWnY,EAAUxN,GAAKoG,SAC1BqC,GAAWA,EAAQyc,SAAWS,EAASjd,aACvCid,EAASV,MAAMxc,GAEnBwG,EAAMjP,GAAO0F,EAAOigB,EAK5B1W,EAAQvJ,EAERuJ,EAAMsH,IACNtH,EAAMsH,KAAK7S,KAASA,EAAG+F,GAAQrK,EAAOsE,GAAK+E,GAG3CwG,EAAMxF,GAAQrK,EAElB,IAAIsE,IAED9B,MAEXtC,OAAOkF,eAAekd,EAAOliB,UAAW,cACpCqD,IAAK,WACD,OAAOjB,KAAKoc,UAAY,KAAOpc,KAAKmc,QAExC3I,YAAY,EACZC,cAAc,IAElBqM,EAAOliB,UAAUmP,QAAU,WACvB,IAAImG,EAAQlT,KACRA,KAAKmb,YAETnb,KAAKujB,YAAYvjB,KAAKiH,WAAY,SAAUzJ,EAAOY,EAAK4f,GACpDA,EAAUjR,QAAQmG,EAAO1V,KAE7BuV,EAAOnV,UAAUmP,QAAQ9I,KAAKjE,QAElC8f,EAAOliB,UAAUsK,KAAO,SAAU6N,EAAO8J,EAAM/J,GAC3CwF,GAAUvF,EAAO,YAAc8J,EAAMsC,IAAWrC,OAAU9f,KAAMgkB,yBAA0BhkB,KAAK8G,aAAegP,KAElHgK,EAAOliB,UAAU8f,aAAe,WAC5B,OAAO3K,EAAOnV,UAAU8f,aAAazZ,KAAKjE,OAAS,UAEvD8f,EAAOliB,UAAU0S,mBAAqB,SAAUrI,EAAQpB,KACxDiZ,EAAoBhL,IAChB/T,GACIub,UAAW,IACX7O,iBAAkB,SAClBZ,YAAa,OAEjBtL,GACI7B,SAAU+Y,GAAW9K,MACrB1G,WAAYwR,GAAW9K,MACvBX,WAAYyL,GAAW9K,MACvBsW,WAAYxL,GAAWjb,MACvBqP,YAAa4L,GAAWC,cAE7BoH,IAGLxW,IAGF9J,GAAOsgB,GAAOliB,UAAWmgB,IACzB,IAAImG,GAAwB,WAIxB,OAHA,SAA8Bxd,EAAQ1H,EAAG6H,GACrC7G,KAAK8O,GAAK9P,EAAE8P,OAIpBgR,GAAOliB,UAAUmK,WAAamc,GAC9B,IAAIC,GAA4B,WAI5B,OAHA,SAAkCnlB,GAC9BgB,KAAK8O,GAAK9P,EAAE8P,OAIpBgR,GAAOliB,UAAUyJ,eAAiB8c,GAClC,IAAIC,GAAcnZ,GAAQzG,QAAShH,WAAO,GAAU,MACpDsiB,GAAOliB,UAAUkJ,aAAgBgI,GAAIsV,IACrCtE,GAAOliB,UAAUglB,kBAAoBwB,IACrCtE,GAAOliB,UAAU8B,SAAW,SAAUgI,GAElC,YADc,IAAVA,IAAoBA,OACfoH,GAAIpH,EAAMoH,KAEvBgR,GAAOpU,WAAawU,GC1TpB,IAAI3M,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAUxCrC,GAA0C,SAAU6E,EAAYJ,EAAQnb,EAAKyY,GAC7E,IAA2H5T,EAAvHD,EAAI3D,UAAUV,OAAQib,EAAI5W,EAAI,EAAIuW,EAAkB,OAAT1C,EAAgBA,EAAOnZ,OAAOoZ,yBAAyByC,EAAQnb,GAAOyY,EACrH,GAAuB,iBAAZgD,SAAoD,mBAArBA,QAAQC,SAAyBF,EAAIC,QAAQC,SAASH,EAAYJ,EAAQnb,EAAKyY,QACpH,IAAK,IAAInY,EAAIib,EAAWhb,OAAS,EAAGD,GAAK,EAAGA,KAASuE,EAAI0W,EAAWjb,MAAIkb,GAAK5W,EAAI,EAAIC,EAAE2W,GAAK5W,EAAI,EAAIC,EAAEsW,EAAQnb,EAAKwb,GAAK3W,EAAEsW,EAAQnb,KAASwb,GAChJ,OAAO5W,EAAI,GAAK4W,GAAKlc,OAAOkF,eAAe2W,EAAQnb,EAAKwb,GAAIA,GAE5DxC,GAAkC,SAAUC,EAAGnU,GAC/C,IAAIoU,KACJ,IAAK,IAAIJ,KAAKG,EAAO3Z,OAAOE,UAAUS,eAAe4F,KAAKoT,EAAGH,IAAMhU,EAAE4O,QAAQoF,GAAK,IAC9EI,EAAEJ,GAAKG,EAAEH,IACb,GAAS,MAALG,GAAqD,mBAAjC3Z,OAAO6Z,sBAC3B,IAAK,IAAI7Y,EAAI,EAAGwY,EAAIxZ,OAAO6Z,sBAAsBF,GAAI3Y,EAAIwY,EAAEvY,OAAQD,IAASwE,EAAE4O,QAAQoF,EAAExY,IAAM,IAC1F4Y,EAAEJ,EAAExY,IAAM2Y,EAAEH,EAAExY,KACtB,OAAO4Y,GASP9X,GAAS6b,EAAc3b,GAAW2kB,EACtCvE,GAAO1e,SAAW,SAAUP,GACxByI,GAAclI,SAAS6C,KAAKjE,KAAMa,GAClC,IAAI7C,EAAQgC,KACRskB,EAAqB,SAAUvR,GAE/B,SAASuR,IACL,OAAkB,OAAXvR,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAM/D,OARAuT,GAAU+Q,EAAmBvR,GAI7BuR,EAAkBjX,MAAQrP,EAC1BsmB,EAAoBxP,IAChBnU,GACD2jB,IAELzjB,EAAUojB,YACZjkB,KAAKskB,kBAAoBA,EACrBtmB,EAAMimB,aAAepjB,EAAUojB,aAC/BjkB,KAAKikB,WAAaK,GAEtB9Y,GAAqBxL,KAAMiiB,KAE/BnC,GAAOlI,SAAW,SAAU9K,EAAYjM,GACpC,IAAI8X,EAAY9X,EAAUjD,UACtBkE,EAAKyiB,GAAQvkB,KAAKiH,WAAa2F,GAAcE,GAAa6L,EAAU7R,aAAc2T,EAAa3Y,EAAG2Y,WAAY5O,EAAe/J,EAAG+J,aAAc2Y,EAAepN,GAAOtV,GAAK,aAAc,iBAC3LtC,GAAOQ,KAAKpC,UAAW4mB,GACvB1X,EAAW2N,WAAa/a,GAASoN,EAAW2N,eAAkBA,GAC9D3N,EAAWjB,aAAeA,EAC1BvC,GAAcsO,SAAS3T,KAAKjE,KAAM8M,EAAYjM,GAC9Cb,KAAKskB,kBAAkBvjB,OAAO+L,EAAWE,gBACzChN,KAAKikB,WAAanX,EAAWmX,WAC7BjkB,KAAKikB,WAAWrmB,UAAUyP,MAAQrN,MAEtC8f,GAAOpU,WAAawU,GACpB1U,GAAqBsU,GAAQmC,IC/D7B,IAAmC5e,GAAWohB,EAAoBrhB,GAAWyY,EAAoBtX,GAAKuX,EAAclX,GAAMmX,EAAe7U,GAAS2M,GAAe3M,OAAkD2G,GAAUgG,GAAeiK,OAAQzP,GAAQwF,GAAe5F,KA2EvQyB,GAAyB,WACzB,SAASA,EAAsBzN,EAAQ0E,EAAQ2I,EAAO0B,EAAS3B,EAAQ8B,GACnEnR,KAAKiC,OAASA,EACdjC,KAAK2G,OAASA,EACd3G,KAAKsP,MAAQA,EACbtP,KAAKgR,QAAUA,EACfhR,KAAKqP,OAASA,EACdrP,KAAKmR,OAASA,EAkClB,OAhCAzB,EAAsB9R,UAAUsJ,OAAS,SAAU0W,GAE/C,IAAK,IADD9b,EAAK9B,KAAMqP,EAASvN,EAAGuN,OAAQpN,EAASH,EAAGG,OAAQia,EAAWja,EAAOia,SAChE9Z,EAAK,EAAGkc,EAAWjP,EAAQjN,EAAKkc,EAAS3f,OAAQyD,KAClDiO,EAAciO,EAASlc,IACf8E,OAAOjF,GAEnBA,EAAO6L,mBACPoB,GAAoBjN,GAExB,IAAK,IAAIF,EAAK,EAAGwc,EAAWlP,EAAQtN,EAAKwc,EAAS5f,OAAQoD,IAAM,CAC5D,IAAIsO,EAAckO,EAASxc,GAC3BsB,GAASpB,EAAQ,SAAUoO,EAAYpO,OAAQia,GAGnD,IAAK,IADDwI,EAAK1kB,KAAMsP,EAAQoV,EAAGpV,MAAO0B,EAAU0T,EAAG1T,QACrC2T,EAAK,EAAGC,EAAUtV,EAAOqV,EAAKC,EAAQjmB,OAAQgmB,IAAM,CACrDje,EAASke,EAAQD,GACrBvhB,GAASsD,EAAQ,MAAOA,EAAQzE,EAAQia,GACxC9Y,GAASnB,EAAQ,MAAOyE,EAAQzE,EAAQia,GAE5C,IAAK,IAAI2I,EAAK,EAAGC,EAAY9T,EAAS6T,EAAKC,EAAUnmB,OAAQkmB,IAAM,CAC/D,IAAIne,EAASoe,EAAUD,GACvBzhB,GAASsD,EAAQ,SAAUA,EAAQzE,EAAQia,GAC3C9Y,GAASnB,EAAQ,SAAUyE,EAAQzE,EAAQia,GAE3Clc,KAAKmR,QACL9N,GAASpB,EAAQ,OAAQA,EAAQia,IAEjC5M,EAAM3Q,QAAUqS,EAAQrS,SACxB0E,GAASpB,EAAQ,SAAUA,EAAQia,GAEvClc,KAAK2G,QAAUO,GAAOjF,EAAQ2b,IAE3BlO,KCpHP9I,GAAQiN,GAAejN,MAAOM,GAAS2M,GAAe3M,OAAQF,GAAc6M,GAAe7M,YCA3FJ,GAAQiN,GAAejN,MAAOM,GAAS2M,GAAe3M,OAAQF,GAAc6M,GAAe7M,YAC3F4J,IAAkBF,QAAQ,GCA1BrN,GAAWohB,EAAoBrhB,GAAWyY,EAAoB7U,GAAc6M,GAAe7M,YAAaJ,GAAQiN,GAAejN,MAAOM,GAAS2M,GAAe3M,OCH9JqM,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAUxCgL,GAAsCzkB,OAAO8B,QAAU,SAAS8X,GAChE,IAAK,IAAID,EAAG3Y,EAAI,EAAG0jB,EAAI/iB,UAAUV,OAAQD,EAAI0jB,EAAG1jB,IAAK,CACjD2Y,EAAIhY,UAAUX,GACd,IAAK,IAAIwY,KAAKG,EAAO3Z,OAAOE,UAAUS,eAAe4F,KAAKoT,EAAGH,KACzDI,EAAEJ,GAAKG,EAAEH,IAEjB,OAAOI,GAEPxC,GAA0C,SAAU6E,EAAYJ,EAAQnb,EAAKyY,GAC7E,IAA2H5T,EAAvHD,EAAI3D,UAAUV,OAAQib,EAAI5W,EAAI,EAAIuW,EAAkB,OAAT1C,EAAgBA,EAAOnZ,OAAOoZ,yBAAyByC,EAAQnb,GAAOyY,EACrH,GAAuB,iBAAZgD,SAAoD,mBAArBA,QAAQC,SAAyBF,EAAIC,QAAQC,SAASH,EAAYJ,EAAQnb,EAAKyY,QACpH,IAAK,IAAInY,EAAIib,EAAWhb,OAAS,EAAGD,GAAK,EAAGA,KAASuE,EAAI0W,EAAWjb,MAAIkb,GAAK5W,EAAI,EAAIC,EAAE2W,GAAK5W,EAAI,EAAIC,EAAEsW,EAAQnb,EAAKwb,GAAK3W,EAAEsW,EAAQnb,KAASwb,GAChJ,OAAO5W,EAAI,GAAK4W,GAAKlc,OAAOkF,eAAe2W,EAAQnb,EAAKwb,GAAIA,GAS5DvW,GAAWohB,EAA4D7d,GAAQiN,GAAejN,MAAOM,GAAS2M,GAAe3M,OAAQF,GAAc6M,GAAe7M,YAAiDxH,GAAS6b,EAAc3b,GAAW2kB,EACrPU,GAAS,EAETvU,GAAQ3S,MAAMD,UAAU4S,MACxBwU,GAAsB,SAAUjS,GAEhC,SAASiS,IACL,OAAkB,OAAXjS,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAG/D,OALAuT,GAAUyR,EAAoBjS,GAI9BiS,EAAmBjG,gBACZiG,GACT/C,IACEgC,GAAc,SAAUlR,GAExB,SAASkR,EAAWjP,EAASnO,EAAS0C,QAClB,IAAZ1C,IAAsBA,MAC1B,IAAIqM,EAAQH,EAAO9O,KAAKjE,KAAM+kB,OAAa/kB,KAsB3C,OArBAkT,EAAMjG,UACNiG,EAAMhG,SACNgG,EAAMkB,WAAalB,EAAMkB,gBACE,IAAvBvN,EAAQuN,aACRlB,EAAMkB,WAAavN,EAAQuN,WAC3BvN,EAAQuN,gBAAa,GAEzBlB,EAAM7F,MAAQ6F,EAAM7F,MAChBxG,EAAQwG,QACR6F,EAAM7F,MAAQxG,EAAQwG,MACtBxG,EAAQwG,WAAQ,GAEpB6F,EAAMrG,YAAcqG,EAAM7F,MAAMzP,UAAUiP,YAC1CqG,EAAM5F,QAAU/D,GAAU,EACtByL,GAEAvE,GAAoByC,EADLf,GAAWe,EAAO8B,EAASnO,GACLA,GAAS,GAElDqM,EAAMqH,WAAWxa,MAAMmT,EAAO7T,WAC1B6T,EAAMrH,cACNqH,EAAMrH,aAAamC,UAAUkF,EAAOA,GACjCA,EAiUX,OA1VAK,GAAU0Q,EAAYlR,GA2BPkR,EACfA,EAAWrmB,UAAUqnB,aAAe,SAAUhY,EAAQpG,GAClD,IAA6Dqe,EAAS,IAAIC,EAA3DnlB,KAAK/B,YAAYmnB,SAASplB,MAAM6G,QAAQuC,MAA4B6D,EAAQpG,GAE3F,OADAqe,EAAO3Y,QAAQvM,MACRklB,GAEXjB,EAAW7iB,SAAW,SAAUP,GAG5B,SAASwkB,EAAenlB,EAAGC,EAAGqN,GAC1BlM,EAAK2C,KAAKjE,KAAME,EAAGC,EAAGoN,GAAcyU,OAASxU,EAASD,GAAcC,OAAS,IAHjF,IAAIlM,EAAOtB,KACXA,KAAKslB,UAAY,KAIjBpkB,GAAQO,OAAON,SAASkkB,GACxBA,EAAeznB,UAAYoC,KAAKpC,UAChCynB,EAAe3Z,WAAasZ,GAC5BhlB,KAAKulB,KAAOvlB,KAAKwlB,OAASH,EAC1B/b,GAAclI,SAAS6C,KAAKjE,KAAMa,GAClC2K,GAAqBxL,KAAMiiB,KAE/BgC,EAAWrM,SAAW,SAAU9K,EAAYjM,GACxC,GAAIiM,EAAW2Y,WAAY,CACvB,IAAI/K,EAAY,IAAIxB,GAASrY,EAAUjD,UAAUmQ,aACjD2M,EAAUtB,aAAatM,EAAW2Y,YAClCzlB,KAAKpC,UAAUmQ,YAAc2M,EAE7B5N,EAAWsH,aACXpU,KAAKpC,UAAUwW,WAAatH,EAAWsH,YAC3C9K,GAAcsO,SAAS3T,KAAKjE,KAAM8M,IAEtCpP,OAAOkF,eAAeqhB,EAAWrmB,UAAW,mBACxCqD,IAAK,WAAc,OAAOjB,KAAKiN,QAC/BuG,YAAY,EACZC,cAAc,IAElB/V,OAAOkF,eAAeqhB,EAAWrmB,UAAW,cACxCqD,IAAK,WAAc,OAAOjB,KAAK0O,aAC/BiG,IAAK,SAAU3V,GACX,IAAIkU,EAAQlT,KACZ,cACehB,GACX,IAAK,SACDgB,KAAK0O,YAAc,SAAUxO,EAAGC,GAC5B,IAAIulB,EAAKxlB,EAAElB,GAAI2mB,EAAKxlB,EAAEnB,GACtB,OAAI0mB,IAAOC,EACA,EACJD,EAAKC,GAAM,EAAI,GAE1B,MACJ,IAAK,WACgB,IAAb3mB,EAAEL,OACFqB,KAAK0O,YAAc,SAAUxO,EAAGC,GAC5B,IAAIulB,EAAK1mB,EAAEiF,KAAKiP,EAAOhT,GAAIylB,EAAK3mB,EAAEiF,KAAKiP,EAAO/S,GAC9C,OAAIulB,IAAOC,EACA,EACJD,EAAKC,GAAM,EAAI,GAI1B3lB,KAAK0O,YAAc,SAAUxO,EAAGC,GAAK,OAAOnB,EAAEiF,KAAKiP,EAAOhT,EAAGC,IAEjE,MACJ,QACIH,KAAK0O,YAAc,OAG/B8E,YAAY,EACZC,cAAc,IAElBwQ,EAAWrmB,UAAU2I,SAAW,WAC5B,OAAOvG,KAAK4lB,SAAW5lB,KAAK4lB,OAAS5lB,KAAKmc,OAASnc,KAAKmc,OAAO5V,WAAavG,KAAKid,gBAErFgH,EAAWrmB,UAAU8P,kBAAoB,SAAUhH,EAAQG,EAAS+W,GAEhE,QADgB,IAAZ/W,IAAsBA,MACtB+W,IAAc5d,KAAlB,CAEA,IAAI6M,EAAc7M,KAAK6M,YACnBnG,EAAO6J,WAAW1D,IAClBmC,GAAYhP,KAAKkN,MAAOxG,GAE5B,IAAIC,EAASC,GAAM5G,MACfgH,GAAYhH,KAAM6G,IAClBxD,GAASrD,KAAM,SAAU0G,EAAQG,GAErCF,GAAUO,GAAOlH,QAErBikB,EAAWrmB,UAAUqD,IAAM,SAAUgT,GACjC,GAAe,MAAXA,EAAJ,CAEA,GAAuB,iBAAZA,EAAsB,CAC7B,IAAInF,EAAKmF,EAAQjU,KAAK6M,aACtB,YAAe,IAAPiC,GAAiB9O,KAAKkN,MAAM4B,IAAQ9O,KAAKkN,MAAM+G,EAAQnO,KAG/D,OAAO9F,KAAKkN,MAAM+G,KAG1BgQ,EAAWrmB,UAAU4d,KAAO,SAAU9I,EAAUjP,GAE5C,IAAK,IADDjF,EAAM+T,GAAYG,EAAUjP,GAAUwJ,EAASjN,KAAKiN,OAC/CvO,EAAI,EAAGA,EAAIuO,EAAOtO,OAAQD,IAC/BF,EAAIyO,EAAOvO,GAAIA,IAGvBulB,EAAWrmB,UAAUE,MAAQ,SAAU4U,EAAUjP,GAE7C,IAAK,IADDjF,EAAMiU,GAAoBC,EAAUjP,GAAUwJ,EAASjN,KAAKiN,OACvDvO,EAAI,EAAGA,EAAIuO,EAAOtO,OAAQD,IAC/B,IAAKF,EAAIyO,EAAOvO,GAAIA,GAChB,OAAO,EAEf,OAAO,GAEXulB,EAAWrmB,UAAUwN,OAAS,SAAUsH,EAAUjP,GAC9C,IAAIjF,EAAMiU,GAAoBC,EAAUjP,GACxC,OAAOzD,KAAK4H,IAAI,SAAU5I,EAAGN,GAAK,OAAOF,EAAIQ,EAAGN,GAAKM,OAAI,KAE7DilB,EAAWrmB,UAAUioB,KAAO,SAAUnT,EAAUjP,GAE5C,IAAK,IADDjF,EAAMiU,GAAoBC,EAAUjP,GAAUwJ,EAASjN,KAAKiN,OACvDvO,EAAI,EAAGA,EAAIuO,EAAOtO,OAAQD,IAC/B,GAAIF,EAAIyO,EAAOvO,GAAIA,GACf,OAAOuO,EAAOvO,GAEtB,OAAO,MAEXulB,EAAWrmB,UAAUiB,KAAO,SAAU6T,EAAUjP,GAC5C,OAAOkG,QAAQ3J,KAAK6lB,KAAKnT,EAAUjP,KAEvCwgB,EAAWrmB,UAAUgK,IAAM,SAAU8K,EAAUjP,GAG3C,IAAK,IAFDjF,EAAM+T,GAAYG,EAAUjP,GAAUwJ,EAASjN,KAAKiN,OAAQ6Y,EAASjoB,MAAMoP,EAAOtO,QAClFmR,EAAI,EACCpR,EAAI,EAAGA,EAAIuO,EAAOtO,OAAQD,IAAK,CACpC,IAAIM,EAAIR,EAAIyO,EAAOvO,GAAIA,QACjB,IAANM,IAAiB8mB,EAAOhW,KAAO9Q,GAGnC,OADA8mB,EAAOnnB,OAASmR,EACTgW,GAEX7B,EAAWrmB,UAAUsW,gBAAkB,SAAUwP,GAC7C,GAAI1jB,KAAKsN,QACL,OAAO,EACX,IAAIyY,EAAQ,EAQZ,OAPA/lB,KAAKwb,KAAK,SAAU9U,GAChB,IAAI2O,EAAQ3O,EAAO0W,gBACf/H,IACAqO,EAAOhd,EAAOZ,KAAOuP,EACrB0Q,OAGDA,GAEX9B,EAAWrmB,UAAU2c,WAAa,aAClC7c,OAAOkF,eAAeqhB,EAAWrmB,UAAW,UACxCqD,IAAK,WAAc,OAAOjB,KAAKiN,OAAOtO,QACtC6U,YAAY,EACZC,cAAc,IAElBwQ,EAAWrmB,UAAUkC,MAAQ,WAAc,OAAOE,KAAKiN,OAAO,IAC9DgX,EAAWrmB,UAAUooB,KAAO,WAAc,OAAOhmB,KAAKiN,OAAOjN,KAAKiN,OAAOtO,OAAS,IAClFslB,EAAWrmB,UAAU+R,GAAK,SAAUsW,GAChC,IAAIpX,EAAQoX,EAAU,EAAIA,EAAUjmB,KAAKiN,OAAOtO,OAASsnB,EACzD,OAAOjmB,KAAKiN,OAAO4B,IAEvBoV,EAAWrmB,UAAUgQ,MAAQ,SAAU/G,QACnB,IAAZA,IAAsBA,MAC1B,IAAIoG,EAASjN,KAAKsN,QAAUC,GAAcyU,MAAQhiB,KAAKiN,OAASjN,KAAK4H,IAAI,SAAUyF,GAAS,OAAOA,EAAMO,UAAauG,EAAO,IAAInU,KAAK/B,YAAYgP,GAAUI,MAAOrN,KAAKqN,MAAO+G,WAAYpU,KAAKoU,YAAcpU,KAAKsN,SAGnN,OAFIzG,EAAQ2c,WACRrP,EAAK8I,cAAgBjd,KAAKuG,YACvB4N,GAEX8P,EAAWrmB,UAAU2N,OAAS,WAC1B,OAAOvL,KAAKiN,OAAOrF,IAAI,SAAUyF,GAAS,OAAOA,EAAM9B,YAE3D0Y,EAAWrmB,UAAU+W,IAAM,SAAUvC,EAAUvL,GAM3C,QALiB,IAAbuL,IAAuBA,WACX,IAAZvL,IAAsBA,WACN,IAAhBA,EAAQ6M,KACR1T,KAAKkI,KAAK,OAAQ,oFAAqFrB,GAEvGA,EAAQkN,MACR/T,KAAK+T,MAAM3B,EAAUvL,OAEpB,CACD,IAAIwJ,EAAcrQ,KAAKsQ,mBAAmB8B,EAAUvL,GACpDwJ,GAAeA,EAAYnJ,SAE/B,OAAOlH,MAEXikB,EAAWrmB,UAAUmP,QAAU,WAC3B,IAAI/M,KAAKmb,UAAT,CAGA,IAAK,IADD+K,GAAclmB,KAAKsN,QACdlL,EAAK,EAAGN,EAAK9B,KAAKiN,OAAQ7K,EAAKN,EAAGnD,OAAQyD,IAAM,CACrD,IAAIsE,EAAS5E,EAAGM,GAChB6L,GAAKjO,KAAM0G,GACPwf,GACAxf,EAAOqG,UAEfgG,EAAOnV,UAAUmP,QAAQ9I,KAAKjE,QAElCikB,EAAWrmB,UAAUmW,MAAQ,SAAUJ,EAAY9M,QAC/B,IAAZA,IAAsBA,MAC1B,IAAIF,EAASC,GAAM5G,MAAOmmB,EAAiBpZ,GAAQ/M,MAOnD,OANI2T,GACAlD,GAAoBzQ,KAAMmS,GAAWnS,KAAM2T,EAAY9M,GAAUA,GAAS,GAE9EG,GAAYhH,KAAM6G,GAClBA,EAAQ6J,QAAUrN,GAASrD,KAAM,QAASA,KAAMN,IAAWymB,eAAgBA,GAAkBtf,IAC7FF,GAAUO,GAAOlH,MACVA,KAAKiN,QAEhBgX,EAAWrmB,UAAU8V,IAAM,SAAUC,EAAY9M,QAC7B,IAAZA,IAAsBA,MAC1B,IAAIuL,EAAWD,GAAWnS,KAAM2T,EAAY9M,GAAUwJ,EAAcrQ,KAAKiN,OAAOtO,OAC5EwQ,GAAenP,KAAMoS,EAAUvL,GAC/B4J,GAAoBzQ,KAAMoS,EAAUvL,GACxC,GAAIwJ,EAEA,OADAA,EAAYnJ,SACLmJ,EAAYf,OAG3B2U,EAAWrmB,UAAUwoB,OAAS,SAAUnT,EAAcpM,GAElD,YADgB,IAAZA,IAAsBA,MACtBoM,EACOpV,MAAMyU,QAAQW,GACjBjB,GAAWhS,KAAMiT,EAAcpM,GAC/B8K,GAAU3R,KAAMiT,EAAcpM,OAI1Cod,EAAWrmB,UAAU0S,mBAAqB,SAAUqD,EAAY9M,QAC5C,IAAZA,IAAsBA,MAC1B,IAAIuL,EAAWD,GAAWnS,KAAM2T,EAAY9M,GAC5C,OAAI7G,KAAKiN,OAAOtO,QACc,IAAnBkI,EAAQuf,OACXjX,GAAenP,KAAMoS,EAAUvL,GAAS,GACxCgK,GAAe7Q,KAAMoS,EAAUvL,GAG5B4J,GAAoBzQ,KAAMoS,EAAUvL,IAGnDod,EAAWrmB,UAAUyoB,MAAQ,SAAUjoB,GACnC,OAAO4B,KAAKiN,OAAOrF,IAAI,SAAUyF,GAAS,OAAOA,EAAMjP,MAE3D6lB,EAAWrmB,UAAU+Q,KAAO,SAAU9H,GAElC,QADgB,IAAZA,IAAsBA,MACtB4H,GAAazO,KAAM6G,GAAU,CAC7B,IAAIF,EAASC,GAAM5G,MACfgH,GAAYhH,KAAM6G,IAClBxD,GAASrD,KAAM,OAAQA,KAAM6G,GAEjCF,GAAUO,GAAOlH,MAErB,OAAOA,MAEXikB,EAAWrmB,UAAU+O,KAAO,SAAUU,EAAOxG,GACzC,OAAO7G,KAAK0T,IAAIrG,EAAO7N,IAASmQ,GAAI3P,KAAKrB,QAAUkI,KAEvDod,EAAWrmB,UAAUge,IAAM,SAAU/U,GACjC,IAAIwG,EAAQrN,KAAK2P,GAAG3P,KAAKrB,OAAS,GAElC,OADAqB,KAAKomB,OAAO/Y,EAAOxG,GACZwG,GAEX4W,EAAWrmB,UAAUwQ,MAAQ,SAAUoG,EAAW3N,GAC9C,IAAIrJ,EAAQwC,KAAKiB,IAAIuT,GAErB,OADAxU,KAAKomB,OAAO5R,EAAW2N,IAAW/T,OAAO,GAAQvH,IAC1CrJ,GAEXymB,EAAWrmB,UAAU8E,QAAU,SAAU2K,EAAOxG,GAC5C,OAAO7G,KAAK0T,IAAIrG,EAAO7N,IAASmQ,GAAI,GAAK9I,KAE7Cod,EAAWrmB,UAAU0oB,MAAQ,SAAUzf,GACnC,IAAIwG,EAAQrN,KAAK2P,GAAG,GAEpB,OADA3P,KAAKomB,OAAO/Y,EAAOxG,GACZwG,GAEX4W,EAAWrmB,UAAU4S,MAAQ,WACzB,OAAOA,GAAMzQ,MAAMC,KAAKiN,OAAQ5N,YAEpC4kB,EAAWrmB,UAAUkU,QAAU,SAAU0C,GACrC,IAAI9N,EAAS1G,KAAKiB,IAAIuT,GACtB,OAAOxU,KAAKiN,OAAO6E,QAAQpL,IAE/Bud,EAAWrmB,UAAU2oB,QAAU,SAAU7e,GACrC,OAAOA,EAAM1H,KAAKqN,MAAMzP,UAAUiP,cAEtCoX,EAAWrmB,UAAU2W,OAAS,SAAUlH,EAAOmZ,GAC3C,IAAI7iB,EAAOgG,QAAQ3J,KAAKiB,IAAIoM,IAASvJ,OAAkB,IAAX0iB,GAAqB7iB,EAAOgG,QAAQ6c,GAShF,OARI7iB,IAASG,IACLH,EACA3D,KAAKomB,OAAO/Y,GAGZrN,KAAK0T,IAAIrG,IAGVvJ,GAEXmgB,EAAWrmB,UAAUsK,KAAO,SAAU6N,EAAO8J,EAAMriB,GAC/C8d,GAAUvF,EAAO,uBAAyB/V,KAAKqN,MAAMzP,UAAU8f,eAAiB,IAAM1d,KAAK0d,eAAiB,KAAOmC,GAC/G4G,SAAUjpB,EACVkpB,kBAAmB1mB,KAAKqN,MAAMzP,UAAUkJ,eAGhDmd,EAAWrmB,UAAU8f,aAAe,WAChC,OAAO3K,EAAOnV,UAAU8f,aAAazZ,KAAKjE,OAAS,cAEvDikB,EAAWvY,WAAawU,GACxB+D,EAA4BnP,IACxB/T,GACIub,UAAW,IACXjP,MAAOyS,GACPrS,iBAAkB,UAClBK,kBAAmB,OAEvBvM,GACI6S,WAAYqE,GAAWjb,MACvB6P,MAAOoL,GAAWC,WAClB+M,WAAYhN,GAAW9K,SAE5BsW,IAGL3a,IAMFkC,GAAqByY,GAAYhC,IACjCnC,GAAOmE,WAAaA,GO/YpB,IAAI1Q,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAcxCwP,GAAiB,SAAU5T,GAE3B,SAAS4T,IACL,OAAkB,OAAX5T,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAa/D,OAfAuT,GAAUoT,EAAe5T,GAIzB4T,EAAc/oB,UAAU2N,OAAS,SAAU/N,GACvC,OAAOA,GAA0B,iBAAVA,EAAqBA,EAAMsR,GAAKtR,GAE3DmpB,EAAc/oB,UAAUgQ,MAAQ,SAAUpQ,GACtC,OAAOA,GAA0B,iBAAVA,EAAqBA,EAAMsR,GAAKtR,GAE3DmpB,EAAc/oB,UAAU8hB,UAAY,SAAUxf,EAAGC,GAE7C,OADUD,IAAc,MAARA,EAAE4O,GAAa5O,EAAIA,EAAE4O,QAAW3O,IAAc,MAARA,EAAE2O,GAAa3O,EAAIA,EAAE2O,MAG/E6X,EAAc/oB,UAAUiL,SAAW,SAAUwE,EAAO7P,EAAO8B,KACpDqnB,GACT1b,IACF6U,GAAO8G,KAAO,SAAcC,GACxB,IAAIC,EAAsBnU,GAAekU,GAKzC,OAJe,IAAI1d,IACf3L,MAAO,KACPkO,WAAYib,KAGX1lB,IAAI,SAAUgT,EAAS3U,GACxB,GAAuB,iBAAZ2U,EACP,OAAOA,EACX,IAAIjH,EAAa8Z,EAAoB9mB,MACjC0G,EAAS,KAMb,OALIsG,GAAcA,EAAWrO,SACzB+H,EAASsG,EAAW/L,IAAIgT,IAAY,KACpCjU,KAAKiH,WAAW3H,GAAQoH,EACxBA,GAAU1G,KAAK8G,YAAYxH,GAAMkgB,aAAa9Y,EAAQ,KAAM1G,UAEzD0G,KLjDf,IAAI6M,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAUxCrC,GAA0C,SAAU6E,EAAYJ,EAAQnb,EAAKyY,GAC7E,IAA2H5T,EAAvHD,EAAI3D,UAAUV,OAAQib,EAAI5W,EAAI,EAAIuW,EAAkB,OAAT1C,EAAgBA,EAAOnZ,OAAOoZ,yBAAyByC,EAAQnb,GAAOyY,EACrH,GAAuB,iBAAZgD,SAAoD,mBAArBA,QAAQC,SAAyBF,EAAIC,QAAQC,SAASH,EAAYJ,EAAQnb,EAAKyY,QACpH,IAAK,IAAInY,EAAIib,EAAWhb,OAAS,EAAGD,GAAK,EAAGA,KAASuE,EAAI0W,EAAWjb,MAAIkb,GAAK5W,EAAI,EAAIC,EAAE2W,GAAK5W,EAAI,EAAIC,EAAEsW,EAAQnb,EAAKwb,GAAK3W,EAAEsW,EAAQnb,KAASwb,GAChJ,OAAO5W,EAAI,GAAK4W,GAAKlc,OAAOkF,eAAe2W,EAAQnb,EAAKwb,GAAIA,GAEhEqK,GAMWmB,SAAW,SAAkByB,GACpC,IAAI1B,EAAWnlB,KAAKslB,YAActlB,KAAKslB,UAAYzS,GAAuB7S,OAAQ8mB,EAAsBnU,GAAekU,GAGvH,OAHqJ,IAAI1d,IACrJC,KAAM+b,IAEMlkB,IAAI,SAAUoS,GAE1B,OADCA,GAAQA,EAAKD,cAAgBC,EAAK9G,QAAQua,EAAoB9mB,OACxDqT,KAGf,IAAIF,GAAmB5F,GAAcyU,MAAQzU,GAAc6S,WM/BvD7M,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAYxCyO,GAAS,KACTmB,GAAS,SAAUhU,GAEnB,SAASgU,IACL,OAAkB,OAAXhU,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAoB/D,OAtBAuT,GAAUwT,EAAOhU,GAIjBgU,EAAMnpB,UAAU2I,SAAW,WAAc,OAAOvG,MAChD+mB,EAAMnpB,UAAUqD,IAAM,SAAU3B,GAC5B,IAAIgN,EAAQtM,KAAKV,GACjB,OAAIgN,GAAStM,OAASA,KAAKid,cAChB3Q,EACJtM,KAAKmc,OAASnc,KAAKmc,OAAOlb,IAAI3B,GAAQU,KAAKid,cAAchc,IAAI3B,IAExE5B,OAAOkF,eAAemkB,EAAO,UACzB9lB,IAAK,WAAc,OAAO2kB,IAC1BjR,IAAK,SAAUqS,GACPpB,IACAA,GAAO7Y,UAEXzD,GAAc1L,UAAUqf,cAAgB2I,GAASoB,GAErDxT,YAAY,EACZC,cAAc,IAEXsT,GACTjH,IACFiH,GACME,OAAS,IAAIF,GCvCnB,IAyDIjlB,GAzDAyR,GAAwC,WACxC,IAAIyD,EAAgBtZ,OAAOgZ,iBACpBO,wBAA2BpZ,OAAS,SAAUoF,EAAG9C,GAAK8C,EAAEgU,UAAY9W,IACvE,SAAU8C,EAAG9C,GAAK,IAAK,IAAI+W,KAAK/W,EAAOA,EAAE9B,eAAe6Y,KAAIjU,EAAEiU,GAAK/W,EAAE+W,KACzE,OAAO,SAAUjU,EAAG9C,GAEhB,SAASgX,IAAOnX,KAAK/B,YAAcgF,EADnC+T,EAAc/T,EAAG9C,GAEjB8C,EAAErF,UAAkB,OAANuC,EAAazC,OAAO8G,OAAOrE,IAAMgX,EAAGvZ,UAAYuC,EAAEvC,UAAW,IAAIuZ,IAP3C,GAUxCrC,GAA0C,SAAU6E,EAAYJ,EAAQnb,EAAKyY,GAC7E,IAA2H5T,EAAvHD,EAAI3D,UAAUV,OAAQib,EAAI5W,EAAI,EAAIuW,EAAkB,OAAT1C,EAAgBA,EAAOnZ,OAAOoZ,yBAAyByC,EAAQnb,GAAOyY,EACrH,GAAuB,iBAAZgD,SAAoD,mBAArBA,QAAQC,SAAyBF,EAAIC,QAAQC,SAASH,EAAYJ,EAAQnb,EAAKyY,QACpH,IAAK,IAAInY,EAAIib,EAAWhb,OAAS,EAAGD,GAAK,EAAGA,KAASuE,EAAI0W,EAAWjb,MAAIkb,GAAK5W,EAAI,EAAIC,EAAE2W,GAAK5W,EAAI,EAAIC,EAAEsW,EAAQnb,EAAKwb,GAAK3W,EAAEsW,EAAQnb,KAASwb,GAChJ,OAAO5W,EAAI,GAAK4W,GAAKlc,OAAOkF,eAAe2W,EAAQnb,EAAKwb,GAAIA,GAOrDrV,IAAMzC,GAAKsZ,IAAW7W,GAAKK,GAAM9C,GAAG8C,IAAKgW,GAAU9Y,GAAG8Y,QAASjb,GAAOmC,GAAGnC,KAAMkb,GAAW/Y,GAAG+Y,SAAUE,GAAgBjZ,GAAGiZ,cAAeD,GAAehZ,GAAGgZ,2IACtK,SAG2BrT,GAYvB,OAXqB,SAAUsL,GAE3B,SAASmU,IACL,OAAkB,OAAXnU,GAAmBA,EAAOhT,MAAMC,KAAMX,YAAcW,KAM/D,OARAuT,GAAU2T,EAAenU,GAIzBmU,EAAcjgB,WAAaQ,EAC3Byf,EAAgBpS,IACZ/T,GACDmmB,IAELC,aAGN,SACsBnoB,GAClB,OAAO,IAAImK,IAAyB3L,MAAOwB,mBAE/C,SAA4BooB,GACxB,OAAO,WAGH,IAAK,IAFDlU,EAAQlT,KACRwW,KACKpU,EAAK,EAAGA,EAAK/C,UAAUV,OAAQyD,IACpCoU,EAAKpU,GAAM/C,UAAU+C,GAEzB,IAAI3D,EAIJ,OAHAuB,KAAKqQ,YAAY,WACb5R,EAAS2oB,EAAOrnB,MAAMmT,EAAOsD,KAE1B/X,4QdoBf,SAAqBhB,EAAO4pB,GACxB,IAAIA,EAWA,OAAO5pB,EAAMmjB,OAVU,oBAAZ/G,SAA2BA,QAAQyN,YAC1CzN,QACKyN,YAAY,cAAe7pB,EAAO4pB,GAClCzG,OAAOnjB,EAAO4pB,GAGnB5pB,EAAMyK,KAAK,QAAS,yEAOhC,SAAqBc,GACjB,OAAOA,EAAK4X"}