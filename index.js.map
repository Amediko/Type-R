{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 5683b8efbee4a4056d3b","webpack:///./src/index.ts","webpack:///./src/objectplus/tools.ts","webpack:///./src/record/index.ts","webpack:///./src/record/transaction.ts","webpack:///./src/objectplus/index.ts","webpack:///./src/objectplus/mixins.ts","webpack:///./src/objectplus/events.ts","webpack:///./src/transactions.ts","webpack:///./src/validation.ts","webpack:///./src/references.ts","webpack:///./src/record/define.ts","webpack:///./src/record/attribute.ts","webpack:///./src/record/nestedTypes.ts","webpack:///./src/record/basicTypes.ts","webpack:///./src/record/typespec.ts"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;ACtCA,KAAY,KAAK,uBAAM,CACvB,CAAC,CAD6C;AAY1C,cAAK;AAXT,sCAAgC,CAEhC,CAAC,CAFkD;AAY/C,cAAK;AAVT,uCAAuB,CACvB,CAAC,CAAc;mCAAE,EAAE,oCAAG,EAAE,4CAAO,EAAE,sCAAI,EAAE,8CAAQ,EAAE,wDAAa,EAAE,sDAAY,CAAY;AAIxF,8BAAc,CACd,CAAC,EADqC;AACtC,8BAAc,CAEd,CAAC,EAFqC;;;;;;;;ACJtC;KAAA;SACI,UAAK,GAAY,CAAC;KAiBtB,CAAC;KAfG,mBAAK,GAAL;SAAO,cAAe;cAAf,WAAe,CAAf,sBAAe,CAAf,IAAe;aAAf,6BAAe;;SAClB,OAAO,CAAC,KAAK,CAAC,KAAK,CAAE,OAAO,EAAE,IAAI,CAAE,CAAC;KACzC,CAAC;KAED,kBAAI,GAAJ;SAAM,cAAe;cAAf,WAAe,CAAf,sBAAe,CAAf,IAAe;aAAf,6BAAe;;SACjB,EAAE,EAAE,IAAI,CAAC,KAAK,GAAG,CAAE,CAAC;aAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAE,OAAO,EAAE,IAAI,CAAE,CAAC;KAC7D,CAAC;KAED,kBAAI,GAAJ;SACI,EAAE,EAAE,IAAI,CAAC,KAAK,GAAG,CAAE,CAAC;aAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAE,OAAO,EAAE,SAAS,CAAE,CAAC;KAClE,CAAC;KAED,mBAAK,GAAL;SACI,EAAE,EAAE,IAAI,CAAC,KAAK,GAAG,CAAE,CAAC;aAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAE,OAAO,EAAE,SAAS,CAAE,CAAC;KACjE,CAAC;KACL,UAAC;AAAD,EAAC;AAEU,YAAG,GAAG,IAAI,GAAG,EAAE,CAAC;AAG3B,sBAA6B,KAAW;KACpC,EAAE,EAAE,KAAK,KAAK,IAAK,CAAC,EAAC;SACjB,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAED,MAAM,EAAE,OAAO,KAAM,CAAC,EAAC;SACvB,KAAK,QAAQ,CAAE;SACf,KAAK,QAAQ,CAAE;SACf,KAAK,SAAS;aACV,MAAM,CAAC,IAAI,CAAC;SAEhB,KAAK,QAAQ;aACT,IAAI,KAAK,GAAG,MAAM,CAAC,cAAc,CAAE,KAAK,CAAE,CAAC;aAE3C,EAAE,EAAE,KAAK,KAAK,MAAM,CAAC,SAAS,IAAI,KAAK,KAAK,KAAK,CAAC,SAAU,CAAC,EAAC;iBAC1D,MAAM,CAAC,KAAK,CAAE,KAAK,EAAE,WAAW,CAAE,CAAC;aACvC,CAAC;KACL,CAAC;KAED,MAAM,CAAC,KAAK,CAAC;AACjB,EAAC;AApBe,oBAAW,cAoB1B;AAMD,uBAA8B,KAAgB;KAC1C,MAAM,CAAC,MAAM,CAAC,cAAc,CAAE,KAAK,CAAC,SAAS,CAAE,CAAC,WAAW;AAC/D,EAAC;AAFe,qBAAY,eAE3B;AAID,oBAAoB,GAAW,EAAE,GAAc;KAC3C,IAAI,MAAM,CAAC;KAEX,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;SAClC,EAAE,EAAE,MAAM,GAAG,GAAG,CAAE,GAAG,CAAE,CAAC,CAAE,EAAE,CAAC,CAAG,CAAC,EAAC;aAC9B,MAAM,CAAC,MAAM,CAAC;SAClB,CAAC;KACL,CAAC;AACL,EAAC;AAED,qBAAqB,GAAQ,EAAE,GAAc;KACzC,IAAI,MAAM,CAAC;KAEX,GAAG,EAAE,IAAI,GAAG,IAAI,GAAI,CAAC,EAAC;SAClB,EAAE,EAAE,GAAG,CAAC,cAAc,CAAE,GAAG,CAAG,CAAC,EAAC;aAC5B,EAAE,EAAE,MAAM,GAAG,GAAG,CAAE,GAAG,CAAE,GAAG,CAAE,EAAE,GAAG,CAAG,CAAC,EAAC;iBAClC,MAAM,CAAC,MAAM,CAAC;aAClB,CAAC;SACL,CAAC;KACL,CAAC;AACL,EAAC;AAED,eAAsB,GAAG,EAAE,GAAc;KACrC,EAAE,EAAE,MAAM,CAAC,cAAc,CAAE,GAAG,CAAE,KAAK,UAAW,CAAC,EAAC;SAC9C,MAAM,CAAC,SAAS,CAAE,GAAG,EAAE,GAAG,CAAE,CAAC;KACjC,CAAC;KACD,IAAI,EAAC;SACD,MAAM,CAAC,UAAU,CAAE,GAAG,EAAE,GAAG,CAAE,CAAC;KAClC,CAAC;AACL,EAAC;AAPe,aAAI,OAOnB;AAED,gBAAuB,GAAS,EAAE,SAAoB;KAClD,MAAM,CAAC,CAAC,IAAI,CAAE,GAAG,EAAE,WAAC,IAAI,QAAC,SAAS,CAAE,CAAC,CAAE,EAAf,CAAe,CAAE,CAAC;AAC9C,EAAC;AAFe,cAAK,QAEpB;AAED,gCAAuC,GAAQ,EAAE,IAAa;KAC1D,IAAI,IAAyB,CAAC;KAE9B,GAAG,EAAE,IAAI,KAAK,GAAG,GAAG,EAAE,CAAC,IAAI,IAAI,KAAK,EAAE,KAAK,GAAG,MAAM,CAAC,cAAc,CAAE,KAAK,CAAE,EAAG,CAAC;SAC5E,IAAI,GAAG,MAAM,CAAC,wBAAwB,CAAE,GAAG,EAAE,IAAI,CAAE,CAAC;KACxD,CAAC;KAED,MAAM,CAAC,IAAI,CAAC;AAChB,EAAC;AARe,8BAAqB,wBAQpC;AAGD,eAAsB,MAAM;KACxB,IAAM,IAAI,GAAG,EAAE,EAAE,OAAO,GAAG,EAAE,CAAC;KAE9B,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAG,EAAE,CAAC;SACzC,OAAO,CAAE,SAAS,CAAE,CAAC,CAAE,CAAE,GAAG,IAAI,CAAC;KACrC,CAAC;KAED,GAAG,EAAE,IAAI,IAAI,IAAI,MAAO,CAAC,CAAC,CAAC;SACvB,EAAE,EAAE,CAAC,OAAO,CAAE,IAAI,CAAE,IAAI,MAAM,CAAC,cAAc,CAAE,IAAI,CAAG,CAAC,CAAC,CAAC;aACrD,IAAI,CAAE,IAAI,CAAE,GAAG,MAAM,CAAE,IAAI,CAAE,CAAC;SAClC,CAAC;KACL,CAAC;KAED,MAAM,CAAC,IAAI,CAAC;AAChB,EAAC;AAde,aAAI,OAcnB;AAED,oBAAmC,IAA+B,EAAE,MAAiC,EAAE,GAA6C;KAChJ,GAAG,EAAE,IAAI,IAAI,IAAI,MAAO,CAAC,CAAC,CAAC;SACvB,EAAE,EAAE,MAAM,CAAC,cAAc,CAAE,IAAI,CAAG,CAAC,CAAC,CAAC;aACjC,IAAI,KAAK,GAAG,GAAG,CAAE,MAAM,CAAE,IAAI,CAAE,EAAE,IAAI,CAAE,CAAC;aACxC,KAAK,KAAK,KAAK,CAAC,IAAI,CAAE,IAAI,CAAE,IAAI,CAAE,GAAQ,KAAK,CAAE,CAAC;SACtD,CAAC;KACL,CAAC;KAED,MAAM,CAAC,IAAI,CAAC;AAChB,EAAC;AATe,kBAAS,YASxB;AAED,qBAA4B,IAAS,EAAE,MAAW;KAC9C,GAAG,EAAE,IAAI,IAAI,IAAI,MAAO,CAAC,CAAC,CAAC;SACvB,IAAI,CAAE,IAAI,CAAE,GAAG,MAAM,CAAE,IAAI,CAAE,CAAC;KAClC,CAAC;AACL,EAAC;AAJe,mBAAU,aAIzB;AAED,uBAA8B,IAAS,EAAE,MAAW;KAChD,GAAG,EAAE,IAAI,IAAI,IAAI,MAAO,CAAC,CAAC,CAAC;SACvB,EAAE,EAAE,IAAI,CAAE,IAAI,CAAE,KAAK,KAAK,CAAE,CAAC,EAAC;aAC1B,IAAI,CAAE,IAAI,CAAE,GAAG,MAAM,CAAE,IAAI,CAAE,CAAC;SAClC,CAAC;KACL,CAAC;AACL,EAAC;AANe,qBAAY,eAM3B;AAED,qBAAqB,GAAG;KACpB,MAAM,CAAC,UAAe,IAAQ;SAAE,iBAAU;cAAV,WAAU,CAAV,sBAAU,CAAV,IAAU;aAAV,gCAAU;;SACtC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAG,CAAC;aACvC,IAAM,MAAM,GAAG,OAAO,CAAE,CAAC,CAAE,CAAC;aAC5B,MAAM,IAAI,GAAG,CAAE,IAAI,EAAE,MAAM,CAAE,CAAC;SAClC,CAAC;SAED,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;AACL,EAAC;AAEY,eAAM,GAAG,UAAU,CAAE,UAAE,IAAI,EAAE,MAAM;KAC5C,GAAG,EAAE,IAAI,IAAI,IAAI,MAAO,CAAC,CAAC,CAAC;SACvB,EAAE,EAAE,MAAM,CAAC,cAAc,CAAE,IAAI,CAAG,CAAC,CAAC,CAAC;aACjC,IAAI,CAAE,IAAI,CAAE,GAAG,MAAM,CAAE,IAAI,CAAE,CAAC;SAClC,CAAC;KACL,CAAC;AACL,EAAC,CAAE,CAAC;AAES,iBAAQ,GAAG,UAAU,CAAE,UAAE,IAAI,EAAE,MAAM;KAC9C,GAAG,EAAE,IAAI,IAAI,IAAI,MAAO,CAAC,CAAC,CAAC;SACvB,EAAE,EAAE,MAAM,CAAC,cAAc,CAAE,IAAI,CAAE,IAAI,IAAI,CAAE,IAAI,CAAE,KAAK,KAAK,CAAE,CAAC,CAAC,CAAC;aAC3D,IAAI,CAAE,IAAI,CAAE,GAAG,MAAM,CAAE,IAAI,CAAE,CAAC;SACnC,CAAC;KACL,CAAC;AACL,EAAC,CAAE,CAAC;AAEJ,eAAsB,IAAe;KACjC,IAAI,IAAI,EAAE,KAAK,GAAG,IAAI,CAAC;KACvB,MAAM,CAAC;SACH,EAAE,CAAC,CAAE,KAAM,CAAC,CAAC,CAAC;aACV,KAAK,GAAG,KAAK,CAAC;aACd,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;aACnC,IAAI,GAAG,IAAI,CAAC;SAChB,CAAC;SACD,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC,CAAC;AACN,EAAC;AAVe,aAAI,OAUnB;AAOD,KAAM,UAAU,GAAG,KAAK,CAAC,SAAS,EAC5B,SAAS,GAAG,IAAI,CAAC,SAAS,EAC1B,WAAW,GAAG,MAAM,CAAC,SAAS,CAAC;AAErC,mBAA0B,CAAO,EAAE,CAAO;KACtC,EAAE,EAAE,CAAC,KAAK,CAAE,CAAC;SAAC,MAAM,CAAC,KAAK,CAAC;KAE3B,EAAE,EAAE,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,IAAI,QAAQ,IAAI,OAAO,CAAC,IAAI,QAAS,CAAC,CAAC,CAAC;SAC1D,IAAM,MAAM,GAAG,MAAM,CAAC,cAAc,CAAE,CAAC,CAAE,CAAC;SAE1C,EAAE,EAAE,MAAM,KAAK,MAAM,CAAC,cAAc,CAAE,CAAC,CAAG,CAAC;aAAC,MAAM,CAAC,IAAI,CAAC;SAExD,MAAM,EAAE,MAAO,CAAC,EAAC;aACb,KAAK,SAAS,EAAK,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;aACpC,KAAK,UAAU,EAAI,MAAM,CAAC,cAAc,CAAE,CAAC,EAAE,CAAC,CAAE,CAAC;aACjD,KAAK,WAAW,CAAE;aAClB,KAAK,IAAI;iBACL,MAAM,CAAC,eAAe,CAAE,CAAC,EAAE,CAAC,CAAE,CAAC;SACvC,CAAC;KACL,CAAC;KAED,MAAM,CAAC,IAAI,CAAC;AAChB,EAAC;AAlBe,iBAAQ,WAkBvB;AAED,0BAA0B,CAAC,EAAE,CAAC;KAC1B,IAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAE,CAAC,CAAE,CAAC;KAE/B,EAAE,EAAE,KAAK,CAAC,MAAM,KAAK,MAAM,CAAC,IAAI,CAAE,CAAC,CAAE,CAAC,MAAO,CAAC;SAAC,MAAM,CAAC,IAAI,CAAC;KAE3D,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAG,CAAC;SACrC,IAAM,GAAG,GAAG,KAAK,CAAE,CAAC,CAAE,CAAC;SAEvB,EAAE,EAAE,CAAC,CAAC,CAAC,cAAc,CAAE,GAAG,CAAE,IAAI,QAAQ,CAAE,CAAC,CAAE,GAAG,CAAE,EAAE,CAAC,CAAE,GAAG,CAAE,CAAG,CAAC,CAAC,CAAC;aAC9D,MAAM,CAAC,IAAI,CAAC;SAChB,CAAC;KACL,CAAC;KAED,MAAM,CAAC,KAAK,CAAC;AACjB,EAAC;AAED,yBAAyB,CAAC,EAAE,CAAC;KACzB,EAAE,EAAE,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,MAAO,CAAC;SAAC,MAAM,CAAC,IAAI,CAAC;KAExC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAG,CAAC;SACjC,EAAE,EAAE,QAAQ,CAAE,CAAC,CAAE,CAAC,CAAE,EAAE,CAAC,CAAE,CAAC,CAAE,CAAG,CAAC;aAAC,MAAM,CAAC,IAAI,CAAC;KACjD,CAAC;KAED,MAAM,CAAC,KAAK,CAAC;AACjB,EAAC;AAGD,KAAI,WAAW,GAAM,CAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,CAAE,EAC1C,aAAa,GAAI,sBAAsB,EACvC,cAAc,GAAG,oIAAoI,CAAC;AAE1J,oBAA2B,IAAI;KAC3B,IAAI,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,aAAa,GAAG,CAAC,CAAC;KAEjD,EAAE,EAAE,MAAM,GAAG,aAAa,CAAC,IAAI,CAAE,IAAI,CAAG,CAAC,CAAC,CAAC;SACvC,SAAS,GAAG,MAAM,CAAE,MAAM,CAAE,CAAC,CAAE,CAAE,CAAC;KACtC,CAAC;KACD,IAAI,CAAC,EAAE,EAAE,CAAE,MAAM,GAAG,cAAc,CAAC,IAAI,CAAE,IAAI,CAAE,CAAE,CAAC,CAAC,CAAC;SAEhD,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAE,CAAC,GAAG,WAAW,CAAE,CAAC,CAAE,CAAE,EAAE,EAAE,CAAC,EAAG,CAAC;aAChD,MAAM,CAAE,CAAC,CAAE,GAAG,CAAC,MAAM,CAAE,CAAC,CAAE,IAAI,CAAC,CAAC;SACpC,CAAC;SAGD,MAAM,CAAE,CAAC,CAAE,GAAG,CAAC,CAAC,MAAM,CAAE,CAAC,CAAE,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;SACtC,MAAM,CAAE,CAAC,CAAE,GAAG,CAAC,MAAM,CAAE,CAAC,CAAE,IAAI,CAAC,CAAC;SAEhC,EAAE,EAAE,MAAM,CAAE,CAAC,CAAE,KAAK,GAAG,IAAI,MAAM,CAAE,CAAC,CAAE,KAAK,SAAU,CAAC,CAAC,CAAC;aACpD,aAAa,GAAG,MAAM,CAAE,EAAE,CAAE,GAAG,EAAE,GAAG,MAAM,CAAE,EAAE,CAAE,CAAC;aAEjD,EAAE,EAAE,MAAM,CAAE,CAAC,CAAE,KAAK,GAAI,CAAC,CAAC,CAAC;iBACvB,aAAa,GAAG,CAAC,GAAG,aAAa,CAAC;aACtC,CAAC;SACL,CAAC;SAED,SAAS;aACL,IAAI,CAAC,GAAG,CAAE,MAAM,CAAE,CAAC,CAAE,EAAE,MAAM,CAAE,CAAC,CAAE,EAAE,MAAM,CAAE,CAAC,CAAE,EAAE,MAAM,CAAE,CAAC,CAAE,EAAE,MAAM,CAAE,CAAC,CAAE,GAAG,aAAa,EAAE,MAAM,CAAE,CAAC,CAAE,EAC5F,MAAM,CAAE,CAAC,CAAE,CAAE,CAAC;KAChC,CAAC;KACD,IAAI,CAAC,CAAC;SACF,SAAS,GAAG,IAAI,CAAC,KAAK,CAAE,IAAI,CAAE,CAAC;KACnC,CAAC;KAED,MAAM,CAAC,SAAS,CAAC;AACrB,EAAC;AAjCe,kBAAS,YAiCxB;;;;;;;;ACvRD,4CAAyC,CACzC,CAAC,CAD0D;AA4BlD,eAAM;AA3Bf,sCAA+D,CAC/D,CAAC,CADsF;AACvF,uCAAwC,EAExC,CAAC,CAFoD;AAErD,4CAAkC,EAClC,CAAC,CADmD;AACpD,qBAAO,EAEP,CAAC,CAFuB;AAExB,wBAAM,CAAC,MAAM,GAAG,UAAU,UAA6B,EAAE,WAAW;KAChE,IAAM,SAAS,GAAY,MAAM,CAAC,cAAc,CAAE,IAAI,CAAC,SAAS,CAAE,EAC1D,eAAe,GAAoB,SAAS,CAAC,WAAW,CAAC;KAEjE,EAAE,EAAE,UAAW,CAAC,CAAC,CAAC;SAEd,IAAM,UAAU,GAAG,mBAAO,CAAE,UAAU,CAAC,UAAU,IAAI,UAAU,CAAC,QAAQ,EAAmB,SAAS,CAAC,WAAW,CAAE,CAAC;SAGnH,iBAAM,CAAE,UAAU,CAAC,UAAU,EAAE,UAAU,CAAC,UAAU,IAAI,EAAE,CAAE,CAAC;SAG7D,mBAAQ,CAAE,UAAU,EAAE,eAAI,CAAE,UAAU,EAAE,YAAY,EAAE,YAAY,CAAE,CAAE,CAAC;SACvE,gBAAK,CAAC,MAAM,CAAC,IAAI,CAAE,IAAI,EAAE,UAAU,EAAE,WAAW,CAAE,CAAC;KACvD,CAAC;KAED,MAAM,CAAC,IAAI,CAAC;AAChB,EAAC;AAED,wBAAM,CAAC,UAAU,GAAG,kCAAiB,CAAC;;;;;;;;;;;;;;;;;;;ACrBtC,sCAA0F,CAE1F,CAAC,CAFiH;AAElH,6CAA4H,CAC5H,CAAC,CAD+I;AA+EhJ,KAAI,WAAW,GAAY,CAAC,CAAC;AAS7B;KAA4B,0BAAa;KA4GrC,gBAAa,QAAc,EAAE,SAA+B,EAAE,KAAc;SA5GhF,iBAwQC;SA3JO,kBAAO,WAAW,EAAE,EAAE,KAAK,CAAE,CAAC;SAE9B,IAAM,OAAO,GAAG,SAAS,IAAI,EAAE,EACzB,MAAM,GAAG,CAAE,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAE,QAAQ,CAAE,GAAI,QAAQ,CAAE,IAAI,EAAE,CAAC;SAI5E,IAAM,UAAU,GAAG,OAAO,CAAC,KAAK,GAAG,eAAe,CAAE,IAAI,EAAE,MAAM,CAAE,GAAG,IAAI,CAAC,QAAQ,CAAE,MAAM,CAAE,CAAC;SAE7F,IAAI,CAAC,WAAW,CAAE,UAAU,EAAE,UAAE,KAAW,EAAE,GAAY,EAAE,IAA8B;aACrF,IAAM,IAAI,GAAG,UAAU,CAAE,GAAG,CAAE,GAAG,IAAI,CAAC,SAAS,CAAE,KAAK,EAAE,OAAO,EAAE,KAAK,CAAC,EAAE,KAAI,CAAE,CAAC;aAC1E,IAAI,CAAC,YAAY,CAAE,IAAI,EAAE,KAAK,CAAC,EAAE,KAAI,CAAE,CAAC;SAClD,CAAC,CAAC,CAAC;SAEH,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,mBAAmB,GAAG,UAAU,CAAC;SAExD,IAAI,CAAC,UAAU,CAAE,QAAQ,EAAE,SAAS,CAAE,CAAC;SAEvC,EAAE,EAAE,IAAI,CAAC,aAAc,CAAC;aAAC,IAAI,CAAC,QAAQ,CAAE,IAAI,EAAE,IAAI,CAAC,aAAa,CAAE,CAAC;KACvE,CAAC;KA9HM,aAAM,GAAb,UAAe,UAA6B,EAAE,WAAW,IAAqB,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;KAc5F,sBAAI,2BAAO;cAAX;aACI,IAAI,OAAO,GAAG,IAAI,CAAC,kBAAkB,CAAC;aAEtC,EAAE,EAAE,CAAC,OAAQ,CAAC,EAAC;iBACX,IAAM,MAAI,GAAG,IAAI,CAAC,mBAAmB,CAAC;iBACtC,OAAO,GAAG,EAAE,CAAC;iBAEb,IAAI,CAAC,WAAW,CAAE,IAAI,CAAC,UAAU,EAAE,UAAE,KAAK,EAAE,GAAG,EAAE,SAAS;qBACtD,EAAE,EAAE,SAAS,CAAC,SAAS,CAAE,KAAK,EAAE,MAAI,CAAE,GAAG,CAAE,CAAG,CAAC,EAAC;yBAC5C,OAAO,CAAE,GAAG,CAAE,GAAG,KAAK,CAAC;qBAC3B,CAAC;iBACL,CAAC,CAAE,CAAC;iBAEJ,IAAI,CAAC,kBAAkB,GAAG,OAAO,CAAC;aACtC,CAAC;aAED,MAAM,CAAC,OAAO,CAAC;SACnB,CAAC;;;QAAA;KAGD,yBAAQ,GAAR;SACI,IAAM,KAAK,GAAS,IAAI,CAAC,MAAM,CAAC;SAIhC,MAAM,CAAC,IAAI,CAAC,SAAS,GAAG,KAAK,GAAG,KAAK,IAAI,KAAK,CAAC,MAAM,CAAC;KAC1D,CAAC;KAUD,sBAAI,sBAAE;cAAN,cAA6B,MAAM,CAAC,IAAI,CAAC,UAAU,CAAE,IAAI,CAAC,WAAW,CAAE,CAAC,CAAC,CAAC;cAC1E,UAAQ,CAAmB,IAAI,YAAY,CAAE,IAAI,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAE,CAAC,CAAC,CAAC;;;QADD;KAe1E,4BAAW,GAAX,UAAa,KAAU,EAAE,QAAoE;SACjF,kCAAW,CAAU;SAE7B,GAAG,EAAE,IAAI,MAAI,IAAI,KAAM,CAAC,EAAC;aACrB,IAAM,IAAI,GAAG,WAAW,CAAE,MAAI,CAAE,CAAC;aAEjC,EAAE,EAAE,IAAK,CAAC,EAAC;iBACP,QAAQ,CAAE,KAAK,CAAE,MAAI,CAAE,EAAE,MAAI,EAAE,IAAI,CAAE,CAAC;aAC1C,CAAC;aACD,IAAI,EAAC;iBACD,cAAG,CAAC,IAAI,CAAE,qBAAqB,EAAE,IAAI,EAAE,4BAA4B,GAAG,MAAI,GAAG,eAAe,EAAE,KAAK,CAAE,CAAC;aAC1G,CAAC;SACL,CAAC;KACL,CAAC;KAED,qBAAI,GAAJ,UAAM,QAAkD,EAAE,OAAc;SACpE,IAAM,GAAG,GAAG,SAAS,CAAC,MAAM,KAAK,CAAC,GAAG,UAAE,CAAC,EAAE,CAAC,IAAM,eAAQ,CAAC,IAAI,CAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAE,EAA9B,CAA8B,GAAG,QAAQ,EACpF,4BAAU,CAAU;SAE1B,GAAG,EAAE,IAAM,GAAG,IAAI,UAAW,CAAC,EAAC;aAC3B,IAAM,KAAK,GAAG,UAAU,CAAE,GAAG,CAAE,CAAC;aAChC,EAAE,EAAE,KAAK,KAAK,KAAK,CAAE,CAAC;iBAAC,GAAG,CAAE,KAAK,EAAE,GAAG,CAAE,CAAC;SAC7C,CAAC;KACL,CAAC;KAGD,wBAAO,GAAP,cAAW,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;KAGvB,uBAAM,GAAN,UAAQ,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;KAG9B,yBAAQ,GAAR,UAAU,MAAY,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;KAgCtC,2BAAU,GAAV,UAAY,MAAO,EAAE,OAAQ,IAAG,CAAC;KAGjC,sBAAK,GAAL,UAAO,KAAY;SACf,MAAM,CAAC,IAAU,IAAI,CAAC,WAAY,CAAE,IAAI,CAAC,UAAU,EAAE,EAAE,KAAK,EAAG,IAAI,EAAE,EAAE,KAAK,CAAE,CAAC;KACnF,CAAC;KAGD,gCAAe,GAAf,UAAiB,MAAuB;SAAxC,iBAaC;SAZG,IAAI,MAAM,GAAM,CAAC,CAAC;SAElB,IAAI,CAAC,WAAW,CAAE,IAAI,CAAC,UAAU,EAAE,UAAE,KAAK,EAAE,IAAI,EAAE,SAAS;aACvD,IAAM,KAAK,GAAG,SAAS,CAAC,QAAQ,CAAE,KAAI,EAAE,KAAK,EAAE,IAAI,CAAE,CAAC;aAEtD,EAAE,EAAE,KAAM,CAAC,EAAC;iBACR,MAAM,CAAE,IAAI,CAAE,GAAG,KAAK,CAAC;iBACvB,MAAM,EAAE,CAAC;aACb,CAAC;SACL,CAAC,CAAE,CAAC;SAEJ,MAAM,CAAC,MAAM,CAAC;KAClB,CAAC;KAGD,oBAAG,GAAH,UAAK,GAAY;SACb,MAAM,CAAC,IAAI,CAAE,GAAG,CAAE,CAAC;KACvB,CAAC;KAOD,uBAAM,GAAN;SAAA,iBAYC;SAXG,IAAM,IAAI,GAAG,EAAE,CAAC;SAEhB,IAAI,CAAC,WAAW,CAAE,IAAI,CAAC,UAAU,EAAE,UAAE,KAAK,EAAE,GAAY,EAAE,EAAmC;iBAAjC,kBAAM;aAE9D,EAAE,EAAE,MAAM,IAAI,KAAK,KAAK,KAAK,CAAE,CAAC,EAAC;iBAE7B,IAAI,CAAE,GAAG,CAAE,GAAG,MAAM,CAAC,IAAI,CAAE,KAAI,EAAE,KAAK,EAAE,GAAG,CAAE,CAAC;aAClD,CAAC;SACL,CAAC,CAAC,CAAC;SAEH,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAGD,sBAAK,GAAL,UAAO,IAAI;SAEP,MAAM,CAAC,IAAI,CAAC,MAAM,CAAE,IAAI,CAAE,CAAC;KAC/B,CAAC;KAOD,mCAAkB,GAAlB,UAAoB,QAAa,EAAE,OAAiC;SAApE,iBA6CC;SA7CkC,uBAAiC,GAAjC,YAAiC;SAChE,IAAM,MAAM,GAAG,KAAK,CAAE,IAAI,CAAE,EACtB,OAAO,GAAc,EAAE,EACvB,MAAM,GAAwB,EAAE,EAC9B,4BAAU,EACZ,MAAM,GAAG,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAE,QAAQ,CAAE,GAAG,QAAQ,EAC1D,KAAK,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC;SAE7B,EAAE,EAAE,MAAM,CAAC,cAAc,CAAE,MAAM,CAAE,KAAK,MAAM,CAAC,SAAU,CAAC,EAAC;aACvD,IAAI,CAAC,WAAW,CAAE,MAAM,EAAE,UAAE,KAAK,EAAE,GAAY,EAAE,IAA8B;iBAC3E,IAAM,IAAI,GAAG,UAAU,CAAE,GAAG,CAAE,CAAC;iBAG/B,EAAE,EAAE,KAAK,IAAI,IAAI,CAAC,YAAY,CAAE,IAAI,EAAE,KAAK,CAAG,CAAC,CAAC,CAAC;qBAC7C,IAAM,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAE,KAAK,EAAE,OAAO,CAAE,CAAC;qBACnE,EAAE,EAAE,iBAAkB,CAAC,EAAC;yBACpB,MAAM,CAAC,IAAI,CAAE,iBAAiB,CAAE,CAAC;yBACjC,OAAO,CAAC,IAAI,CAAE,GAAG,CAAE,CAAC;qBACxB,CAAC;qBAED,MAAM,CAAC;iBACX,CAAC;iBAGD,IAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAE,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,KAAI,CAAE,CAAC;iBAE1D,EAAE,EAAE,IAAI,CAAC,SAAS,CAAE,IAAI,EAAE,IAAI,CAAG,CAAC,CAAC,CAAC;qBAChC,UAAU,CAAE,GAAG,CAAE,GAAG,IAAI,CAAC;qBACzB,OAAO,CAAC,IAAI,CAAE,GAAG,CAAE,CAAC;qBAGpB,IAAI,CAAC,YAAY,CAAE,IAAI,EAAE,IAAI,EAAE,KAAI,CAAE,CAAC;iBAC1C,CAAC;aACL,CAAC,CAAE,CAAC;SACR,CAAC;SACD,IAAI,EAAC;aACD,cAAG,CAAC,KAAK,CAAE,cAAc,EAAE,IAAI,EAAE,0BAA0B,EAAE,MAAM,EAAE,uBAAuB,CAAE,CAAC;SACnG,CAAC;SAED,EAAE,EAAE,MAAM,CAAC,MAAM,IAAI,OAAO,CAAC,MAAO,CAAC,EAAC;aAClC,MAAM,CAAC,IAAI,iBAAiB,CAAE,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,CAAE,CAAC;SAClE,CAAC;SAGD,MAAM,IAAI,wBAAM,CAAE,IAAI,EAAE,OAAO,CAAE,CAAC;KACtC,CAAC;KAGD,kCAAiB,GAAjB,UAAmB,KAAqB,EAAE,OAA4B;SAClE,IAAI,CAAC,oBAAoB,CAAE,KAAK,CAAC,SAAS,EAAE,OAAO,CAAE,CAAC;KAC1D,CAAC;KAGD,qCAAoB,GAApB,UAAsB,GAAY,EAAE,OAAiC;SAAjC,uBAAiC,GAAjC,YAAiC;SAEjE,IAAM,MAAM,GAAG,KAAK,CAAE,IAAI,CAAE,CAAC;SAE7B,EAAE,EAAE,CAAC,OAAO,CAAC,MAAO,CAAC,EAAC;aAClB,WAAW,CAAE,IAAI,CAAE,CAAC;aACpB,mBAAQ,CAAE,IAAI,EAAE,SAAS,GAAG,GAAG,EAAE,IAAI,CAAC,UAAU,CAAE,GAAG,CAAE,EAAE,IAAI,EAAE,OAAO,CAAE,CAAC;SAC7E,CAAC;SAED,MAAM,IAAI,wBAAM,CAAE,IAAI,EAAE,OAAO,CAAE,CAAC;KACtC,CAAC;KAGD,wBAAO,GAAP;SAAA,iBAQC;SAPG,IAAI,CAAC,WAAW,CAAE,IAAI,CAAC,UAAU,EAAE,UAAE,KAAK,EAAE,GAAG;aAC3C,EAAE,EAAE,KAAK,IAAI,KAAI,KAAK,KAAK,CAAC,MAAO,CAAC,EAAC;iBACjC,KAAK,CAAC,OAAO,EAAE,CAAC;aACpB,CAAC;SACL,CAAC,CAAC,CAAC;SAEH,gBAAK,CAAC,OAAO,WAAE,CAAC;KACpB,CAAC;KA9QL;SAAC,iBAAM,CAAC;aAEJ,SAAS,EAAG,GAAG;aAGf,WAAW,EAAG,IAAI;UACrB,CAAC;eAAA;KAyQF,aAAC;AAAD,EAAC,CAxQ2B,+BAAa,GAwQxC;AAxQY,eAAM,SAwQlB;AAAA,EAAC;AAMF,gBAAgB,MAAe;KAC3B,EAAE,EAAE,uBAAM,CAAE,MAAM,CAAG,CAAC,EAAC;SACnB,MAAM,CAAC,mBAAmB,GAAG,IAAI,MAAM,CAAC,UAAU,CAAE,MAAM,CAAC,UAAU,CAAE,CAAC;SACxE,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAED,MAAM,CAAC,KAAK,CAAC;AACjB,EAAC;AAED,sBAAsB,MAAM;KACxB,6BAAY,CAAE,MAAM,CAAE,CAAC;KACvB,MAAM,CAAC,kBAAkB,GAAG,IAAI,CAAC;AACrC,EAAC;AAGD,0BAA0B,MAAe,EAAE,YAA+B;KACtE,IAAM,UAAU,GAAG,IAAI,MAAM,CAAC,UAAU,CAAE,YAAY,CAAE,CAAC;KAEzD,MAAM,CAAC,WAAW,CAAE,UAAU,EAAE,UAAU,KAAK,EAAE,IAAI,EAAE,IAAgB;SACnE,UAAU,CAAE,IAAI,CAAE,GAAG,IAAI,CAAC,KAAK,CAAE,KAAK,CAAE,CAAC;KAC7C,CAAC,CAAE,CAAC;KAEJ,MAAM,CAAC,UAAU,CAAC;AACtB,EAAC;AAID,uBAA8B,MAAe,EAAE,IAAa,EAAE,KAAW;KACrE,IAAM,MAAM,GAAI,KAAK,CAAE,MAAM,CAAE,EACzB,OAAO,GAAG,EAAE,EACZ,8BAAU,EACV,IAAI,GAAG,MAAM,CAAC,WAAW,CAAE,IAAI,CAAE,EACjC,IAAI,GAAG,UAAU,CAAE,IAAI,CAAE,CAAC;KAGhC,EAAE,EAAE,IAAI,CAAC,YAAY,CAAE,IAAI,EAAE,KAAK,CAAG,CAAC,CAAC,CAAC;SACpC,IAAM,iBAAiB,GAAqB,IAAM,CAAC,kBAAkB,CAAE,KAAK,EAAE,OAAO,CAAE,CAAC;SACxF,EAAE,EAAE,iBAAkB,CAAC,EAAC;aACpB,iBAAiB,CAAC,MAAM,CAAE,OAAO,EAAE,IAAI,CAAE,CAAC;aAC1C,WAAW,CAAE,MAAM,CAAE,CAAC;aACtB,mBAAQ,CAAE,MAAM,EAAE,SAAS,GAAG,IAAI,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,CAAE,CAAC;SAChE,CAAC;KACL,CAAC;KACD,IAAI,CAAC,CAAC;SAEF,IAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAE,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,MAAM,CAAE,CAAC;SAE5D,EAAE,EAAE,IAAI,CAAC,SAAS,CAAE,IAAI,EAAE,IAAI,CAAG,CAAC,CAAC,CAAC;aAChC,UAAU,CAAE,IAAI,CAAE,GAAG,IAAI,CAAC;aAG1B,IAAI,CAAC,YAAY,CAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAE,CAAC;aAEtC,WAAW,CAAE,MAAM,CAAE,CAAC;aACtB,mBAAQ,CAAE,MAAM,EAAE,SAAS,GAAG,IAAI,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,CAAE,CAAC;SAEhE,CAAC;KACL,CAAC;KAED,MAAM,IAAI,wBAAM,CAAE,MAAM,EAAE,OAAO,CAAE,CAAC;AACxC,EAAC;AAjCe,qBAAY,eAiC3B;AAGD;KAEI,2BAAoB,MAAe,EAAS,MAAgB,EAAS,MAAsB,EAAS,OAAkB;SAAlG,WAAM,GAAN,MAAM,CAAS;SAAS,WAAM,GAAN,MAAM,CAAU;SAAS,WAAM,GAAN,MAAM,CAAgB;SAAS,YAAO,GAAP,OAAO,CAAW;SAClH,WAAW,CAAE,MAAM,CAAE,CAAC;KAC1B,CAAC;KAGD,kCAAM,GAAN,UAAQ,OAAiC,EAAE,QAAmB;SAAtD,uBAAiC,GAAjC,YAAiC;SACrC,aAAwC,EAAhC,kBAAM,EAAE,kBAAM,EAAE,oBAAO,CAAU;SAGzC,GAAG,EAAqB,UAAM,EAAN,iBAAM,EAAN,oBAAM,EAAN,IAAO,CAAC;aAA3B,IAAI,WAAW;aAChB,WAAW,CAAC,MAAM,CAAE,OAAO,EAAE,IAAI,CAAE,CAAC;UACvC;SAGD,EAAE,EAAE,CAAC,OAAO,CAAC,MAAO,CAAC,EAAC;aACV,kCAAU,CAAY;aAC9B,GAAG,EAAa,UAAO,EAAP,mBAAO,EAAP,qBAAO,EAAP,IAAQ,CAAC;iBAApB,IAAI,GAAG;iBACR,mBAAQ,CAAE,MAAM,EAAE,SAAS,GAAG,GAAG,EAAE,UAAU,CAAE,GAAG,CAAE,EAAE,MAAM,EAAE,OAAO,CAAE,CAAC;cAC3E;SACL,CAAC;SAED,IAAI,CAAC,MAAM,IAAI,wBAAM,CAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,CAAE,CAAC;KACvD,CAAC;KACL,wBAAC;AAAD,EAAC;;;;;;;;;;;ACrcD,8BAAc,CACd,CAAC,EADyB;AAC1B,8BAAc,CACd,CAAC,EAD0B;AAC3B,8BAAc,CAAa,CAAC,EAAD;;;;;;;;;;;;;ACG3B,sCAA4F,CAE5F,CAAC,CAFuG;AA0CxG;KAAA;KAqIA,CAAC;KAlIU,YAAM,GAAb,UAAe,CAAO,EAAE,CAAQ,EAAE,CAAQ;SACtC,MAAM,CAAC,IAAU,IAAK,CAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;KACtC,CAAC;KAOM,YAAM,GAAb;SAAe,gBAA+B;cAA/B,WAA+B,CAA/B,sBAA+B,CAA/B,IAA+B;aAA/B,+BAA+B;;SAC1C,IAAM,KAAK,GAAQ,IAAI,CAAC,SAAS,EAC3B,UAAU,GAAiB,IAAI,CAAC,WAAW,IAAI,EAAE,CAAC;SAExD,GAAG,EAAE,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAG,CAAC;aAC3C,IAAM,KAAK,GAAG,MAAM,CAAE,CAAC,CAAE,CAAC;aAC1B,EAAE,EAAE,KAAK,YAAY,KAAM,CAAC,CAAC,CAAC;iBAC1B,KAAK,CAAC,MAAM,CAAC,KAAK,CAAE,IAAI,EAAE,KAAK,CAAE,CAAC;aACtC,CAAC;aACD,IAAI,CAAC,EAAE,EAAE,OAAO,KAAK,KAAK,UAAW,CAAC,EAAC;iBACnC,mBAAQ,CAAE,IAAI,EAAE,KAAK,CAAE,CAAC;iBACxB,UAAU,CAAE,KAAK,EAAa,KAAM,CAAC,SAAS,EAAE,UAAU,CAAE,CAAC;aACjE,CAAC;aACD,IAAI,CAAC,CAAC;iBACF,UAAU,CAAE,KAAK,EAAE,KAAK,EAAE,UAAU,CAAE,CAAC;aAC3C,CAAC;SACL,CAAC;SAED,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAGM,WAAK,GAAZ;SAAmB,cAAoB;cAApB,WAAoB,CAApB,sBAAoB,CAApB,IAAoB;aAApB,6BAAoB;;SACnC,GAAG,EAAc,UAAI,EAAJ,aAAI,EAAJ,kBAAI,EAAJ,IAAK,CAAC;aAAlB,IAAI,IAAI;aACT,KAAK,CAAC,MAAM,CAAC,IAAI,CAAE,IAAI,EAAE,IAAI,CAAE,CAAC;UACnC;SAED,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAIM,gBAAU,GAAjB,UAAmB,UAAwB;SACvC,IAAM,IAAI,GAAG,MAAM,CAAC,cAAc,CAAE,IAAI,CAAC,SAAS,CAAE,CAAC,WAAW,CAAC;SAEjE,EAAE,EAAE,IAAI,CAAC,WAAY,CAAC,CAAC,CAAC;aACpB,UAAU,CAAE,UAAU,EAAE,IAAI,CAAC,WAAW,CAAE,CAAC;SAC/C,CAAC;SAED,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC;SAC9B,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAID,uBAAO,GAAP;SACI,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAG,CAAC;aACzC,IAAM,MAAI,GAAG,SAAS,CAAE,CAAC,CAAE,CAAC;aAE5B,IAAI,CAAE,MAAI,CAAE,GAAG,IAAI,CAAE,MAAI,CAAE,CAAC,IAAI,CAAE,IAAI,CAAE,CAAC;SAC7C,CAAC;KACL,CAAC;KAUM,YAAM,GAAb,UAAe,UAAiC,EAAE,WAAiB;SAApD,0BAAiC,GAAjC,eAAiC;SAE5C,EAAE,EAAE,CAAC,IAAI,CAAC,MAAO,CAAC,EAAC;aACf,cAAG,CAAC,KAAK,CAAE,6JAA6J,EAAE,UAAU,CAAE,CAAC;aACvL,MAAM,CAAC,IAAI,CAAC;SAChB,CAAC;SAGD,IAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC;SAG7B,IAAM,UAAU,GAAG,eAAI,CAAE,UAAU,EAAE,YAAY,EAAE,QAAQ,EAAE,YAAY,CAAE,EACrE,0BAA6B,EAA7B,oCAA6B,EAAE,0BAAM,EAAE,kCAAU,CAAgB;SAGvE,iBAAM,CAAE,KAAK,EAAE,UAAU,CAAE,CAAC;SAC5B,iBAAM,CAAE,IAAI,EAAE,WAAW,CAAE,CAAC;SAG5B,UAAU,IAAI,MAAM,CAAC,gBAAgB,CAAE,KAAK,EAAE,oBAAS,CAAE,EAAE,EAAE,UAAU,EAAE,oBAAoB,CAAE,CAAE,CAAC;SAGlG,UAAU,IAAI,IAAI,CAAC,UAAU,CAAE,UAAU,CAAE,CAAC;SAC5C,MAAM,IAAI,IAAI,CAAC,MAAM,CAAE,MAAM,CAAE,CAAC;SAEhC,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAGM,YAAM,GAAb,UAAc,IAAuB,EAAE,OAAa;SAChD,IAAI,QAAuB,CAAC;SAI5B,EAAE,EAAE,IAAI,IAAI,IAAI,CAAC,cAAc,CAAE,aAAa,CAAG,CAAC,EAAC;aAE/C,QAAQ,GAAQ,IAAI,CAAC,WAAW,CAAC;aACjC,SAAS,CAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;SAChC,CAAC;SAED,IAAI,EAAC;aACD,QAAQ,GAAG;iBAAuB,4BAAI;iBAA3B;qBAAuB,8BAAI;iBAAE,CAAC;iBAAD,eAAC;aAAD,CAAC,CAAP,IAAI,EAAG,CAAC;SAC9C,CAAC;SAGD,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAE,IAAI,EAAE,OAAO,CAAE,CAAC;KAC5C,CAAC;KAIM,eAAS,GAAhB;SACI,IAAM,SAAS,GAAkB,uBAAY,CAAE,IAAI,CAAE,CAAC;SAGtD,EAAE,EAAE,SAAS,CAAC,MAAM,KAAK,IAAI,CAAC,MAAO,CAAC,CAAC,CAAC;aACpC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;SAC/B,CAAC;SAED,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KA7HgB,iBAAW,GAAiB,EAAE,UAAU,EAAG,OAAO,EAAE,CAAC;KA8H1E,YAAC;AAAD,EAAC;AArIY,cAAK,QAqIjB;AAED,+BAA+B,CAAY;KACvC,MAAM,CAAC,OAAO,CAAC,KAAK,UAAU,GAAG,EAAE,GAAG,EAAgB,CAAC,EAAE,GAAwB,CAAC,CAAC;AACvF,EAAC;AAGD,qBAA4B,KAAmB;KAC3C,MAAM,CAAC,eAAe,CAAE,YAAY,EAAE,KAAK,CAAE,CAAC;AAClD,EAAC;AAFe,mBAAU,aAEzB;AAGD;KAAwB,cAAc;UAAd,WAAc,CAAd,sBAAc,CAAd,IAAc;SAAd,6BAAc;;KAClC,MAAM,CAAC,eAAe,CAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;AAC7C,EAAC;AAFe,eAAM,SAErB;AAGD,qBAA4B,IAAe;KACvC,KAAK,CAAC,KAAK,CAAE,IAAI,CAAE,CAAC;AACxB,EAAC;AAFe,mBAAU,aAEzB;AAGD,oBAA2B,WAA0C;KACjE,WAAW,CAAC,SAAS,EAAE,CAAC;AAC5B,EAAC;AAFe,kBAAS,YAExB;AAGD,iBAAwB,IAAsB;KAC1C,MAAM,CAAC,eAAe,CAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;AAC7C,EAAC;AAFe,eAAM,SAErB;AAID,0BAA0B,IAAa,EAAE,IAAS;KAC9C,MAAM,CAAC,UAAU,IAAe;SAC5B,EAAE,EAAE,IAAI,CAAE,IAAI,CAAG,CAAC,CAAC,CAAC;aAChB,IAAI,CAAE,IAAI,CAAE,CAAE,IAAI,CAAE,CAAC;SACzB,CAAC;SACD,IAAI,CAAC,CAAC;aACF,KAAK,CAAE,IAAI,CAAE,CAAC,IAAI,CAAE,IAAI,EAAE,IAAI,CAAE,CAAC;SACrC,CAAC;KACL,CAAC;AACL,EAAC;AAKD,uBAAuB,CAAM,EAAE,CAAM,EAAE,KAAoB;KACvD,IAAM,CAAC,GAAG,iBAAM,CAAE,EAAE,EAAE,CAAC,CAAE,CAAC;KAC1B,MAAM,CAAC,UAAU,CAAE,CAAC,EAAG,CAAC,EAAE,KAAK,CAAE,CAAC;AACtC,EAAC;AAMD,KAAM,cAAc,GAAqB;KACrC,IAAI,YAAa,CAAiB,EAAE,CAAkB;SAClD,MAAM,CAAC,UAAU,CAAK;aAClB,MAAM,CAAC,CAAC,CAAC,IAAI,CAAE,IAAI,EAAE,CAAC,CAAC,IAAI,CAAE,IAAI,EAAE,CAAC,CAAE,CAAE,CAAC;SAC7C,CAAC;KACL,CAAC;KAED,QAAQ,YAAE,CAAY,EAAE,CAAY;SAChC,MAAM,CAAC;aACH,CAAC,CAAC,KAAK,CAAE,IAAI,EAAE,SAAS,CAAE,CAAC;aAC3B,CAAC,CAAC,KAAK,CAAE,IAAI,EAAE,SAAS,CAAE,CAAC;SAC/B,CAAC;KACL,CAAC;KAED,OAAO,YAAE,CAAY,EAAE,CAAY;SAC/B,MAAM,CAAC;aACH,CAAC,CAAC,KAAK,CAAE,IAAI,EAAE,SAAS,CAAE,CAAC;aAC3B,CAAC,CAAC,KAAK,CAAE,IAAI,EAAE,SAAS,CAAE,CAAC;SAC/B,CAAC;KACL,CAAC;KAED,KAAK,YAAE,CAAY,EAAE,CAAY;SAC7B,MAAM,CAAC;aACH,MAAM,CAAC,CAAC,CAAC,KAAK,CAAE,IAAI,EAAE,SAAS,CAAE,IAAI,CAAC,CAAC,KAAK,CAAE,IAAI,EAAE,SAAS,CAAE,CAAC;SACpE,CAAC;KACL,CAAC;KAED,IAAI,YAAE,CAAY,EAAE,CAAY;SAC5B,MAAM,CAAC;aACH,MAAM,CAAC,CAAC,CAAC,KAAK,CAAE,IAAI,EAAE,SAAS,CAAE,IAAI,CAAC,CAAC,KAAK,CAAE,IAAI,EAAE,SAAS,CAAE,CAAC;SACpE,CAAC;KACL,CAAC;EACJ,CAAC;AAEF,qBAAqC,MAAU,EAAE,MAAW,EAAE,KAAwB;KAAxB,qBAAwB,GAAxB,UAAwB;KAClF,GAAG,EAAc,UAAqB,EAArB,WAAM,CAAC,IAAI,CAAE,MAAM,CAAE,EAArB,cAAqB,EAArB,IAAsB,CAAC;SAAnC,IAAI,MAAI;SACT,IAAM,UAAU,GAAG,MAAM,CAAC,wBAAwB,CAAE,MAAM,EAAE,MAAI,CAAE,EAC5D,QAAQ,GAAK,gCAAqB,CAAE,MAAM,EAAE,MAAI,CAAE,CAAC;SAEzD,EAAE,EAAE,QAAS,CAAC,CAAC,CAAC;aACZ,IAAM,IAAI,GAAI,KAAK,CAAE,MAAI,CAAE,EACrB,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;aAE7B,EAAE,EAAE,IAAI,IAAI,KAAM,CAAC,CAAC,CAAC;iBACjB,MAAM,CAAE,MAAI,CAAE,GAAG,OAAO,IAAI,KAAK,QAAQ;qBACrC,YAAY,CAAE,KAAK,EAAE,UAAU,CAAC,KAAK,EAAE,IAAI,CAAE,GAAE,CAC3C,IAAI,KAAK,OAAO;qBACZ,YAAY,CAAE,KAAK,EAAE,UAAU,CAAC,KAAK,CAAE;qBACvC,cAAc,CAAE,IAAI,CAAE,CAAE,KAAK,EAAE,UAAU,CAAC,KAAK,CAAE,CACxD,CAAC;aACV,CAAC;SACL,CAAC;SACD,IAAI,CAAC,CAAC;aACF,MAAM,CAAC,cAAc,CAAE,MAAM,EAAE,MAAI,EAAE,UAAU,CAAE,CAAC;SACtD,CAAC;MACJ;KAED,MAAM,CAAC,MAAM,CAAC;AAClB,EAAC;;;;;;;;;;;;;;ACtSD,sCAAqB,CACrB,CAAC,CADgC;AACjC,uCAAkD,CAKlD,CAAC,CAL8D;AAK/D,mBAA0B,IAAgB,EAAE,IAAa;KAC7C,0BAAO,CAAU;KACzB,EAAE,EAAE,OAAQ,CAAC,EAAC;SACF,qBAAG,CAAa;SACxB,WAAW,CAAE,OAAO,CAAE,IAAI,CAAE,CAAE,CAAC;SAC/B,WAAW,CAAE,GAAG,EAAE,IAAI,CAAE,CAAC;KAC7B,CAAC;AACL,EAAC;AAPe,iBAAQ,WAOvB;AAAA,EAAC;AAEF,mBAA0B,IAAgB,EAAE,IAAa,EAAE,CAAO;KACtD,0BAAO,CAAU;KACzB,EAAE,EAAE,OAAQ,CAAC,EAAC;SACF,qBAAG,CAAa;SACxB,WAAW,CAAE,OAAO,CAAE,IAAI,CAAE,EAAE,CAAC,CAAE,CAAC;SAClC,WAAW,CAAE,GAAG,EAAE,IAAI,EAAE,CAAC,CAAE,CAAC;KAChC,CAAC;AACL,EAAC;AAPe,iBAAQ,WAOvB;AAAA,EAAC;AAEF,mBAA0B,IAAgB,EAAE,IAAa,EAAE,CAAC,EAAE,CAAC;KACnD,0BAAO,CAAU;KACzB,EAAE,EAAE,OAAQ,CAAC,EAAC;SACF,qBAAG,CAAa;SACxB,WAAW,CAAE,OAAO,CAAE,IAAI,CAAE,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;SACrC,WAAW,CAAE,GAAG,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;KACnC,CAAC;AACL,EAAC;AAPe,iBAAQ,WAOvB;AAAA,EAAC;AAEF,mBAA0B,IAAgB,EAAE,IAAa,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;KACtD,0BAAO,CAAU;KACzB,EAAE,EAAE,OAAQ,CAAC,EAAC;SACF,qBAAG,CAAa;SACxB,WAAW,CAAE,OAAO,CAAE,IAAI,CAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;SACxC,WAAW,CAAE,GAAG,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;KACtC,CAAC;AACL,EAAC;AAPe,iBAAQ,WAOvB;AAAA,EAAC;AAiBF,KAAI,aAAa,GAAG,KAAK,CAAC;AAK1B,KAAI,SAAS,GAAG,UAAS,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI;KAC3D,IAAI,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC;KACjB,EAAE,CAAC,CAAC,IAAI,IAAI,OAAO,IAAI,KAAK,QAAQ,CAAC,CAAC,CAAC;SAEnC,EAAE,CAAC,CAAC,QAAQ,KAAK,KAAK,CAAC,IAAI,SAAS,IAAI,IAAI,IAAI,IAAI,CAAC,OAAO,KAAK,KAAK,CAAC,CAAC;aAAC,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC;SACjG,GAAG,CAAC,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAG,CAAC,EAAE,EAAE,CAAC;aAC9C,MAAM,GAAG,SAAS,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;SACzE,CAAC;KACL,CAAC;KAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,IAAI,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;SAE1C,GAAG,CAAC,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;aAC5D,MAAM,GAAG,QAAQ,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;SACxD,CAAC;KACL,CAAC;KAAC,IAAI,CAAC,CAAC;SAEJ,MAAM,GAAG,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;KACpD,CAAC;KACD,MAAM,CAAC,MAAM,CAAC;AAClB,EAAC,CAAC;AAEF,kBAAkB,GAAQ;KACtB,GAAG,EAAE,IAAI,CAAC,IAAI,GAAI,CAAC,EAAC;SAChB,MAAM,CAAC,KAAK,CAAC;KACjB,CAAC;KAED,MAAM,CAAC,IAAI,CAAC;AAChB,EAAC;AAED,KAAI,QAAQ,GAAG,CAAC,CAAC;AACjB;KACI,MAAM,CAAC,GAAG,GAAG,QAAQ,EAAE,CAAC;AAC5B,EAAC;AAED;KAEI,qBAAoB,GAAG,EAAS,KAAK,EAAS,EAAE,EAAS,WAAW;SAAhD,QAAG,GAAH,GAAG;SAAS,UAAK,GAAL,KAAK;SAAS,OAAE,GAAF,EAAE;SAAS,gBAAW,GAAX,WAAW;SADpE,UAAK,GAAY,CAAC;KACqD,CAAC;KAC5E,kBAAC;AAAD,EAAC;AAwBD;KAWI,mBAAa,GAAqB;SARlC,YAAO,GAAe,KAAK,CAAC,CAAC;SAC7B,eAAU,GAAe,KAAK,CAAC,CAAC;SAChC,iBAAY,GAAoB,KAAK,CAAC,CAAC;SAOnC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,SAAS,GAAG,GAAG,CAAC;KACpC,CAAC;KAID,sBAAE,GAAF,UAAG,IAAI,EAAE,QAAQ,EAAE,OAAO;SACtB,MAAM,CAAC,UAAU,CAAC,IAAI,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC;KACrD,CAAC;KAKD,uBAAG,GAAH,UAAI,IAAc,EAAE,QAAoB,EAAE,OAAQ;SAC9C,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;aAAC,MAAM,CAAC,IAAI,CAAC;SAC/B,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,EAAE,QAAQ,EACrC,IAAI,UAAU,CACV,OAAO,EACP,IAAI,CAAC,UAAU,CAAE,CACpB,CAAC;SAC1B,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAID,iCAAa,GAAb,UAAe,GAAgB,EAAE,IAAc,EAAE,QAAoB;SACjE,IAAI,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC;SACpC,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC;aAAC,MAAM,CAAC,IAAI,CAAC;SAE9B,IAAI,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC;SAE9C,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;aAClC,IAAI,SAAS,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;aAIpC,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;iBAAC,KAAK,CAAC;aAEtB,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;SAC5C,CAAC;SACD,EAAE,CAAC,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;aAAC,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC,CAAC;SAErD,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAKD,4BAAQ,GAAR,UAAS,GAAe,EAAE,IAAI,EAAE,QAAS;SACrC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC;aAAC,MAAM,CAAC,IAAI,CAAC;SACtB,IAAI,EAAE,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,QAAQ,EAAE,CAAC,CAAC;SAC3C,IAAI,WAAW,GAAG,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC,CAAC;SAChE,IAAI,SAAS,GAAG,WAAW,CAAC,EAAE,CAAC,CAAC;SAIhC,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;aACb,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,QAAQ,EAAE,CAAC,CAAC;aACjD,SAAS,GAAG,WAAW,CAAC,EAAE,CAAC,GAAG,IAAI,WAAW,CAAE,GAAG,EAAE,EAAE,EAAE,MAAM,EAAE,WAAW,CAAE,CAAC;SAClF,CAAC;SAGD,UAAU,CAAC,GAAG,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC;SACjD,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAMD,wBAAI,GAAJ,UAAK,IAAI,EAAE,QAAQ,EAAE,OAAO;SAExB,IAAI,MAAM,GAAG,SAAS,CAAC,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAE,IAAI,CAAE,CAAC,CAAC;SAC3E,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,KAAK,CAAC,EAAE,OAAO,CAAC,CAAC;KAC5C,CAAC;KAGD,gCAAY,GAAZ,UAAa,GAAe,EAAE,IAAI,EAAE,QAAQ;SAExC,IAAI,MAAM,GAAG,SAAS,CAAC,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAE,IAAI,EAAE,GAAG,CAAE,CAAE,CAAC;SAC3F,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;KACtC,CAAC;KAMD,2BAAO,GAAP,UAAQ,IAAa,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE;SAC7B,MAAM,EAAE,SAAS,CAAC,MAAO,CAAC,EAAC;aAEvB,KAAK,CAAC;iBAAG,QAAQ,CAAE,IAAI,EAAE,IAAI,CAAE,CAAC;iBAAC,KAAK,CAAC;aACvC,KAAK,CAAC;iBAAG,QAAQ,CAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAE,CAAC;iBAAC,KAAK,CAAC;aAC1C,KAAK,CAAC;iBAAG,QAAQ,CAAE,IAAI,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;iBAAC,KAAK,CAAC;aAC7C,KAAK,CAAC;iBAAG,QAAQ,CAAE,IAAI,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;iBAAC,KAAK,CAAC;aAGhD;iBAEI,IAAM,OAAO,GAAG,KAAK,CAAE,SAAS,CAAC,MAAM,CAAE,CAAC;iBAE1C,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;qBACtC,OAAO,CAAE,CAAC,CAAE,GAAG,SAAS,CAAE,CAAC,CAAE,CAAC;iBAClC,CAAC;iBAGO,0BAAO,CAAU;iBAEzB,EAAE,EAAE,OAAQ,CAAC,EAAC;qBACV,aAAa,CAAE,OAAO,CAAE,IAAI,CAAE,EAAE,OAAO,CAAC,MAAM,CAAE,CAAC,EAAE,CAAC,CAAE,CAAE,CAAC;qBACzD,aAAa,CAAE,OAAO,CAAC,GAAG,EAAE,OAAO,CAAE,CAAC;iBAC1C,CAAC;SACT,CAAC;SAED,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAED,2BAAO,GAAP;SACI,IAAI,CAAC,aAAa,EAAE,CAAC;SACrB,IAAI,CAAC,GAAG,EAAE,CAAC;KACf,CAAC;KAtIL;SAAC,kBAAM,CAAC;aACJ,SAAS,EAAG,GAAG;UAClB,CAAC;SACD,sBAAU;kBAAA;KAoIX,gBAAC;AAAD,EAAC;AAnIqB,kBAAS,YAmI9B;AAED,KAAM,KAAK,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC;AAEvB,eAAM,GAAG,SAAS,CAAC,SAAS,CAAC;AAG1C,KAAI,UAAU,GAAG,UAAS,GAAe,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,SAAU;KAC1E,GAAG,CAAC,OAAO,GAAG,SAAS,CAAC,KAAK,EAAE,GAAG,CAAC,OAAO,IAAI,EAAE,EAAE,IAAI,EAC9B,QAAQ,EAAE,IAAI,OAAO,CAAE,OAAO,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC;KAEzE,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;SACZ,IAAI,SAAS,GAAG,GAAG,CAAC,UAAU,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG,EAAE,CAAC,CAAC;SACxD,SAAS,CAAC,SAAS,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC;KACxC,CAAC;KAED,MAAM,CAAC,GAAG,CAAC;AACf,EAAC,CAAC;AAMF;KACI,iBAAoB,OAAO,EAAS,GAAG,EAAS,SAAuB,EAAS,QAAoB;SAAhF,YAAO,GAAP,OAAO;SAAS,QAAG,GAAH,GAAG;SAAS,cAAS,GAAT,SAAS,CAAc;SAAS,aAAQ,GAAR,QAAQ,CAAY;KACpG,CAAC;KAED,uBAAK,GAAL,UAAO,QAAQ;SACX,aAAmC,EAA3B,oBAAO,EAAE,wBAAS,CAAU;SACpC,EAAE,CAAC,CAAC,SAAS,CAAC;aAAC,SAAS,CAAC,KAAK,EAAE,CAAC;SACjC,MAAM,CAAC,IAAI,OAAO,CAAE,OAAO,EAAE,OAAO,IAAI,IAAI,CAAC,GAAG,EAAE,SAAS,EAAE,QAAQ,CAAE,CAAC;KAC5E,CAAC;KACL,cAAC;AAAD,EAAC;AAQD,KAAI,KAAK,GAAG,UAAS,MAAkB,EAAE,IAAa,EAAE,QAAmB,EAAE,OAAO;KAChF,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;SACX,IAAI,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,EACvB,KAAK,GAAG,CAAE,OAAO,CAAC,KAAK,CAAE,QAAQ,CAAE,CAAE,CAAC;SAE1C,MAAM,CAAC,IAAI,CAAC,GAAG,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAE,KAAK,CAAE,GAAG,KAAK,CAAC;KAC/D,CAAC;KAED,MAAM,CAAC,MAAM,CAAC;AAClB,EAAC,CAAC;AAEF;KACI,oBAAoB,OAAO,EAAS,SAAqB;SAArC,YAAO,GAAP,OAAO;SAAS,cAAS,GAAT,SAAS,CAAY;KAAG,CAAC;KACjE,iBAAC;AAAD,EAAC;AAED,eAAe,CAAO;KAClB,MAAM,CAAC,CAAC,GAAG,MAAM,CAAC,IAAI,CAAE,CAAC,CAAE,GAAG,EAAE,CAAC;AACrC,EAAC;AAGD,KAAI,MAAM,GAAG,UAAS,MAAkB,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAoB;KAC1E,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC;SAAC,MAAM,CAAC;KAEpB,IAAI,CAAC,GAAG,CAAC,EAAE,SAAS,CAAC;KACrB,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,EAAE,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC;KAG7D,EAAE,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;SACjC,IAAI,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC;SAC1B,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;aACzB,SAAS,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;aAC9B,OAAO,SAAS,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;aAC/B,OAAO,SAAS,CAAC,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;SAClD,CAAC;SACD,MAAM,CAAC;KACX,CAAC;KAED,IAAI,KAAK,GAAG,IAAI,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;KACzC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;SAC3B,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;SAChB,IAAI,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;SAG5B,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC;aAAC,KAAK,CAAC;SAGrB,IAAI,SAAS,GAAG,EAAE,CAAC;SACnB,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;aACvC,IAAI,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;aAC1B,EAAE,CAAC,CACC,QAAQ,IAAI,QAAQ,KAAK,OAAO,CAAC,QAAQ;iBACzC,QAAQ,KAAK,OAAO,CAAC,QAAQ,CAAC,SAAS;iBACvC,OAAO,IAAI,OAAO,KAAK,OAAO,CAAC,OACnC,CAAC,CAAC,CAAC;iBACC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;aAC5B,CAAC;aAAC,IAAI,CAAC,CAAC;iBACJ,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC;iBAC9B,EAAE,CAAC,CAAC,SAAS,IAAI,EAAE,SAAS,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC;qBACvC,OAAO,SAAS,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;qBAC/B,OAAO,SAAS,CAAC,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;iBAClD,CAAC;aACL,CAAC;SACL,CAAC;SAGD,EAAE,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC;aACnB,MAAM,CAAC,IAAI,CAAC,GAAG,SAAS,CAAC;SAC7B,CAAC;SAAC,IAAI,CAAC,CAAC;aACJ,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;SACxB,CAAC;KACL,CAAC;KACD,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;SAAC,MAAM,CAAC,MAAM,CAAC;AACxC,EAAC,CAAC;AASF,KAAI,OAAO,GAAG,UAAS,GAAG,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK;KAC7C,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;SACX,IAAI,KAAK,GAAU,GAAG,CAAC,IAAI,CAAC,GAAG,eAAI,CAAC;aAChC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;aACnB,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;SACpC,CAAC,CAAC,CAAC;SACH,KAAK,CAAC,SAAS,GAAG,QAAQ,CAAC;KAC/B,CAAC;KACD,MAAM,CAAC,GAAG,CAAC;AACf,EAAC,CAAC;AAIF,sBAAsB,MAAkB;KACpC,EAAE,EAAE,MAAO,CAAC;SACR,GAAG,EAAY,UAAM,EAAN,iBAAM,EAAN,oBAAM,EAAN,IAAO,CAAC;aAAlB,IAAI,EAAE;aACP,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAE,EAAE,CAAC,GAAG,CAAE,CAAC;UAAA;AACvC,EAAC;AAED,sBAAsB,MAAkB,EAAE,CAAC;KACvC,EAAE,EAAE,MAAO,CAAC;SACR,GAAG,EAAY,UAAM,EAAN,iBAAM,EAAN,oBAAM,EAAN,IAAO,CAAC;aAAlB,IAAI,EAAE;aACP,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAE,EAAE,CAAC,GAAG,EAAE,CAAC,CAAE,CAAC;UAAA;AAC1C,EAAC;AAED,sBAAsB,MAAkB,EAAE,CAAC,EAAE,CAAC;KAC1C,EAAE,EAAE,MAAO,CAAC;SACR,GAAG,EAAY,UAAM,EAAN,iBAAM,EAAN,oBAAM,EAAN,IAAO,CAAC;aAAlB,IAAI,EAAE;aACP,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAE,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;UAAA;AAC7C,EAAC;AAED,sBAAsB,MAAkB,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;KAC7C,EAAE,EAAE,MAAO,CAAC;SACR,GAAG,EAAY,UAAM,EAAN,iBAAM,EAAN,oBAAM,EAAN,IAAO,CAAC;aAAlB,IAAI,EAAE;aACP,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAE,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;UAAA;AAChD,EAAC;AAED,sBAAsB,MAAkB,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;KAChD,EAAE,EAAE,MAAO,CAAC;SACR,GAAG,EAAY,UAAM,EAAN,iBAAM,EAAN,oBAAM,EAAN,IAAO,CAAC;aAAlB,IAAI,EAAE;aACP,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAE,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;UAAA;AACnD,EAAC;AAED,wBAAwB,MAAkB,EAAE,IAAY;KACpD,EAAE,EAAE,MAAO,CAAC;SACR,GAAG,EAAY,UAAM,EAAN,iBAAM,EAAN,oBAAM,EAAN,IAAO,CAAC;aAAlB,IAAI,EAAE;aACP,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAE,EAAE,CAAC,GAAG,EAAE,IAAI,CAAE,CAAC;UAAA;AAC9C,EAAC;;;;;;;;;;;;;;;;;;;ACraD,sCAAkG,CAClG,CAAC,CADwH;AACzH,2CAA6D,CAC7D,CAAC,CAD6E;AAC9E,2CAA8C,CAO9C,CAAC,CAP8D;AAa/D;KAA4C,iCAAS;KAoBjD,uBAAa,GAAqB,EAAE,KAAc,EAAE,QAAkB;SAClE,kBAAO,GAAG,CAAE,CAAC;SAnBjB,iBAAY,GAAQ,EAAE;SAGtB,iBAAY,GAAa,KAAK,CAAC;SAG/B,aAAQ,GAAc,KAAK,CAAC;SA0I5B,qBAAgB,GAAqB,KAAK,CAAC;SA5HvC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;SACpB,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;KAC9B,CAAC;KAQD,mCAAW,GAAX,UAAa,GAA6B,EAAE,OAA6B;SACrE,IAAM,MAAM,GAAG,KAAK,CAAE,IAAI,CAAE,CAAC;SAC7B,GAAG,CAAE,IAAI,CAAE,CAAC;SACZ,MAAM,IAAI,MAAM,CAAE,IAAI,EAAE,OAAO,CAAE,CAAC;KACtC,CAAC;KAID,kCAAU,GAAV,UAAY,QAA8C,EAAE,OAA6B;SACrF,IAAM,MAAM,GAAG,KAAK,CAAE,IAAI,CAAE,CAAC;SAC7B,IAAI,CAAC,IAAI,CAAE,QAAQ,CAAE,CAAC;SACtB,MAAM,IAAI,MAAM,CAAE,IAAI,EAAE,OAAO,CAAE,CAAC;KACtC,CAAC;KAGD,2BAAG,GAAH,UAAK,MAAY,EAAE,OAA6B;SAC5C,EAAE,EAAE,MAAO,CAAC,EAAC;aACT,IAAM,WAAW,GAAG,IAAI,CAAC,kBAAkB,CAAE,MAAM,EAAE,OAAO,CAAE,CAAC;aAC/D,WAAW,IAAI,WAAW,CAAC,MAAM,CAAE,OAAO,EAAE,IAAI,CAAE,CAAC;SACvD,CAAC;SAED,MAAM,CAAC,IAAI,CAAC;KAChB,CAAC;KAQD,6BAAK,GAAL,UAAO,IAAU,IAAW,MAAM,CAAC,IAAI,EAAC,CAAC;KAazC,+BAAO,GAAP,UAAS,SAAkB;SACvB,MAAM,CAAC,gCAAgB,CAAE,IAAI,EAAE,SAAS,EAAE,UAAE,MAAM,EAAE,GAAG,IAAM,aAAM,CAAC,GAAG,CAAE,GAAG,CAAE,EAAjB,CAAiB,CAAE,CAAC;KACrF,CAAC;KAKD,gCAAQ,GAAR;SACI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;KACvB,CAAC;KAMD,gCAAQ,GAAR;SACY,wBAAM,CAAU;SACxB,MAAM,CAAC,MAAM,GAAmB,MAAM,CAAC,QAAQ,EAAE,GAAG,IAAI,CAAC,aAAa,CAAC;KAC3E,CAAC;KAWD,2BAAG,GAAH,UAAQ,QAA2C,EAAE,OAAc;SAC/D,IAAM,GAAG,GAAS,EAAE,EACd,GAAG,GAAG,SAAS,CAAC,MAAM,KAAK,CAAC,GAAG,UAAE,CAAC,EAAE,CAAC,IAAM,eAAQ,CAAC,IAAI,CAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAE,EAA9B,CAA8B,GAAG,QAAQ,CAAC;SAE3F,IAAI,CAAC,IAAI,CAAE,UAAE,GAAG,EAAE,GAAG;aACjB,IAAM,MAAM,GAAG,GAAG,CAAE,GAAG,EAAE,GAAG,CAAE,CAAC;aAC/B,EAAE,EAAE,MAAM,KAAK,KAAK,CAAE,CAAC;iBAAC,GAAG,CAAC,IAAI,CAAE,MAAM,CAAE,CAAC;SAC/C,CAAC,CAAE,CAAC;SAEJ,MAAM,CAAC,GAAG,CAAC;KACf,CAAC;KAGD,iCAAS,GAAT,UAAc,QAAoD,EAAE,OAAc;SAC9E,IAAM,GAAG,GAA8B,EAAE,EACrC,GAAG,GAAG,SAAS,CAAC,MAAM,KAAK,CAAC,GAAG,UAAE,CAAC,EAAE,CAAC,IAAM,eAAQ,CAAC,IAAI,CAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAE,EAA9B,CAA8B,GAAG,QAAQ,CAAC;SAEzF,IAAI,CAAC,IAAI,CAAE,UAAE,GAAG,EAAE,GAAG;aACjB,IAAM,MAAM,GAAG,QAAQ,CAAE,GAAG,EAAE,GAAG,CAAE,CAAC;aACpC,EAAE,EAAE,MAAM,KAAK,KAAK,CAAE,CAAC;iBAAC,GAAG,CAAE,GAAG,CAAE,GAAG,MAAM,CAAC;SAChD,CAAC,CAAE,CAAC;SAEJ,MAAM,CAAC,GAAG,CAAC;KACf,CAAC;KAGD,4BAAI,GAAJ;SACI,MAAM,CAAC,IAAI,CAAC,GAAG,CAAE,UAAE,KAAK,EAAE,GAAG;aACzB,EAAE,EAAE,KAAK,KAAK,KAAK,CAAE,CAAC;iBAAC,MAAM,CAAC,GAAG,CAAC;SACtC,CAAC,CAAC,CAAC;KACP,CAAC;KAGD,8BAAM,GAAN;SACI,MAAM,CAAC,IAAI,CAAC,GAAG,CAAE,eAAK,IAAI,YAAK,EAAL,CAAK,CAAE,CAAC;KACtC,CAAC;KAUD,sBAAI,0CAAe;cAAnB;aACI,MAAM,CAAC,IAAI,CAAC,gBAAgB,IAAI,CAAE,IAAI,CAAC,gBAAgB,GAAG,IAAI,+BAAe,CAAE,IAAI,CAAE,CAAE,CAAC;SAC5F,CAAC;;;QAAA;KAMD,gCAAQ,GAAR,UAAU,GAAoB,IAAU,CAAC;KAGzC,0CAAkB,GAAlB,UAAoB,GAAY;SAC5B,IAAI,KAAK,GAAG,IAAI,CAAC,eAAe,CAAC;SACjC,MAAM,CAAC,CAAE,GAAG,GAAG,KAAK,IAAI,KAAK,CAAC,MAAM,CAAE,GAAG,CAAE,GAAG,KAAK,CAAE,IAAI,IAAI,CAAC;KAClE,CAAC;KAGD,2CAAmB,GAAnB,UAAqB,SAAkB;SACnC,MAAM,CAAC,gCAAgB,CAAE,IAAI,EAAE,SAAS,EAAE,UAAE,MAAM,EAAE,GAAG,IAAM,aAAM,CAAC,kBAAkB,CAAE,GAAG,CAAE,EAAhC,CAAgC,CAAE,CAAC;KACpG,CAAC;KAGD,2CAAmB,GAAnB,UAAqB,QAAwE;SACjF,0CAAe,CAAU;SACjC,eAAe,IAAI,eAAe,CAAC,SAAS,CAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;KACnE,CAAC;KAGD,+BAAO,GAAP,UAAS,GAAY;SACjB,MAAM,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAE,GAAG,CAAE,CAAC;KAC3C,CAAC;KAtLL;SAAC,iBAAM,CAAC;aACJ,gBAAgB,EAAG,QAAQ;UAC9B,CAAC;sBAAA;KAqLF,oBAAC;AAAD,EAAC,CApL2C,oBAAS,GAoLpD;AApLqB,sBAAa,gBAoLlC;AAmDD,gBAAuB,MAAsB;KACzC,MAAM,CAAC,MAAM,CAAC,YAAY,GAAG,KAAK,GAAG,CAAE,MAAM,CAAC,YAAY,GAAG,IAAI,CAAE,CAAC;AACxE,EAAC;AAFe,cAAK,QAEpB;AAGD,sBAA6B,MAAsB;KAC/C,MAAM,CAAC,QAAQ,GAAI,IAAI,CAAC;KACxB,MAAM,CAAC,YAAY,GAAG,EAAE,CAAC;KACzB,MAAM,CAAC,gBAAgB,GAAG,KAAK,CAAC,CAAC;AACrC,EAAC;AAJe,oBAAW,cAI1B;AAID,iBAAwB,MAAsB,EAAE,OAA4B,EAAE,QAAmB;KAC7F,IAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;KAEjC,EAAE,EAAE,OAAO,CAAC,MAAO,CAAC,EAAC;SACjB,MAAM,CAAC,QAAQ,GAAI,KAAK,CAAC;KAC7B,CAAC;KACD,IAAI,EAAC;SACD,OAAO,MAAM,CAAC,QAAQ,EAAE,CAAC;aACrB,MAAM,CAAC,QAAQ,GAAG,KAAK,CAAC;aACxB,mBAAQ,CAAE,MAAM,EAAE,MAAM,CAAC,gBAAgB,EAAE,MAAM,EAAE,OAAO,CAAE,CAAC;SACjE,CAAC;KACL,CAAC;KAED,MAAM,CAAC,YAAY,GAAG,KAAK,CAAC;KAG5B,EAAE,EAAE,CAAC,QAAQ,IAAI,QAAQ,IAAI,MAAM,CAAC,MAAO,CAAC,EAAC;SACzC,MAAM,CAAC,MAAM,CAAC,iBAAiB,CAAE,MAAM,EAAE,OAAO,CAAE,CAAC;KACvD,CAAC;AACL,EAAC;AAnBe,eAAM,SAmBrB;AAOD,iBAAwB,KAAa,EAAE,KAAqB,EAAE,GAAa;KACvE,EAAE,EAAE,CAAC,KAAK,CAAC,MAAO,CAAC,EAAC;SAChB,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC;SACrB,KAAK,CAAC,SAAS,GAAG,GAAG,CAAC;KAC1B,CAAC;AACL,EAAC;AALe,eAAM,SAKrB;AAGD,eAAsB,KAAa,EAAE,KAAqB;KACtD,EAAE,EAAE,KAAK,KAAK,KAAK,CAAC,MAAO,CAAC,EAAC;SACzB,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,CAAC;SACtB,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC,CAAC;KAC7B,CAAC;AACL,EAAC;AALe,aAAI,OAKnB;;;;;;;;AC/RD;KAQI,yBAAa,GAAiB;SAC1B,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,eAAe,CAAE,IAAI,CAAC,MAAM,GAAG,EAAE,CAAE,CAAC;SAEtD,EAAE,EAAE,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,QAAQ,CAAE,GAAG,CAAG,CAAC,EAAC;aACnC,IAAI,CAAC,MAAM,EAAE,CAAC;SAClB,CAAC;KACL,CAAC;KAED,8BAAI,GAAJ,UAAM,QAAgD;SAClD,aAA8B,EAAtB,gBAAK,EAAE,kBAAM,CAAU;SAE/B,EAAE,EAAE,KAAM,CAAC;aAAC,QAAQ,CAAE,KAAK,EAAE,IAAI,CAAE,CAAC;SAEpC,GAAG,EAAE,IAAM,GAAG,IAAI,MAAO,CAAC,EAAC;aACvB,QAAQ,CAAE,MAAM,CAAE,GAAG,CAAE,EAAE,GAAG,CAAE,CAAC;SACnC,CAAC;KACL,CAAC;KAED,mCAAS,GAAT,UAAW,QAAsE,EAAE,MAAoB;SACnG,IAAI,CAAC,IAAI,CAAE,UAAE,KAAK,EAAE,GAAG;aACnB,EAAE,EAAE,KAAK,YAAY,eAAgB,CAAC,EAAC;iBACnC,KAAK,CAAC,SAAS,CAAE,QAAQ,EAAE,MAAM,CAAC,GAAG,CAAE,GAAG,CAAE,CAAE,CAAC;aACnD,CAAC;aACD,IAAI,EAAC;iBACD,QAAQ,CAAE,KAAK,EAAE,GAAG,EAAE,MAAM,CAAE,CAAC;aACnC,CAAC;SACL,CAAC,CAAC,CAAC;KACP,CAAC;KACL,sBAAC;AAAD,EAAC;AApCY,wBAAe,kBAoC3B;;;;;;;;ACjCD,KAAM,aAAa,GAAI,gBAAgB,CAAC;AAGxC,2BAAkC,SAAkB;KAChD,IAAM,IAAI,GAAG,SAAS;UACL,KAAK,CAAE,aAAa,CAAE;UACtB,GAAG,CAAE,aAAG,IAAI,UAAG,KAAK,GAAG,GAAG,aAAa,GAAG,CAAE,GAAG,KAAK,GAAG,GAAG,YAAY,GAAG,GAAG,CAAE,EAAlE,CAAkE,CAAE;UAChF,IAAI,CAAE,GAAG,CAAE,CAAC;KAE7B,MAAM,CAAO,IAAI,QAAQ,CAAE,MAAM,EAAE,iBAAgB,IAAI,MAAI,CAAE,CAAC;AAClE,EAAC;AAPe,yBAAgB,mBAO/B;AAED,2BAAkC,IAAkB,EAAE,SAAkB,EAAE,MAAwC;KAC9G,IAAM,IAAI,GAAG,SAAS,CAAC,KAAK,CAAE,aAAa,CAAE,EACvC,IAAI,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;KAE7B,IAAI,IAAI,GAAG,IAAI,CAAC;KAEhB,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,EAAE,CAAC,EAAE,EAAE,CAAC;SAC5B,IAAM,GAAG,GAAG,IAAI,CAAE,CAAC,CAAE,CAAC;SACtB,MAAM,EAAE,GAAI,CAAC,EAAC;aACV,KAAK,GAAG;iBAAG,IAAI,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;iBAAC,KAAK,CAAC;aACzC,KAAK,GAAG;iBAAG,IAAI,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;iBAAC,KAAK,CAAC;aACzC,SAAW,IAAI,GAAG,IAAI,CAAC,GAAG,CAAE,GAAG,CAAE,CAAC;SACtC,CAAC;SAGD,EAAE,EAAE,CAAC,IAAK,CAAC;aAAC,MAAM,CAAC;KACvB,CAAC;KAED,MAAM,CAAE,IAAI,EAAE,IAAI,CAAE,IAAI,CAAE,CAAE,CAAC;KAC7B,MAAM,CAAC,IAAI,CAAC;AAChB,EAAC;AApBe,yBAAgB,mBAoB/B;AAGD,4BAAmC,SAAS,EAAE,KAAK;KAC/C,IAAM,IAAI,GAAG,SAAS,CAAC,KAAK,CAAE,GAAG,CAAE,EAC7B,IAAI,GAAG,EAAE,EACT,IAAI,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;KAC7B,IAAI,OAAO,GAAG,IAAI,CAAC;KAEnB,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,EAAE,CAAC,EAAE,EAAE,CAAC;SAC5B,OAAO,GAAG,OAAO,CAAE,IAAI,CAAE,CAAC,CAAE,CAAE,GAAG,EAAE,CAAC;KACxC,CAAC;KAED,OAAO,CAAE,IAAI,CAAE,IAAI,CAAE,CAAE,GAAG,KAAK,CAAC;KAEhC,MAAM,CAAC,IAAI,CAAC;AAChB,EAAC;AAbe,0BAAiB,oBAahC;;;;;;;;AC9DD,0CAAiC,EAAgB,CAAC;AAElD,sCAAqE,CACrE,CAAC,CAD4F;AAC7F,yCAAsC,EAEtC,CAAC,CAFoD;AAwBrD,kBAAyB,QAAiC,EAAE,cAA+B;KACvF,IAAM,YAAY,GAAG,oBAAS,CAAkB,EAAE,EAAE,QAAQ,EAAE,eAAe,CAAE,EACzE,aAAa,GAAG,mBAAQ,CAAkB,EAAE,EAAE,YAAY,EAAE,cAAc,CAAE,EAC5E,UAAU,GAAG,eAAe,CAAE,aAAa,CAAE,EAC7C,KAAK,GAAkB;SACrB,UAAU,EAAG,UAAU;SACvB,WAAW,EAAG,IAAI,UAAU,CAAE,aAAa,CAAE;SAC7C,UAAU,EAAG,oBAAS,CAAyB,EAAE,EAAE,YAAY,EAAE,WAAC,IAAI,QAAC,CAAC,wBAAwB,EAAE,EAA5B,CAA4B,CAAE;SACpG,QAAQ,EAAG,cAAc,CAAE,aAAa,CAAE;SAC1C,OAAO,EAAG,YAAY,CAAE,aAAa,CAAE;SACvC,MAAM,EAAG,WAAW,CAAE,YAAY,EAAE,aAAa,CAAE;SACnD,aAAa,EAAG,cAAc,CAAE,aAAa,CAAE;MACjD,CAAC;KAGP,EAAE,EAAE,cAAG,CAAC,KAAK,GAAG,CAAE,CAAC,EAAC;SAChB,KAAK,CAAC,OAAO,GAAG,aAAa,CAAE,aAAa,CAAE,CAAC;KACnD,CAAC;KAED,MAAM,CAAC,KAAK,CAAC;AACjB,EAAC;AApBe,gBAAO,UAoBtB;AAGD,0BAA0B,IAAI,EAAE,IAAI;KAChC,MAAM,CAAC,+BAAgB,CAAC,MAAM,CAAE,mCAAqB,CAAE,IAAI,CAAE,EAAE,IAAI,CAAE,CAAC;AAC1E,EAAC;AAGD,yBAAyB,SAA0B;KAC/C,IAAI,MAAM,GAAmB,EAAE,CAAC;KAEhC,GAAG,EAAE,IAAI,GAAG,IAAI,SAAU,CAAC,EAAC;SACxB,IAAM,SAAS,GAAG,SAAS,CAAE,GAAG,CAAE,EAC5B,uCAAS,CAAuB;SAEtC,EAAE,EAAE,SAAU,CAAC,EAAC;aACZ,MAAM,CAAE,SAAS,GAAG,GAAG,CAAE,GAAG,SAAS,CAAC;SAC1C,CAAC;KACL,CAAC;KAED,MAAM,CAAC,MAAM,CAAC;AAClB,EAAC;AAED,wBAA+B,SAA0B;KACrD,IAAI,UAAU,GAAG,CAAE,6BAA6B,CAAE,CAAC;KAEnD,GAAG,EAAE,IAAI,MAAI,IAAI,SAAU,CAAC,EAAC;SACzB,UAAU,CAAC,IAAI,CAAE,aAAW,MAAI,iCAA2B,MAAI,eAAS,MAAI,QAAK,CAAE,CAAC;KACxF,CAAC;KAED,MAAM,CAAW,IAAI,QAAQ,CAAE,GAAG,EAAE,GAAG,EAAE,UAAU,CAAC,IAAI,CAAE,EAAE,CAAE,CAAE,CAAC;AACrE,EAAC;AARe,sBAAa,gBAQ5B;AAED,0BAAiC,SAA0B;KACvD,IAAI,UAAU,GAAG,EAAE,CAAC;KAEpB,GAAG,EAAE,IAAI,MAAI,IAAI,SAAU,CAAC,EAAC;SACzB,UAAU,CAAC,IAAI,CAAE,UAAQ,MAAI,aAAQ,MAAI,MAAG,CAAE,CAAC;KACnD,CAAC;KAED,IAAI,SAAS,GAAG,IAAI,QAAQ,CAAE,GAAG,EAAE,UAAU,CAAC,IAAI,CAAE,EAAE,CAAE,CAAE,CAAC;KAC3D,SAAS,CAAC,SAAS,GAAG,MAAM,CAAC,SAAS,CAAC;KACvC,MAAM,CAAuB,SAAS,CAAC;AAC3C,EAAC;AAVe,wBAAe,kBAU9B;AAGD,yBAAyB,SAA0B;KAC/C,IAAI,QAAQ,GAAG,CAAC,QAAQ,CAAC,EAAE,QAAQ,GAAG,EAAE,CAAC;KAEzC,oBAAqB,IAAI,EAAE,IAAI;SAC3B,QAAQ,CAAC,IAAI,CAAE,UAAQ,IAAI,mBAAc,IAAI,wBAAmB,IAAI,UAAO,CAAE,CAAC;SAC9E,QAAQ,CAAC,IAAI,CAAE,UAAQ,IAAI,WAAM,IAAI,MAAG,CAAE,CAAC;KAC/C,CAAC;KAGD,GAAG,EAAE,IAAI,MAAI,IAAI,SAAU,CAAC,EAAC;SACzB,IAAM,QAAQ,GAAG,SAAS,CAAE,MAAI,CAAE,EAC1B,sBAAK,EAAE,oBAAI,CAAc;SAEjC,EAAE,EAAE,KAAK,KAAK,KAAK,CAAC,IAAI,IAAK,CAAC,EAAC;aAE3B,UAAU,CAAE,MAAI,EAAE,OAAK,MAAI,cAAW,CAAE,CAAC;SAC7C,CAAC;SACD,IAAI,EAAC;aAED,EAAE,EAAE,sBAAW,CAAE,KAAK,CAAG,CAAC,EAAC;iBAEvB,UAAU,CAAE,MAAI,EAAE,IAAI,CAAC,SAAS,CAAE,KAAK,CAAE,CAAE,CAAC;aAChD,CAAC;aACD,IAAI,CAAC,EAAE,EAAE,KAAK,KAAK,KAAK,CAAE,CAAC,EAAC;iBAExB,UAAU,CAAE,MAAI,EAAE,QAAQ,CAAE,CAAC;aACjC,CAAC;aACD,IAAI,EAAC;iBAED,UAAU,CAAE,MAAI,EAAE,OAAK,MAAI,WAAQ,CAAE,CAAC;aAC1C,CAAC;SACL,CAAC;KACL,CAAC;KAED,IAAM,cAAc,GAAS,IAAI,QAAQ,CAAE,GAAG,EAAE,QAAQ,CAAC,IAAI,CAAE,EAAE,CAAE,CAAE,EAC/D,cAAc,GAAS,IAAI,QAAQ,CAAE,GAAG,EAAE,GAAG,EAAE,QAAQ,CAAC,IAAI,CAAE,EAAE,CAAE,CAAE,CAAC;KAE3E,cAAc,CAAC,SAAS,GAAG,cAAc,CAAC,SAAS,GAAG,MAAM,CAAC,SAAS,CAAC;KAIvE,MAAM,CAAC,UAAU,KAAW;SACxB,MAAM,CAAC,KAAK,GAAG,IAAI,cAAc,CAAE,KAAK,EAAE,IAAI,CAAC,WAAW,CAAE,GAAG,IAAI,cAAc,CAAE,IAAI,CAAC,WAAW,CAAE,CAAC;KAC1G,CAAC;AACL,EAAC;AAED,sBAAsB,YAA6B,EAAE,SAA0B;KAC3E,IAAI,UAAU,GAAG,CAAE,yBAAyB,CAAE,EAC1C,MAAM,GAAO,KAAK,CAAC;KAEvB,GAAG,EAAE,IAAI,MAAI,IAAI,YAAa,CAAC,EAAC;SAC5B,IAAM,KAAK,GAAG,SAAS,CAAE,MAAI,CAAE,CAAC;SAGhC,EAAE,EAAE,KAAK,IAAI,KAAK,CAAC,KAAM,CAAC;aAAC,MAAM,GAAG,IAAI,CAAC;SAGzC,EAAE,EAAE,YAAY,CAAE,MAAI,CAAE,CAAC,KAAM,CAAC,EAAC;aAC7B,IAAM,CAAC,GAAG,OAAK,MAAI,0BAAqB,MAAI,aAAQ,MAAI,6BAAwB,MAAI,YAAM,MAAI,WAAO,CAAC;aACtG,UAAU,CAAC,IAAI,CAAE,CAAC,CAAE,CAAC;SACzB,CAAC;KACL,CAAC;KAED,EAAE,EAAE,MAAO,CAAC,EAAC;SACT,UAAU,CAAC,IAAI,CAAE,WAAW,CAAE,CAAC;SAC/B,MAAM,CAAO,IAAI,QAAQ,CAAE,GAAG,EAAE,UAAU,CAAC,IAAI,CAAE,EAAE,CAAE,CAAE,CAAC;KAC5D,CAAC;AACJ,EAAC;AAEF,uBAAuB,SAA0B;KAC7C,IAAI,UAAU,GAAG,CAAE,qDAAqD,CAAE,CAAC;KAE3E,GAAG,EAAE,IAAI,GAAG,IAAI,SAAU,CAAC,EAAC;SACxB,IAAM,MAAM,GAAG,SAAS,CAAE,GAAG,CAAE,CAAC,MAAM,CAAC;SAEvC,EAAE,EAAE,MAAO,CAAC,EAAC;aACT,UAAU,CAAC,IAAI,CAAE,UAAQ,GAAG,aAAQ,GAAG,8BAA0B,GAAG,WAAO,GAAG,SAAM,CAAE,CAAC;SAC3F,CAAC;KACL,CAAC;KAED,UAAU,CAAC,IAAI,CAAE,cAAc,CAAE,CAAC;KAElC,MAAM,CAAO,IAAI,QAAQ,CAAE,UAAU,CAAC,IAAI,CAAE,EAAE,CAAE,CAAE,CAAC;AACvD,EAAC;;;;;;;;AChLD,4CAA+F,CAC/F,CAAC,CADgH;AACjH,sCAA8C,CAE9C,CAAC,CAFqE;AActE;KAuGI,0BAAoB,IAAa,EAAS,OAA6B;SAAnD,SAAI,GAAJ,IAAI,CAAS;SAAS,YAAO,GAAP,OAAO,CAAsB;SAyCvE,YAAO,GAAoC,IAAI;SAvCjC,yBAAK,EAAE,mBAAI,EAAE,qBAAK,EAAE,uBAAM,EAC1B,qBAAa,EAAb,kCAAa,EACb,uBAAe,EAAf,oCAAe,EACf,2BAAmB,EAAnB,wCAAmB,CACX;SAElB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;SACnB,IAAI,CAAC,IAAI,GAAI,IAAI,CAAC;SAElB,IAAI,CAAC,KAAK,GAAI,KAAK,CAAC;SACpB,IAAI,CAAC,MAAM,GAAG,MAAM,KAAK,KAAK,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;SAOvD,UAAU,CAAC,OAAO,CAAE,IAAI,CAAC,OAAO,CAAE,CAAC;SAGnC,EAAE,EAAE,IAAI,CAAC,GAAI,CAAC;aAAC,QAAQ,CAAC,OAAO,CAAE,IAAI,CAAC,GAAG,CAAE,CAAC;SAG5C,IAAI,CAAC,UAAU,CAAC,KAAK,CAAE,IAAI,EAAE,SAAS,CAAE,CAAC;SAGzC,EAAE,EAAE,QAAQ,CAAC,MAAO,CAAC,EAAC;aAClB,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAE,aAAa,CAAE,CAAC;SACpD,CAAC;SAED,EAAE,EAAE,UAAU,CAAC,MAAO,CAAC,EAAC;aACpB,IAAI,CAAC,SAAS,GAAG,UAAU,CAAC,MAAM,CAAE,eAAe,CAAE,CAAC;SAC1D,CAAC;SAED,EAAE,EAAE,cAAc,CAAC,MAAO,CAAC,EAAC;aACxB,IAAI,CAAC,YAAY,GAAG,cAAc,CAAC,MAAM,CAAE,mBAAmB,CAAE,CAAC;SACrE,CAAC;KACL,CAAC;KA5IM,uBAAM,GAAb,UAAe,OAA6B,EAAE,IAAa;SACvD,IAAM,IAAI,GAAG,OAAO,CAAC,IAAI,EACnB,aAAa,GAAG,IAAI,GAAG,IAAI,CAAC,UAAU,GAAG,gBAAgB,CAAC;SAEhE,MAAM,CAAC,IAAI,aAAa,CAAE,IAAI,EAAE,OAAO,CAAE,CAAC;KAC9C,CAAC;KAQA,uCAAY,GAAZ,UAAc,IAAI,EAAE,IAAI;SACpB,MAAM,CAAC,KAAK,CAAC;KACjB,CAAC;KAKF,oCAAS,GAAT,UAAW,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,IAAK,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;KAG1D,kCAAO,GAAP,UAAS,KAAK,EAAE,OAAO,EAAE,KAAK,IAAK,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;KAKlD,oCAAS,GAAT,UAAW,CAAC,EAAE,CAAC;SACX,MAAM,CAAC,mBAAQ,CAAE,CAAC,EAAE,CAAC,CAAE,CAAC;KAC5B,CAAC;KAKD,uCAAY,GAAZ,UAAc,IAAI,EAAE,IAAI,EAAE,KAAK,IAAI,CAAC;KAOpC,iCAAM,GAAN,cAAW,MAAM,CAAC,IAAW,IAAI,CAAC,IAAM,EAAE,CAAC,CAAC,CAAC;KAI7C,gCAAK,GAAL,UAAO,KAAK,EAAE,OAAkC;SAAlC,uBAAkC,GAAlC,YAAkC;SAC5C,EAAE,EAAE,KAAK,IAAI,OAAO,KAAK,KAAK,QAAS,CAAC,CAAC,CAAC;aAEtC,EAAE,EAAE,KAAK,CAAC,KAAM,CAAC,CAAC,CAAC;iBACf,MAAM,CAAC,KAAK,CAAC,KAAK,CAAE,OAAO,CAAE,CAAC;aAClC,CAAC;aAED,EAAE,EAAE,OAAO,CAAC,IAAK,CAAC,EAAC;iBACf,IAAM,KAAK,GAAG,MAAM,CAAC,cAAc,CAAE,KAAK,CAAE,CAAC;iBAG7C,EAAE,EAAE,KAAK,KAAK,MAAM,CAAC,SAAS,IAAI,KAAK,KAAK,KAAK,CAAC,SAAU,CAAC,EAAC;qBAC1D,MAAM,CAAC,IAAI,CAAC,KAAK,CAAE,IAAI,CAAC,SAAS,CAAE,KAAK,CAAE,CAAE,CAAC;iBACjD,CAAC;aACL,CAAC;SACL,CAAC;SAED,MAAM,CAAC,KAAK,CAAC;KACjB,CAAC;KAED,mCAAQ,GAAR,UAAU,MAAe,EAAE,KAAW,EAAE,GAAY,IAAG,CAAC;KAExD,iCAAM,GAAN,UAAQ,KAAK,EAAE,GAAG;SACd,MAAM,CAAC,KAAK,IAAI,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,EAAE,GAAG,KAAK,CAAC;KAC1D,CAAC;KAED,mDAAwB,GAAxB;SACI,aAA8B,EAAtB,cAAI,EAAE,oBAAO,CAAU;SAE/B,EAAE,EAAE,IAAI,KAAK,IAAK,CAAC,EAAC;aAChB,MAAM,CAAC;iBAEH,GAAG,YAAE,KAAK;qBACN,6BAAY,CAAO,IAAI,EAAE,IAAI,EAAE,KAAK,CAAE,CAAC;iBAC3C,CAAC;iBAGD,GAAG,EAAG,OAAO;qBACP;yBACI,MAAM,CAAC,OAAO,CAAC,IAAI,CAAE,IAAI,EAAE,IAAI,CAAC,UAAU,CAAE,IAAI,CAAE,EAAE,IAAI,CAAE,CAAC;qBAC/D,CAAC;qBACD;yBACI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAE,IAAI,CAAE,CAAC;qBACnC,CAAC;cACV;SACL,CAAC;KACL,CAAC;KAOD,qCAAU,GAAV,UAAY,IAAa,EAAE,OAAO,IAAG,CAAC;KA6C1C,uBAAC;AAAD,EAAC;AAlJY,yBAAgB,mBAkJ5B;AAED,8BAA8B,IAAoB,EAAE,IAAoB;KACpE,MAAM,CAAC,UAAU,IAAI,EAAE,IAAI,EAAE,KAAK;SAC9B,IAAI,CAAC,IAAI,CAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,CAAE,CAAC;SACrC,IAAI,CAAC,IAAI,CAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,CAAE,CAAC;KACzC,CAAC;AACL,EAAC;AAED,wBAAwB,IAAc,EAAE,IAAc;KAClD,MAAM,CAAC,UAAU,KAAK,EAAE,IAAI;SACxB,MAAM,CAAC,IAAI,CAAC,IAAI,CAAE,IAAI,CAAC,IAAI,CAAE,KAAK,EAAE,IAAI,CAAE,EAAE,IAAI,CAAE,CAAC;KACvD,CAAC;AACL,EAAC;AAED,0BAA0B,IAAgB,EAAE,IAAgB;KACxD,MAAM,CAAC,UAAU,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK;SACxC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,CAAE,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,CAAE,CAAC;KACnG,CAAC;AACL,EAAC;;;;;;;;;;;;;ACpLD,4CAAuB,CACvB,CAAC,CADwC;AACzC,0CAAiC,EACjC,CAAC,CADgD;AAGjD;KAAuC,qCAAgB;KAAvD;SAAuC,8BAAgB;KA6BvD,CAAC;KA1BG,wCAAY,GAAZ,UAAc,IAAoB,EAAE,IAAU;SAE1C,MAAM,CAAC,IAAI,IAAI,IAAI,IAAI,CAAC,CAAE,IAAI,YAAY,IAAI,CAAC,IAAI,CAAE,CAAC;KAC1D,CAAC;KAED,mCAAO,GAAP,UAAS,KAAW,EAAE,OAA4B,EAAE,MAAe;SAE/D,MAAM,CAAC,KAAK,IAAI,IAAI,IAAI,KAAK,YAAY,IAAI,CAAC,IAAI,GAAG,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAE,KAAK,EAAE,OAAO,EAAE,MAAM,CAAE,CAAC;KAC5G,CAAC;KAED,kCAAM,GAAN;SACI,MAAM,CAAC,IAAU,IAAI,CAAC,IAAK,EAAE,CAAC;KAClC,CAAC;KAED,wCAAY,GAAZ,UAAc,IAAoB,EAAE,IAAoB,EAAE,MAAe;SAErE,EAAE,EAAE,IAAI,IAAI,IAAI,CAAC,MAAM,KAAK,MAAO,CAAC,EAAC;aACjC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;SACxC,CAAC;SAGD,EAAE,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,MAAO,CAAC,EAAC;aACvB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;aACrB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC;SAC/B,CAAC;KACL,CAAC;KACL,wBAAC;AAAD,EAAC,CA7BsC,+BAAgB,GA6BtD;AA7BY,0BAAiB,oBA6B7B;AAED,wBAAM,CAAC,UAAU,GAAG,iBAAiB,CAAC;;;;;;;;;;;;;ACnCtC,0CAAiC,EACjC,CAAC,CADgD;AACjD,sCAA0B,CAG1B,CAAC,CAHiD;AAGlD;KAA8B,mCAAgB;KAA9C;SAA8B,8BAAgB;KAW9C,CAAC;KARG,iCAAO,GAAP,UAAS,KAAK;SACV,MAAM,CAAC,KAAK,IAAI,IAAI,IAAI,KAAK,YAAY,IAAI,CAAC,IAAI,GAAG,KAAK,GAAG,IAAI,IAAI,CAAC,IAAI,CAAE,KAAK,CAAE,CAAC;KACxF,CAAC;KAED,+BAAK,GAAL,UAAO,KAAK,EAAE,OAAO;SAEjB,MAAM,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAE,KAAK,EAAE,OAAO,CAAE,GAAG,IAAI,CAAC,OAAO,CAAE,IAAI,CAAC,KAAK,CAAE,IAAI,CAAC,SAAS,CAAE,KAAK,CAAE,CAAE,CAAE,CAAC;KAC/G,CAAC;KACL,sBAAC;AAAD,EAAC,CAX6B,+BAAgB,GAW7C;AAED,SAAQ,CAAC,SAAS,CAAC,UAAU,GAAG,eAAe,CAAC;AAGhD;KAAuB,4BAAgB;KAAvC;SAAuB,8BAAgB;KAevC,CAAC;KAdG,0BAAO,GAAP,UAAS,KAAK;SACV,MAAM,CAAC,KAAK,IAAI,IAAI,IAAI,KAAK,YAAY,IAAI,GAAG,KAAK;aAC9C,IAAI,IAAI,CAAE,OAAO,KAAK,KAAK,QAAQ,GAAG,oBAAS,CAAE,KAAK,CAAE,GAAG,KAAK,CAAE,CAAC;KAC9E,CAAC;KAED,2BAAQ,GAAR,UAAU,KAAK,EAAE,KAAK,EAAE,IAAI;SACxB,EAAE,EAAE,KAAK,CAAE,CAAC,KAAK,CAAG,CAAC;aAAC,MAAM,CAAC,IAAI,GAAG,kBAAkB,CAAC;KAC3D,CAAC;KAED,yBAAM,GAAN,UAAQ,KAAK,IAAK,MAAM,CAAC,KAAK,IAAI,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;KAEnD,4BAAS,GAAT,UAAW,CAAC,EAAE,CAAC,IAAK,MAAM,CAAC,CAAE,CAAC,IAAI,CAAC,CAAC,CAAE,KAAK,CAAE,CAAC,IAAI,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC;KAEzD,wBAAK,GAAL,UAAO,KAAK,IAAK,MAAM,CAAC,KAAK,IAAI,IAAI,IAAI,CAAE,CAAC,KAAK,CAAE,CAAC,CAAC,CAAC;KAC1D,eAAC;AAAD,EAAC,CAfsB,+BAAgB,GAetC;AAED,KAAI,CAAC,UAAU,GAAG,QAAQ,CAAC;AAG3B;KAAmC,iCAAgB;KAAnD;SAAmC,8BAAgB;KAYnD,CAAC;KATG,8BAAM,GAAN,cAAW,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;KAEhC,8BAAM,GAAN,UAAQ,KAAK,IAAK,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;KAEjC,+BAAO,GAAP,UAAS,KAAK,IAAK,MAAM,CAAC,KAAK,IAAI,IAAI,GAAG,KAAK,GAAG,IAAI,CAAC,IAAI,CAAE,KAAK,CAAE,CAAC,CAAC,CAAC;KAEvE,iCAAS,GAAT,UAAW,CAAC,EAAE,CAAC,IAAK,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;KAErC,6BAAK,GAAL,UAAO,KAAK,IAAK,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;KACpC,oBAAC;AAAD,EAAC,CAZkC,+BAAgB,GAYlD;AAZY,sBAAa,gBAYzB;AAED,QAAO,CAAC,UAAU,GAAG,MAAM,CAAC,UAAU,GAAG,aAAa,CAAC;AAGvD;KAAiC,+BAAa;KAA9C;SAAiC,8BAAa;KAS9C,CAAC;KANG,8BAAQ,GAAR,UAAU,KAAK,EAAE,KAAK,EAAE,IAAI;SAExB,EAAE,EAAE,CAAC,QAAQ,CAAE,KAAK,CAAG,CAAC,CAAC,CAAC;aACtB,MAAM,CAAC,IAAI,GAAG,sBAAsB,CAAC;SACzC,CAAC;KACL,CAAC;KACL,kBAAC;AAAD,EAAC,CATgC,aAAa,GAS7C;AATY,oBAAW,cASvB;AAED,OAAM,CAAC,UAAU,GAAG,WAAW,CAAC;AAShC,GAAE,EAAE,MAAO,CAAC,EAAC;KACT,MAAM,CAAC,OAAO,GAAG,UAAU,CAAC,IAAI,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAE,CAAC,CAAE,GAAG,CAAC,CAAC,CAAC,CAAC;KACjE,MAAM,CAAC,OAAO,CAAC,UAAU,GAAG,WAAW,CAAC;AAC5C,EAAC;AAGD;KAA+B,6BAAgB;KAA/C;SAA+B,8BAAgB;KAU/C,CAAC;KATG,0BAAM,GAAN,UAAQ,KAAK,IAAK,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;KAEjC,2BAAO,GAAP,UAAS,KAAK;SAEV,EAAE,EAAE,KAAK,IAAI,IAAI,IAAI,KAAK,YAAY,KAAM,CAAC;aAAC,MAAM,CAAC,KAAK,CAAC;SAG3D,MAAM,CAAC,EAAE,CAAC;KACd,CAAC;KACL,gBAAC;AAAD,EAAC,CAV8B,+BAAgB,GAU9C;AAVY,kBAAS,YAUrB;AAED,MAAK,CAAC,UAAU,GAAG,SAAS,CAAC;;;;;;;;ACxF7B,sCAAmD,CAEnD,CAAC,CAF0E;AAE3E;KAGI,gCAAa,OAAkC;SAAlC,uBAAkC,GAAlC,YAAkC;SAC3C,IAAI,CAAC,OAAO,GAAG,EAAE,QAAQ,EAAG,EAAE,EAAE,UAAU,EAAG,EAAE,EAAE,cAAc,EAAG,EAAE,EAAC,CAAC;SACtE,iBAAM,CAAE,IAAI,CAAC,OAAO,EAAE,OAAO,CAAE,CAAC;KACpC,CAAC;KAGD,oCAAG,GAAH,UAAK,GAAG;SACJ,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAE,GAAG,CAAE,CAAC;KACtC,CAAC;KAGD,oCAAG,GAAH,UAAK,GAAG;SACJ,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAE,UAAU,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK;aAC9D,EAAE,EAAE,IAAI,CAAC,SAAS,CAAE,IAAI,EAAE,IAAI,CAAG,CAAC,CAAC,CAAC;iBAChC,IAAI,OAAO,GAAG,GAAG,CAAC,IAAI,CAAE,KAAK,EAAE,IAAI,EAAE,IAAI,CAAE,CAAC;iBAC5C,MAAM,CAAC,OAAO,KAAK,KAAK,CAAC,GAAG,IAAI,GAAG,OAAO,CAAC;aAC/C,CAAC;aAED,MAAM,CAAC,IAAI,CAAC;SAChB,CAAC,CAAE,CAAC;KACR,CAAC;KAGD,uCAAM,GAAN,UAAQ,GAAmB;SACvB,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,IAAI,CAAE,UAAU,IAAI,EAAE,IAAI,EAAE,MAAe;aAC/D,IAAI,IAAI,MAAM,CAAC,aAAa,CAAE,IAAI,CAAE,CAAC;aAErC,IAAI,IAAI,MAAM,CAAC,QAAQ,CAAE,IAAI,EAAE,GAAG,CAAE,CAAC;SACzC,CAAC,CAAC,CAAC;KACX,CAAC;KAGD,yCAAQ,GAAR,UAAU,OAA2B;SACjC,IAAI,CAAC,OAAO,CAAC,SAAS,GAAG,OAAO,CAAC;KACrC,CAAC;KAED,sBAAI,uCAAG;cAAP,cAAY,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;;;QAAA;KAQ1B,sCAAK,GAAL,UAAO,CAAC,IAAK,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;KAC1C,6BAAC;AAAD,EAAC;AAhDY,+BAAsB,yBAgDlC;AAUD,SAAQ,CAAC,SAAS,CAAC,KAAK,GAAG,UAAU,CAAC;KAClC,MAAM,CAAC,IAAI,sBAAsB,CAAE,EAAE,IAAI,EAAG,IAAI,EAAE,KAAK,EAAG,CAAC,EAAE,CAAE,CAAC;AACpE,EAAC,CAAC;AASF,OAAM,CAAC,cAAc,CAAE,QAAQ,CAAC,SAAS,EAAE,KAAK,EAAE;KAC9C,GAAG;SAEC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,sBAAsB,CAAE,EAAE,IAAI,EAAG,IAAI,EAAE,CAAE,CAAC;KACtE,CAAC;KAED,GAAG,YAAE,KAAK,IAAK,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC;EACtC,CAAE,CAAC;AAEJ,gCAAuC,IAAU;KAC7C,EAAE,EAAE,OAAO,IAAI,KAAK,UAAW,CAAC,CAAC,CAAC;SAC9B,MAAM,CAAC,EAAE,IAAI,EAAS,IAAI,EAAE,CAAC;KACjC,CAAC;KAED,EAAE,EAAE,IAAI,IAAI,IAAI,YAAY,sBAAuB,CAAC,CAAC,CAAC;SAClD,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;KACxB,CAAC;KAED,MAAM,CAAC;SACH,IAAI,EAAG,SAAS,CAAE,IAAI,CAAE;SACxB,KAAK,EAAG,IAAI;MACf;AACL,EAAC;AAbe,8BAAqB,wBAapC;AAED,oBAAoB,KAAU;KAC1B,MAAM,EAAE,OAAO,KAAM,CAAC,CAAC,CAAC;SACpB,KAAK,QAAQ;aACT,MAAM,CAAC,MAAM,CAAC;SAClB,KAAK,QAAQ;aACT,MAAM,CAAC,MAAM,CAAC;SAClB,KAAK,SAAS;aACV,MAAM,CAAC,OAAO,CAAC;SACnB,KAAK,WAAW;aACZ,MAAM,CAAC,KAAK,CAAC,CAAC;SAClB,KAAK,QAAQ;aACT,MAAM,CAAC,KAAK,GAAS,KAAK,CAAC,WAAW,GAAG,MAAM,CAAC;KACxD,CAAC;AACL,EAAC","file":"./index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Nested\"] = factory();\n\telse\n\t\troot[\"Nested\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 5683b8efbee4a4056d3b\n **/","import * as tools from './objectplus/tools.ts'\r\nimport { Record as Model } from './record/index.ts'\r\n\r\nimport { Events } from './objectplus/events.ts'\r\nexport const { on, off, trigger, once, listenTo, stopListening, listenToOnce } = Events;\r\n\r\n//import { Collection } from './collection'\r\n\r\nexport * from './objectplus/mixins.ts'\r\nexport * from './objectplus/events.ts'\r\n\r\nexport {\r\n    tools,\r\n    Model,\r\n    //Collection,\r\n}; \n\n\n/** WEBPACK FOOTER **\n ** ./src/index.ts\n **/","/**\r\n * Simple overridable logging stubs\r\n *\r\n */\r\n\r\nclass Log {\r\n    level : Number = 2\r\n\r\n    error( ...args : any[] ) : void {\r\n        console.error.apply( console, args );\r\n    }\r\n\r\n    warn( ...args : any[] ) : void {\r\n        if( this.level > 0 ) console.warn.apply( console, args );\r\n    }\r\n\r\n    info(){\r\n        if( this.level > 1 ) console.info.apply( console, arguments );\r\n    }\r\n\r\n    debug(){\r\n        if( this.level > 2 ) console.log.apply( console, arguments );\r\n    }\r\n}\r\n\r\nexport let log = new Log();\r\n\r\n// Check if value is valid JSON.\r\nexport function isValidJSON( value : any ) : boolean {\r\n    if( value === null ){\r\n        return true;\r\n    }\r\n\r\n    switch( typeof value ){\r\n    case 'number' :\r\n    case 'string' :\r\n    case 'boolean' :\r\n        return true;\r\n\r\n    case 'object':\r\n        var proto = Object.getPrototypeOf( value );\r\n\r\n        if( proto === Object.prototype || proto === Array.prototype ){\r\n            return every( value, isValidJSON );\r\n        }\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n/**\r\n * Object manipulation helpers...\r\n */\r\n\r\nexport function getBaseClass( Class : Function ){\r\n    return Object.getPrototypeOf( Class.prototype ).constructor\r\n}\r\n\r\ntype Iteratee = ( value : any, key? : string | number ) => any;\r\n\r\nfunction someArray( arr : any[], fun : Iteratee ) : any {\r\n    let result;\r\n\r\n    for( let i = 0; i < arr.length; i++ ){\r\n        if( result = fun( arr[ i ], i ) ){\r\n            return result;\r\n        }\r\n    }\r\n}\r\n\r\nfunction someObject( obj : {}, fun : Iteratee ) : any {\r\n    let result;\r\n\r\n    for( let key in obj ){\r\n        if( obj.hasOwnProperty( key ) ){\r\n            if( result = fun( obj[ key ], key ) ){\r\n                return result;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function some( obj, fun : Iteratee ) : any {\r\n    if( Object.getPrototypeOf( obj ) === ArrayProto ){\r\n        return someArray( obj, fun );\r\n    }\r\n    else{\r\n        return someObject( obj, fun );\r\n    }\r\n}\r\n\r\nexport function every( obj : { }, predicate : Iteratee ) : boolean {\r\n    return !some( obj, x => !predicate( x ) );\r\n}\r\n\r\nexport function getPropertyDescriptor( obj : {}, prop : string ) : PropertyDescriptor {\r\n    let desc : PropertyDescriptor;\r\n\r\n    for( let proto = obj; !desc && proto; proto = Object.getPrototypeOf( proto ) ) {\r\n        desc = Object.getOwnPropertyDescriptor( obj, prop );\r\n    }\r\n\r\n    return desc;\r\n}\r\n\r\nexport function omit( source : {}, ...rest : string[] ) : {}\r\nexport function omit( source ) : {} {\r\n    const dest = {}, discard = {};\r\n\r\n    for( let i = 1; i < arguments.length; i ++ ){\r\n        discard[ arguments[ i ] ] = true;\r\n    }\r\n\r\n    for( var name in source ) {\r\n        if( !discard[ name ] && source.hasOwnProperty( name ) ) {\r\n            dest[ name ] = source[ name ];\r\n        }\r\n    }\r\n\r\n    return dest;\r\n}\r\n\r\nexport function transform< A, B >( dest : { [ key : string ] : A }, source : { [ key : string ] : B }, fun : ( value : B, key : string ) => A | void ) : { [ key : string ] : A } {\r\n    for( var name in source ) {\r\n        if( source.hasOwnProperty( name ) ) {\r\n            var value = fun( source[ name ], name );\r\n            value === void 0 || ( dest[ name ] = < A >value );\r\n        }\r\n    }\r\n\r\n    return dest;\r\n}\r\n\r\nexport function fastAssign( dest : {}, source : {} ) : void {\r\n    for( var name in source ) {\r\n        dest[ name ] = source[ name ];\r\n    }\r\n}\r\n\r\nexport function fastDefaults( dest : {}, source : {} ) : void {\r\n    for( var name in source ) {\r\n        if( dest[ name ] === void 0 ){\r\n            dest[ name ] = source[ name ];\r\n        }\r\n    }\r\n}\r\n\r\nfunction forAllArgs( fun ) {\r\n    return function< T >( dest : T, ...sources ) : T {\r\n        for( var i = 0; i < sources.length; i++ ) {\r\n            const source = sources[ i ];\r\n            source && fun( dest, source );\r\n        }\r\n\r\n        return dest;\r\n    }\r\n}\r\n\r\nexport const assign = forAllArgs( ( dest, source ) => {\r\n    for( var name in source ) {\r\n        if( source.hasOwnProperty( name ) ) {\r\n            dest[ name ] = source[ name ];\r\n        }\r\n    }\r\n} );\r\n\r\nexport const defaults = forAllArgs( ( dest, source ) => {\r\n    for( var name in source ) {\r\n        if( source.hasOwnProperty( name ) && dest[ name ] === void 0 ) {\r\n             dest[ name ] = source[ name ];\r\n        }\r\n    }\r\n} );\r\n \r\nexport function once( func : Function ) : Function {\r\n    var memo, first = true;\r\n    return function() {\r\n        if ( first ) {\r\n            first = false;\r\n            memo = func.apply(this, arguments);\r\n            func = null;\r\n        }\r\n        return memo;\r\n    };\r\n}\r\n\r\n/**\r\n * notEqual( a, b ) function, for deep JSON comparison\r\n * Optimized for primitive types\r\n */\r\n\r\nconst ArrayProto = Array.prototype,\r\n      DateProto = Date.prototype,\r\n      ObjectProto = Object.prototype;\r\n\r\nexport function notEqual( a : any, b : any) : boolean {\r\n    if( a === b ) return false;\r\n\r\n    if( a && b && typeof a == 'object' && typeof b == 'object' ) {\r\n        const protoA = Object.getPrototypeOf( a );\r\n\r\n        if( protoA !== Object.getPrototypeOf( b ) ) return true;\r\n\r\n        switch( protoA ){\r\n            case DateProto   : return +a !== +b;\r\n            case ArrayProto  : return arraysNotEqual( a, b );\r\n            case ObjectProto :\r\n            case null:\r\n                return objectsNotEqual( a, b );\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction objectsNotEqual( a, b ) {\r\n    const keysA = Object.keys( a );\r\n\r\n    if( keysA.length !== Object.keys( b ).length ) return true;\r\n\r\n    for( let i = 0; i < keysA.length; i++ ) {\r\n        const key = keysA[ i ];\r\n\r\n        if( !b.hasOwnProperty( key ) || notEqual( a[ key ], b[ key ] ) ) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfunction arraysNotEqual( a, b ) {\r\n    if( a.length !== b.length ) return true;\r\n\r\n    for( let i = 0; i < a.length; i++ ) {\r\n        if( notEqual( a[ i ], b[ i ] ) ) return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n\r\nvar numericKeys    = [ 1, 4, 5, 6, 7, 10, 11 ],\r\n    msDatePattern  = /\\/Date\\(([0-9]+)\\)\\//,\r\n    isoDatePattern = /^(\\d{4}|[+\\-]\\d{6})(?:-(\\d{2})(?:-(\\d{2}))?)?(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(?:(Z)|([+\\-])(\\d{2})(?::(\\d{2}))?)?)?$/;\r\n\r\nexport function parseDate( date ) {\r\n    var msDate, timestamp, struct, minutesOffset = 0;\r\n\r\n    if( msDate = msDatePattern.exec( date ) ) {\r\n        timestamp = Number( msDate[ 1 ] );\r\n    }\r\n    else if( ( struct = isoDatePattern.exec( date )) ) {\r\n        // avoid NaN timestamps caused by undefined values being passed to Date.UTC\r\n        for( var i = 0, k; ( k = numericKeys[ i ] ); ++i ) {\r\n            struct[ k ] = +struct[ k ] || 0;\r\n        }\r\n\r\n        // allow undefined days and months\r\n        struct[ 2 ] = (+struct[ 2 ] || 1) - 1;\r\n        struct[ 3 ] = +struct[ 3 ] || 1;\r\n\r\n        if( struct[ 8 ] !== 'Z' && struct[ 9 ] !== undefined ) {\r\n            minutesOffset = struct[ 10 ] * 60 + struct[ 11 ];\r\n\r\n            if( struct[ 9 ] === '+' ) {\r\n                minutesOffset = 0 - minutesOffset;\r\n            }\r\n        }\r\n\r\n        timestamp =\r\n            Date.UTC( struct[ 1 ], struct[ 2 ], struct[ 3 ], struct[ 4 ], struct[ 5 ] + minutesOffset, struct[ 6 ],\r\n                      struct[ 7 ] );\r\n    }\r\n    else {\r\n        timestamp = Date.parse( date );\r\n    }\r\n\r\n    return timestamp;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/objectplus/tools.ts\n **/","import { Record, RecordDefinition } from './transaction.ts'\r\nimport { assign, defaults, omit, Class, ClassDefinition } from '../objectplus/index.ts'\r\nimport { compile, AttributesSpec } from './define.ts'\r\n\r\nimport { TransactionalType } from './nestedTypes.ts'\r\nimport './basicTypes.ts'\r\n\r\nRecord.define = function( protoProps : RecordDefinition, staticProps ){\r\n    const baseProto : Record = Object.getPrototypeOf( this.prototype ),\r\n            BaseConstructor = < typeof Record >baseProto.constructor;\r\n\r\n    if( protoProps ) {\r\n        // Compile attributes spec, creating definition mixin.\r\n        const definition = compile( protoProps.attributes || protoProps.defaults, <AttributesSpec> baseProto._attributes );\r\n\r\n        // Explicit 'properties' declaration overrides auto-generated attribute properties.\r\n        assign( definition.properties, protoProps.properties || {} );\r\n\r\n        // Merge in definition.\r\n        defaults( definition, omit( protoProps, 'attributes', 'collection' ) );            \r\n        Class.define.call( this, definition, staticProps );\r\n    }\r\n\r\n    return this;\r\n}\r\n\r\nRecord._attribute = TransactionalType;\r\n\r\nexport { Record }\n\n\n/** WEBPACK FOOTER **\n ** ./src/record/index.ts\n **/","/**\r\n * Record core implementing transactional updates.\r\n * The root of all definitions. \r\n */\r\n\r\nimport { EventHandlers, Class, ClassDefinition, Constructor, trigger3, log, define } from '../objectplus/index.ts'\r\n\r\nimport { begin as _begin, markAsDirty as _markAsDirty, commit, Transactional, Transaction, TransactionOptions, Owner } from '../transactions.ts'\r\nimport { ChildrenErrors } from '../validation.ts'\r\n\r\n/***************************************************************\r\n * Record Definition as accepted by Record.define( definition )\r\n */\r\n\r\nexport interface RecordDefinition extends ClassDefinition {\r\n    attributes? : AttributeDescriptorMap\r\n    defaults? : AttributeDescriptorMap\r\n}\r\n\r\nexport interface AttributeDescriptorMap {\r\n    [ name : string ] : AttributeDescriptor\r\n}\r\n\r\nexport interface AttributeDescriptor {\r\n    type? : Constructor< any >\r\n    value? : any\r\n\r\n    parse? : AttributeParse\r\n    toJSON? : AttributeToJSON\r\n   \r\n    getHooks? : GetHook[]\r\n    transforms? : Transform[]\r\n    changeHandlers? : ChangeHandler[]\r\n\r\n    _onChange? : ChangeAttrHandler\r\n}\r\n\r\nexport type GetHook = ( value : any, key : string ) => any;\r\n\r\nexport type ChangeAttrHandler = ( ( value : any, attr : string ) => void ) | string;\r\nexport type Transform = ( next : any, options : TransactionOptions, prev : any, record : Record ) => any;\r\nexport type ChangeHandler = ( next : any, prev : any, record : Record ) => void;\r\n\r\nexport type AttributeToJSON = ( value : any, key : string ) => any\r\nexport type AttributeParse = ( value : any, key : string ) => any\r\n\r\n/*************************************\r\n * Attribute definitions\r\n */\r\nexport interface AttributesValues {\r\n    [ key : string ] : any\r\n}\r\n\r\nexport type CloneAttributesCtor = new ( x : AttributesValues ) => AttributesValues\r\n\r\nexport interface AttributesSpec {\r\n    [ key : string ] : Attribute\r\n}\r\n\r\nexport interface Attribute extends AttributeUpdatePipeline, AttributeSerialization {\r\n    clone( value : any ) : any\r\n    create() : any\r\n    validate( record : Record, value : any, key : string )\r\n}\r\n\r\nexport interface AttributeUpdatePipeline{\r\n    canBeUpdated( prev : any, next : any ) : boolean\r\n    transform : Transform\r\n    isChanged( a : any, b : any ) : boolean\r\n    handleChange : ChangeHandler\r\n}\r\n\r\nexport interface AttributeSerialization {\r\n    toJSON : AttributeToJSON\r\n    parse : AttributeParse\r\n}\r\n\r\n/*******************************************************\r\n * Record core implementation\r\n */\r\n\r\ninterface ConstructorOptions extends TransactionOptions{\r\n    clone? : boolean\r\n}\r\n\r\n// Client unique id counter\r\nlet _cidCounter : number = 0;\r\n\r\n@define({\r\n    // Default client id prefix \r\n    cidPrefix : 'c',\r\n\r\n    // Default id attribute name\r\n    idAttribute : 'id'\r\n})\r\nexport class Record extends Transactional implements Owner {\r\n    // Implemented at the index.ts to avoid circular dependency. Here we have just proper singature.\r\n    static define( protoProps : RecordDefinition, staticProps ) : typeof Record { return this; }\r\n\r\n    /***********************************\r\n     * Core Members\r\n     */\r\n    // Previous attributes\r\n    _previousAttributes : {}\r\n\r\n    // Current attributes    \r\n    attributes : AttributesValues\r\n\r\n    // Lazily evaluated changed attributes hash\r\n    _changedAttributes : AttributesValues\r\n\r\n    get changed(){\r\n        let changed = this._changedAttributes;\r\n\r\n        if( !changed ){\r\n            const prev = this._previousAttributes;\r\n            changed = {};\r\n\r\n            this.forEachAttr( this.attributes, ( value, key, attribute ) => { \r\n                if( attribute.isChanged( value, prev[ key ] ) ){\r\n                    changed[ key ] = value;\r\n                }\r\n            } );\r\n\r\n            this._changedAttributes = changed;\r\n        }\r\n\r\n        return changed;    \r\n    } \r\n\r\n    // Returns Record owner skipping collections. TODO: Move out\r\n    getOwner() : Owner {\r\n        const owner : any = this._owner;\r\n\r\n        // If there are no key, owner must be transactional object, and it's the collection.\r\n        // We don't expect that collection can be the member of collection, so we're skipping just one level up. An optimization.\r\n        return this._ownerKey ? owner : owner && owner._owner;\r\n    }\r\n\r\n    /***********************************\r\n     * Identity managements\r\n     */\r\n\r\n    // Id attribute name ('id' by default)\r\n    idAttribute : string;\r\n\r\n    // Fixed 'id' property pointing to id attribute\r\n    get id() : string | number { return this.attributes[ this.idAttribute ]; }\r\n    set id( x : string | number ){ setAttribute( this, this.idAttribute, x ); }\r\n\r\n    /***********************************\r\n     * Dynamically compiled stuff\r\n     */\r\n\r\n    // Attributes specifications \r\n    _attributes : AttributesSpec\r\n    \r\n    // Attributes object copy constructor\r\n    Attributes : CloneAttributesCtor\r\n\r\n    // forEach function for traversing through attributes, with protective default implementation\r\n    // Overriden by dynamically compiled loop unrolled function in define.ts\r\n    forEachAttr( attrs : {}, iteratee : ( value : any, key? : string, spec? : Attribute ) => void ) : void {\r\n        const { _attributes } = this;\r\n\r\n        for( let name in attrs ){\r\n            const spec = _attributes[ name ];\r\n\r\n            if( spec ){\r\n                iteratee( attrs[ name ], name, spec );\r\n            }\r\n            else{\r\n                log.warn( '[Unknown Attribute]', this, 'Unknown record attribute \"' + name + '\" is ignored:', attrs );\r\n            }\r\n        }\r\n    }\r\n\r\n    each( iteratee : ( value? : any, key? : string ) => void, context? : any ){\r\n        const fun = arguments.length === 2 ? ( v, k ) => iteratee.call( context, v, k ) : iteratee,\r\n            { attributes } = this;\r\n\r\n        for( const key in attributes ){\r\n            const value = attributes[ key ];\r\n            if( value !== void 0 ) fun( value, key );\r\n        }\r\n    }\r\n\r\n    // Attributes-level serialization\r\n    _toJSON(){ return {}; }\r\n\r\n    // Attributes-level parse\r\n    _parse( data ){ return data; }\r\n\r\n    // Create record default values, optionally augmenting given values.\r\n    defaults( values? : {} ){ return {}; }\r\n\r\n    // Event map for change:attribute events. \r\n    _listenToSelf : EventHandlers\r\n\r\n    /***************************************************\r\n     * Record construction\r\n     */\r\n    // Create record, optionally setting an owner\r\n    constructor( a_values? : {}, a_options? : ConstructorOptions, owner? : Owner ){\r\n        super( _cidCounter++, owner );\r\n\r\n        const options = a_options || {},\r\n              values = ( options.parse ? this.parse( a_values ) :  a_values ) || {};\r\n\r\n        // TODO: type error for wrong object.\r\n\r\n        const attributes = options.clone ? cloneAttributes( this, values ) : this.defaults( values ); \r\n\r\n        this.forEachAttr( attributes, ( value : any, key : string, attr : AttributeUpdatePipeline ) => {\r\n            const next = attributes[ key ] = attr.transform( value, options, void 0, this );\r\n                  attr.handleChange( next, void 0, this );\r\n        });\r\n\r\n        this.attributes = this._previousAttributes = attributes;\r\n\r\n        this.initialize( a_values, a_options );\r\n\r\n        if( this._listenToSelf ) this.listenTo( this, this._listenToSelf );\r\n    }\r\n\r\n    // Initialization callback, to be overriden by the subclasses \r\n    initialize( values?, options? ){}\r\n\r\n    // Deeply clone record, optionally setting new owner.\r\n    clone( owner? : any ) : this {\r\n        return new (<any>this.constructor)( this.attributes, { clone : true }, owner );\r\n    }\r\n\r\n    // Validate attributes.\r\n    _validateNested( errors : ChildrenErrors ) : number {\r\n        var length    = 0;\r\n\r\n        this.forEachAttr( this.attributes, ( value, name, attribute ) => {\r\n            const error = attribute.validate( this, value, name );\r\n\r\n            if( error ){\r\n                errors[ name ] = error;\r\n                length++;\r\n            }\r\n        } );\r\n\r\n        return length;\r\n    }\r\n\r\n    // Get attribute by key\r\n    get( key : string ) : any {\r\n        return this[ key ];\r\n    }\r\n\r\n    /**\r\n     * Serialization control\r\n     */\r\n\r\n    // Default record-level serializer, to be overriden by subclasses \r\n    toJSON() : Object {\r\n        const json = {};\r\n\r\n        this.forEachAttr( this.attributes, ( value, key : string, { toJSON } : AttributeSerialization ) =>{\r\n            // If attribute serialization is not disabled, and its value is not undefined...\r\n            if( toJSON && value !== void 0 ){\r\n                // ...serialize it according with its spec.\r\n                json[ key ] = toJSON.call( this, value, key );\r\n            }\r\n        });\r\n\r\n        return json;\r\n    }\r\n    \r\n    // Default record-level parser, to be overriden by the subclasses.\r\n    parse( data ){\r\n        // Call dynamically compiled loop-unrolled attribute-level parse function.\r\n        return this._parse( data );\r\n    }\r\n\r\n    /**\r\n     * Transactional control\r\n     */\r\n    \r\n    // Create transaction. TODO: Move to transaction constructor\r\n    _createTransaction( a_values : {}, options : TransactionOptions = {} ) : Transaction {\r\n        const isRoot = begin( this ),\r\n              changes : string[] = [],\r\n              nested : RecordTransaction[]= [],\r\n              { attributes } = this,\r\n              values = options.parse ? this.parse( a_values ) : a_values,\r\n              merge = !options.reset;\r\n\r\n        if( Object.getPrototypeOf( values ) === Object.prototype ){\r\n            this.forEachAttr( values, ( value, key : string, attr : AttributeUpdatePipeline ) => {\r\n                const prev = attributes[ key ];\r\n\r\n                // handle deep update...\r\n                if( merge && attr.canBeUpdated( prev, value ) ) { // todo - skip empty updates.\r\n                    const nestedTransaction = prev.createTransaction( value, options );\r\n                    if( nestedTransaction ){\r\n                        nested.push( nestedTransaction );\r\n                        changes.push( key );\r\n                    }\r\n\r\n                    return;\r\n                }\r\n\r\n                // cast and hook...\r\n                const next = attr.transform( value, options, prev, this );\r\n\r\n                if( attr.isChanged( next, prev ) ) {\r\n                    attributes[ key ] = next;\r\n                    changes.push( key );\r\n\r\n                    // Do the rest of the job after assignment\r\n                    attr.handleChange( next, prev, this );\r\n                }\r\n            } );\r\n        }\r\n        else{\r\n            log.error( '[Type Error]', this, 'Record update rejected (', values, '). Incompatible type.' );\r\n        }\r\n\r\n        if( nested.length || changes.length ){\r\n            return new RecordTransaction( this, isRoot, nested, changes );\r\n        }\r\n        \r\n        // No changes\r\n        isRoot && commit( this, options );\r\n    }\r\n\r\n    // Handle nested changes\r\n    _onChildrenChange( child : Transactional, options : TransactionOptions ) : void {        \r\n        this.forceAttributeChange( child._ownerKey, options );\r\n    }\r\n\r\n    // Simulate attribute change \r\n    forceAttributeChange( key : string, options : TransactionOptions = {} ){\r\n        // Touch an attribute in bounds of transaction\r\n        const isRoot = begin( this );\r\n\r\n        if( !options.silent ){\r\n            markAsDirty( this );\r\n            trigger3( this, 'change:' + key, this.attributes[ key ], this, options );\r\n        }\r\n\r\n        isRoot && commit( this, options );\r\n    }\r\n\r\n    // Dispose object and all childrens\r\n    dispose(){\r\n        this.forEachAttr( this.attributes, ( value, key ) => {\r\n            if( value && this === value._owner ){\r\n                value.dispose();\r\n            }\r\n        });\r\n\r\n        super.dispose();\r\n    }\r\n};\r\n\r\n/***********************************************\r\n * Helper functions\r\n */\r\n\r\nfunction begin( record : Record ){\r\n    if( _begin( record ) ){\r\n        record._previousAttributes = new record.Attributes( record.attributes );\r\n        return true;\r\n    }\r\n    \r\n    return false;\r\n}\r\n\r\nfunction markAsDirty( record ){\r\n    _markAsDirty( record );\r\n    record._changedAttributes = null;\r\n}\r\n\r\n// Deeply clone record attributes\r\nfunction cloneAttributes( record : Record, a_attributes : AttributesValues ) : AttributesValues {\r\n    const attributes = new record.Attributes( a_attributes );\r\n\r\n    record.forEachAttr( attributes, function( value, name, attr : Attribute ){\r\n        attributes[ name ] = attr.clone( value ); //TODO: Add owner?\r\n    } );\r\n\r\n    return attributes;\r\n}\r\n\r\n // Optimized single attribute transactional update. To be called from attributes setters\r\n // options.silent === false, parse === false. \r\nexport function setAttribute( record : Record, name : string, value : any ) : void {\r\n    const isRoot  = begin( record ),\r\n          options = {},\r\n        { attributes } = record,\r\n          spec = record._attributes[ name ],\r\n          prev = attributes[ name ];\r\n\r\n    // handle deep update...\r\n    if( spec.canBeUpdated( prev, value ) ) {\r\n        const nestedTransaction = ( <Transactional> prev )._createTransaction( value, options );\r\n        if( nestedTransaction ){\r\n            nestedTransaction.commit( options, true );\r\n            markAsDirty( record );\r\n            trigger3( record, 'change:' + name, prev, record, options );\r\n        }\r\n    }\r\n    else {\r\n        // cast and hook...\r\n        const next = spec.transform( value, options, prev, record );\r\n\r\n        if( spec.isChanged( next, prev ) ) {\r\n            attributes[ name ] = next;\r\n\r\n            // Do the rest of the job after assignment\r\n            spec.handleChange( next, prev, this );\r\n\r\n            markAsDirty( record );\r\n            trigger3( record, 'change:' + name, next, record, options );\r\n\r\n        }\r\n    }\r\n\r\n    isRoot && commit( record, options );\r\n}\r\n\r\n// Transaction class. Implements two-phase transactions on object's tree. \r\nclass RecordTransaction implements Transaction {\r\n    // open transaction\r\n    constructor( public object : Record, public isRoot : boolean, public nested : Transaction[], public changes : string[] ){\r\n        markAsDirty( object );\r\n    }\r\n\r\n    // commit transaction\r\n    commit( options : TransactionOptions = {}, isNested? : boolean ) : void {\r\n        const { nested, object, changes } = this;\r\n\r\n        // Commit all pending nested transactions...\r\n        for( let transaction of nested ){ \r\n            transaction.commit( options, true );\r\n        }\r\n\r\n        // Notify listeners on attribute changes...\r\n        if( !options.silent ){\r\n            const { attributes } = object;\r\n            for( let key of changes ){\r\n                trigger3( object, 'change:' + key, attributes[ key ], object, options );\r\n            }\r\n        }\r\n\r\n        this.isRoot && commit( object, options, isNested ); // Do not tell parent to update.\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/record/transaction.ts\n **/","export * from './tools.ts'\r\nexport * from './mixins.ts'\r\nexport * from './events.ts'\n\n\n/** WEBPACK FOOTER **\n ** ./src/objectplus/index.ts\n **/","/**\r\n * Mixins and @define metaprogramming class extensions\r\n * \r\n * Vlad Balin & Volicon, (c) 2016\r\n */\r\nimport { log, assign, omit, getPropertyDescriptor, getBaseClass, defaults, transform } from './tools.ts'\r\n\r\ntype MergeRule = 'merge' | 'pipe' | 'sequence' | 'reverse' | 'every' | 'some'\r\n\r\ninterface IMixinRules {\r\n    [ propertyName : string ] : MergeRule | IMixinRules\r\n}\r\n\r\ninterface PropertyMap {\r\n    [ name : string ] : Property\r\n}\r\n\r\ntype Property = PropertyDescriptor | ( () => any )\r\n\r\nexport interface ClassDefinition {\r\n    properties? : PropertyMap\r\n    mixins? : Array< Object >\r\n    mixinRules? : IMixinRules\r\n    [ name : string ] : any\r\n}\r\n\r\ndeclare function __extends( a, b )\r\n\r\nexport interface Constructor< T >{\r\n    new ( ...args : any[] ) : T\r\n}\r\n\r\nexport interface ExtendableConstructor< T > extends Constructor< T >{\r\n    prototype : Class\r\n    create( a : any, b? : any, c? : any ) : Class\r\n    mixins( ...mixins : ( Constructor<any> | {} )[] ) : ExtendableConstructor< T >\r\n    mixinRules( mixinRules : IMixinRules ) : ExtendableConstructor< T >\r\n    mixTo( ...args : Constructor<any>[] ) : ExtendableConstructor< T >\r\n    define( definition : ClassDefinition, staticProps? : {} ) : ExtendableConstructor< T >\r\n    extend(spec? : ClassDefinition, statics? : {} ) : ExtendableConstructor< T >\r\n    predefine() : ExtendableConstructor< T >\r\n}\r\n\r\ntype ClassConstructor = ExtendableConstructor< Class >\r\n\r\n// Base class, holding metaprogramming class extensions\r\n// Supports mixins, and Class.define metaprogramming method.\r\nexport class Class {\r\n\r\n    // Generic class factory. May be overridden for abstract classes. Not inherited.\r\n    static create( a : any, b? : any, c? : any ) : Class {\r\n        return new (<any>this)( a, b, c );\r\n    }\r\n\r\n    protected static _mixinRules : IMixinRules = { properties : 'merge' };\r\n\r\n    /**\r\n     * Attach mixins to class prototype.\r\n     */\r\n    static mixins( ...mixins : ( Function | {} )[] ) : typeof Class {\r\n        const proto      = this.prototype,\r\n              mergeRules : IMixinRules = this._mixinRules || {};\r\n\r\n        for( var i = mixins.length - 1; i >= 0; i-- ) {\r\n            const mixin = mixins[ i ];\r\n            if( mixin instanceof Array ) {\r\n                Class.mixins.apply( this, mixin );\r\n            }\r\n            else if( typeof mixin === 'function' ){\r\n                defaults( this, mixin );\r\n                mergeProps( proto, (<Function>mixin).prototype, mergeRules );\r\n            }\r\n            else {\r\n                mergeProps( proto, mixin, mergeRules );\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    // Inversion of control version of Class.mixin.\r\n    static mixTo< T >( ...args : Function[] ) : typeof Class {\r\n        for( let Ctor of args ) {\r\n            Class.mixins.call( Ctor, this );\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    // Members merging policy is controlled by MyClass.mixinRules property.\r\n    // mixinRules are properly inherited and merged.\r\n    static mixinRules( mixinRules : IMixinRules ) : ExtendableConstructor< Class > {\r\n        const Base = Object.getPrototypeOf( this.prototype ).constructor;\r\n\r\n        if( Base._mixinRules ) {\r\n            mergeProps( mixinRules, Base._mixinRules );\r\n        }\r\n\r\n        this._mixinRules = mixinRules;\r\n        return this;\r\n    }\r\n\r\n    // Autobinding helper to be used from constructors\r\n    bindAll( ...names : string [] ) : void\r\n    bindAll() {\r\n        for( var i = 0; i < arguments.length; i++ ) {\r\n            const name = arguments[ i ];\r\n\r\n            this[ name ] = this[ name ].bind( this );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Main metaprogramming method. May be overriden in subclasses to customize the behavior.   \r\n     * - Merge definition to the prototype.\r\n     * - Add native properties with descriptors from spec.properties to the prototype.\r\n     * - Prevents inheritance of 'create' factory method.\r\n     * - Assign mixinRules static property, and merge it with parent.\r\n     * - Adds mixins.\r\n     */\r\n    static define( definition : ClassDefinition = {}, staticProps? : {} ) : typeof Class {\r\n        // That actually might happen when we're using @define decorator... \r\n        if( !this.define ){\r\n            log.error( \"[Class.define] Class must have class extensions to use @define decorator. Use '@extendable' before @define, or extend the base class with class extensions.\", definition );\r\n            return this;\r\n        }\r\n\r\n        // Obtain references to prototype and base class.\r\n        const proto = this.prototype;\r\n\r\n        // Extract prototype properties from the definition.\r\n        const protoProps = omit( definition, 'properties', 'mixins', 'mixinRules' ),\r\n            { properties = <PropertyMap> {}, mixins, mixinRules } = definition;\r\n\r\n        // Update prototype and statics.\r\n        assign( proto, protoProps );\r\n        assign( this, staticProps );\r\n\r\n        // Define native properties.\r\n        properties && Object.defineProperties( proto, transform( {}, properties, toPropertyDescriptor ) );\r\n\r\n        // Apply mixins and mixin rules.\r\n        mixinRules && this.mixinRules( mixinRules );\r\n        mixins && this.mixins( mixins );\r\n\r\n        return this;\r\n    }\r\n\r\n    // Backbone-compatible extend method to be used in ES5 and for backward compatibility\r\n    static extend(spec? : ClassDefinition, statics? : {} ) : typeof Class {\r\n        let Subclass : typeof Class;\r\n\r\n        // 1. Create the subclass (ES5 compatibility shim).\r\n        // If constructor function is given...\r\n        if( spec && spec.hasOwnProperty( 'constructor' ) ){\r\n            // ...we need to manually call internal TypeScript __extend function. Hack! Hack!\r\n            Subclass = <any>spec.constructor; \r\n            __extends( Subclass, this );\r\n        }\r\n        // Otherwise, create the subclall in usual way.\r\n        else{\r\n            Subclass = class Subclass extends this {};\r\n        }\r\n\r\n        // 2. Apply definitions\r\n        return Subclass.define( spec, statics );\r\n    }\r\n\r\n    // Do the magic necessary for forward declarations.\r\n    // Must be written in the way that it's safe to call twice.\r\n    static predefine() : typeof Class {\r\n        const BaseClass : typeof Class = getBaseClass( this );\r\n\r\n        // Make sure we don't inherit class factories.\r\n        if( BaseClass.create === this.create ) {\r\n            this.create = Class.create;\r\n        }\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\nfunction toPropertyDescriptor( x : Property ) : PropertyDescriptor {\r\n    return typeof x === 'function' ? { get : < () => any >x } : <PropertyDescriptor> x;\r\n}\r\n\r\n// @mixinRules({ ... }) decorator\r\nexport function mixinRules( rules : IMixinRules ) {\r\n    return createDecorator( 'mixinRules', rules );\r\n}\r\n\r\n// @mixins( A, B, C ) decorator\r\nexport function mixins( ...list : {}[] ) {\r\n    return createDecorator( 'mixins', list );\r\n}\r\n\r\n// @extendable decorator. Convert class to be an ExtendableConstructor.\r\nexport function extendable( Type : Function ) : void {\r\n    Class.mixTo( Type );\r\n}\r\n\r\n// @predefine decorator for forward definitions. \r\nexport function predefine( Constructor : ExtendableConstructor< any > ) : void {\r\n    Constructor.predefine();\r\n}\r\n\r\n// @define decorator for metaprogramming magic.\r\nexport function define( spec : ClassDefinition ){\r\n    return createDecorator( 'define', spec );\r\n} \r\n\r\n// Create ES7 class decorator forwarding call to the static class member.\r\n// If there is no such a member, forward the call to Class.\r\nfunction createDecorator( name : string, spec : {} ){\r\n    return function( Ctor : Function ) : void {\r\n        if( Ctor[ name ] ) {\r\n            Ctor[ name ]( spec );\r\n        }\r\n        else {\r\n            Class[ name ].call( Ctor, spec );\r\n        }\r\n    }\r\n}\r\n\r\n/***********************\r\n * Mixins helpers\r\n */\r\nfunction mergeObjects( a : {}, b : {}, rules? : IMixinRules ) : {} {\r\n    const x = assign( {}, a );\r\n    return mergeProps( x , b, rules );\r\n}\r\n\r\ninterface IMergeFunctions {\r\n    [ name : string ] : ( a : Function, b : Function ) => Function\r\n}\r\n\r\nconst mergeFunctions : IMergeFunctions = {\r\n    pipe< A, B, C >( a: ( x : B ) => C, b : ( x : A ) => B ) : ( x : A ) => C {\r\n        return function( x : A ) : C {\r\n            return a.call( this, b.call( this, x ) );\r\n        }\r\n    },\r\n\r\n    sequence( a : Function, b : Function ){\r\n        return function() : void {\r\n            a.apply( this, arguments );\r\n            b.apply( this, arguments );\r\n        }\r\n    },\r\n\r\n    reverse( a : Function, b : Function ){\r\n        return function() : void {\r\n            b.apply( this, arguments );\r\n            a.apply( this, arguments );\r\n        }\r\n    },\r\n\r\n    every( a : Function, b : Function ){\r\n        return function() {\r\n            return a.apply( this, arguments ) && b.apply( this, arguments );\r\n        }\r\n    },\r\n\r\n    some( a : Function, b : Function ){\r\n        return function() {\r\n            return a.apply( this, arguments ) || b.apply( this, arguments );\r\n        }\r\n    }\r\n};\r\n\r\nfunction mergeProps< T extends {} >( target : T, source : {}, rules : IMixinRules = {}) : T {\r\n    for( let name of Object.keys( source ) ) {\r\n        const sourceProp = Object.getOwnPropertyDescriptor( source, name ),\r\n              destProp   = getPropertyDescriptor( target, name ); // Shouldn't be own\r\n\r\n        if( destProp ) {\r\n            const rule  = rules[ name ],\r\n                  value = destProp.value;\r\n\r\n            if( rule && value ) {\r\n                target[ name ] = typeof rule === 'object' ?\r\n                    mergeObjects( value, sourceProp.value, rule ) :(\r\n                        rule === 'merge' ?\r\n                            mergeObjects( value, sourceProp.value ) :\r\n                            mergeFunctions[ rule ]( value, sourceProp.value )\r\n                    );\r\n            }\r\n        }\r\n        else {\r\n            Object.defineProperty( target, name, sourceProp );\r\n        }\r\n    }\r\n\r\n    return target;\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/objectplus/mixins.ts\n **/","import { once } from './tools.ts'\r\nimport { Class, mixins, define, extendable } from './mixins.ts'\r\n\r\n/************\r\n * JIT-Optimized monomorphic functions to trigger single event \r\n */\r\nexport function trigger0( self : Messenger, name : string ) : void {\r\n    const { _events } = self;\r\n    if( _events ){\r\n        const { all } = _events;\r\n        _fireEvent0( _events[ name ] );\r\n        _fireEvent1( all, name );\r\n    }\r\n};\r\n\r\nexport function trigger1( self : Messenger, name : string, a : any ) : void {\r\n    const { _events } = self;\r\n    if( _events ){\r\n        const { all } = _events;\r\n        _fireEvent1( _events[ name ], a );\r\n        _fireEvent2( all, name, a );\r\n    }\r\n};\r\n\r\nexport function trigger2( self : Messenger, name : string, a, b ) : void {\r\n    const { _events } = self;\r\n    if( _events ){\r\n        const { all } = _events;\r\n        _fireEvent2( _events[ name ], a, b );\r\n        _fireEvent3( all, name, a, b );\r\n    }\r\n};\r\n\r\nexport function trigger3( self : Messenger, name : string, a, b, c ) : void{\r\n    const { _events } = self;\r\n    if( _events ){\r\n        const { all } = _events;\r\n        _fireEvent3( _events[ name ], a, b, c );\r\n        _fireEvent4( all, name, a, b, c );\r\n    }\r\n};\r\n\r\n// Backbone.Events\r\n// ---------------\r\n\r\n// A module that can be mixed in to *any object* in order to provide it with\r\n// a custom event channel. You may bind a callback to an event with `on` or\r\n// remove with `off`; `trigger`-ing an event fires all callbacks in\r\n// succession.\r\n//\r\n//     var object = {};\r\n//     _.extend(object, Backbone.Events);\r\n//     object.on('expand', function(){ alert('expanded'); });\r\n//     object.trigger('expand');\r\n//\r\n\r\n// Regular expression used to split event strings.\r\nvar eventSplitter = /\\s+/;\r\n\r\n// Iterates over the standard `event, callback` (as well as the fancy multiple\r\n// space-separated events `\"change blur\", callback` and jQuery-style event\r\n// maps `{event: callback}`).\r\nvar eventsApi = function(iteratee, events, name, callback, opts) {\r\n    var i = 0, names;\r\n    if (name && typeof name === 'object') {\r\n        // Handle event maps.\r\n        if (callback !== void 0 && 'context' in opts && opts.context === void 0) opts.context = callback;\r\n        for (names = keys(name); i < names.length ; i++) {\r\n            events = eventsApi(iteratee, events, names[i], name[names[i]], opts);\r\n        }\r\n    } else if (name && eventSplitter.test(name)) {\r\n        // Handle space separated event names by delegating them individually.\r\n        for (names = name.split(eventSplitter); i < names.length; i++) {\r\n            events = iteratee(events, names[i], callback, opts);\r\n        }\r\n    } else {\r\n        // Finally, standard events.\r\n        events = iteratee(events, name, callback, opts);\r\n    }\r\n    return events;\r\n};\r\n\r\nfunction isEmpty( obj : {} ) : boolean {\r\n    for( var i in obj ){\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nlet _idCount = 0;\r\nfunction uniqueId(){\r\n    return 'l' + _idCount++;\r\n}\r\n\r\nclass ListeningTo {\r\n    count : number = 0\r\n    constructor( public obj, public objId, public id, public listeningTo ){}\r\n}\r\n\r\ninterface ListeningToMap {\r\n    [ id : string ] : ListeningTo\r\n}\r\n\r\ninterface Listeners {\r\n    [ id : string ] : Messenger\r\n}\r\n\r\nexport interface EventHandlers {\r\n    [ events : string ] : Function | string\r\n}\r\n\r\n/*************************\r\n * Messenger is extendable class with capabilities of sending and receiving messages.\r\n * This class itself can serve as both mixin and base class\r\n */\r\n\r\n// Attach default cid prefix to the prototype.\r\n@define({\r\n    cidPrefix : 'l'\r\n})\r\n@extendable\r\nexport abstract class Messenger implements Class {\r\n    bindAll : ( ...names : string [] ) => void\r\n\r\n    _events : EventsMap = void 0;\r\n    _listeners : Listeners = void 0;\r\n    _listeningTo : ListeningToMap = void 0;\r\n    cidPrefix : string\r\n    cid : string\r\n\r\n    static create : ( a : any, b? : any, c? : any ) => Messenger\r\n\r\n    constructor( cid : string | number ){\r\n        this.cid = this.cidPrefix + cid;\r\n    }\r\n\r\n    // Bind an event to a `callback` function. Passing `\"all\"` will bind\r\n    // the callback to all events fired.\r\n    on(name, callback, context) {\r\n        return internalOn(this, name, callback, context);\r\n    }\r\n    // Remove one or many callbacks. If `context` is null, removes all\r\n    // callbacks with that function. If `callback` is null, removes all\r\n    // callbacks for the event. If `name` is null, removes all bound\r\n    // callbacks for all events.\r\n    off(name? : string, callback? : Function, context? ) {\r\n        if (!this._events) return this;\r\n        this._events = eventsApi(offApi, this._events, name, callback,\r\n                                new OffOptions(\r\n                                    context,\r\n                                    this._listeners )\r\n                                );\r\n        return this;\r\n    }\r\n\r\n    // Tell this object to stop listening to either specific events ... or\r\n    // to every object it's currently listening to.\r\n    stopListening( obj? : Messenger, name? : string, callback? : Function ) {\r\n        var listeningTo = this._listeningTo;\r\n        if (!listeningTo) return this;\r\n\r\n        var ids = obj ? [obj.cid] : keys(listeningTo);\r\n\r\n        for (var i = 0; i < ids.length; i++) {\r\n            var listening = listeningTo[ids[i]];\r\n\r\n            // If listening doesn't exist, this object is not currently\r\n            // listening to obj. Break out early.\r\n            if (!listening) break;\r\n\r\n            listening.obj.off(name, callback, this);\r\n        }\r\n        if (isEmpty(listeningTo)) this._listeningTo = void 0;\r\n\r\n        return this;\r\n    }\r\n\r\n    // Inversion-of-control versions of `on`. Tell *this* object to listen to\r\n    // an event in another object... keeping track of what it's listening to\r\n    // for easier unbinding later.\r\n    listenTo(obj : Messenger, name, callback? ) {\r\n        if (!obj) return this;\r\n        var id = obj.cid || (obj.cid = uniqueId());\r\n        var listeningTo = this._listeningTo || (this._listeningTo = {});\r\n        var listening = listeningTo[id];\r\n\r\n        // This object is not listening to any other events on `obj` yet.\r\n        // Setup the necessary references to track the listening callbacks.\r\n        if (!listening) {\r\n            var thisId = this.cid || (this.cid = uniqueId());\r\n            listening = listeningTo[id] = new ListeningTo( obj, id, thisId, listeningTo );\r\n        }\r\n\r\n        // Bind callbacks on obj, and keep track of them on listening.\r\n        internalOn(obj, name, callback, this, listening);\r\n        return this;\r\n    }\r\n\r\n    // Bind an event to only be triggered a single time. After the first time\r\n    // the callback is invoked, its listener will be removed. If multiple events\r\n    // are passed in using the space-separated syntax, the handler will fire\r\n    // once for each event, not once for a combination of all events.\r\n    once(name, callback, context) {\r\n        // Map the event into a `{event: once}` object.\r\n        var events = eventsApi(onceMap, {}, name, callback, this.off.bind( this ));\r\n        return this.on(events, void 0, context);\r\n    }\r\n\r\n    // Inversion-of-control versions of `once`.\r\n    listenToOnce(obj : Messenger, name, callback) {\r\n        // Map the event into a `{event: once}` object.\r\n        var events = eventsApi(onceMap, {}, name, callback, this.stopListening.bind( this, obj ) );\r\n        return this.listenTo(obj, events);\r\n    }\r\n\r\n    // Trigger one or many events, firing all bound callbacks. Callbacks are\r\n    // passed the same arguments as `trigger` is, apart from the event name\r\n    // (unless you're listening on `\"all\"`, which will cause your callback to\r\n    // receive the true name of the event as the first argument).\r\n    trigger(name : string, a?, b?, c? ) : this {\r\n        switch( arguments.length ){\r\n            // Forward call to monomorphic fast-path functions.\r\n            case 1 : trigger0( this, name ); break;\r\n            case 2 : trigger1( this, name, a ); break;\r\n            case 3 : trigger2( this, name, a, b ); break;\r\n            case 4 : trigger3( this, name, a, b, c ); break;\r\n            \r\n            // Trigger event with more than 3 arguments.\r\n            default :\r\n                // Passing arguments around killing performance. Convert it to array.\r\n                const allArgs = Array( arguments.length );\r\n                \r\n                for( let i = 0; i < allArgs.length; i++ ){\r\n                    allArgs[ i ] = arguments[ i ];\r\n                }\r\n\r\n                // Send events.\r\n                const { _events } = this;\r\n\r\n                if( _events ){\r\n                    _fireEventAll( _events[ name ], allArgs.splice( 0, 1 ) );\r\n                    _fireEventAll( _events.all, allArgs );\r\n                }                      \r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    dispose() : void {\r\n        this.stopListening();\r\n        this.off();\r\n    }\r\n}\r\n\r\nconst slice = Array.prototype.slice;\r\n\r\nexport const Events = Messenger.prototype;\r\n\r\n// Guard the `listening` argument from the public API.\r\nvar internalOn = function(obj : Messenger, name, callback, context, listening? ) : Messenger {\r\n    obj._events = eventsApi(onApi, obj._events || {}, name,\r\n                            callback, new Handler( context, obj, listening));\r\n\r\n    if (listening) {\r\n        var listeners = obj._listeners || (obj._listeners = {});\r\n        listeners[listening.id] = listening;\r\n    }\r\n\r\n    return obj;\r\n};\r\n\r\ninterface Callback extends Function{\r\n    _callback? : any\r\n}\r\n\r\nclass Handler {\r\n    constructor( public context, public ctx, public listening : ListeningTo, public callback? : Callback ){\r\n    }\r\n\r\n    clone( callback ){\r\n        const { context, listening } = this;\r\n        if (listening) listening.count++;\r\n        return new Handler( context, context || this.ctx, listening, callback );\r\n    }\r\n}\r\n\r\ninterface EventsMap {\r\n    all? : Handler[]\r\n    [ name : string ] : Handler[]\r\n}\r\n\r\n// The reducing API that adds a callback to the `events` object.\r\nvar onApi = function(events : EventsMap, name : string, callback : Function, options) : EventsMap {\r\n    if (callback) {\r\n        var handlers = events[name],\r\n            toAdd = [ options.clone( callback ) ];\r\n            \r\n        events[name] = handlers ? handlers.concat( toAdd ) : toAdd;\r\n    }\r\n    \r\n    return events;\r\n};\r\n\r\nclass OffOptions {\r\n    constructor( public context, public listeners : Listeners ){}\r\n}\r\n\r\nfunction keys( o : any ) : string[]{\r\n    return o ? Object.keys( o ) : [];\r\n}\r\n\r\n// The reducing API that removes a callback from the `events` object.\r\nvar offApi = function(events : EventsMap, name, callback, options : OffOptions ) {\r\n    if (!events) return;\r\n\r\n    var i = 0, listening;\r\n    var context = options.context, listeners = options.listeners;\r\n\r\n    // Delete all events listeners and \"drop\" events.\r\n    if (!name && !callback && !context) {\r\n        var ids = keys(listeners);\r\n        for (; i < ids.length; i++) {\r\n            listening = listeners[ids[i]];\r\n            delete listeners[listening.id];\r\n            delete listening.listeningTo[listening.objId];\r\n        }\r\n        return;\r\n    }\r\n\r\n    var names = name ? [name] : keys(events);\r\n    for (; i < names.length; i++) {\r\n        name = names[i];\r\n        var handlers = events[name];\r\n\r\n        // Bail out if there are no events stored.\r\n        if (!handlers) break;\r\n\r\n        // Replace events if there are any remaining.  Otherwise, clean up.\r\n        var remaining = [];\r\n        for (var j = 0; j < handlers.length; j++) {\r\n            var handler = handlers[j];\r\n            if (\r\n                callback && callback !== handler.callback &&\r\n                callback !== handler.callback._callback ||\r\n                context && context !== handler.context\r\n            ) {\r\n                remaining.push(handler);\r\n            } else {\r\n                listening = handler.listening;\r\n                if (listening && --listening.count === 0) {\r\n                    delete listeners[listening.id];\r\n                    delete listening.listeningTo[listening.objId];\r\n                }\r\n            }\r\n        }\r\n\r\n        // Update tail event if the list has any events.  Otherwise, clean up.\r\n        if (remaining.length) {\r\n            events[name] = remaining;\r\n        } else {\r\n            delete events[name];\r\n        }\r\n    }\r\n    if (!isEmpty(events)) return events;\r\n};\r\n\r\n\r\ninterface Once extends Function {\r\n    _callback? : Function\r\n}\r\n\r\n// Reduces the event callbacks into a map of `{event: onceWrapper}`.\r\n// `offer` unbinds the `onceWrapper` after it has been called.\r\nvar onceMap = function(map, name, callback, offer) {\r\n    if (callback) {\r\n        var _once : Once = map[name] = once(function() {\r\n            offer(name, _once);\r\n            callback.apply(this, arguments);\r\n        });\r\n        _once._callback = callback;\r\n    }\r\n    return map;\r\n};\r\n\r\n// Specialized functions with events triggering loops.\r\n// JS JIT loves these small functions and code duplication.\r\nfunction _fireEvent0( events : Handler[] ) : void {\r\n    if( events )\r\n        for( let ev of events )\r\n            ev.callback.call( ev.ctx );\r\n}\r\n\r\nfunction _fireEvent1( events : Handler[], a ) : void {\r\n    if( events )\r\n        for( let ev of events )\r\n            ev.callback.call( ev.ctx, a );\r\n}\r\n\r\nfunction _fireEvent2( events : Handler[], a, b ) : void {\r\n    if( events )\r\n        for( let ev of events )\r\n            ev.callback.call( ev.ctx, a, b );\r\n}\r\n\r\nfunction _fireEvent3( events : Handler[], a, b, c ) : void {\r\n    if( events )\r\n        for( let ev of events )\r\n            ev.callback.call( ev.ctx, a, b, c );\r\n}\r\n\r\nfunction _fireEvent4( events : Handler[], a, b, c, d ) : void {\r\n    if( events )\r\n        for( let ev of events )\r\n            ev.callback.call( ev.ctx, a, b, c, d );\r\n}\r\n\r\nfunction _fireEventAll( events : Handler[], args : any[] ) : void {\r\n    if( events )\r\n        for( let ev of events )\r\n            ev.callback.apply( ev.ctx, args );\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/objectplus/events.ts\n **/","import { Messenger, trigger2, trigger3, assign, define, Constructor, ExtendableConstructor } from './objectplus/index.ts'\r\nimport { ValidationError, Validatable, ChildrenErrors } from './validation.ts'\r\nimport { Traversable, resolveReference } from './references.ts'\r\n/***\r\n * Abstract class implementing ownership tree, tho-phase transactions, and validation. \r\n * 1. createTransaction() - apply changes to an object tree, and if there are some events to send, transaction object is created.\r\n * 2. transaction.commit() - send and process all change events, and close transaction.\r\n */\r\n\r\nexport type TransactionalConstructor = ExtendableConstructor< Transactional >;\r\n\r\n// Transactional object interface\r\n@define({\r\n    _changeEventName : 'change'\r\n})\r\nexport abstract class Transactional extends Messenger implements Validatable, Traversable {\r\n    // Unique version token replaced on change\r\n    _changeToken : {} = {}\r\n\r\n    // true while inside of the transaction\r\n    _transaction : boolean = false;\r\n\r\n    // true, when in the middle of transaction and there're changes but is an unsent change event\r\n    _isDirty  : boolean = false;\r\n\r\n    // Backreference set by owner (Record, Collection, or other object)\r\n    _owner : Owner\r\n\r\n    // Key supplied by owner. Used by record to identify attribute key.\r\n    // Only collections doesn't set the key, which is used to distinguish collections.  \r\n    _ownerKey : string\r\n\r\n    // Name of the change event\r\n    _changeEventName : string\r\n\r\n    constructor( cid : string | number, owner? : Owner, ownerKey? : string ){\r\n        super( cid );\r\n        this._owner = owner;\r\n        this._ownerKey = ownerKey;\r\n    }\r\n\r\n    // Deeply clone ownership subtree, optionally setting the new owner\r\n    // (TODO: Do we really need it? Record must ignore events with empty keys)\r\n    // 'Pin store' shall assign this._defaultStore = this.getStore();\r\n    abstract clone( options? : { owner? : Owner, key? : string, pinStore? : boolean }) : this\r\n    \r\n    // Execute given function in the scope of ad-hoc transaction.\r\n    transaction( fun : ( self : this ) => void, options? : TransactionOptions ) : void{\r\n        const isRoot = begin( this );\r\n        fun( this );\r\n        isRoot && commit( this, options );\r\n    }\r\n\r\n    // Loop through the members in the scope of transaction.\r\n    // Transactional version of each()\r\n    updateEach( iteratee : ( val : any, key : string ) => void, options? : TransactionOptions ){\r\n        const isRoot = begin( this );\r\n        this.each( iteratee );\r\n        isRoot && commit( this, options );\r\n    }\r\n\r\n    // Apply bulk in-place object update in scope of ad-hoc transaction \r\n    set( values : any, options? : TransactionOptions ) : this {\r\n        if( values ){ \r\n            const transaction = this._createTransaction( values, options );\r\n            transaction && transaction.commit( options, true );\r\n        } \r\n\r\n        return this;\r\n    }\r\n\r\n    // Apply bulk object update without any notifications, and return open transaction.\r\n    // Used internally to implement two-phase commit.\r\n    // Returns null if there are no any changes.  \r\n    abstract _createTransaction( values : any, options? : TransactionOptions ) : Transaction\r\n    \r\n    // Parse function applied when 'parse' option is set for transaction.\r\n    parse( data : any ) : any { return data }\r\n\r\n    // Convert object to the serializable JSON structure\r\n    abstract toJSON() : {}\r\n\r\n    /*******************\r\n     * Traversals and member access\r\n     */\r\n    \r\n    // Get object member by its key.\r\n    abstract get( key : string ) : any\r\n\r\n    // Get object member by symbolic reference.\r\n    deepGet( reference : string ) : any {\r\n        return resolveReference( this, reference, ( object, key ) => object.get( key ) );\r\n    }\r\n\r\n    //_isCollection : boolean\r\n\r\n    // Return owner skipping collections.\r\n    getOwner() : Owner {\r\n        return this._owner;\r\n    }\r\n\r\n    // Store used when owner chain store lookup failed. Static value in the prototype. \r\n    _defaultStore : Transactional\r\n\r\n    // Locate the closest store. Store object stops traversal by overriding this method. \r\n    getStore() : Transactional {\r\n        const { _owner } = this;\r\n        return _owner ? <Transactional> _owner.getStore() : this._defaultStore;\r\n    }\r\n\r\n\r\n    /***************************************************\r\n     * Iteration API\r\n     */\r\n\r\n    // Loop through the members. Must be efficiently implemented in container class.\r\n    abstract each( iteratee : ( val : any, key : string | number ) => void, context? : any )\r\n\r\n    // Map members to an array\r\n    map<T>( iteratee : ( val : any, key : string ) => T, context? : any ) : T[]{\r\n        const arr : T[] = [],\r\n              fun = arguments.length === 2 ? ( v, k ) => iteratee.call( context, v, k ) : iteratee;\r\n        \r\n        this.each( ( val, key ) => {\r\n            const result = fun( val, key );\r\n            if( result !== void 0 ) arr.push( result );\r\n        } );\r\n\r\n        return arr;\r\n    }\r\n\r\n    // Map members to an object\r\n    mapObject<T>( iteratee : ( val : any, key : string | number ) => T, context? : any ) : { [ key : string ] : T }{\r\n        const obj : { [ key : string ] : T } = {},\r\n            fun = arguments.length === 2 ? ( v, k ) => iteratee.call( context, v, k ) : iteratee;\r\n        \r\n        this.each( ( val, key ) => {\r\n            const result = iteratee( val, key );\r\n            if( result !== void 0 ) obj[ key ] = result;\r\n        } );\r\n\r\n        return obj;\r\n    }\r\n\r\n    // Get array of attribute keys (Record) or record ids (Collection) \r\n    keys() : string[] {\r\n        return this.map( ( value, key ) => {\r\n            if( value !== void 0 ) return key;\r\n        });\r\n    }\r\n\r\n    // Get array of attribute values (Record) or records (Collection)\r\n    values() : any[] {\r\n        return this.map( value => value );\r\n    }\r\n    \r\n    /*********************************\r\n     * Validation API\r\n     */\r\n\r\n    // Lazily evaluated validation error\r\n    _validationError : ValidationError = void 0\r\n\r\n    // Validate ownership tree and return valudation error \r\n    get validationError() : ValidationError {\r\n        return this._validationError || ( this._validationError = new ValidationError( this ) );\r\n    }\r\n\r\n    // Validate nested members. Returns errors count.\r\n    abstract _validateNested( errors : ChildrenErrors ) : number\r\n\r\n    // Object-level validator. Returns validation error.\r\n    validate( obj? : Transactional ) : any {}\r\n\r\n    // Return validation error (or undefined) for nested object with the given key. \r\n    getValidationError( key : string ) : any {\r\n        var error = this.validationError;\r\n        return ( key ? error && error.nested[ key ] : error ) || null;\r\n    }\r\n\r\n    // Get validation error for the given symbolic reference.\r\n    deepValidationError( reference : string ) : any {\r\n        return resolveReference( this, reference, ( object, key ) => object.getValidationError( key ) );\r\n    }\r\n\r\n    // Iterate through all validation errors across the ownership tree.\r\n    eachValidationError( iteratee : ( error : any, key : string, object : Transactional ) => void ) : void {\r\n        const { validationError } = this;\r\n        validationError && validationError.eachError( iteratee, this );\r\n    }\r\n\r\n    // Check whenever member with a given key is valid. \r\n    isValid( key : string ) : boolean {\r\n        return !this.getValidationError( key );\r\n    }\r\n}\r\n\r\n// Owner must accept children update events. It's an only way children communicates with an owner.\r\nexport interface Owner extends Traversable {\r\n    _onChildrenChange( child : Transactional, options : TransactionOptions ) : void;\r\n    getOwner() : Owner\r\n    getStore() : Transactional\r\n}\r\n\r\n// Transaction object used for two-phase commit protocol.\r\n// Must be implemented by subclasses.\r\nexport interface Transaction {\r\n    // Object transaction is being made on.\r\n    object : Transactional\r\n\r\n    // Send out change events, process update triggers, and close transaction.\r\n    // Nested transactions must be marked with isNested flag (it suppress owner notification).\r\n    commit( options? : TransactionOptions, isNested? : boolean )\r\n}\r\n\r\n// Options for distributed transaction  \r\nexport interface TransactionOptions {\r\n    // Invoke parsing \r\n    parse? : boolean\r\n\r\n    // Suppress change notifications and update triggers\r\n    silent? : boolean\r\n\r\n    // Update existing transactional members in place, or skip the update (ignored by models)\r\n    merge? : boolean // =true\r\n\r\n    // Should collections remove elements in set (ignored by models)  \r\n    remove? : boolean // =true\r\n\r\n    // Always replace enclosed objects with new instances\r\n    reset? : boolean // = false\r\n\r\n    validate? : boolean\r\n}\r\n\r\n/**\r\n * Low-level transactions API. Must be used like this:\r\n * const isRoot = begin( record );\r\n * ...\r\n * isRoot && commit( record, options );\r\n * \r\n * When committing nested transaction, the flag must be set to true. \r\n * commit( object, options, isNested ) \r\n */\r\n\r\n// Start transaction. Return true if it's the root one.\r\nexport function begin( object : Transactional ) : boolean {\r\n    return object._transaction ? false : ( object._transaction = true );  \r\n}\r\n\r\n// Mark transactional object as dirty, so change event will be sent on commit.\r\nexport function markAsDirty( object : Transactional ){\r\n    object._isDirty  = true;\r\n    object._changeToken = {};\r\n    object._validationError = void 0;\r\n}\r\n\r\n// Commit transaction. Send out change event and notify owner. Returns true if there were changes.\r\n// Should be executed for the root transaction only.\r\nexport function commit( object : Transactional, options : TransactionOptions, isNested? : boolean ){\r\n    const wasDirty = object._isDirty;\r\n\r\n    if( options.silent ){\r\n        object._isDirty  = false;\r\n    }\r\n    else{\r\n        while( object._isDirty ){\r\n            object._isDirty = false; \r\n            trigger2( object, object._changeEventName, object, options );\r\n        }\r\n    }\r\n    \r\n    object._transaction = false;\r\n\r\n    // Don't notify owner for the case of nested transaction, it already knows if there were changes  \r\n    if( !isNested && wasDirty && object._owner ){\r\n        object._owner._onChildrenChange( object, options );\r\n    }\r\n}\r\n\r\n/************************************\r\n * Ownership management\r\n */\r\n\r\n// Add reference to the record.\r\nexport function aquire( owner : Owner, child : Transactional, key? : string ) : void {\r\n    if( !child._owner ){\r\n        child._owner = owner;\r\n        child._ownerKey = key;\r\n    }\r\n}\r\n\r\n// Remove reference to the record.\r\nexport function free( owner : Owner, child : Transactional ) : void {\r\n    if( owner === child._owner ){\r\n        child._owner = void 0;\r\n        child._ownerKey = void 0;\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/transactions.ts\n **/","export interface ChildrenErrors {\r\n    [ key : string ] : ValidationError | any\r\n} \r\n\r\nexport interface Validatable {\r\n    _validateNested( errors : ChildrenErrors ) : number;\r\n    validate( self : any ) : any\r\n    get( key : string ) : any\r\n}\r\n\r\n// Validation error object.\r\nexport class ValidationError {\r\n    // Invalid nested object keys \r\n    nested : ChildrenErrors \r\n    length : number\r\n\r\n    // Local error\r\n    error : any\r\n\r\n    constructor( obj : Validatable ){\r\n        this.length = obj._validateNested( this.nested = {} );\r\n\r\n        if( this.error = obj.validate( obj ) ){\r\n            this.length++;\r\n        }\r\n    }\r\n\r\n    each( iteratee : ( value : any, key : string ) => void ){\r\n        const { error, nested } = this;\r\n\r\n        if( error ) iteratee( error, null );\r\n\r\n        for( const key in nested ){\r\n            iteratee( nested[ key ], key );\r\n        }\r\n    }\r\n\r\n    eachError( iteratee : ( error : any, key : string, object : Validatable ) => void, object : Validatable ){\r\n        this.each( ( value, key ) => {\r\n            if( value instanceof ValidationError ){\r\n                value._traverse( iteratee, object.get( key ) );\r\n            }\r\n            else{\r\n                iteratee( value, key, object );\r\n            }\r\n        });\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/validation.ts\n **/","/**\r\n * Some sketches for reference resolution.\r\n *\r\n * \r\n * a : Model.from( '~collection' )\r\n * \r\n * We need two functions. One for get, and one for compile. \r\n */\r\nexport interface Traversable {\r\n    getStore() : Traversable\r\n    getOwner() : Traversable\r\n    get( key : string ) : any \r\n}\r\n\r\nconst referenceMask =  /\\~|\\^|([^.]+)/g;\r\n\r\n// Compile reference to function\r\nexport function compileReference( reference : string ) : ( root : any ) => any {\r\n    const path = reference\r\n                    .match( referenceMask )\r\n                    .map( key => key === '~' ? 'getStrore()' : ( key === '^' ? 'getOwner()' : key ) )\r\n                    .join( '.' );\r\n\r\n    return <any> new Function( 'self', `return self.${ path };` );          \r\n}\r\n\r\nexport function resolveReference( root : Traversable, reference : string, action : ( object, key : string ) => any ) : any {\r\n    const path = reference.match( referenceMask ),\r\n          skip = path.length - 1;\r\n    \r\n    let self = root;\r\n\r\n    for( var i = 0; i < skip; i++ ){\r\n        const key = path[ i ];\r\n        switch( key ){\r\n            case '~' : self = self.getStore(); break;\r\n            case '^' : self = self.getOwner(); break;\r\n            default  : self = self.get( key );\r\n        }\r\n\r\n        // Do nothing if object on the path doesn't exist.\r\n        if( !self ) return;\r\n    }\r\n\r\n    action( self, path[ skip ] );\r\n    return self;\r\n}\r\n\r\n// Construct object reference { a : { b : { c : 0 } } }\r\nexport function referenceToObject( reference, value ){\r\n    const path = reference.split( '.' ),\r\n          root = {},\r\n          last = path.length - 1;\r\n    let current = root;\r\n\r\n    for( let i = 0; i < last; i++ ){\r\n        current = current[ path[ i ] ] = {};\r\n    }\r\n\r\n    current[ path[ last ] ] = value;\r\n\r\n    return root;\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/references.ts\n **/","import { GenericAttribute } from './attribute.ts';\r\nimport { Attribute, AttributesValues, AttributeDescriptorMap, CloneAttributesCtor } from './transaction.ts'\r\nimport { defaults, isValidJSON, transform, log, EventHandlers } from '../objectplus/index.ts'\r\nimport { toAttributeDescriptor } from './typespec.ts'\r\n\r\nexport interface DynamicMixin {\r\n    _attributes : AttributesSpec\r\n    Attributes : CloneAttributesCtor\r\n    properties : PropertyDescriptorMap\r\n    forEach? : ForEach\r\n    defaults : Defaults\r\n    _toJSON : ToJSON\r\n    _parse : Parse\r\n    _listenToSelf : EventHandlers\r\n}\r\n\r\n// Refine AttributesSpec definition.\r\nexport interface AttributesSpec {\r\n    [ key : string ] : GenericAttribute\r\n}\r\n\r\ntype ForEach   = ( obj : {}, iteratee : ( val : any, key? : string, spec? : Attribute ) => void ) => void;\r\ntype Defaults  = ( attrs? : {} ) => {}\r\ntype Parse     = ( data : any ) => any;\r\ntype ToJSON    = () => any;\r\n\r\n// Compile attributes spec\r\nexport function compile( rawSpecs : AttributeDescriptorMap, baseAttributes : AttributesSpec ) : DynamicMixin {\r\n    const myAttributes = transform( <AttributesSpec>{}, rawSpecs, createAttribute ),\r\n          allAttributes = defaults( <AttributesSpec>{}, myAttributes, baseAttributes ),\r\n          Attributes = createCloneCtor( allAttributes ),\r\n          mixin : DynamicMixin = {\r\n            Attributes : Attributes,\r\n            _attributes : new Attributes( allAttributes ),\r\n            properties : transform( <PropertyDescriptorMap>{}, myAttributes, x => x.createPropertyDescriptor() ),\r\n            defaults : createDefaults( allAttributes ),\r\n            _toJSON : createToJSON( allAttributes ), // <- TODO: profile and check if there is any real benefit. I doubt it. \r\n            _parse : createParse( myAttributes, allAttributes ),\r\n            _listenToSelf : createEventMap( allAttributes )\r\n         };\r\n\r\n    // Enable optimized forEach if warnings are disabled.\r\n    if( log.level > 0 ){\r\n        mixin.forEach = createForEach( allAttributes );\r\n    }\r\n\r\n    return mixin;\r\n}\r\n\r\n// Create attribute from the type spec.\r\nfunction createAttribute( spec, name ){\r\n    return GenericAttribute.create( toAttributeDescriptor( spec ), name );\r\n}\r\n\r\n// Build events map for attribute change events.\r\nfunction createEventMap( attrSpecs : AttributesSpec ) : EventHandlers {\r\n    var events : EventHandlers = {};\r\n\r\n    for( var key in attrSpecs ){\r\n        const attribute = attrSpecs[ key ],\r\n            { _onChange } = attribute.options; \r\n\r\n        if( _onChange ){\r\n            events[ 'change:' + key ] = _onChange;\r\n        }\r\n    }\r\n\r\n    return events;\r\n}\r\n\r\nexport function createForEach( attrSpecs : AttributesSpec ) : ForEach {\r\n    let statements = [ 'var v, _a=this._attributes;' ];\r\n\r\n    for( let name in attrSpecs ){\r\n        statements.push( `( v = a.${name} ) === void 0 || f( v, \"${name}\", _a.${name} );` );\r\n    }\r\n\r\n    return <ForEach> new Function( 'a', 'f', statements.join( '' ) );\r\n}\r\n\r\nexport function createCloneCtor( attrSpecs : AttributesSpec ) : CloneAttributesCtor {\r\n    var statements = [];\r\n\r\n    for( let name in attrSpecs ){\r\n        statements.push( `this.${name} = x.${name};` );\r\n    }\r\n\r\n    var CloneCtor = new Function( \"x\", statements.join( '' ) );\r\n    CloneCtor.prototype = Object.prototype;\r\n    return <CloneAttributesCtor> CloneCtor;\r\n}\r\n\r\n// Create optimized model.defaults( attrs, options ) function\r\nfunction createDefaults( attrSpecs : AttributesSpec ) : Defaults {\r\n    let assign_f = ['var v;'], create_f = [];\r\n\r\n    function appendExpr( name, expr ){\r\n        assign_f.push( `this.${name} = ( v = a.${name} ) === void 0 ? ${expr} : v;` );\r\n        create_f.push( `this.${name} = ${expr};` );\r\n    }\r\n\r\n    // Compile optimized constructor function for efficient deep copy of JSON literals in defaults.\r\n    for( let name in attrSpecs ){\r\n        const attrSpec = attrSpecs[ name ],\r\n              { value, type } = attrSpec;\r\n\r\n        if( value === void 0 && type ){\r\n            // if type with no value is given, create an empty object\r\n            appendExpr( name, `i.${name}.create()` );//TODO: consider adding owner reference\r\n        }\r\n        else{\r\n            // If value is given, type casting logic will do the job later, converting value to the proper type.\r\n            if( isValidJSON( value ) ){\r\n                // JSON literals must be deep copied.\r\n                appendExpr( name, JSON.stringify( value ) );\r\n            }\r\n            else if( value === void 0 ){\r\n                // handle undefined value separately. Usual case for model ids.\r\n                appendExpr( name, 'void 0' );\r\n            }\r\n            else{\r\n                // otherwise, copy value by reference.\r\n                appendExpr( name, `i.${name}.value` );\r\n            }\r\n        }\r\n    }\r\n\r\n    const CreateDefaults : any = new Function( 'i', create_f.join( '' ) ),\r\n          AssignDefaults : any = new Function( 'a', 'i', assign_f.join( '' ) );\r\n\r\n    CreateDefaults.prototype = AssignDefaults.prototype = Object.prototype;\r\n\r\n    // Create model.defaults( attrs, options ) function\r\n    // 'attrs' will override default values, options will be passed to nested backbone types\r\n    return function( attrs? : {} ){ //TODO: Consider removing of the CreateDefaults. Currently is not used. May be used in Record costructor, though.\r\n        return attrs ? new AssignDefaults( attrs, this._attributes ) : new CreateDefaults( this._attributes );\r\n    }\r\n}\r\n\r\nfunction createParse( allAttrSpecs : AttributesSpec, attrSpecs : AttributesSpec ) : Parse {\r\n    var statements = [ 'var a=this._attributes;' ],\r\n        create     = false;\r\n\r\n    for( let name in allAttrSpecs ){\r\n        const local = attrSpecs[ name ];\r\n\r\n        // Is there any 'parse' option in local model definition?\r\n        if( local && local.parse ) create = true;\r\n\r\n        // Add statement for each attribute with 'parse' option.\r\n        if( allAttrSpecs[ name ].parse ){\r\n            const s = `r.${name} === void 0 ||( r.${name} = a.${name}.parse.call( this, r.${name}, \"${name}\") );`;\r\n            statements.push( s );\r\n        }\r\n    }\r\n\r\n    if( create ){\r\n        statements.push( 'return r;' );\r\n        return <any> new Function( 'r', statements.join( '' ) );\r\n    }\r\n }\r\n\r\nfunction createToJSON( attrSpecs : AttributesSpec ) : ToJSON {\r\n    let statements = [ `var json = {},v=this.attributes,a=this._attributes;` ];\r\n\r\n    for( let key in attrSpecs ){\r\n        const toJSON = attrSpecs[ key ].toJSON;\r\n\r\n        if( toJSON ){\r\n            statements.push( `json.${key} = a.${key}.toJSON.call( this, v.${ key }, '${key}' );` );\r\n        }\r\n    }\r\n\r\n    statements.push( `return json;` );\r\n\r\n    return <any> new Function( statements.join( '' ) );\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/record/define.ts\n **/","import { setAttribute, Record, Attribute, Transform, ChangeHandler, AttributeDescriptor } from './transaction.ts'\r\nimport { notEqual, assign, Constructor } from '../objectplus/index.ts'\r\n\r\nimport { Owner, Transactional, TransactionOptions } from '../transactions.ts'\r\n\r\ntype GetHook = ( value : any, key : string ) => any;\r\nexport type ChangeAttrHandler = ( ( value : any, attr : string ) => void ) | string;\r\n\r\ndeclare global {\r\n    interface Function {\r\n        _attribute : typeof GenericAttribute\r\n    }\r\n}\r\n\r\n// TODO: interface differs from options, do something obout it\r\nexport class GenericAttribute implements Attribute {\r\n    // Factory method to create attribute from options \r\n    static create( options : AttributeDescriptor, name : string ) : GenericAttribute {\r\n        const type = options.type,\r\n              AttributeCtor = type ? type._attribute : GenericAttribute;\r\n\r\n        return new AttributeCtor( name, options );\r\n    }\r\n    /**\r\n     * Update pipeline functions\r\n     * =========================\r\n     *\r\n     * Stage 0. canBeUpdated( value )\r\n     * - presence of this function implies attribute's ability to update in place.\r\n     */\r\n     canBeUpdated( prev, next ) : boolean {\r\n         return false;\r\n     }\r\n\r\n    /**\r\n     * Stage 1. Transform stage\r\n     */\r\n    transform( value, options, prev, model ) { return value; }\r\n\r\n    // convert attribute type to `this.type`\r\n    convert( value, options, model ) { return value; }\r\n\r\n    /**\r\n     * Stage 2. Check if attr value is changed\r\n     */\r\n    isChanged( a, b ) {\r\n        return notEqual( a, b );\r\n    }\r\n\r\n    /**\r\n     * Stage 3. Handle attribute change\r\n     */\r\n    handleChange( next, prev, model ) {}\r\n\r\n    /**\r\n     * End update pipeline definitions.\r\n     */\r\n\r\n    // create empty object passing backbone options to constructor...\r\n    create() { return new ( <any>this.type )(); }\r\n\r\n    // generic clone function for typeless attributes\r\n    // Must be overriden in sublass\r\n    clone( value, options : { deep? : boolean } = {} ) {\r\n        if( value && typeof value === 'object' ) {\r\n            // delegate to object's clone(), if it exist...\r\n            if( value.clone ) {\r\n                return value.clone( options );\r\n            }\r\n\r\n            if( options.deep ){\r\n                const proto = Object.getPrototypeOf( value );\r\n\r\n                // attempt to deep copy raw objects, assuming they are JSON\r\n                if( proto === Object.prototype || proto === Array.prototype ){\r\n                    return JSON.parse( JSON.stringify( value ) );\r\n                }\r\n            }\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    validate( record : Record, value : any, key : string ){}\r\n\r\n    toJSON( value, key ) {\r\n        return value && value.toJSON ? value.toJSON() : value;\r\n    }\r\n\r\n    createPropertyDescriptor() : PropertyDescriptor | void {\r\n        const { name, getHook } = this;\r\n\r\n        if( name !== 'id' ){\r\n            return {\r\n                // call to optimized set function for single argument.\r\n                set( value ){\r\n                    setAttribute( <any>this, name, value );\r\n                },\r\n\r\n                // attach get hook to the getter function, if present\r\n                get : getHook ?\r\n                      function() {\r\n                          return getHook.call( this, this.attributes[ name ], name );\r\n                      } :\r\n                      function() {\r\n                          return this.attributes[ name ];\r\n                      }\r\n            }\r\n        }\r\n    }\r\n\r\n    value : any\r\n    type : Constructor< any >\r\n\r\n    parse : ( value, key : string ) => any\r\n\r\n    initialize( name : string, options ){}\r\n\r\n    constructor( public name : string, public options : AttributeDescriptor ) {\r\n        const {\r\n                  value, type, parse, toJSON,\r\n                  getHooks = [],\r\n                  transforms = [],\r\n                  changeHandlers = []\r\n              } = options;\r\n\r\n        this.value = value;\r\n        this.type  = type;\r\n\r\n        this.parse  = parse;\r\n        this.toJSON = toJSON === void 0 ? this.toJSON : toJSON;\r\n\r\n        /**\r\n         * Assemble pipelines...\r\n         */\r\n\r\n        // `convert` is default transform, which is always present...\r\n        transforms.unshift( this.convert );\r\n\r\n        // Get hook from the attribute will be used first...\r\n        if( this.get ) getHooks.unshift( this.get );\r\n\r\n        // let subclasses configure the pipeline...\r\n        this.initialize.apply( this, arguments );\r\n\r\n        // let attribute spec configure the pipeline...\r\n        if( getHooks.length ){\r\n            this.getHook = getHooks.reduce( chainGetHooks );\r\n        }\r\n        \r\n        if( transforms.length ){\r\n            this.transform = transforms.reduce( chainTransforms );\r\n        }\r\n        \r\n        if( changeHandlers.length ){\r\n            this.handleChange = changeHandlers.reduce( chainChangeHandlers );\r\n        }\r\n    }\r\n\r\n    getHook : ( value, key : string ) => any = null\r\n    get : ( value, key : string ) => any\r\n}\r\n\r\nfunction chainChangeHandlers( prev : ChangeHandler, next : ChangeHandler ) : ChangeHandler {\r\n    return function( next, prev, model ) {\r\n        prev.call( this, next, prev, model );\r\n        next.call( this, next, prev, model );\r\n    }\r\n}\r\n\r\nfunction chainGetHooks( prev : GetHook, next : GetHook ) : GetHook {\r\n    return function( value, name ) {\r\n        return next.call( prev.call( value, name ), name );\r\n    }\r\n}\r\n\r\nfunction chainTransforms( prev : Transform, next : Transform ) : Transform {\r\n    return function( value, options, prev, model ) {\r\n        return next.call( this, prev.call( this, value, options, prev, model ), options, prev, model );\r\n    }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/record/attribute.ts\n **/","import { Record } from './transaction.ts' \r\nimport { GenericAttribute } from './attribute.ts'\r\nimport { Owner, Transactional, TransactionOptions, TransactionalConstructor } from '../transactions.ts' \r\n\r\nexport class TransactionalType extends GenericAttribute {\r\n    type : TransactionalConstructor\r\n\r\n    canBeUpdated( prev : Transactional, next : any ) : boolean {\r\n        // If an object already exists, and new value is of incompatible type, let object handle the update.\r\n        return prev && next && !( next instanceof this.type );\r\n    }\r\n\r\n    convert( value : any, options : TransactionOptions, record : Record ) : Transactional {\r\n        // Invoke class factory to handle abstract classes\r\n        return value == null || value instanceof this.type ? value : this.type.create( value, options, record );\r\n    }\r\n\r\n    create() : Transactional {\r\n        return new (<any>this.type)(); // this the subclass of Transactional here.\r\n    }\r\n\r\n    handleChange( next : Transactional, prev : Transactional, record : Record ){\r\n        // Remove reference to self\r\n        if( prev && prev._owner === record ){\r\n            prev._ownerKey = prev._owner = null;\r\n        } \r\n\r\n        // Take ownership if possible\r\n        if( next && !next._owner ){\r\n            next._owner = record;\r\n            next._ownerKey = this.name;\r\n        }\r\n    }\r\n}\r\n\r\nRecord._attribute = TransactionalType;\n\n\n/** WEBPACK FOOTER **\n ** ./src/record/nestedTypes.ts\n **/","import { GenericAttribute } from './attribute.ts'\r\nimport { parseDate } from '../objectplus/index.ts'\r\n\r\n// Default attribute type for all constructor functions...\r\nclass ConstructorType extends GenericAttribute {\r\n    type : new ( value : any ) => {}\r\n\r\n    convert( value ) {\r\n        return value == null || value instanceof this.type ? value : new this.type( value );\r\n    }\r\n\r\n    clone( value, options ) {\r\n        // delegate to clone function or deep clone through serialization\r\n        return value.clone ? value.clone( value, options ) : this.convert( JSON.parse( JSON.stringify( value ) ) );\r\n    }\r\n}\r\n\r\nFunction.prototype._attribute = ConstructorType;\r\n\r\n// Date Attribute\r\nclass DateType extends GenericAttribute {\r\n    convert( value ) {\r\n        return value == null || value instanceof Date ? value :\r\n               new Date( typeof value === 'string' ? parseDate( value ) : value );\r\n    }\r\n\r\n    validate( model, value, name ) {\r\n        if( isNaN( +value ) ) return name + ' is Invalid Date';\r\n    }\r\n\r\n    toJSON( value ) { return value && value.toJSON(); }\r\n\r\n    isChanged( a, b ) { return ( a && +a ) !== ( b && +b ); }\r\n\r\n    clone( value ) { return value && new Date( +value ); }\r\n}\r\n\r\nDate._attribute = DateType;\r\n\r\n// Primitive Types.\r\nexport class PrimitiveType extends GenericAttribute {\r\n    type : NumberConstructor | StringConstructor | BooleanConstructor\r\n\r\n    create() { return this.type(); }\r\n\r\n    toJSON( value ) { return value; }\r\n\r\n    convert( value ) { return value == null ? value : this.type( value ); }\r\n\r\n    isChanged( a, b ) { return a !== b; }\r\n\r\n    clone( value ) { return value; }\r\n}\r\n\r\nBoolean._attribute = String._attribute = PrimitiveType;\r\n\r\n// Number type with special validation algothim. \r\nexport class NumericType extends PrimitiveType {\r\n    type : NumberConstructor\r\n\r\n    validate( model, value, name ) {\r\n        // Whatever is not symmetrically serializable to JSON, is not valid by default.\r\n        if( !isFinite( value ) ) {\r\n            return name + ' is not valid number';\r\n        }\r\n    }\r\n}\r\n\r\nNumber._attribute = NumericType;\r\n\r\n// Add global Integer data type\r\ndeclare global {\r\n    interface Window {\r\n        Integer : Function\r\n    }\r\n}\r\n\r\nif( window ){\r\n    window.Integer = function( x ){ return x ? Math.round( x ) : 0; }\r\n    window.Integer._attribute = NumericType;\r\n}\r\n\r\n// Compatibility wrapper for Array type.\r\nexport class ArrayType extends GenericAttribute {\r\n    toJSON( value ) { return value; }\r\n\r\n    convert( value ) {\r\n        // Fix incompatible constructor behaviour of Array...\r\n        if( value == null || value instanceof Array ) return value;\r\n\r\n        // todo: log an error.\r\n        return [];\r\n    }\r\n}\r\n\r\nArray._attribute = ArrayType;\n\n\n/** WEBPACK FOOTER **\n ** ./src/record/basicTypes.ts\n **/","/**\r\n * Type spec engine. Declare attributes using chainable syntax,\r\n * and returns object with spec.\r\n */\r\n\r\nimport { ChangeAttrHandler } from './attribute.ts'\r\nimport { AttributeDescriptor, Record } from './transaction.ts'\r\nimport { assign, EventHandlers, Constructor } from '../objectplus/index.ts'\r\n\r\nexport class ChainableAttributeSpec {\r\n    options : AttributeDescriptor;\r\n\r\n    constructor( options : AttributeDescriptor = {} ) {\r\n        this.options = { getHooks : [], transforms : [], changeHandlers : []};\r\n        assign( this.options, options );\r\n    }\r\n\r\n    // Attribute get hook.\r\n    get( fun ) {\r\n        this.options.getHooks.push( fun );\r\n    }\r\n\r\n    // Attribute set hook.\r\n    set( fun ) {\r\n        this.options.transforms.push( function( next, options, prev, model ) {\r\n            if( this.isChanged( next, prev ) ) {\r\n                var changed = fun.call( model, next, name );\r\n                return changed === void 0 ? prev : changed;\r\n            }\r\n\r\n            return prev;\r\n        } );\r\n    }\r\n\r\n    // Subsribe to events from an attribute.\r\n    events( map : EventHandlers ){\r\n        this.options.changeHandlers.push( function( next, prev, record : Record ){\r\n                prev && record.stopListening( prev );\r\n\r\n                next && record.listenTo( next, map );\r\n            });\r\n    }\r\n\r\n    // Subscribe for a change event from an attribute.\r\n    onChange( handler : ChangeAttrHandler ){\r\n        this.options._onChange = handler;\r\n    }\r\n\r\n    get has() { return this; }\r\n\r\n    /*\r\n    get isRequired() {\r\n        this.options.isRequired = true;\r\n        return this;\r\n    }*/\r\n\r\n    value( x ) { this.options.value = x; }\r\n}\r\n\r\ndeclare global {\r\n    interface Function{\r\n        value : ( x : any ) => ChainableAttributeSpec;\r\n        isRequired : ChainableAttributeSpec;\r\n        has : ChainableAttributeSpec;\r\n    }\r\n}\r\n\r\nFunction.prototype.value = function( x ) {\r\n    return new ChainableAttributeSpec( { type : this, value : x } );\r\n};\r\n\r\n/*\r\nObject.defineProperty( Function.prototype, 'isRequired', {\r\n    get() {\r\n        return new ChainableAttributeSpec( { type : this, isRequired : true } );\r\n    } \r\n});*/\r\n\r\nObject.defineProperty( Function.prototype, 'has', {\r\n    get() {\r\n        // workaround for sinon.js and other libraries overriding 'has'\r\n        return this._has || new ChainableAttributeSpec( { type : this } );\r\n    },\r\n\r\n    set( value ) { this._has = value; }\r\n} );\r\n\r\nexport function toAttributeDescriptor( spec : any ) : AttributeDescriptor {\r\n    if( typeof spec === 'function' ) {\r\n        return { type : <any> spec };\r\n    }\r\n\r\n    if( spec && spec instanceof ChainableAttributeSpec ) {\r\n        return spec.options;\r\n    }\r\n \r\n    return {\r\n        type : inferType( spec ),\r\n        value : spec\r\n    }\r\n}\r\n\r\nfunction inferType( value : {} ) : Constructor<any> {\r\n    switch( typeof value ) {\r\n        case 'number' :\r\n            return Number;\r\n        case 'string' :\r\n            return String;\r\n        case 'boolean' :\r\n            return Boolean;\r\n        case 'undefined' :\r\n            return void 0;\r\n        case 'object' :\r\n            return value ? <any> value.constructor : Object;\r\n    }\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/record/typespec.ts\n **/"],"sourceRoot":""}